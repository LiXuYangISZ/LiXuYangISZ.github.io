<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>å…«ã€ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ– | Leoçš„åšå®¢</title><meta name="author" content="Leo"><meta name="copyright" content="Leo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="éƒ½æœ‰å“ªäº›çº¬åº¦å¯ä»¥è¿›è¡Œæ•°æ®åº“è°ƒä¼˜ï¼Ÿç®€è¨€ä¹‹ï¼š  ç´¢å¼•å¤±æ•ˆã€æ²¡æœ‰å……åˆ†åˆ©ç”¨æ‰€ä»¥â€”â€”ç´¢å¼•å»ºç«‹ å…³è”æŸ¥è¯¢å¤ªå¤š JOINï¼ˆè®¾è®¡ç¼ºé™·æˆ–ä¸å¾—å·²çš„éœ€æ±‚ï¼‰â€”â€”SQL ä¼˜åŒ– æœåŠ¡å™¨è°ƒä¼˜åŠå„ä¸ªå‚æ•°è®¾ç½®ï¼ˆç¼“å†²ã€ çº¿ç¨‹æ•°ï¼‰â€”â€”è°ƒæ•´ my.cnf æ•°æ®è¿‡å¤šâ€”â€”åˆ†åº“åˆ†è¡¨  å…³äºæ•°æ®åº“è°ƒä¼˜çš„çŸ¥è¯†ç‚¹éå¸¸åˆ†æ•£ï¼Œä¸åŒ DBMSï¼Œä¸åŒçš„å…¬å¸ï¼Œä¸åŒçš„èŒä½ï¼Œä¸åŒçš„é¡¹ç›®é‡åˆ°çš„é—®é¢˜éƒ½ä¸å°½ç›¸åŒã€‚ è™½ç„¶ SQL æŸ¥è¯¢ä¼˜åŒ–çš„æŠ€æœ¯å¾ˆå¤šï¼Œä½†æ˜¯å¤§ä½“æ–¹å‘ä¸Šå®Œå…¨å¯">
<meta property="og:type" content="article">
<meta property="og:title" content="å…«ã€ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–">
<meta property="og:url" content="https://blog.dalicoding.fun/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC08%E7%AB%A0_%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%B8%8E%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/index.html">
<meta property="og:site_name" content="Leoçš„åšå®¢">
<meta property="og:description" content="éƒ½æœ‰å“ªäº›çº¬åº¦å¯ä»¥è¿›è¡Œæ•°æ®åº“è°ƒä¼˜ï¼Ÿç®€è¨€ä¹‹ï¼š  ç´¢å¼•å¤±æ•ˆã€æ²¡æœ‰å……åˆ†åˆ©ç”¨æ‰€ä»¥â€”â€”ç´¢å¼•å»ºç«‹ å…³è”æŸ¥è¯¢å¤ªå¤š JOINï¼ˆè®¾è®¡ç¼ºé™·æˆ–ä¸å¾—å·²çš„éœ€æ±‚ï¼‰â€”â€”SQL ä¼˜åŒ– æœåŠ¡å™¨è°ƒä¼˜åŠå„ä¸ªå‚æ•°è®¾ç½®ï¼ˆç¼“å†²ã€ çº¿ç¨‹æ•°ï¼‰â€”â€”è°ƒæ•´ my.cnf æ•°æ®è¿‡å¤šâ€”â€”åˆ†åº“åˆ†è¡¨  å…³äºæ•°æ®åº“è°ƒä¼˜çš„çŸ¥è¯†ç‚¹éå¸¸åˆ†æ•£ï¼Œä¸åŒ DBMSï¼Œä¸åŒçš„å…¬å¸ï¼Œä¸åŒçš„èŒä½ï¼Œä¸åŒçš„é¡¹ç›®é‡åˆ°çš„é—®é¢˜éƒ½ä¸å°½ç›¸åŒã€‚ è™½ç„¶ SQL æŸ¥è¯¢ä¼˜åŒ–çš„æŠ€æœ¯å¾ˆå¤šï¼Œä½†æ˜¯å¤§ä½“æ–¹å‘ä¸Šå®Œå…¨å¯">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg">
<meta property="article:published_time" content="2024-04-05T06:24:07.000Z">
<meta property="article:modified_time" content="2024-04-05T07:08:23.052Z">
<meta property="article:author" content="Leo">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.dalicoding.fun/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC08%E7%AB%A0_%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%B8%8E%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"00PKU8B7R6","apiKey":"058cbcb1db57036717778c874da0ef87","indexName":"blog-leo","hits":{"per_page":10},"languages":{"input_placeholder":"æœç´¢æ–‡ç« ","hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œç”¨æ—¶ ${time} æ¯«ç§’"}},
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":50,"languages":{"author":"ä½œè€…: Leo","link":"é“¾æ¥: ","source":"æ¥æº: Leoçš„åšå®¢","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'å…«ã€ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-05 15:08:23'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/center-atom.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403221853832.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> æ¸…å•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Leoçš„åšå®¢"><img class="site-icon" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202404041655130.png"/><span class="site-name">Leoçš„åšå®¢</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> æ¸…å•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">å…«ã€ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-04-05T06:24:07.000Z" title="å‘è¡¨äº 2024-04-05 14:24:07">2024-04-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-04-05T07:08:23.052Z" title="æ›´æ–°äº 2024-04-05 15:08:23">2024-04-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">21.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>75åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="å…«ã€ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>éƒ½æœ‰å“ªäº›çº¬åº¦å¯ä»¥è¿›è¡Œæ•°æ®åº“è°ƒä¼˜ï¼Ÿç®€è¨€ä¹‹ï¼š</p>
<ul>
<li>ç´¢å¼•å¤±æ•ˆã€æ²¡æœ‰å……åˆ†åˆ©ç”¨æ‰€ä»¥â€”â€”<strong>ç´¢å¼•å»ºç«‹</strong></li>
<li>å…³è”æŸ¥è¯¢å¤ªå¤š JOINï¼ˆè®¾è®¡ç¼ºé™·æˆ–ä¸å¾—å·²çš„éœ€æ±‚ï¼‰â€”â€”<strong>SQL ä¼˜åŒ–</strong></li>
<li>æœåŠ¡å™¨è°ƒä¼˜åŠå„ä¸ªå‚æ•°è®¾ç½®ï¼ˆç¼“å†²ã€ çº¿ç¨‹æ•°ï¼‰â€”â€”<strong>è°ƒæ•´ my.cnf</strong></li>
<li>æ•°æ®è¿‡å¤šâ€”â€”<strong>åˆ†åº“åˆ†è¡¨</strong></li>
</ul>
<p>å…³äºæ•°æ®åº“è°ƒä¼˜çš„çŸ¥è¯†ç‚¹éå¸¸åˆ†æ•£ï¼Œä¸åŒ DBMSï¼Œä¸åŒçš„å…¬å¸ï¼Œä¸åŒçš„èŒä½ï¼Œä¸åŒçš„é¡¹ç›®é‡åˆ°çš„é—®é¢˜éƒ½ä¸å°½ç›¸åŒã€‚</p>
<p>è™½ç„¶ SQL æŸ¥è¯¢ä¼˜åŒ–çš„æŠ€æœ¯å¾ˆå¤šï¼Œä½†æ˜¯å¤§ä½“æ–¹å‘ä¸Šå®Œå…¨å¯ä»¥åˆ†ä¸º <code>ç‰©ç†æŸ¥è¯¢ä¼˜åŒ–</code> å’Œ <code>é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–</code> ä¸¤å¤§å—ã€‚</p>
<ul>
<li>ç‰©ç†æŸ¥è¯¢ä¼˜åŒ–æ˜¯é€šè¿‡ <code>ç´¢å¼•</code> å’Œ <code>è¡¨è¿æ¥æ–¹å¼</code> ç­‰æŠ€æœ¯æ¥è¿›è¡Œä¼˜åŒ–ï¼Œè¿™é‡Œé‡ç‚¹éœ€è¦æŒæ¡ç´¢å¼•çš„ä½¿ç”¨</li>
<li>é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–å°±æ˜¯é€šè¿‡ SQL <code>ç­‰ä»·å˜æ¢</code> æå‡æŸ¥è¯¢æ•ˆç‡ï¼Œç›´ç™½ä¸€ç‚¹æ¥è®²å°±æ˜¯ï¼Œæ¢ä¸€ç§æ‰§è¡Œæ•ˆç‡æ›´é«˜çš„æŸ¥è¯¢å†™æ³•</li>
</ul>
<h2 id="1-æ•°æ®å‡†å¤‡"><a href="#1-æ•°æ®å‡†å¤‡" class="headerlink" title="1. æ•°æ®å‡†å¤‡"></a>1. æ•°æ®å‡†å¤‡</h2><p>å­¦å‘˜è¡¨æ’50ä¸‡æ¡ï¼Œ ç­çº§è¡¨æ’1ä¸‡æ¡ã€‚</p>
<p><strong><font color=blue>æ­¥éª¤1ï¼šå»ºè¡¨</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#ç­çº§è¡¨</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `class` (</span><br><span class="line">`id` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`className` <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`address` <span class="type">VARCHAR</span>(<span class="number">40</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`monitor` <span class="type">INT</span> <span class="keyword">NULL</span> ,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line">#å­¦å‘˜è¡¨</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `student` (</span><br><span class="line">`id` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`stuno` <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">`name` <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`age` <span class="type">INT</span>(<span class="number">3</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`classId` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">#<span class="keyword">CONSTRAINT</span> `fk_class_id` <span class="keyword">FOREIGN</span> KEY (`classId`) <span class="keyword">REFERENCES</span> `t_class` (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>æ­¥éª¤2ï¼šè®¾ç½®å‚æ•°</font></strong></p>
<p>å‘½ä»¤å¼€å¯ï¼šå…è®¸åˆ›å»ºå‡½æ•°è®¾ç½®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_bin_trust_function_creators<span class="operator">=</span><span class="number">1</span>;   </span><br><span class="line"># ä¸åŠ <span class="keyword">global</span>åªæ˜¯å½“å‰çª—å£æœ‰æ•ˆã€‚</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>æ­¥éª¤3ï¼šåˆ›å»ºå‡½æ•°</font></strong></p>
<p>éšæœºäº§ç”Ÿå­—ç¬¦ä¸²ï¼Œä¿è¯æ¯æ¡æ•°æ®éƒ½ä¸åŒã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#éšæœºäº§ç”Ÿå­—ç¬¦ä¸²</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_string(n <span class="type">INT</span>) <span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line"><span class="keyword">BEGIN</span>  </span><br><span class="line"><span class="keyword">DECLARE</span> chars_str <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span></span><br><span class="line"><span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> return_str <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">WHILE i <span class="operator">&lt;</span> n DO </span><br><span class="line"><span class="keyword">SET</span> return_str <span class="operator">=</span>CONCAT(return_str,<span class="built_in">SUBSTRING</span>(chars_str,<span class="built_in">FLOOR</span>(<span class="number">1</span><span class="operator">+</span>RAND()<span class="operator">*</span><span class="number">52</span>),<span class="number">1</span>)); </span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> WHILE;</span><br><span class="line"><span class="keyword">RETURN</span> return_str;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">#å‡å¦‚è¦åˆ é™¤</span><br><span class="line">#<span class="keyword">drop</span> <span class="keyword">function</span> rand_string;</span><br></pre></td></tr></table></figure>

<p>éšæœºäº§ç”Ÿç­çº§ç¼–å·</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#ç”¨äºéšæœºäº§ç”Ÿå¤šå°‘åˆ°å¤šå°‘çš„ç¼–å·</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_num (from_num <span class="type">INT</span> ,to_num <span class="type">INT</span>) <span class="keyword">RETURNS</span> <span class="type">INT</span>(<span class="number">11</span>)</span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; </span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> <span class="built_in">FLOOR</span>(from_num <span class="operator">+</span>RAND()<span class="operator">*</span>(to_num <span class="operator">-</span> from_num<span class="operator">+</span><span class="number">1</span>))  ;</span><br><span class="line"><span class="keyword">RETURN</span> i; </span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">#å‡å¦‚è¦åˆ é™¤</span><br><span class="line">#<span class="keyword">drop</span> <span class="keyword">function</span> rand_num;</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>æ­¥éª¤4ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹</font></strong></p>
<p>åˆ›å»ºå¾€stuè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºå¾€stuè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_stu(  <span class="keyword">START</span> <span class="type">INT</span> , max_num <span class="type">INT</span> )</span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line">	<span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; </span><br><span class="line">	<span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;   #è®¾ç½®æ‰‹åŠ¨æäº¤äº‹åŠ¡</span><br><span class="line">	REPEAT  #å¾ªç¯</span><br><span class="line">	<span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;  #èµ‹å€¼</span><br><span class="line">	<span class="keyword">INSERT</span> <span class="keyword">INTO</span> student (stuno, name ,age ,classId ) <span class="keyword">VALUES</span></span><br><span class="line">	((<span class="keyword">START</span><span class="operator">+</span>i),rand_string(<span class="number">6</span>),rand_num(<span class="number">1</span>,<span class="number">50</span>),rand_num(<span class="number">1</span>,<span class="number">1000</span>)); </span><br><span class="line">	UNTIL i <span class="operator">=</span> max_num </span><br><span class="line">	<span class="keyword">END</span> REPEAT; </span><br><span class="line">	<span class="keyword">COMMIT</span>;  #æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">#å‡å¦‚è¦åˆ é™¤</span><br><span class="line">#<span class="keyword">drop</span> <span class="keyword">PROCEDURE</span> insert_stu;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå¾€classè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€classè¡¨æ·»åŠ éšæœºæ•°æ®</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> `insert_class`( max_num <span class="type">INT</span> )</span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line">	<span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; </span><br><span class="line">	<span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">	REPEAT </span><br><span class="line">	<span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>; </span><br><span class="line">	<span class="keyword">INSERT</span> <span class="keyword">INTO</span> class ( classname,address,monitor ) <span class="keyword">VALUES</span></span><br><span class="line">	(rand_string(<span class="number">8</span>),rand_string(<span class="number">10</span>),rand_num(<span class="number">1</span>,<span class="number">100000</span>)); </span><br><span class="line">	UNTIL i <span class="operator">=</span> max_num </span><br><span class="line">	<span class="keyword">END</span> REPEAT; </span><br><span class="line">	<span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">#å‡å¦‚è¦åˆ é™¤</span><br><span class="line">#<span class="keyword">drop</span> <span class="keyword">PROCEDURE</span> insert_class;</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>æ­¥éª¤5ï¼šè°ƒç”¨å­˜å‚¨è¿‡ç¨‹</font></strong></p>
<p>å¾€classè¡¨æ·»åŠ 1ä¸‡æ¡æ•°æ® </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€classè¡¨æ·»åŠ <span class="number">1</span>ä¸‡æ¡æ•°æ® </span><br><span class="line"><span class="keyword">CALL</span> insert_class(<span class="number">10000</span>);</span><br></pre></td></tr></table></figure>

<p>å¾€stuè¡¨æ·»åŠ 50ä¸‡æ¡æ•°æ®,è¿™ä¸ªæ—¶é—´ä¼šç¨å¾®æœ‰ç‚¹é•¿ï¼Œè¯·è€å¿ƒç­‰å¾…å“Ÿ~</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€stuè¡¨æ·»åŠ <span class="number">80</span>ä¸‡æ¡æ•°æ® </span><br><span class="line"><span class="keyword">CALL</span> insert_stu(<span class="number">100000</span>,<span class="number">800000</span>);</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢ä¸‹æ•°æ®æ˜¯å¦æ’å…¥æˆåŠŸ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> class;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> student;</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>æ­¥éª¤6ï¼šåˆ é™¤æŸè¡¨ä¸Šçš„ç´¢å¼•</font></strong></p>
<p>åˆ›å»ºåˆ é™¤ç´¢å¼•å­˜å‚¨è¿‡ç¨‹ã€‚è¿™æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬çš„å­¦ä¹ ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ¼”ç¤ºæŸä¸ªç´¢å¼•çš„æ•ˆæœæ—¶ï¼Œå¯èƒ½éœ€è¦åˆ é™¤å…¶å®ƒç´¢å¼•ï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªä¸ªæ‰‹å·¥åˆ é™¤ï¼Œå°±å¤ªè´¹åŠ²äº†ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span>  <span class="keyword">PROCEDURE</span> `proc_drop_index`(dbname <span class="type">VARCHAR</span>(<span class="number">200</span>),tablename <span class="type">VARCHAR</span>(<span class="number">200</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">DECLARE</span> ct <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">DECLARE</span> _index <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">   <span class="keyword">DECLARE</span> _cur <span class="keyword">CURSOR</span> <span class="keyword">FOR</span>  <span class="keyword">SELECT</span>  index_name  <span class="keyword">FROM</span></span><br><span class="line">information_schema.STATISTICS  <span class="keyword">WHERE</span> table_schema<span class="operator">=</span>dbname <span class="keyword">AND</span> table_name<span class="operator">=</span>tablename <span class="keyword">AND</span></span><br><span class="line">seq_in_index<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span>  index_name <span class="operator">&lt;&gt;</span><span class="string">&#x27;PRIMARY&#x27;</span> ;</span><br><span class="line">#æ¯ä¸ªæ¸¸æ ‡å¿…é¡»ä½¿ç”¨ä¸åŒçš„<span class="keyword">declare</span> continue handler <span class="keyword">for</span> <span class="keyword">not</span> found <span class="keyword">set</span> done<span class="operator">=</span><span class="number">1</span>æ¥æ§åˆ¶æ¸¸æ ‡çš„ç»“æŸ</span><br><span class="line">   <span class="keyword">DECLARE</span>  CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">set</span> done<span class="operator">=</span><span class="number">2</span> ;   </span><br><span class="line">#è‹¥æ²¡æœ‰æ•°æ®è¿”å›,ç¨‹åºç»§ç»­,å¹¶å°†å˜é‡doneè®¾ä¸º<span class="number">2</span></span><br><span class="line">    <span class="keyword">OPEN</span> _cur;</span><br><span class="line">    <span class="keyword">FETCH</span> _cur <span class="keyword">INTO</span> _index;</span><br><span class="line">    WHILE _index<span class="operator">&lt;&gt;</span><span class="string">&#x27;&#x27;</span> DO</span><br><span class="line">       <span class="keyword">SET</span> <span class="variable">@str</span> <span class="operator">=</span> CONCAT(&quot;drop index &quot; , _index , &quot; on &quot; , tablename );</span><br><span class="line">       <span class="keyword">PREPARE</span> sql_str <span class="keyword">FROM</span> <span class="variable">@str</span> ;</span><br><span class="line">       <span class="keyword">EXECUTE</span> sql_str;</span><br><span class="line">       <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> sql_str;</span><br><span class="line">       <span class="keyword">SET</span> _index<span class="operator">=</span><span class="string">&#x27;&#x27;</span>;</span><br><span class="line">       <span class="keyword">FETCH</span> _cur <span class="keyword">INTO</span> _index;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line"> <span class="keyword">CLOSE</span> _cur;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> proc_drop_index(&quot;dbname&quot;,&quot;tablename&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="2-ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹"><a href="#2-ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹" class="headerlink" title="2. ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹"></a>2. ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹</h2><p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301613943.png" alt="image-20220816104223377"></p>
<h3 id="2-1-å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±"><a href="#2-1-å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±" class="headerlink" title="2.1 å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±"></a>2.1 å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±</h3><p><strong><font color=red>å…¨å€¼åŒ¹é…å¯ä»¥å……åˆ†çš„åˆ©ç”¨ç»„åˆç´¢å¼•~</font></strong> </p>
<p>ç³»ç»Ÿä¸­ç»å¸¸å‡ºç°çš„sqlè¯­å¥å¦‚ä¸‹ï¼Œå½“æ²¡æœ‰å»ºç«‹ç´¢å¼•æ—¶ï¼Œ<code>possible_keys</code>å’Œ<code>key</code>éƒ½ä¸ºNULL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># SQL_NO_CACHEè¡¨ç¤ºä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">30</span>;</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> classId<span class="operator">=</span><span class="number">4</span>;</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> classId<span class="operator">=</span><span class="number">4</span> <span class="keyword">AND</span> NAME <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶æ‰§è¡ŒSQLï¼Œæ•°æ®æŸ¥è¯¢é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ï¼Œè€—æ—¶0.12s</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> classId<span class="operator">=</span><span class="number">4</span> <span class="keyword">AND</span> NAME <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.12</span> sec)</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å»ºç«‹ç´¢å¼•</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_age <span class="keyword">ON</span> student(age);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_classid <span class="keyword">ON</span> student(age,classId);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_classid_name <span class="keyword">ON</span> student(age,classId,NAME);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ’ŒQ &#x3D;&#x3D;ä¸Šé¢ä¸‰ä¸ªç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå»ºç«‹ç´¢å¼•ï¼Ÿ&#x3D;&#x3D;<br>ä¸Šé¢å»ºç«‹ç´¢å¼•æ˜¯ä¸ä¸‰æ¡sqlçš„ä½¿ç”¨åœºæ™¯å¯¹åº”çš„ï¼Œéµå®ˆäº†å…¨å€¼åŒ¹é…çš„è§„åˆ™ï¼Œå°±æ˜¯è¯´å»ºç«‹å‡ ä¸ªå¤åˆç´¢å¼•å­—æ®µï¼Œæœ€å¥½å°±ç”¨ä¸Šå‡ ä¸ªå­—æ®µã€‚ä¸”æŒ‰ç…§é¡ºåºæ¥ç”¨ã€‚</p>
</blockquote>
<p>å»ºç«‹ç´¢å¼•åæ‰§è¡Œï¼Œå‘ç°ä½¿ç”¨åˆ°äº†è”åˆç´¢å¼•ï¼Œä¸”è€—æ—¶è¾ƒçŸ­ 0.00s</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> classId<span class="operator">=</span><span class="number">4</span> <span class="keyword">AND</span> NAME <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------------------------------------+----------------------+---------+-------------------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys                                <span class="operator">|</span> key                  <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>               <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------------------------------------+----------------------+---------+-------------------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> student <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> idx_age,idx_age_classid,idx_age_classid_name <span class="operator">|</span> idx_age_classid_name <span class="operator">|</span> <span class="number">73</span>      <span class="operator">|</span> const,const,const <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+----------------------------------------------+----------------------+---------+-------------------+------+----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">2</span> warnings (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> classId<span class="operator">=</span><span class="number">4</span> <span class="keyword">AND</span> NAME <span class="operator">=</span> <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼š</strong>ä¸Šé¢çš„ç´¢å¼•å¯èƒ½ä¸ç”Ÿæ•ˆå“¦ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿›è¡Œå…¨å€¼åŒ¹é…<code>SELECT *</code>ï¼Œä¼˜åŒ–å™¨å¯èƒ½ç»è¿‡è®¡ç®—å‘ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢æ‰€æœ‰çš„æ•°æ®åï¼Œè¿˜éœ€è¦å¯¹æŸ¥æ‰¾åˆ°çš„æ•°æ®è¿›è¡Œå›è¡¨æ“ä½œï¼Œæ€§èƒ½è¿˜ä¸å¦‚å…¨è¡¨æ‰«æã€‚è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰é€ è¿™ä¹ˆå¤šæ•°æ®ï¼Œæ‰€ä»¥å°±ä¸æ¼”ç¤ºæ•ˆæœå’¯ã€‚</p>
<h3 id="2-2-æœ€å·¦åŒ¹é…åŸåˆ™"><a href="#2-2-æœ€å·¦åŒ¹é…åŸåˆ™" class="headerlink" title="2.2 æœ€å·¦åŒ¹é…åŸåˆ™"></a>2.2 æœ€å·¦åŒ¹é…åŸåˆ™</h3><p>åœ¨ MySQL å»ºç«‹è”åˆç´¢å¼•æ—¶ä¼šéµå®ˆæœ€ä½³å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œå³æœ€å·¦ä¼˜å…ˆï¼Œåœ¨æ£€ç´¢æ•°æ®æ—¶ä»è”åˆç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ã€‚</p>
<p><strong><font color=blue>1. ä¸‹é¢çš„SQLå°†ä½¿ç”¨ç´¢å¼•idx_age</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> student.name<span class="operator">=</span><span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>2. ä¸‹é¢çš„sqlä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰åˆ›å»ºclassIdæˆ–è€…nameçš„ç´¢å¼•</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.classId<span class="operator">=</span><span class="number">4</span> <span class="keyword">AND</span> student.name<span class="operator">=</span><span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Q:ä¸ºä»€ä¹ˆä¸ä¼šä½¿ç”¨idx_age_classidç´¢å¼•ï¼Ÿ<br>ç´¢å¼•idx_age_classidçš„B+æ ‘ä¼šå…ˆä½¿ç”¨ageæ’åºï¼Œåœ¨ä½¿ç”¨classIdç»™ageç›¸åŒçš„æ•°æ®æ’åºï¼Œè¿™ä¸ªç´¢å¼•æ ¹æœ¬ç”¨ä¸ä¸Šå“Ÿã€‚è¿™å°±æ˜¯ä¸‹é¢çš„æœ€å·¦å‰ç¼€åŸåˆ™ã€‚</p>
</blockquote>
<p><strong><font color=blue>3.ä¸‹é¢çš„sqlæŸ¥è¯¢å°±æ˜¯éµå®ˆè¿™ä¸€åŸåˆ™çš„æ­£ç¡®æ‰“å¼€æ–¹å¼</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">AND</span> student.classId<span class="operator">=</span><span class="number">4</span> <span class="keyword">AND</span> student.name<span class="operator">=</span><span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>4. æ€è€ƒï¼šä¸‹é¢sqlä¼šä¸ä¼šä½¿ç”¨ç´¢å¼•å‘¢ï¼Ÿ</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.classId<span class="operator">=</span><span class="number">4</span> <span class="keyword">AND</span> student.age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">AND</span> student.name<span class="operator">=</span><span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆæ˜¯ä¼šï¼å› ä¸ºä¼˜åŒ–å™¨ä¼šæ‰§è¡Œä¼˜åŒ–çš„å“¦ï¼Œä¼šè°ƒæ•´æŸ¥è¯¢æ¡ä»¶çš„é¡ºåºã€‚ä¸è¿‡åœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬è¿˜æ˜¯è¦ä¿æŒè‰¯å¥½çš„å¼€å‘ä¹ æƒ¯å“Ÿã€‚</p>
<p><strong><font color=blue>5. æ€è€ƒï¼šåˆ å»ç´¢å¼•<code>idx_age_classid</code>å’Œ<code>idx_age</code>,åªä¿ç•™<code>idx_age_classid_name</code>ï¼Œæ‰§è¡Œå¦‚ä¸‹sqlï¼Œä¼šä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼Ÿ</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span>  student.age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">AND</span> student.name<span class="operator">=</span><span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆæ˜¯ä¼šï¼Œä½†æ˜¯åªä¼šç”¨ä¸€éƒ¨åˆ†ã€‚çœ‹çœ‹æ‰§è¡Œç»“æœ</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301613171.png" alt="image-20220824161042002"></p>
<p>ä½¿ç”¨äº†idx_age_classid_nameï¼Œä½†æ˜¯key_lenæ˜¯5ï¼Œä¹Ÿå°±æ˜¯è¯´åªä½¿ç”¨äº†ageéƒ¨åˆ†çš„æ’åºï¼Œå› ä¸ºageæ˜¯intç±»å‹ï¼Œ4ä¸ªå­—èŠ‚åŠ ä¸Šnullå€¼åˆ—è¡¨ä¸€å…±5ä¸ªå­—èŠ‚å“¦ã€‚æƒ³æƒ³å°±çŸ¥é“ï¼ŒB+æ ‘æ˜¯å…ˆæŒ‰ç…§ageæ’åºï¼Œå†æŒ‰ç…§classidæ’åºï¼Œæœ€åæŒ‰ç…§nameæ’åºï¼Œå› æ­¤ä¸èƒ½è·³è¿‡classIdçš„æ’åºç›´æ¥å°±ä½¿ç”¨nameçš„æ’åºå“¦ã€‚</p>
<p>ç»“è®ºï¼šMySQL å¯ä»¥ä¸ºå¤šä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œä¸€ä¸ªç´¢å¼•å¯ä»¥åŒ…æ‹¬ 16 ä¸ªå­—æ®µï¼Œå¯¹äºå¤šåˆ—å­—æ®µï¼Œ**<font color=red>è¿‡æ»¤æ¡ä»¶è¦ä½¿ç”¨ç´¢å¼•é‚£å¿…é¡»æŒ‰ç…§ç´¢å¼•å»ºç«‹æ—¶çš„é¡ºåºï¼Œä¾æ¬¡æ»¡è¶³ï¼Œä¸€æ—¦è·³è¿‡æŸä¸ªå­—æ®µï¼Œç´¢å¼•åé¢çš„å­—æ®µéƒ½æ— æ³•ä½¿ç”¨</font>**ã€‚å¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­æ²¡æœ‰ä½¿ç”¨è¿™äº›å­—æ®µä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µæ—¶ï¼Œå¤šåˆ—ç´¢å¼•ä¸ä¼šè¢«ä½¿ç”¨ã€‚</p>
<blockquote>
<p><strong>æ‹“å±•:Alibabaã€ŠJavaå¼€å‘æ‰‹å†Œã€‹</strong></p>
<p>ç´¢å¼•æ–‡ä»¶å…·æœ‰ B-Tree çš„æœ€å·¦å‰ç¼€åŒ¹é…ç‰¹æ€§ï¼Œå¦‚æœå·¦è¾¹çš„å€¼æœªç¡®å®šï¼Œé‚£ä¹ˆæ— æ³•ä½¿ç”¨æ­¤ç´¢å¼•ã€‚</p>
</blockquote>
<h3 id="2-3-ä¸»é”®æ’å…¥é¡ºåº"><a href="#2-3-ä¸»é”®æ’å…¥é¡ºåº" class="headerlink" title="2.3 ä¸»é”®æ’å…¥é¡ºåº"></a>2.3 ä¸»é”®æ’å…¥é¡ºåº</h3><p>å¯¹äºä¸€ä¸ªä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œåœ¨æˆ‘ä»¬æ²¡æœ‰æ˜¾å¼çš„åˆ›å»ºç´¢å¼•æ—¶ï¼Œè¡¨ä¸­çš„æ•°æ®å®é™…ä¸Šéƒ½æ˜¯å­˜å‚¨åœ¨ <code>èšç°‡ç´¢å¼•</code> çš„å¶å­èŠ‚ç‚¹çš„ã€‚è€Œè®°å½•åˆæ˜¯å­˜å‚¨åœ¨æ•°æ®é¡µä¸­ï¼Œæ•°æ®é¡µå’Œè®°å½•åˆæ˜¯æŒ‰ç…§ <code>è®°å½•ä¸»é”®å€¼ä»å°åˆ°å¤§</code> çš„é¡ºåºè¿›è¡Œæ’åºï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ <code>æ’å…¥</code> çš„è®°å½•çš„ <code>ä¸»é”®æ˜¯ä¾æ¬¡å¢å¤§</code> çš„è¯ï¼Œé‚£æˆ‘ä»¬æ¯æ’æ»¡ä¸€ä¸ªæ•°æ®é¡µå°±æ¢åˆ°ä¸‹ä¸€ä¸ªæ•°æ®é¡µç»§ç»­æ’ï¼Œè€Œå¦‚æœæˆ‘ä»¬æ’å…¥çš„ <code>ä¸»é”®å€¼å¿½å¤§å¿½å°</code> çš„è¯ï¼Œå°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œå‡è®¾æŸä¸ªæ•°æ®é¡µå­˜å‚¨çš„è®°å½•å·²ç»æ»¡äº†ï¼Œå®ƒå­˜å‚¨çš„ä¸»é”®å€¼åœ¨ 1~100 ä¹‹é—´ï¼š</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301613083.png" alt="image-20220824161409652"></p>
<p>å¦‚æœæ­¤æ—¶å†æ’å…¥ä¸€æ¡ä¸»é”®å€¼ä¸º <code>9</code> çš„è®°å½•ï¼Œé‚£å®ƒæ’å…¥çš„ä½ç½®å°±å¦‚ä¸‹å›¾:</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301613098.png" alt="image-20220824161420173"></p>
<p>å¯è¿™ä¸ªæ•°æ®é¡µå·²ç»æ»¡äº†ï¼Œå†æ’è¿›æ¥å’‹åŠå‘¢?æˆ‘ä»¬éœ€è¦æŠŠå½“å‰ <code>é¡µé¢åˆ†è£‚</code> æˆä¸¤ä¸ªé¡µé¢ï¼ŒæŠŠæœ¬é¡µä¸­çš„ä¸€äº›è®°å½•ç§»åŠ¨åˆ°æ–°åˆ›å»ºçš„è¿™ä¸ªé¡µä¸­ã€‚é¡µé¢åˆ†è£‚å’Œè®°å½•ç§»ä½æ„å‘³ç€ä»€ä¹ˆï¼Ÿæ„å‘³ç€ï¼š<code>æ€§èƒ½æŸè€—</code>ï¼æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³å°½é‡é¿å…è¿™æ ·æ— è°“çš„æ€§èƒ½æŸè€—ï¼Œæœ€å¥½è®©æ’å…¥çš„è®°å½•çš„ <code>ä¸»é”®å€¼ä¾æ¬¡é€’å¢</code> ï¼Œè¿™æ ·å°±ä¸ä¼šå‘ç”Ÿè¿™æ ·çš„æ€§èƒ½æŸè€—äº†ã€‚ æ‰€ä»¥æˆ‘ä»¬å»ºè®®ï¼šè®©ä¸»é”®å…·æœ‰ <code>AUTO_INCREMENT</code> ï¼Œè®©å­˜å‚¨å¼•æ“è‡ªå·±ä¸ºè¡¨ç”Ÿæˆä¸»é”®ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æ’å…¥ï¼Œæ¯”å¦‚<code>person_info</code>è¡¨ï¼š</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301613122.png" alt="image-20220824161706495"></p>
<p>æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸»é”®åˆ— <code>id</code> æ‹¥æœ‰ <code>AUTO_INCREMENT</code> å±æ€§ï¼Œåœ¨æ’å…¥è®°å½•æ—¶å­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬å¡«å…¥è‡ªå¢çš„ä¸»é”®å€¼ã€‚è¿™æ ·çš„ä¸»é”®å ç”¨ç©ºé—´å°ï¼Œé¡ºåºå†™å…¥ï¼Œå‡å°‘é¡µåˆ†è£‚ã€‚</p>
<blockquote>
<p>ğŸ€Tipsï¼š<br>æˆ‘ä»¬ä¸€èˆ¬å°†ä¸»é”®ç­–ç•¥è®¾ç½®ä¸ºè‡ªåŠ¨é€’å¢<code>AUTO_INCREMENT</code>å“¦ï¼(æ ¸å¿ƒä¸šåŠ¡è¡¨é™¤å¤–ï¼Œåé¢ä¼šä»‹ç»è¿™ç§æƒ…å†µ)</p>
</blockquote>
<h3 id="2-4-è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢ï¼ˆè‡ªåŠ¨æˆ–æ‰‹åŠ¨ï¼‰å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"><a href="#2-4-è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢ï¼ˆè‡ªåŠ¨æˆ–æ‰‹åŠ¨ï¼‰å¯¼è‡´ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="2.4 è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢ï¼ˆè‡ªåŠ¨æˆ–æ‰‹åŠ¨ï¼‰å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"></a>2.4 è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢ï¼ˆè‡ªåŠ¨æˆ–æ‰‹åŠ¨ï¼‰å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h3><p><strong><font color=blue>ä¸¾ä¾‹1ï¼šå½“ä½¿ç”¨å‡½æ•°æ—¶</font></strong></p>
<ol>
<li>è¿™ä¸¤æ¡ sql å“ªç§å†™æ³•æ›´å¥½ï¼Ÿ</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># æ­¤è¯­å¥æ¯”ä¸‹ä¸€æ¡è¦å¥½ï¼ï¼ˆèƒ½å¤Ÿä½¿ç”¨ä¸Šç´¢å¼•ï¼‰</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.name <span class="keyword">LIKE</span> <span class="string">&#x27;abc%&#x27;</span>;</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">LEFT</span>(student.name,<span class="number">3</span>) <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span>; </span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ›å»ºç´¢å¼•</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> student(NAME); </span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ç¬¬ä¸€ç§ï¼šç´¢å¼•ä¼˜åŒ–ç”Ÿæ•ˆ</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.name <span class="keyword">LIKE</span> <span class="string">&#x27;abc%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+---------------+----------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type  <span class="operator">|</span> possible_keys <span class="operator">|</span> key      <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span> <span class="operator">|</span> filtered <span class="operator">|</span> Extra                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+---------------+----------+---------+------+------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> student <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">range</span> <span class="operator">|</span> idx_name      <span class="operator">|</span> idx_name <span class="operator">|</span> <span class="number">63</span>      <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>   <span class="number">22</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> index <span class="keyword">condition</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+-------+---------------+----------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.name <span class="keyword">LIKE</span> <span class="string">&#x27;abc%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> id      <span class="operator">|</span> stuno  <span class="operator">|</span> name   <span class="operator">|</span> age  <span class="operator">|</span> classId <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4290221</span> <span class="operator">|</span> <span class="number">247516</span> <span class="operator">|</span> aBCiho <span class="operator">|</span>   <span class="number">48</span> <span class="operator">|</span>     <span class="number">936</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ......  <span class="operator">|</span>          ........				 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4243832</span> <span class="operator">|</span> <span class="number">201127</span> <span class="operator">|</span> ABcIkb <span class="operator">|</span>   <span class="number">26</span> <span class="operator">|</span>     <span class="number">483</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+--------+--------+------+---------+</span></span><br><span class="line"><span class="number">22</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ç¬¬äºŒç§ï¼šç´¢å¼•ä¼˜åŒ–å¤±æ•ˆ</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">LEFT</span>(student.name,<span class="number">3</span>) <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span>   <span class="operator">|</span> partitions <span class="operator">|</span> type <span class="operator">|</span> possible_keys <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> <span class="keyword">rows</span>   <span class="operator">|</span> filtered <span class="operator">|</span> Extra       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> student <span class="operator">|</span> <span class="keyword">NULL</span>       <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> <span class="keyword">NULL</span>          <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">499907</span> <span class="operator">|</span>   <span class="number">100.00</span> <span class="operator">|</span> <span class="keyword">Using</span> <span class="keyword">where</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">2</span> warnings (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">LEFT</span>(student.name,<span class="number">3</span>) <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>type ä¸ºâ€œALLâ€ï¼Œè¡¨ç¤ºæ²¡æœ‰ä½¿ç”¨åˆ°ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶é—´ä¸º 0.21 ç§’ï¼ŒæŸ¥è¯¢æ•ˆç‡è¾ƒä¹‹å‰ä½å¾ˆå¤š</p>
<p><strong><font color=blue>ä¸¾ä¾‹2ï¼šå½“æ¡ä»¶æœ‰è®¡ç®—æ—¶</font></strong></p>
<ol>
<li>studentè¡¨çš„å­—æ®µstunoä¸Šè®¾ç½®æœ‰ç´¢å¼•</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_sno <span class="keyword">ON</span> student(stuno);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç´¢å¼•ä¼˜åŒ–å¤±æ•ˆ</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE id, stuno, NAME <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> stuno<span class="operator">+</span><span class="number">1</span> <span class="operator">=</span> <span class="number">900001</span>; </span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301613370.png" alt="image-20220824165532304"></p>
<p>å¯ä»¥çœ‹åˆ°å¦‚æœå¯¹ç´¢å¼•è¿›è¡Œäº†è¡¨è¾¾å¼è®¡ç®—ï¼Œç´¢å¼•å°±å¤±æ•ˆäº†ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦æŠŠç´¢å¼•å­—æ®µçš„å€¼éƒ½å–å‡ºæ¥ï¼Œç„¶åä¸€æ¬¡è¿›è¡Œè¡¨è¾¾å¼çš„è®¡ç®—æ¥è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå› æ­¤é‡‡ç”¨çš„å°±æ˜¯<code>å…¨è¡¨æ‰«æ</code> çš„æ–¹å¼ï¼Œè¿è¡Œæ—¶é—´ä¹Ÿä¼šæ…¢å¾ˆå¤šã€‚</p>
<ol start="3">
<li>å»æ‰ä¸Šé¢SQLçš„è®¡ç®—ï¼Œç´¢å¼•ä¼˜åŒ–ç”Ÿæ•ˆï¼š</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE id, stuno, NAME <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> stuno <span class="operator">=</span> <span class="number">900000</span>; </span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614089.png" alt="image-20220824165631933"></p>
<p> <strong><font color=blue>ä¸¾ä¾‹3ï¼šç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</font></strong></p>
<p>ä¸‹åˆ—å“ªä¸ªSQLè¯­å¥å¯ä»¥ç”¨åˆ°ç´¢å¼•ï¼ˆå‡è®¾nameå­—æ®µä¸Šè®¾ç½®æœ‰ç´¢å¼•ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># æœªä½¿ç”¨åˆ°ç´¢å¼•</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="number">123</span>;</span><br><span class="line"># ä½¿ç”¨åˆ°ç´¢å¼•</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><code>name = 123</code> å‘ç”Ÿç±»å‹è½¬æ¢ï¼Œç›¸å½“äºä½¿ç”¨äº†éšå½¢ å‡½æ•°ï¼Œç´¢å¼•å¤±æ•ˆ</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614546.png" alt="image-20220824170121497"></p>
<blockquote>
<p>ç»“è®ºï¼šè®¾è®¡å®ä½“ç±»å±æ€§æ—¶ï¼Œä¸€å®šè¦ä¸æ•°æ®åº“å­—æ®µç±»å‹ç›¸å¯¹åº”ã€‚å¦åˆ™ï¼Œå°±ä¼šå‡ºç°ç±»å‹è½¬æ¢çš„æƒ…å†µ</p>
</blockquote>
<h3 id="2-5-èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—ç´¢å¼•å¤±æ•ˆ"><a href="#2-5-èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="2.5 èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—ç´¢å¼•å¤±æ•ˆ"></a>2.5 èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—ç´¢å¼•å¤±æ•ˆ</h3><p>ç¯å¢ƒå‡†å¤‡ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åˆ é™¤studentè¡¨ä¸Šçš„æ‰€æœ‰ç´¢å¼•</span><br><span class="line"><span class="keyword">CALL</span> proc_drop_index(<span class="string">&#x27;atguigudb2&#x27;</span>,<span class="string">&#x27;student&#x27;</span>);</span><br><span class="line"># åˆ›å»ºageã€classIdã€NAMEçš„è”åˆç´¢å¼•</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_classId_name <span class="keyword">ON</span> student(age,classId,NAME);</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>1. å¦‚æœç³»ç»Ÿç»å¸¸å‡ºç°çš„sqlå¦‚ä¸‹ï¼Œé‚£ä¹ˆç´¢å¼• idx_age_classId_name è¿™ä¸ªç´¢å¼•è¿˜èƒ½æ­£å¸¸ä½¿ç”¨ä¹ˆï¼Ÿ</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student </span><br><span class="line"><span class="keyword">WHERE</span> student.age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> student.classId<span class="operator">&gt;</span><span class="number">20</span> <span class="keyword">AND</span> student.name <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span> ;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614793.png" alt="image-20220824174623086"></p>
<p>ä¸èƒ½ï¼Œ&#x3D;&#x3D;èŒƒå›´å³è¾¹çš„åˆ—ä¸èƒ½ä½¿ç”¨&#x3D;&#x3D;ã€‚æ¯”å¦‚ &lt;ã€&lt;&#x3D;ã€&gt;ã€&gt;&#x3D; å’Œ between ç­‰</p>
<p>æœ‰åŒå­¦ä¼šå¥½å¥‡ï¼Œæˆ‘æ”¹å˜ä¸‹<code>WHERE</code>åé¢å­—æ®µçš„é¡ºåºå‘¢ï¼Œæ˜¯å¦å¯ä»¥ä½¿ç”¨å‘¢ï¼Ÿ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student </span><br><span class="line"><span class="keyword">WHERE</span> student.age<span class="operator">=</span><span class="number">30</span> <span class="keyword">AND</span> student.name <span class="operator">=</span><span class="string">&#x27;abc&#x27;</span> <span class="keyword">AND</span> student.classId<span class="operator">&gt;</span><span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆä¹Ÿæ˜¯ä¸èƒ½<del>ï¼Œå› ä¸º &#x3D;&#x3D;ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨å¸®ä½ æ»¡è¶³æœ€å·¦å‰ç¼€åŸåˆ™&#x3D;&#x3D; ï¼Œå³ä¼˜åŒ–å™¨ä¼š å…ˆæ ¹æ®è”åˆç´¢å¼•è¿›è¡Œæ’åº ï¼Œè”åˆç´¢å¼•çš„é¡ºåºæ‰èƒ½å†³å®š</del></p>
<blockquote>
<p><strong>è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆèŒƒå›´æŸ¥è¯¢ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼š</strong><br>å› ä¸ºæ ¹æ®èŒƒå›´æŸ¥æ‰¾ç­›é€‰åçš„æ•°æ®ï¼Œæ— æ³•ä¿è¯èŒƒå›´æŸ¥æ‰¾åé¢çš„å­—æ®µæ˜¯æœ‰åºçš„ã€‚</p>
<p>ä¾‹å¦‚ï¼ša_b_cè¿™ä¸ªç´¢å¼•ï¼Œä½ æ ¹æ®bèŒƒå›´æŸ¥æ‰¾&gt;2çš„ï¼Œåœ¨æ»¡è¶³b&gt;2çš„æƒ…å†µä¸‹ï¼Œå¦‚bï¼š3,4ï¼Œcå¯èƒ½æ˜¯5,3ã€å› ä¸ºcæ— åºï¼Œé‚£ä¹ˆcçš„ç´¢å¼•ä¾¿å¤±æ•ˆäº†</p>
</blockquote>
<p><strong><font color=blue>2. æ”¹è¿›</font></strong></p>
<p>å¯ä»¥å»ºç«‹å¦‚ä¸‹ç´¢å¼•ï¼ˆèŒƒå›´å­—æ®µæ”¾åœ¨æœ€åï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_age_name_classid <span class="keyword">on</span> student(age,name,classid); </span><br></pre></td></tr></table></figure>

<p>è¿›è¡ŒéªŒè¯ï¼Œå¯ä»¥çœ‹åˆ°è”åˆç´¢å¼•æ‰€æœ‰çš„åˆ—éƒ½ç”¨ä¸Šäº†</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614217.png" alt="image-20220824174830572"></p>
<blockquote>
<p>åº”ç”¨å¼€å‘ä¸­èŒƒå›´æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼šé‡‘é¢æŸ¥è¯¢ï¼Œæ—¥æœŸæŸ¥è¯¢å¾€å¾€éƒ½æ˜¯èŒƒå›´æŸ¥è¯¢ã€‚åº”å°†æŸ¥è¯¢æ¡ä»¶æ”¾ç½®whereè¯­å¥æœ€åã€‚ï¼ˆåˆ›å»ºçš„è”åˆç´¢å¼•ä¸­ï¼Œ&#x3D;&#x3D;åŠ¡å¿…æŠŠèŒƒå›´è®¾è®¡åˆ°çš„å­—æ®µå†™åœ¨æœ€å&#x3D;&#x3D;ï¼‰</p>
</blockquote>
<h3 id="2-6-ä¸ç­‰äºï¼ˆ-æˆ–è€…-ï¼‰ç´¢å¼•å¤±æ•ˆ"><a href="#2-6-ä¸ç­‰äºï¼ˆ-æˆ–è€…-ï¼‰ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="2.6 ä¸ç­‰äºï¼ˆ!&#x3D; æˆ–è€… &lt;&gt;ï¼‰ç´¢å¼•å¤±æ•ˆ"></a>2.6 ä¸ç­‰äºï¼ˆ!&#x3D; æˆ–è€… &lt;&gt;ï¼‰ç´¢å¼•å¤±æ•ˆ</h3><ul>
<li>ä¸ºnameå­—æ®µåˆ›å»ºç´¢å¼•</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> student(NAME);</span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥çœ‹ç´¢å¼•æ˜¯å¦å¤±æ•ˆ</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.name <span class="operator">&lt;&gt;</span> <span class="string">&#x27;abc&#x27;</span> ;</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> student.name <span class="operator">!=</span> <span class="string">&#x27;abc&#x27;</span> ;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614465.png" alt="image-20220824182716862"></p>
<h3 id="2-7-is-nullå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œis-not-nullæ— æ³•ä½¿ç”¨ç´¢å¼•"><a href="#2-7-is-nullå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œis-not-nullæ— æ³•ä½¿ç”¨ç´¢å¼•" class="headerlink" title="2.7 is nullå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œis not nullæ— æ³•ä½¿ç”¨ç´¢å¼•"></a>2.7 is nullå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œis not nullæ— æ³•ä½¿ç”¨ç´¢å¼•</h3><ul>
<li>IS NULLï¼šå¯ä»¥è§¦å‘ç´¢å¼•</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614009.png" alt="image-20220824182818489"></p>
<ul>
<li>IS NOT NULLï¼šæ— æ³•è§¦å‘ç´¢å¼•</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614481.png" alt="image-20220824182851982"></p>
<blockquote>
<p>ç»“è®ºï¼šæœ€å¥½åœ¨è®¾è®¡æ•°æ®åº“çš„æ—¶å€™å°±å°† <code>å­—æ®µè®¾ç½®ä¸º NOT NULL çº¦æŸ</code>ã€‚æ¯”å¦‚å¯ä»¥å°† INT ç±»å‹çš„å­—æ®µï¼Œé»˜è®¤è®¾ç½®ä¸º 0ã€‚å°†å­—ç¬¦ä¸²çš„é»˜è®¤å€¼è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆâ€œâ€ï¼‰ã€‚</p>
<p>æ‰©å±•ï¼šåŒç†ï¼Œåœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ <code>not like</code> ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œå¯¼è‡´å…¨è¡¨æ‰«æ</p>
</blockquote>
<h3 id="2-8-like-ä»¥é€šé…ç¬¦-å¼€å¤´ç´¢å¼•å¤±æ•ˆ"><a href="#2-8-like-ä»¥é€šé…ç¬¦-å¼€å¤´ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="2.8 like ä»¥é€šé…ç¬¦ % å¼€å¤´ç´¢å¼•å¤±æ•ˆ"></a>2.8 like ä»¥é€šé…ç¬¦ % å¼€å¤´ç´¢å¼•å¤±æ•ˆ</h3><p>åœ¨ä½¿ç”¨ LIKE å…³é”®å­—è¿›è¡ŒæŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥ä¸­ï¼Œå¦‚æœåŒ¹é…å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºâ€œ%â€ï¼Œç´¢å¼•å°±ä¸ä¼šå…¶ä½œç”¨ã€‚åªæœ‰â€œ%â€ä¸åœ¨ç¬¬ä¸€ä¸ªä½ç½®ï¼Œç´¢å¼•æ‰ä¼šèµ·ä½œç”¨ã€‚</p>
<ul>
<li>ä½¿ç”¨åˆ°ç´¢å¼•</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;ab%&#x27;</span>; </span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614010.png" alt="image-20220824183323044"></p>
<ul>
<li>æœªä½¿ç”¨åˆ°ç´¢å¼•</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%ab%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614737.png" alt="image-20220824183400615"></p>
<blockquote>
<p><strong>æ‹“å±•ï¼šAlibabaã€ŠJava å¼€å‘æ‰‹å†Œã€‹</strong></p>
<p>ã€å¼ºåˆ¶ã€‘é¡µé¢æœç´¢&#x3D;&#x3D;ä¸¥ç¦å·¦æ¨¡ç³Šæˆ–è€…å…¨æ¨¡ç³Š&#x3D;&#x3D;ï¼Œå¦‚æœéœ€è¦è¯·èµ°æœç´¢å¼•æ“æ¥è§£å†³ã€‚</p>
</blockquote>
<h3 id="2-9-OR-å‰åå­˜åœ¨éç´¢å¼•çš„åˆ—ï¼Œç´¢å¼•å¤±æ•ˆ"><a href="#2-9-OR-å‰åå­˜åœ¨éç´¢å¼•çš„åˆ—ï¼Œç´¢å¼•å¤±æ•ˆ" class="headerlink" title="2.9 OR å‰åå­˜åœ¨éç´¢å¼•çš„åˆ—ï¼Œç´¢å¼•å¤±æ•ˆ"></a>2.9 OR å‰åå­˜åœ¨éç´¢å¼•çš„åˆ—ï¼Œç´¢å¼•å¤±æ•ˆ</h3><p>åœ¨WHERE å­å¥ä¸­ï¼Œå¦‚æœåœ¨ OR å‰çš„æ¡ä»¶åˆ—è¿›è¡Œäº†ç´¢å¼•ï¼Œè€Œåœ¨ OR åçš„æ¡ä»¶åˆ—æ²¡æœ‰è¿›è¡Œç´¢å¼•ï¼Œé‚£ä¹ˆç´¢å¼•ä¼šå¤±æ•ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ&#x3D;&#x3D;OR å‰åçš„ä¸¤ä¸ªæ¡ä»¶ä¸­çš„åˆ—éƒ½æ˜¯ç´¢å¼•æ—¶ï¼ŒæŸ¥è¯¢ä¸­æ‰ä½¿ç”¨ç´¢å¼•&#x3D;&#x3D;ã€‚</p>
<p>å› ä¸º OR çš„å«ä¹‰å°±æ˜¯ä¸¤ä¸ªåªè¦æ»¡è¶³ä¸€ä¸ªå³å¯ï¼Œå› æ­¤ &#x3D;&#x3D;åªæœ‰ä¸€ä¸ªæ¡ä»¶åˆ—è¿›è¡Œäº†ç´¢å¼•æ˜¯æ²¡æœ‰æ„ä¹‰çš„&#x3D;&#x3D;ï¼Œåªè¦æœ‰æ¡ä»¶åˆ—æ²¡æœ‰è¿›è¡Œç´¢å¼•ï¼Œå°±ä¼šè¿›è¡Œ&#x3D;&#x3D;å…¨è¡¨æ‰«æ&#x3D;&#x3D;ï¼Œå› æ­¤ç´¢å¼•çš„æ¡ä»¶åˆ—ä¹Ÿä¼šå¤±æ•ˆã€‚</p>
<p>æŸ¥è¯¢è¯­å¥ä½¿ç”¨ OR å…³é”®å­—çš„æƒ…å†µï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºç´¢å¼•ï¼ˆåªæœ‰<span class="keyword">OR</span>å‰é¢çš„å­—æ®µæœ‰ç´¢å¼•ï¼‰</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age <span class="keyword">ON</span> student(age);</span><br><span class="line"># æœªä½¿ç”¨åˆ°ç´¢å¼•</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">10</span> <span class="keyword">OR</span> classid <span class="operator">=</span> <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614874.png" alt="image-20220824183640699"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å†ä¸º<span class="keyword">OR</span>åé¢çš„å­—æ®µåˆ›å»ºä¸€ä¸ªç´¢å¼•</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_cid <span class="keyword">ON</span> student(classid);</span><br><span class="line"># ä½¿ç”¨åˆ°ç´¢å¼•</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">10</span> <span class="keyword">OR</span> classid <span class="operator">=</span> <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614428.png" alt="image-20220824184608531"></p>
<blockquote>
<p>è§£é‡Šä¸‹ OR å‰åå­˜åœ¨éç´¢å¼•çš„åˆ—ï¼Œç´¢å¼•å¤±æ•ˆ</p>
<p>å› ä¸º ORå‰åä¸€ä¸ªä½¿ç”¨ç´¢å¼•ï¼Œä¸€ä¸ªè¿›è¡Œå…¨è¡¨æ‰«æï¼Œè¿˜æ²¡æœ‰ç›´æ¥è¿›è¡Œå…¨è¡¨æ‰«ææ›´å¿«~</p>
</blockquote>
<h3 id="2-10-æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨utf8mb4-utf8mb3"><a href="#2-10-æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨utf8mb4-utf8mb3" class="headerlink" title="2.10 æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨utf8mb4&#x2F;utf8mb3"></a>2.10 æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨utf8mb4&#x2F;utf8mb3</h3><p>ç»Ÿä¸€ä½¿ç”¨ utf8mb4ï¼ˆ5.5.3ç‰ˆæœ¬ä»¥ä¸Šæ”¯æŒï¼‰å…¼å®¹æ€§æ›´å¥½ï¼Œç»Ÿä¸€å­—ç¬¦é›†å¯ä»¥é¿å…ç”±äºå­—ç¬¦é›†è½¬æ¢äº§ç”Ÿçš„ä¹±ç ã€‚ä¸åŒçš„ <code>å­—ç¬¦é›†</code> è¿›è¡Œæ¯”è¾ƒå‰éœ€è¦è¿›è¡Œ <code>è½¬æ¢</code> ä¼šé€ æˆç´¢å¼•å¤±æ•ˆã€‚</p>
<h3 id="2-11-ç»ƒä¹ åŠä¸€èˆ¬æ€§å»ºè®®"><a href="#2-11-ç»ƒä¹ åŠä¸€èˆ¬æ€§å»ºè®®" class="headerlink" title="2.11 ç»ƒä¹ åŠä¸€èˆ¬æ€§å»ºè®®"></a>2.11 ç»ƒä¹ åŠä¸€èˆ¬æ€§å»ºè®®</h3><p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614388.png"></p>
<p><strong>ä¸€èˆ¬æ€§å»ºè®®ï¼š</strong></p>
<ul>
<li>å¯¹äºå•åˆ—ç´¢å¼•ï¼Œå°½é‡é€‰æ‹©é’ˆå¯¹å½“å‰ query è¿‡æ»¤æ€§æ›´å¥½çš„ç´¢å¼•</li>
<li>åœ¨é€‰æ‹©ç»„åˆç´¢å¼•çš„æ—¶å€™ï¼Œå½“å‰ query ä¸­è¿‡æ»¤æ€§æœ€å¥½çš„å­—æ®µåœ¨ç´¢å¼•å­—æ®µé¡ºåºä¸­ï¼Œä½ç½®è¶Šé å‰è¶Šå¥½</li>
<li>åœ¨é€‰æ‹©ç»„åˆç´¢å¼•çš„æ—¶å€™ï¼Œå°½é‡é€‰æ‹©èƒ½å¤ŸåŒ…å«å½“å‰ query ä¸­çš„ where å­å¥ä¸­æ›´å¤šå­—æ®µçš„ç´¢å¼•</li>
<li>åœ¨é€‰æ‹©ç»„åˆç´¢å¼•çš„æ—¶å€™ï¼Œå¦‚æœæŸä¸ªå­—æ®µå¯èƒ½å‡ºç°èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œå°½é‡æŠŠè¿™ä¸ªå­—æ®µæ”¾åœ¨ç´¢å¼•æ¬¡åºçš„æœ€åé¢ã€‚</li>
</ul>
<p>æ€»ä¹‹ï¼Œä¹¦å†™ SQL è¯­å¥æ—¶ï¼Œå°½é‡é¿å…é€ æˆç´¢å¼•å¤±æ•ˆçš„æƒ…å†µã€‚</p>
<h2 id="3-å…³è”æŸ¥è¯¢ä¼˜åŒ–"><a href="#3-å…³è”æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="3. å…³è”æŸ¥è¯¢ä¼˜åŒ–"></a>3. å…³è”æŸ¥è¯¢ä¼˜åŒ–</h2><h3 id="3-1-æ•°æ®å‡†å¤‡"><a href="#3-1-æ•°æ®å‡†å¤‡" class="headerlink" title="3.1 æ•°æ®å‡†å¤‡"></a>3.1 æ•°æ®å‡†å¤‡</h3><p>åˆ›å»ºTypeè¡¨</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `type` (</span><br><span class="line">`id` <span class="type">INT</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`card` <span class="type">INT</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºbookè¡¨</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `book` (</span><br><span class="line">`bookid` <span class="type">INT</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`card` <span class="type">INT</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`bookid`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>åœ¨typeè¡¨ä¸­æ‰§è¡Œ20æ¬¡å¦‚ä¸‹æ•°æ®ï¼Œæ’å…¥20æ¡æ•°æ®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> TYPE(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> RAND() <span class="operator">*</span> <span class="number">20</span>));</span><br><span class="line"># ...</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œåœ¨bookè¡¨ä¸­æ’å…¥20æ¡æ•°æ®</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book(card) <span class="keyword">VALUES</span>(<span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> RAND() <span class="operator">*</span> <span class="number">20</span>));</span><br><span class="line"># ...</span><br></pre></td></tr></table></figure>

<h3 id="3-1-é‡‡ç”¨å·¦å¤–è¿æ¥"><a href="#3-1-é‡‡ç”¨å·¦å¤–è¿æ¥" class="headerlink" title="3.1 é‡‡ç”¨å·¦å¤–è¿æ¥"></a>3.1 é‡‡ç”¨å·¦å¤–è¿æ¥</h3><p>æˆ‘ä»¬çŸ¥é“å¤šè¡¨æŸ¥è¯¢åˆ†ä¸ºå¤–è¿æ¥å’Œå†…è¿æ¥ï¼Œè€Œå¤–è¿æ¥åˆåˆ†ä¸ºå·¦å¤–è¿æ¥ï¼Œå³å¤–è¿æ¥å’Œæ»¡å¤–è¿æ¥ã€‚å…¶ä¸­å¤–è¿æ¥ä¸­ï¼Œå·¦å¤–è¿æ¥ä¸å³å¤–è¿æ¥å¯ä»¥é€šè¿‡äº¤æ¢è¡¨æ¥ç›¸äº’æ”¹é€ ï¼Œå…¶åŸç†ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œè€Œæ»¡å¤–è¿æ¥æ— éæ˜¯äºŒè€…çš„ä¸€ä¸ªç»¼åˆï¼Œå› æ­¤å¤–è¿æ¥æˆ‘ä»¬åªä»‹ç»å·¦å¤–è¿æ¥çš„ä¼˜åŒ–å³å¯ã€‚</p>
<p><strong><font color=blue>1.ä¸‹é¢å¼€å§‹ EXPLAIN åˆ†æï¼Œå½“æ²¡æœ‰ä½¿ç”¨ç´¢å¼•æ—¶ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯å…¨è¡¨æ‰«æ~</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> `type` <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card <span class="operator">=</span> book.card;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614498.png" alt="image-20220824230108579"></p>
<p>åœ¨ä¸Šé¢çš„æŸ¥è¯¢sqlä¸­ï¼Œtypeè¡¨æ˜¯é©±åŠ¨è¡¨ï¼Œbookè¡¨æ˜¯è¢«é©±åŠ¨è¡¨ã€‚åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œä¼šå…ˆæŸ¥æ‰¾é©±åŠ¨è¡¨ä¸­ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œå†æ ¹æ®é©±åŠ¨è¡¨æŸ¥è¯¢åˆ°çš„æ•°æ®åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ ¹æ®åŒ¹é…æ¡ä»¶æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®ã€‚å› æ­¤è¢«é©±åŠ¨è¡¨åµŒå¥—æŸ¥è¯¢çš„æ¬¡æ•°æ˜¯20*20&#x3D;400æ¬¡ã€‚å®é™…ä¸Šï¼Œç”±äºæˆ‘ä»¬æ€»æ˜¯éœ€è¦åœ¨è¢«é©±åŠ¨è¡¨ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œä¼˜åŒ–å™¨å¸®æˆ‘ä»¬å·²ç»åšäº†ä¼˜åŒ–ï¼Œä¸Šé¢çš„æŸ¥è¯¢ç»“æœä¸­å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨äº†<code>join buffer</code>ï¼Œå°†æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œæé«˜æ£€ç´¢çš„é€Ÿåº¦ã€‚</p>
<p><strong><font color=blue>2. ä¸ºäº†æé«˜å¤–è¿æ¥çš„æ€§èƒ½ï¼Œæˆ‘ä»¬æ·»åŠ ä¸‹ç´¢å¼•</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX Y <span class="keyword">ON</span> book(card); #ã€è¢«é©±åŠ¨è¡¨ã€‘ï¼Œå¯ä»¥é¿å…å…¨è¡¨æ‰«æ</span><br><span class="line"></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> `type` </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card <span class="operator">=</span> book.card;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614819.png" alt="image-20220824230338583"></p>
<p>å¯¹äºå¤–å±‚è¡¨æ¥è¯´ï¼Œè™½ç„¶å…¶æŸ¥è¯¢ä»ç„¶æ˜¯å…¨è¡¨æ‰«æï¼Œä½†æ˜¯å› ä¸ºæ˜¯å·¦å¤–è¿æ¥ï¼Œ<code>LEFT JOIN</code>å·¦è¾¹çš„è¡¨çš„æ•°æ®æ— è®ºæ˜¯å¦æ»¡è¶³æ¡ä»¶éƒ½ä¼šä¿ç•™ï¼Œå› æ­¤å…¨è¡¨æ‰«æä¹Ÿæ˜¯ä¸èµ–çš„ã€‚å¦å¤–å¯ä»¥çœ‹åˆ°ç¬¬äºŒè¡Œçš„ type å˜ä¸ºäº† refï¼Œrows ä¹Ÿå˜æˆäº†1ï¼Œä¼˜åŒ–æ¯”è¾ƒæ˜æ˜¾ã€‚è¿™æ˜¯ç”±å·¦è¿æ¥ç‰¹æ€§å†³å®šçš„ã€‚<code>LEFT JOIN</code> æ¡ä»¶ç”¨äºç¡®å®šå¦‚ä½•ä»å³è¡¨æœç´¢è¡Œï¼Œå·¦è¾¹ä¸€å®šéƒ½æœ‰ï¼Œæ‰€ä»¥ <code>å³è¾¹æ˜¯æˆ‘ä»¬çš„å…³é”®ç‚¹ï¼Œä¸€å®šéœ€è¦å»ºç«‹ç´¢å¼•</code></p>
<p><strong><font color=blue>3. æˆ‘ä»¬å½“ç„¶ä¹Ÿå¯ä»¥ç»™typeè¡¨å»ºç«‹ç´¢å¼•ã€‚</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX X <span class="keyword">ON</span> `type`(card); #ã€é©±åŠ¨è¡¨ã€‘ï¼Œæ— æ³•é¿å…å…¨è¡¨æ‰«æ</span><br><span class="line"># <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `type` <span class="keyword">ADD</span> INDEX X (card);</span><br><span class="line"></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> `type` <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card <span class="operator">=</span> book.card;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301614985.png" alt="image-20220824230536748"></p>
<blockquote>
<p>æ³¨æ„ï¼Œå¤–è¿æ¥çš„å…³è”æ¡ä»¶ä¸­ï¼Œä¸¤ä¸ªå…³è”å­—æ®µçš„ç±»å‹ã€å­—ç¬¦é›†ä¸€å®šè¦ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ç´¢å¼•ä¼šå¤±æ•ˆå“¦ã€‚</p>
</blockquote>
<p><strong><font color=blue>4. åˆ é™¤ç´¢å¼•Yï¼Œæˆ‘ä»¬ç»§ç»­æŸ¥è¯¢</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åˆ é™¤ç´¢å¼•</span><br><span class="line"><span class="keyword">DROP</span> INDEX Y <span class="keyword">ON</span> book;</span><br><span class="line"></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> `type` <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card <span class="operator">=</span> book.card;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615026.png" alt="image-20220824230642449"></p>
<p>bookè¡¨ä½¿ç”¨<code>join buffer</code>ï¼Œå†æ¬¡éªŒè¯äº†å·¦å¤–è¿æ¥å·¦è¾¹çš„è¡¨æ˜¯é©±åŠ¨è¡¨ï¼Œå³è¾¹çš„è¡¨æ˜¯è¢«é©±åŠ¨è¡¨ï¼Œåé¢æˆ‘ä»¬å°†ä¸å†…è¿æ¥åœ¨è¿™ä¸€ç‚¹è¿›è¡Œå¯¹æ¯”ã€‚</p>
<blockquote>
<p>å·¦å¤–é“¾æ¥å·¦è¡¨æ˜¯é©±åŠ¨è¡¨å³è¡¨æ˜¯è¢«é©±åŠ¨è¡¨ï¼Œå³å¤–é“¾æ¥å’Œæ­¤ç›¸åï¼Œå†…é“¾æ¥åˆ™æ˜¯æŒ‰ç…§æ•°æ®é‡çš„å¤§å°ï¼Œæ•°æ®é‡å°‘çš„æ˜¯é©±åŠ¨è¡¨ï¼Œå¤šçš„æ˜¯è¢«é©±åŠ¨è¡¨</p>
</blockquote>
<h3 id="3-2-é‡‡ç”¨å†…è¿æ¥"><a href="#3-2-é‡‡ç”¨å†…è¿æ¥" class="headerlink" title="3.2 é‡‡ç”¨å†…è¿æ¥"></a>3.2 é‡‡ç”¨å†…è¿æ¥</h3><p><strong><font color=blue>1. åˆ é™¤ç°æœ‰çš„ç´¢å¼•ï¼Œæ¢æˆ inner join(MySQLè‡ªåŠ¨é€‰æ‹©é©±åŠ¨è¡¨)</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> index X <span class="keyword">on</span> type;</span><br><span class="line"><span class="keyword">drop</span> index Y <span class="keyword">on</span> book;# (å¦‚æœå·²ç»åˆ é™¤äº†å¯ä»¥ä¸ç”¨å†æ‰§è¡Œè¯¥æ“ä½œ)</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> type <span class="keyword">INNER</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card<span class="operator">=</span>book.card;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615690.png" alt="image-20220826120632384"></p>
<p><strong><font color=blue>2. ä¸ºbookè¡¨æ·»åŠ ç´¢å¼•ä¼˜åŒ–</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">ADD</span> INDEX Y (card);</span><br><span class="line"></span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span>  type <span class="keyword">INNER</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card<span class="operator">=</span>book.card;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615170.png" alt="image-20220826120800619"></p>
<p><strong><font color=blue>3. å‘typeè¡¨ä¸­å†å¢åŠ 20æ¡æ•°æ®ï¼Œä¸ºtypeè¡¨å¢åŠ ç´¢å¼•ä¼˜åŒ–ï¼Œè§‚å¯Ÿæƒ…å†µ</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å†å‘typeè¡¨ä¸­æ’å…¥<span class="number">20</span>æ¡æ•°æ®ï¼Œæ­¤æ—¶type:<span class="number">40</span>æ¡æ•°æ®ï¼Œbook:<span class="number">20</span>æ¡æ•°æ® (è¿‡ç¨‹çœç•¥)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> type <span class="keyword">ADD</span> INDEX X (card);</span><br><span class="line"></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> type <span class="keyword">INNER</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card<span class="operator">=</span>book.card;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615458.png" alt="image-20220826121414744"></p>
<p>ä¸Šé¢çš„ä¸¤æ¬¡æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€æ¬¡æ˜¯ä½¿ç”¨typeä½œä¸ºé©±åŠ¨è¡¨ï¼Œbookä½œä¸ºè¢«é©±åŠ¨è¡¨ã€‚è€Œç¬¬äºŒæ¬¡æ˜¯ä½¿ç”¨bookä½œä¸ºé©±åŠ¨è¡¨ï¼Œtypeä½œä¸ºè¢«é©±åŠ¨è¡¨ã€‚&#x3D;&#x3D;å¯¹äºå†…è¿æ¥æ¥è¯´ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨å¯ä»¥å†³å®šè°ä½œä¸ºé©±åŠ¨è¡¨ï¼Œè°ä½œä¸ºè¢«é©±åŠ¨è¡¨å‡ºç°çš„&#x3D;&#x3D;</p>
<p><strong><font color=blue>4. æ¥ç€ï¼Œåˆ é™¤è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX X <span class="keyword">ON</span> `type`;</span><br><span class="line"></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> type <span class="keyword">INNER</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card<span class="operator">=</span>book.card;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615018.png" alt="image-20220826122407713"></p>
<p>è¢«é©±åŠ¨è¡¨è¿›è¡Œäº†åè½¬ã€‚è¿™æ˜¯å› ä¸ºå†…è¿æ¥ä¼˜åŒ–å™¨å¯ä»¥å†³å®šï¼ˆè¢«ï¼‰é©±åŠ¨è¡¨ã€‚åœ¨åªæœ‰ä¸€ä¸ªè¡¨å­˜åœ¨ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œä¼š<strong>é€‰æ‹©å­˜åœ¨ç´¢å¼•çš„è¡¨ä½œä¸ºè¢«é©±åŠ¨è¡¨</strong>(å› ä¸ºè¢«é©±åŠ¨è¡¨æŸ¥è¯¢æ¬¡æ•°æ›´å¤š)</p>
<p><strong><font color=blue>5. å†åŠ ä¸Šç´¢å¼•ï¼Œè§‚å¯Ÿç»“æœ</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `type` <span class="keyword">ADD</span> INDEX X (card);</span><br><span class="line"></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> type <span class="keyword">INNER</span> <span class="keyword">JOIN</span> book <span class="keyword">ON</span> type.card<span class="operator">=</span>book.card;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615138.png" alt="image-20220826123444163"></p>
<p>è¢«é©±åŠ¨è¡¨åˆè¿›è¡Œäº†åè½¬~</p>
<blockquote>
<p>ç»“è®ºï¼šå¯¹äºå†…è¿æ¥æ¥è¯´ï¼Œåœ¨ä¸¤ä¸ªè¡¨çš„è¿æ¥æ¡ä»¶éƒ½å­˜åœ¨ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œä¼šé€‰æ‹©å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ã€‚â€œ&#x3D;&#x3D;å°è¡¨é©±åŠ¨å¤§è¡¨&#x3D;&#x3D;â€</p>
</blockquote>
<h3 id="3-3-join-è¯­å¥åŸç†"><a href="#3-3-join-è¯­å¥åŸç†" class="headerlink" title="3.3 join è¯­å¥åŸç†"></a>3.3 join è¯­å¥åŸç†</h3><p>join æ–¹å¼è¿æ¥å¤šè¡¨ï¼Œæœ¬è´¨å°±æ˜¯å„ä¸ªè¡¨ä¹‹é—´æ•°æ®çš„å¾ªç¯åŒ¹é…ã€‚MySQL 5.5 ç‰ˆæœ¬ä¹‹å‰ï¼ŒMySQL åªæ”¯æŒä¸€ç§è¡¨é—´å…³è”æ–¹å¼ï¼Œå°±æ˜¯åµŒå¥—å¾ªç¯ã€‚å¦‚æœå…³è”è¡¨çš„æ•°æ®é‡å¾ˆå¤§ï¼Œåˆ™ join å…³è”çš„æ‰§è¡Œæ—¶é—´ä¼šéå¸¸æ¼«é•¿ã€‚åœ¨ MySQL 5.5 ä»¥åçš„ç‰ˆæœ¬ä¸­ï¼ŒMySQL é€šè¿‡å¼•å…¥ BNLJ ç®—æ³•æ¥ä¼˜åŒ–åµŒå¥—æ‰§è¡Œã€‚</p>
<h4 id="3-3-1-é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨"><a href="#3-3-1-é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨" class="headerlink" title="3.3.1 é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨"></a>3.3.1 é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨</h4><p>é©±åŠ¨è¡¨å°±æ˜¯ä¸»è¡¨ï¼Œè¢«é©±åŠ¨è¡¨å°±æ˜¯ä»è¡¨ã€éé©±åŠ¨è¡¨ã€‚</p>
<ul>
<li><strong>å¯¹äºå†…è¿æ¥æ¥è¯´:</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> A <span class="keyword">JOIN</span> B <span class="keyword">ON</span> ...</span><br></pre></td></tr></table></figure>

<p>A å¹¶ä¸ä¸€å®šå°±æ˜¯é©±åŠ¨è¡¨ï¼Œä¼˜åŒ–å™¨ä¼šæ ¹æ®ä½ çš„æŸ¥è¯¢è¯­å¥åšä¼˜åŒ–ï¼Œå†³å®šå…ˆæŸ¥å“ªå¼ è¡¨ã€‚å…ˆæŸ¥è¯¢çš„å“ªå¼ è¡¨å°±æ˜¯é©±åŠ¨è¡¨ï¼Œåä¹‹å°±æ˜¯è¢«é©±åŠ¨è¡¨ã€‚é€šè¿‡ explain å…³é”®å­—å¯ä»¥æŸ¥çœ‹ã€‚</p>
<blockquote>
<p>3.2 å·²ç»æ€»ç»“äº†ä¼˜åŒ–å™¨é€‰æ‹©çš„è§„å¾‹ï¼šä¸¤è¡¨ä¸­ä¸€ä¸ªè¡¨æœ‰ç´¢å¼•ï¼Œä¸€ä¸ªè¡¨æ²¡æœ‰ç´¢å¼•ï¼Œåˆ™æ²¡æœ‰ç´¢å¼•çš„ä¸ºé©±åŠ¨è¡¨ï¼Œæœ‰ç´¢å¼•çš„ä¸ºè¢«é©±åŠ¨è¡¨ï¼›ä¸¤ä¸ªè¡¨éƒ½æ²¡æœ‰ç´¢å¼•ï¼Œåˆ™å°è¡¨é©±åŠ¨å¤§è¡¨ã€‚</p>
<p>ğŸ’¡Q:ä¸Šé¢çš„è§„å¾‹æ˜¯ä¸€æˆä¸å˜çš„å—ï¼Ÿå¦‚æœä¸€ä¸ªè¡¨æœ‰ç´¢å¼•ï¼Œä½†æ˜¯æ•°æ®é‡å¾ˆå°ï¼Œä¸€ä¸ªè¡¨æ²¡æœ‰ç´¢å¼•ï¼Œä½†æ˜¯æ•°æ®é‡å¾ˆå¤§ï¼Œæƒ…å†µä¼šæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ<br>æˆ‘ä»¬è¦æ˜ç™½ä¼˜åŒ–å™¨çš„ä¼˜åŒ–åŸç†ï¼šå¯¹äºå†…è¿æ¥mysqlä¼šé€‰æ‹©æ‰«ææ¬¡æ•°æ¯”è¾ƒå°‘çš„ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå› æ­¤å®é™…ç”Ÿäº§ä¸­æœ€å¥½ä½¿ç”¨<code>Explain</code>æµ‹è¯•éªŒè¯ã€‚</p>
</blockquote>
<ul>
<li><strong>å¯¹äºå¤–è¿æ¥æ¥è¯´ï¼š</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> A <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> B <span class="keyword">ON</span> ...</span><br><span class="line"># æˆ–</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> B <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> A <span class="keyword">ON</span> ...</span><br></pre></td></tr></table></figure>

<p>é€šå¸¸ï¼Œå¤§å®¶ä¼šè®¤ä¸º A å°±æ˜¯é©±åŠ¨è¡¨ï¼ŒB å°±æ˜¯è¢«é©±åŠ¨è¡¨ã€‚ä½†ä¹Ÿæœªå¿…ã€‚æµ‹è¯•å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> a(f1 <span class="type">INT</span>,f2 <span class="type">INT</span>,INDEX(f1)) ENGINE<span class="operator">=</span>INNODB;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> b(f1 <span class="type">INT</span>,f2 <span class="type">INT</span>) ENGINE<span class="operator">=</span>INNODB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> a <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">1</span>),(<span class="number">2</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">4</span>),(<span class="number">5</span>,<span class="number">5</span>),(<span class="number">6</span>,<span class="number">6</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> b <span class="keyword">values</span>(<span class="number">3</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">4</span>),(<span class="number">5</span>,<span class="number">5</span>),(<span class="number">6</span>,<span class="number">6</span>),(<span class="number">7</span>,<span class="number">7</span>),(<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line"># æµ‹è¯•<span class="number">1</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> a <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> b <span class="keyword">ON</span>(a.f1<span class="operator">=</span>b.f1) <span class="keyword">WHERE</span> (a.f2<span class="operator">=</span>b.f2);</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615050.png" alt="image-20220826132157586"></p>
<p>æ˜æ˜æˆ‘ä»¬å†™çš„æ˜¯<code>a LEFT JOIN b</code>,ä½†æ˜¯æˆ‘ä»¬æ‰§è¡ŒsqlæŸ¥è¯¢æ—¶ï¼Œå´æ˜¯bä½œä¸ºäº†é©±åŠ¨è¡¨ï¼Œaä½œä¸ºäº†è¢«é©±åŠ¨è¡¨ã€‚</p>
<p>å®é™…ä¸Šï¼Œ&#x3D;&#x3D;æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå¸®ä½ æŠŠå¤–è¿æ¥æ”¹é€ ä¸ºå†…è¿æ¥ï¼Œç„¶åæ ¹æ®å…¶ä¼˜åŒ–ç­–ç•¥é€‰æ‹©é©±åŠ¨è¡¨ä¸è¢«é©±åŠ¨è¡¨&#x3D;&#x3D;</p>
<h4 id="3-3-2-Simple-Nested-Loop-Joinï¼ˆç®€å•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰"><a href="#3-3-2-Simple-Nested-Loop-Joinï¼ˆç®€å•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰" class="headerlink" title="3.3.2 Simple Nested-Loop Joinï¼ˆç®€å•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰"></a>3.3.2 Simple Nested-Loop Joinï¼ˆç®€å•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰</h4><p>ç®—æ³•ç›¸å½“ç®€å•ï¼Œä»è¡¨ A å–å‡ºä¸€æ¡æ•°æ® 1ï¼Œéå†è¡¨ Bï¼Œå°†åŒ¹é…åˆ°çš„æ•°æ®æ”¾åˆ° resultã€‚ä»¥æ­¤ç±»æ¨ï¼Œé©±åŠ¨è¡¨ A ä¸­çš„æ¯ä¸€æ¡è®°å½•ä¸è¢«åŠ¨é©±åŠ¨è¡¨ B çš„è®°å½•è¿›è¡Œåˆ¤æ–­ï¼š</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615939.png" alt="image-20220826133623699"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™ç§æ–¹å¼æ•ˆç‡æ˜¯éå¸¸ä½çš„ï¼Œä»¥ä¸Šè¿°è¡¨ A æ•°æ® 100 æ¡ï¼Œè¡¨ B æ•°æ® 1000 æ¡ï¼Œåˆ™ A*B&#x3D;10 ä¸‡æ¬¡ã€‚å¼€é”€ç»Ÿè®¡å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å¼€é”€ç»Ÿè®¡</th>
<th align="left">SNLJ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å¤–è¡¨æ‰«ææ¬¡æ•°</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">å†…è¡¨æ‰«ææ¬¡æ•°</td>
<td align="left">A</td>
</tr>
<tr>
<td align="left">è¯»å–è®°å½•æ•°</td>
<td align="left">A+B*A</td>
</tr>
<tr>
<td align="left">JOIN æ¯”è¾ƒæ¬¡æ•°</td>
<td align="left">B*A</td>
</tr>
<tr>
<td align="left">å›è¡¨è¯»å–è®°å½•æ¬¡æ•°</td>
<td align="left">0</td>
</tr>
</tbody></table>
<p>å½“ç„¶ MySQL è‚¯å®šä¸ä¼šè¿™ä¹ˆç²—æš´çš„è¿›è¡Œè¡¨çš„è¿æ¥ï¼Œæ‰€ä»¥å°±å‡ºç°äº†åé¢çš„ä¸¤ç§å…¶çš„ä¼˜åŒ–ç®—æ³•ã€‚</p>
<p>å¦å¤–ï¼Œä»è¯»å–è®°å½•æ•°æ¥çœ‹ï¼šA+B*Aä¸­ï¼Œé©±åŠ¨è¡¨Aå¯¹æ€§èƒ½çš„å½±å“æƒé‡æ›´å¤§ã€‚å› æ­¤æˆ‘ä»¬ä¼˜åŒ–å™¨ä¼šé€‰æ‹©å°è¡¨é©±åŠ¨å¤§è¡¨ã€‚</p>
<h4 id="3-3-3-Index-Nested-Loop-Joinï¼ˆç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰"><a href="#3-3-3-Index-Nested-Loop-Joinï¼ˆç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰" class="headerlink" title="3.3.3 Index Nested-Loop Joinï¼ˆç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰"></a>3.3.3 Index Nested-Loop Joinï¼ˆç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰</h4><p>Index Nested-Loop Join å…¶ä¼˜åŒ–çš„æ€è·¯ä¸»è¦æ˜¯ä¸ºäº† <code>å‡å°‘å†…å±‚è¡¨æ•°æ®çš„åŒ¹é…æ¬¡æ•°</code>ï¼Œæ‰€ä»¥è¦æ±‚è¢«é©±åŠ¨è¡¨ä¸Šå¿…é¡» <code>æœ‰ç´¢å¼•</code> æ‰è¡Œã€‚é€šè¿‡å¤–å±‚è¡¨åŒ¹é…æ¡ä»¶ç›´æ¥ä¸å†…å±‚ç´¢å¼•è¿›è¡ŒåŒ¹é…ï¼Œé¿å…å’Œå†…å±‚è¡¨çš„æ¯æ¡è®°å½•è¿›è¡Œæ¯”è¾ƒï¼Œè¿™æ ·æå¤§åœ°å‡å°‘äº†å¯¹å†…å±‚è¡¨çš„åŒ¹é…æ¬¡æ•°ã€‚</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615162.png" alt="image-20220826134205095"></p>
<p>é©±åŠ¨è¡¨ä¸­çš„æ¯æ¡è®°å½•é€šè¿‡è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•è¿›è¡Œè®¿é—®ï¼Œå› ä¸ºç´¢å¼•æŸ¥è¯¢çš„æˆæœ¬æ˜¯æ¯”è¾ƒå›ºå®šçš„ï¼Œæ•… MySQL ä¼˜åŒ–å™¨éƒ½å€¾å‘äºä½¿ç”¨è®°å½•æ•°å°‘çš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼ˆå¤–è¡¨ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å¼€é”€ç»Ÿè®¡</th>
<th align="left">SNLJ</th>
<th align="left">INLJ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å¤–è¡¨æ‰«ææ¬¡æ•°</td>
<td align="left">1</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">å†…è¡¨æ‰«ææ¬¡æ•°</td>
<td align="left">A</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">è¯»å–è®°å½•æ•°</td>
<td align="left">A+B*A</td>
<td align="left">A+Bï¼ˆmatchï¼‰</td>
</tr>
<tr>
<td align="left">JOIN æ¯”è¾ƒæ¬¡æ•°</td>
<td align="left">B*A</td>
<td align="left">A*Indexï¼ˆHeightï¼‰</td>
</tr>
<tr>
<td align="left">å›è¡¨è¯»å–è®°å½•æ¬¡æ•°</td>
<td align="left">0</td>
<td align="left">Bï¼ˆmatchï¼‰ï¼ˆif possibleï¼‰</td>
</tr>
</tbody></table>
<p>å¦‚æœè¢«é©±åŠ¨è¡¨åŠ ç´¢å¼•ï¼Œæ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼Œå¦‚æœç´¢å¼•ä¸æ˜¯ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥è¿˜å¾—è¿›è¡Œä¸€æ¬¡å›è¡¨æŸ¥è¯¢ã€‚ç›¸æ¯”ï¼Œè¢«é©±åŠ¨è¡¨çš„ç´¢å¼•æ˜¯ä¸»é”®ç´¢å¼•ï¼Œæ•ˆç‡ä¼šæ›´é«˜</p>
<h4 id="3-3-4-Block-Nested-Loop-Joinï¼ˆå¿«åµŒå¥—å¾ªç¯è¿æ¥ï¼‰"><a href="#3-3-4-Block-Nested-Loop-Joinï¼ˆå¿«åµŒå¥—å¾ªç¯è¿æ¥ï¼‰" class="headerlink" title="3.3.4 Block Nested-Loop Joinï¼ˆå¿«åµŒå¥—å¾ªç¯è¿æ¥ï¼‰"></a>3.3.4 Block Nested-Loop Joinï¼ˆå¿«åµŒå¥—å¾ªç¯è¿æ¥ï¼‰</h4><p>å¦‚æœå­˜åœ¨ç´¢å¼•ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨ index çš„æ–¹å¼è¿›è¡Œ joinï¼Œå¦‚æœ join çš„åˆ—æ²¡æœ‰ç´¢å¼•ï¼Œè¢«é©±åŠ¨è¡¨è¦æ‰«æçš„æ¬¡æ•°å¤ªå¤šäº†ã€‚æ¯æ¬¡è®¿é—®è¢«é©±åŠ¨è¡¨ï¼Œå…¶è¡¨ä¸­çš„è®°å½•éƒ½ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åå†ä»é©±åŠ¨è¡¨ä¸­å–ä¸€æ¡ä¸å…¶åŒ¹é…ï¼ŒåŒ¹é…ç»“æŸåæ¸…é™¤å†…å­˜ï¼Œç„¶åå†ä»é©±åŠ¨è¡¨ä¸­åŠ è½½ä¸€æ¡è®°å½•ï¼Œç„¶åæŠŠé©±åŠ¨è¡¨çš„è®°å½•å†åŠ è½½åˆ°å†…å­˜åŒ¹é…ï¼Œè¿™æ ·å‘¨è€Œå¤å§‹ï¼Œå¤§å¤§å¢åŠ äº† IO æ¬¡æ•°ã€‚ä¸ºäº†å‡å°‘è¢«é©±åŠ¨è¡¨çš„ IO æ¬¡æ•°ï¼Œå°±å‡ºç°äº† <code>Block Nested-Loop Join</code>çš„æ–¹å¼</p>
<p>ä¸å†æ˜¯é€æ¡è·å–é©±åŠ¨è¡¨çš„æ•°æ®ï¼Œè€Œæ˜¯ä¸€å—ä¸€å—çš„è·å–ï¼Œå¼•å…¥äº† <code>join buffer ç¼“å†²åŒº</code>ï¼Œå°†é©±åŠ¨è¡¨ join ç›¸å…³çš„éƒ¨åˆ†æ•°æ®åˆ—ï¼ˆå¤§å°å— join buffer çš„é™åˆ¶ï¼‰ç¼“å­˜åˆ° join buffer ä¸­ï¼Œç„¶åå…¨è¡¨æ‰«æè¢«é©±åŠ¨è¡¨ï¼Œè¢«é©±åŠ¨è¡¨çš„æ¯ä¸€æ¡è®°å½•ä¸€æ¬¡æ€§å’Œ join buffer ä¸­çš„æ‰€æœ‰é©±åŠ¨è¡¨è®°å½•è¿›è¡ŒåŒ¹é…ï¼ˆå†…å­˜ä¸­æ“ä½œï¼‰ï¼Œå°†ç®€å•åµŒå¥—å¾ªç¯ä¸­çš„å¤šæ¬¡æ¯”è¾ƒåˆå¹¶æˆä¸€æ¬¡ï¼Œé™ä½äº†è¢«åŠ¨è¡¨çš„è®¿é—®é¢‘ç‡ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<p>è¿™é‡Œç¼“å­˜çš„ä¸åªæ˜¯å…³è”è¡¨çš„åˆ—ï¼Œselect åé¢çš„åˆ—ä¹Ÿä¼šç¼“å­˜èµ·æ¥</p>
<p>åœ¨ä¸€ä¸ªæœ‰ N ä¸ª join å…³è”çš„ SQL ä¸­ä¼šåˆ†é… N-1 ä¸ª join bufferã€‚æ‰€ä»¥æŸ¥è¯¢çš„æ—¶å€™å°½é‡å‡å°‘ä¸å¿…è¦çš„å­—æ®µï¼Œå¯ä»¥ è®© join buffer ä¸­å­˜æ”¾æ›´å¤šçš„åˆ—ã€‚</p>
</blockquote>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615499.png" alt="image-20220826135208899"></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301620444.png" alt="image-20220826135248800"></p>
<p>å‚æ•°è®¾ç½®ï¼š</p>
<ul>
<li><p>block_nested_loop</p>
<p>é€šè¿‡ <code>show variables like &#39;%optimizer_switch%&#39;</code> æŸ¥çœ‹ <code>block_nested_loop</code> çŠ¶æ€ã€‚é»˜è®¤æ˜¯å¼€å¯çš„ã€‚</p>
</li>
<li><p>join_buffer_size</p>
<p>é©±åŠ¨è¡¨èƒ½ä¸èƒ½ä¸€æ¬¡åŠ è½½å®Œï¼Œè¦çœ‹ join buffer èƒ½ä¸èƒ½å­˜å‚¨æ‰€æœ‰çš„æ•°æ®ï¼Œé»˜è®¤æƒ…å†µä¸‹ <code>join_buffer_size = 256K</code>ã€‚</p>
<p>join <em>buffer</em> size çš„æœ€å¤§å€¼åœ¨ 32 ä½ç³»ç»Ÿå¯ä»¥ç”³è¯· 4Gï¼Œè€Œåœ¨ 64 ä½æ“åšç³»ç»Ÿä¸‹å¯ä»¥ç”³è¯·å¤§äº 4G çš„ join_bufferç©ºé—´ï¼ˆ64 ä½ Windows é™¤å¤–ï¼Œå…¶å¤§å€¼ä¼šè¢«æˆªæ–­ä¸º 4GBå¹¶å‘å‡ºè­¦å‘Šï¼‰ã€‚</p>
</li>
</ul>
<h4 id="3-3-5-å°ç»“"><a href="#3-3-5-å°ç»“" class="headerlink" title="3.3.5 å°ç»“"></a>3.3.5 å°ç»“</h4><ol>
<li>ä¿è¯è¢«é©±åŠ¨è¡¨çš„ JOIN å­—æ®µå·²ç»åˆ›å»ºäº†ç´¢å¼•ï¼ˆå‡å°‘å†…å±‚è¡¨çš„å¾ªç¯åŒ¹é…æ¬¡æ•°ï¼‰</li>
<li>éœ€è¦ JOIN çš„å­—æ®µï¼Œæ•°æ®ç±»å‹ä¿æŒç»å¯¹ä¸€è‡´ã€‚</li>
<li>LEFT JOIN æ—¶ï¼Œé€‰æ‹©å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œ å¤§è¡¨ä½œä¸ºè¢«é©±åŠ¨è¡¨ ã€‚å‡å°‘å¤–å±‚å¾ªç¯çš„æ¬¡æ•°ã€‚</li>
<li>INNER JOIN æ—¶ï¼ŒMySQL ä¼šè‡ªåŠ¨å°†å°ç»“æœé›†çš„è¡¨é€‰ä¸ºé©±åŠ¨è¡¨ ã€‚é€‰æ‹©ç›¸ä¿¡ MySQL ä¼˜åŒ–ç­–ç•¥ã€‚</li>
<li>èƒ½å¤Ÿç›´æ¥å¤šè¡¨å…³è”çš„å°½é‡ç›´æ¥å…³è”ï¼Œä¸ç”¨å­æŸ¥è¯¢ã€‚(å‡å°‘æŸ¥è¯¢çš„è¶Ÿæ•°)</li>
<li>ä¸å»ºè®®ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå»ºè®®å°†å­æŸ¥è¯¢ SQL æ‹†å¼€ç»“åˆç¨‹åºå¤šæ¬¡æŸ¥è¯¢ï¼Œæˆ–ä½¿ç”¨ JOIN æ¥ä»£æ›¿å­æŸ¥è¯¢ã€‚</li>
<li>è¡ç”Ÿè¡¨å»ºä¸äº†ç´¢å¼•</li>
<li>é»˜è®¤æ•ˆç‡æ¯”è¾ƒï¼š&#x3D;&#x3D;INLJ &gt; BNLJ &gt; SNLJ&#x3D;&#x3D;</li>
<li>æ­£ç¡®ç†è§£å°è¡¨é©±åŠ¨å¤§è¡¨ï¼šå¤§å°ä¸æ˜¯æŒ‡è¡¨ä¸­çš„è®°å½•æ•°ï¼Œè€Œæ˜¯æ°¸è¿œç”¨å°ç»“æœé›†é©±åŠ¨å¤§ç»“æœé›†ï¼ˆå…¶æœ¬è´¨å°±æ˜¯å‡å°‘å¤–å±‚å¾ªç¯çš„æ•°æ®æ•°é‡ï¼‰ã€‚ æ¯”å¦‚Aè¡¨æœ‰100æ¡è®°å½•ï¼ŒBè¡¨æœ‰1000æ¡è®°å½•ï¼Œä½†æ˜¯whereæ¡ä»¶è¿‡æ»¤åï¼ŒBè¡¨ç»“æœé›†åªç•™ä¸‹50ä¸ªè®°å½•ï¼ŒAè¡¨ç»“æœé›†æœ‰80æ¡è®°å½•ï¼Œæ­¤æ—¶å°±å¯èƒ½æ˜¯Bè¡¨é©±åŠ¨Aè¡¨ã€‚å…¶å®ä¸Šé¢çš„ä¾‹å­è¿˜æ˜¯ä¸å¤Ÿå‡†ç¡®ï¼Œå› ä¸ºç»“æœé›†çš„å¤§å°ä¹Ÿä¸èƒ½ç²—ç•¥çš„ç”¨ç»“æœé›†çš„è¡Œæ•°è¡¨ç¤ºï¼Œè€Œæ˜¯&#x3D;&#x3D;è¡¨è¡Œæ•° * æ¯è¡Œå¤§å°&#x3D;&#x3D;ã€‚å…¶å®è¦ç†è§£ä½ åªéœ€è¦ç»“åˆJoin Bufferå°±å¥½äº†ï¼Œå› ä¸ºè¡¨è¡Œæ•° * æ¯è¡Œå¤§å°è¶Šå°ï¼Œå…¶å ç”¨å†…å­˜è¶Šå°,å°±å¯ä»¥åœ¨Join Bufferä¸­å°½é‡å°‘çš„æ¬¡æ•°åŠ è½½å®Œäº†ã€‚</li>
</ol>
<h4 id="3-3-6-Hash-Join"><a href="#3-3-6-Hash-Join" class="headerlink" title="3.3.6 Hash Join"></a>3.3.6 Hash Join</h4><p>&#x3D;&#x3D;ä» MySQL 8.0.20 ç‰ˆæœ¬å¼€å§‹å°†åºŸå¼ƒ BNLJï¼Œå› ä¸ºåŠ å…¥äº† hash join é»˜è®¤éƒ½ä¼šä½¿ç”¨ hash join&#x3D;&#x3D;</p>
<ul>
<li><p>Nested Loopï¼š</p>
<p>å¯¹äºè¢«è¿æ¥çš„æ•°æ®å­é›†è¾ƒå°çš„æƒ…å†µï¼ŒNested Loop æ˜¯ä¸ªè¾ƒå¥½çš„é€‰æ‹©ã€‚</p>
</li>
<li><p>Hash Join æ˜¯åš <code>å¤§æ•°æ®é›†è¿æ¥</code> æ—¶çš„å¸¸ç”¨æ–¹æ³•ï¼Œä¼˜åŒ–å™¨ä½¿ç”¨ä¸¤ä¸ªè¡¨ä¸­è¾ƒå°ï¼ˆç›¸å¯¹è¾ƒå°ï¼‰çš„è¡¨åˆ©ç”¨ join key åœ¨å†…å­˜ä¸­å»ºç«‹ <code>æ•£åˆ—è¡¨</code>ï¼Œç„¶åæ‰«æè¾ƒå¤§çš„è¡¨å¹¶æ¢æµ‹æ•£åˆ—è¡¨ï¼Œæ‰¾å‡ºä¸ Hash è¡¨åŒ¹é…çš„è¡Œã€‚</p>
<ul>
<li>è¿™ç§æ–¹å¼é€‚ç”¨äºè¾ƒå°çš„è¡¨å®Œå…¨å¯ä»¥æ”¾äºå†…å­˜ä¸­çš„æƒ…å†µï¼Œè¿™æ ·æ€»æˆæœ¬å°±æ˜¯è®¿é—®ä¸¤ä¸ªè¡¨çš„æˆæœ¬ä¹‹å’Œ</li>
<li>åœ¨è¡¨å¾ˆå¤§çš„æƒ…å†µä¸‹å¹¶ä¸èƒ½å®Œå…¨æ”¾å…¥å†…å­˜ï¼Œè¿™æ—¶ä¼˜åŒ–å™¨ä¼šå°†å®ƒåˆ†å‰²æˆ <code>è‹¥å¹²ä¸åŒçš„åˆ†åŒº</code>ï¼Œä¸èƒ½æ”¾å…¥å†…å­˜çš„éƒ¨åˆ†å°±æŠŠè¯¥åˆ†åŒºå†™å…¥ç£ç›˜çš„ä¸´æ—¶æ®µï¼Œæ­¤æ—¶è¦æ±‚æœ‰è¾ƒå¤§çš„ä¸´æ—¶æ®µä»è€Œå°½é‡æé«˜ I&#x2F;O çš„æ€§èƒ½ã€‚</li>
<li>å®ƒèƒ½å¤Ÿå¾ˆå¥½çš„å·¥ä½œäºæ²¡æœ‰ç´¢å¼•çš„å¤§è¡¨å’Œå¹¶è¡ŒæŸ¥è¯¢çš„ç¯å¢ƒä¸­ï¼Œå¹¶æä¾›æœ€å¥½çš„æ€§èƒ½ã€‚å¤§å¤šæ•°äººéƒ½è¯´å®ƒæ˜¯ Join çš„é‡å‹å‡é™æœºã€‚Hash Join åªèƒ½åº”ç”¨äºç­‰å€¼è¿æ¥ï¼ˆå¦‚ WHERE A.COL1 &#x3D; B.COL2ï¼‰ï¼Œè¿™æ˜¯ç”± Hash çš„ç‰¹ç‚¹å†³å®šçš„ã€‚</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">ç±»å‹</th>
<th align="left">Nested Loop</th>
<th align="left">Hash Join</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ä½¿ç”¨æ¡ä»¶</td>
<td align="left">ä»»ä½•æ¡ä»¶</td>
<td align="left">ç­‰å€¼è¿æ¥ï¼ˆ&#x3D;ï¼‰</td>
</tr>
<tr>
<td align="left">ç›¸å…³èµ„æº</td>
<td align="left">CPUã€ç£ç›˜ I&#x2F;O</td>
<td align="left">å†…å­˜ã€ä¸´æ—¶ç©ºé—´</td>
</tr>
<tr>
<td align="left">ç‰¹ç‚¹</td>
<td align="left">å½“æœ‰é«˜é€‰æ‹©æ€§ç´¢å¼•æˆ–è¿›è¡Œé™åˆ¶æ€§æœç´¢æ—¶æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œèƒ½å¤Ÿå¿«é€Ÿè¿”å›ç¬¬ä¸€æ¬¡çš„æœç´¢ç»“æœ</td>
<td align="left">å½“ç¼ºä¹ç´¢å¼•æˆ–è€…ç´¢å¼•æ¡ä»¶æ¨¡ç³Šæ—¶ï¼ŒHash Join æ¯” Nested Loop æœ‰æ•ˆã€‚åœ¨æ•°æ®ä»“åº“ç¯å¢ƒä¸‹ï¼Œå¦‚æœè¡¨çš„è®°å½•æ•°å¤šï¼Œæ•ˆç‡é«˜</td>
</tr>
<tr>
<td align="left">ç¼ºç‚¹</td>
<td align="left">å½“ç´¢å¼•ä¸¢å¤±æˆ–è€…æŸ¥è¯¢æ¡ä»¶é™åˆ¶ä¸å¤Ÿæ—¶ï¼Œæ•ˆç‡å¾ˆä½ï¼›å½“è¡¨çš„è®°å½•æ•°è¾ƒå¤šï¼Œæ•ˆç‡ä½</td>
<td align="left">ä¸ºç®€å†å“ˆå¸Œè¡¨ï¼Œéœ€è¦å¤§é‡å†…å­˜ã€‚ç¬¬ä¸€æ¬¡çš„ç»“æœè¿”å›è¾ƒæ…¢</td>
</tr>
</tbody></table>
<h2 id="4-å­æŸ¥è¯¢ä¼˜åŒ–"><a href="#4-å­æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="4. å­æŸ¥è¯¢ä¼˜åŒ–"></a>4. å­æŸ¥è¯¢ä¼˜åŒ–</h2><p>MySQL ä» 4.1 ç‰ˆæœ¬å¼€å§‹æ”¯æŒå­æŸ¥è¯¢ï¼Œä½¿ç”¨å­æŸ¥è¯¢å¯ä»¥è¿›è¡Œ SELECT è¯­å¥çš„åµŒå¥—æŸ¥è¯¢ï¼Œå³ä¸€ä¸ª SELECT æŸ¥è¯¢çš„ç»“æœä½œä¸ºå¦ä¸€ä¸ª SELECT è¯­å¥çš„æ¡ä»¶ã€‚<code>å­æŸ¥è¯¢å¯ä»¥ä¸€æ¬¡æ€§å®Œæˆå¾ˆå¤šé€»è¾‘ä¸Šéœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆçš„æ“ä½œ</code> ã€‚</p>
<p><strong>å­æŸ¥è¯¢æ˜¯ MySQL çš„ä¸€é¡¹é‡è¦çš„åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª SQL è¯­å¥å®ç°æ¯”è¾ƒå¤æ‚çš„æŸ¥è¯¢ã€‚ä½†æ˜¯ï¼Œå­æŸ¥è¯¢çš„æ‰§è¡Œæ•ˆç‡ä¸é«˜ã€‚</strong> é€šå¸¸æˆ‘ä»¬å¯ä»¥å°†å…¶ä¼˜åŒ–æˆä¸€ä¸ªè¿æ¥æŸ¥è¯¢~</p>
<p>åŸå› :</p>
<p><font color=blue>â‘ </font> æ‰§è¡Œå­æŸ¥è¯¢æ—¶ï¼ŒMySQL éœ€è¦ä¸ºå†…å±‚æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢ç»“æœ<code>å»ºç«‹ä¸€ä¸ªä¸´æ—¶è¡¨</code> ï¼Œç„¶åå¤–å±‚æŸ¥è¯¢è¯­å¥ä»ä¸´æ—¶è¡¨ä¸­æŸ¥è¯¢è®°å½•ã€‚æŸ¥è¯¢å®Œæ¯•åï¼Œå†<code>æ’¤é”€è¿™äº›ä¸´æ—¶è¡¨</code> ã€‚è¿™æ ·ä¼šæ¶ˆè€—è¿‡å¤šçš„ CPU å’Œ IO èµ„æºï¼Œäº§ç”Ÿå¤§é‡çš„æ…¢æŸ¥è¯¢ã€‚</p>
<p><font color=blue>â‘¡</font> å­æŸ¥è¯¢çš„ç»“æœé›†å­˜å‚¨çš„ä¸´æ—¶è¡¨ï¼Œä¸è®ºæ˜¯å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨éƒ½ <code>ä¸ä¼šå­˜åœ¨ç´¢å¼•</code> ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ã€‚</p>
<p><font color=blue>â‘¢</font> å¯¹äºè¿”å›ç»“æœé›†æ¯”è¾ƒå¤§çš„å­æŸ¥è¯¢ï¼Œå…¶å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚</p>
<p>&#x3D;&#x3D;åœ¨ MySQL ä¸­ï¼Œå¯ä»¥ä½¿ç”¨è¿æ¥ï¼ˆJOINï¼‰æŸ¥è¯¢æ¥æ›¿ä»£å­æŸ¥è¯¢ã€‚&#x3D;&#x3D; è¿æ¥æŸ¥è¯¢ <code>ä¸éœ€è¦å»ºç«‹ä¸´æ—¶è¡¨</code>ï¼Œå…¶ <code>é€Ÿåº¦æ¯”å­æŸ¥è¯¢è¦å¿«</code>ï¼Œå¦‚æœæŸ¥è¯¢ä¸­ä½¿ç”¨ç´¢å¼•çš„è¯ï¼Œæ€§èƒ½å°±ä¼šæ›´å¥½ã€‚</p>
<p><strong><font color=green>ä¸¾ä¾‹1ï¼šæŸ¥è¯¢å­¦ç”Ÿè¡¨ä¸­æ˜¯ç­é•¿çš„å­¦ç”Ÿä¿¡æ¯</font></strong></p>
<ul>
<li>ä½¿ç”¨å­æŸ¥è¯¢</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºç­çº§è¡¨ä¸­ç­é•¿çš„ç´¢å¼•</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_monitor <span class="keyword">ON</span> class(monitor);</span><br><span class="line"></span><br><span class="line">#æŸ¥è¯¢ç­é•¿çš„ä¿¡æ¯</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student stu1</span><br><span class="line">    <span class="keyword">WHERE</span> stu1.`stuno` <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> monitor</span><br><span class="line">    <span class="keyword">FROM</span> class c</span><br><span class="line">    <span class="keyword">WHERE</span> monitor <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>æ¨èï¼šä½¿ç”¨å¤šè¡¨æŸ¥è¯¢</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> stu1.<span class="operator">*</span> <span class="keyword">FROM</span> student stu1 <span class="keyword">JOIN</span> class c </span><br><span class="line"><span class="keyword">ON</span> stu1.`stuno` <span class="operator">=</span> c.`monitor`</span><br><span class="line"><span class="keyword">WHERE</span> c.`monitor` <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<p><strong><font color=green>ä¸¾ä¾‹2ï¼šå–æ‰€æœ‰ä¸ä¸ºç­é•¿çš„åŒå­¦</font></strong></p>
<ul>
<li>ä¸æ¨è</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#æŸ¥è¯¢ä¸ä¸ºç­é•¿çš„å­¦ç”Ÿä¿¡æ¯</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE a.<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> student a </span><br><span class="line"><span class="keyword">WHERE</span>  a.stuno  <span class="keyword">NOT</span>  <span class="keyword">IN</span> (</span><br><span class="line">            <span class="keyword">SELECT</span> monitor <span class="keyword">FROM</span> class b </span><br><span class="line">            <span class="keyword">WHERE</span> monitor <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>æ¨è</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># è½¬æ¢æˆå·¦è¿æ¥æŸ¥è¯¢</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE a.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span>  student a <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> class b </span><br><span class="line"><span class="keyword">ON</span> a.stuno <span class="operator">=</span>b.monitor</span><br><span class="line"><span class="keyword">WHERE</span> b.monitor <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç»“è®ºï¼šå°½é‡ä¸è¦ä½¿ç”¨ NOT IN æˆ–è€… NOT EXISTSï¼Œç”¨ <code>LEFT JOIN xxx ON xx WHERE xx IS NULL</code> æ›¿ä»£</p>
</blockquote>
<h2 id="5-æ’åºä¼˜åŒ–"><a href="#5-æ’åºä¼˜åŒ–" class="headerlink" title="5. æ’åºä¼˜åŒ–"></a>5. æ’åºä¼˜åŒ–</h2><h3 id="5-1-æ’åºä¼˜åŒ–"><a href="#5-1-æ’åºä¼˜åŒ–" class="headerlink" title="5.1 æ’åºä¼˜åŒ–"></a>5.1 æ’åºä¼˜åŒ–</h3><p><strong>é—®é¢˜ï¼šåœ¨ WHERE æ¡ä»¶å­—æ®µä¸ŠåŠ ç´¢å¼•ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆåœ¨ ORDER BY å­—æ®µä¸Šè¿˜è¦åŠ ç´¢å¼•å‘¢ï¼Ÿ</strong></p>
<p>åœ¨ MySQL ä¸­ï¼Œæ”¯æŒä¸¤ç§æ’åºæ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ <code>FileSort</code> å’Œ <code>Index</code> æ’åºã€‚</p>
<ul>
<li>Index æ’åºä¸­ï¼Œç´¢å¼•å¯ä»¥ä¿è¯æ•°æ®çš„æœ‰åºæ€§ï¼Œå°±ä¸éœ€è¦å†è¿›è¡Œæ’åºï¼Œ<code>æ•ˆç‡æ›´æ›´é«˜</code>ã€‚</li>
<li>FileSort æ’åºåˆ™ä¸€èˆ¬åœ¨ <code>å†…å­˜ä¸­</code> è¿›è¡Œæ’åºï¼Œå ç”¨ <code>CPU è¾ƒå¤š</code>ã€‚å¦‚æœå¾…æ’åºçš„ç»“æœè¾ƒå¤§ï¼Œä¼šäº§ç”Ÿä¸´æ—¶æ–‡ä»¶ I&#x2F;O åˆ°ç£ç›˜è¿›è¡Œæ’åºçš„æƒ…å†µï¼Œæ•ˆç‡ä½ã€‚</li>
</ul>
<p><strong>ä¼˜åŒ–å»ºè®®:</strong></p>
<ol>
<li>SQL ä¸­ï¼Œå¯ä»¥åœ¨ WHERE å­å¥å’Œ ORDER BY å­å¥ä¸­ä½¿ç”¨ç´¢å¼•ï¼Œç›®çš„æ˜¯åœ¨ WHERE å­å¥ä¸­ <code>é¿å…å…¨è¡¨æ‰«æ</code>ï¼Œåœ¨ ORDER BY å­å¥ <code>é¿å…ä½¿ç”¨ FileSort æ’åº</code>ã€‚å½“ç„¶ï¼ŒæŸäº›æƒ…å†µä¸‹å…¨è¡¨æ‰«æï¼Œæˆ–è€… FileSort æ’åºä¸ä¸€å®šæ¯”ç´¢å¼•æ…¢ã€‚ä½†æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦é¿å…ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li>
<li>å°½é‡ä½¿ç”¨ Index å®Œæˆ ORDER BY æ’åºã€‚å¦‚æœ WHERE å’Œ ORDER BY åé¢æ˜¯ç›¸åŒçš„åˆ—å°±ä½¿ç”¨å•ç´¢å¼•åˆ—ï¼›å¦‚æœä¸åŒå°±ä½¿ç”¨è”åˆç´¢å¼•ã€‚</li>
<li>æ— æ³•ä½¿ç”¨ Index æ—¶ï¼Œéœ€è¦å¯¹ FileSort æ–¹å¼è¿›è¡Œè°ƒä¼˜ã€‚</li>
</ol>
<h3 id="5-2-æµ‹è¯•"><a href="#5-2-æµ‹è¯•" class="headerlink" title="5.2 æµ‹è¯•"></a>5.2 æµ‹è¯•</h3><p>æ‰§å…ˆæ¡ˆä¾‹å‰ï¼Œè°ƒç”¨å­˜å‚¨è¿‡ç¨‹åˆ é™¤studentå’Œclassè¡¨ä¸Šçš„ç´¢å¼•ã€‚åªç•™ä¸»é”®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> proc_drop_index(<span class="string">&#x27;atguigudb2&#x27;</span>,<span class="string">&#x27;student&#x27;</span>);</span><br><span class="line"><span class="keyword">call</span> proc_drop_index(<span class="string">&#x27;atguigudb2&#x27;</span>,<span class="string">&#x27;class&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹æ˜¯å¦èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œèƒ½å¦å»æ‰ <code>using filesort</code></p>
<p><strong>è¿‡ç¨‹ä¸€ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> age,classid;  </span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615099.png" alt="image-20220826151348825"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> age,classid LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615874.png" alt="image-20220826151419544"></p>
<p><strong>è¿‡ç¨‹äºŒï¼š</strong></p>
<p><strong><font color=blue>1. åˆ›å»ºç´¢å¼•ï¼Œä½†æ˜¯ä¸åŠ limité™åˆ¶ï¼Œç´¢å¼•å¤±æ•ˆ</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span>  INDEX idx_age_classid_name <span class="keyword">ON</span> student (age,classid,NAME);</span><br><span class="line"></span><br><span class="line">#ä¸é™åˆ¶,ç´¢å¼•å¤±æ•ˆ</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> age,classid; </span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615019.png" alt="image-20220826151550127"></p>
<p>æˆ‘ä»¬ä¸æ˜¯å»ºç«‹äº†ç´¢å¼•å˜›ï¼Œä¸ºå•¥æ˜¾ç¤ºæ²¡æœ‰ä½¿ç”¨å‘¢ï¼Ÿè¿™æ˜¯ä¼˜åŒ–å™¨é€šè¿‡è®¡ç®—å‘ç°ï¼Œè¿™é‡Œéœ€è¦å›è¡¨çš„æ•°æ®é‡ç‰¹åˆ«å¤§ï¼Œä½¿ç”¨ç´¢å¼•çš„æ€§èƒ½ä»£ä»·åè€Œæ¯”ä¸ä¸Šä¸ç”¨ç´¢å¼•çš„ã€‚</p>
<p><strong><font color=blue>2. å‡å¦‚æˆ‘ä»¬æœ€ååªæŸ¥è¯¢äºŒçº§ç´¢å¼•ä¸­æœ‰çš„å­—æ®µï¼Œè§‚å¯Ÿç»“æœï¼š</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ä¼šä½¿ç”¨ç´¢å¼• ï¼ˆè¦†ç›–ç´¢å¼•ï¼‰</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> SQL_NO_CACHE age,classid,name,id <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> age,classid;  </span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615338.png" alt="image-20220826151951066"></p>
<p><strong><font color=blue>3. å‡å¦‚æˆ‘ä»¬é™åˆ¶æ’åºè¿”å›çš„ç»“æœæ•°é‡ï¼Œè§‚å¯Ÿç»“æœï¼š</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#å¢åŠ limitè¿‡æ»¤æ¡ä»¶ï¼Œä½¿ç”¨ä¸Šç´¢å¼•äº†ã€‚</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> age,classid LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301615418.png" alt="image-20220826152308067"></p>
<p><strong>è¿‡ç¨‹ä¸‰ï¼šorder by æ—¶é¡ºåºé”™è¯¯ï¼Œç´¢å¼•å¤±æ•ˆ</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºç´¢å¼•age,classid,stuno</span><br><span class="line"><span class="keyword">CREATE</span>  INDEX idx_age_classid_stuno <span class="keyword">ON</span> student (age,classid,stuno); </span><br><span class="line"></span><br><span class="line">#ä»¥ä¸‹å“ªäº›ç´¢å¼•å¤±æ•ˆ?</span><br><span class="line"># å¤±æ•ˆ</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> classid LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"># å¤±æ•ˆ</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> classid,NAME LIMIT <span class="number">10</span>;  </span><br><span class="line"></span><br><span class="line"># å¯ä»¥</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> age,classid,stuno LIMIT <span class="number">10</span>; </span><br><span class="line"></span><br><span class="line"># å¯ä»¥</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> age,classid LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"># å¯ä»¥</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> age LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p><strong>è¿‡ç¨‹å››ï¼šorder by æ—¶è§„åˆ™ä¸ä¸€è‡´, ç´¢å¼•å¤±æ•ˆ ï¼ˆé¡ºåºé”™ï¼Œä¸ç´¢å¼•ï¼›æ–¹å‘åï¼Œä¸ç´¢å¼•ï¼‰</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># å¤±æ•ˆ</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">DESC</span>, classid <span class="keyword">ASC</span> LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"># å¤±æ•ˆ</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> classid <span class="keyword">DESC</span>, NAME <span class="keyword">DESC</span> LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"># å¤±æ•ˆ</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">ASC</span>,classid <span class="keyword">DESC</span> LIMIT <span class="number">10</span>; </span><br><span class="line"></span><br><span class="line"># å¯ä»¥</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">DESC</span>, classid <span class="keyword">DESC</span> LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p><strong>è¿‡ç¨‹äº”ï¼šæ— è¿‡æ»¤ï¼Œä¸ç´¢å¼•</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># å¯ä»¥</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">45</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> classid;</span><br><span class="line"></span><br><span class="line"># å¯ä»¥</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age<span class="operator">=</span><span class="number">45</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> classid,NAME; </span><br><span class="line"></span><br><span class="line"># å¤±æ•ˆ</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> classid<span class="operator">=</span><span class="number">45</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> age;</span><br><span class="line"></span><br><span class="line"># å¯ä»¥</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> classid<span class="operator">=</span><span class="number">45</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> age LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_cid <span class="keyword">ON</span> student(classid);</span><br><span class="line"></span><br><span class="line"># å¯ä»¥</span><br><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> classid<span class="operator">=</span><span class="number">45</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> age;</span><br></pre></td></tr></table></figure>

<p><strong>å°ç»“ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">INDEX a_b_c(a,b,c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> èƒ½ä½¿ç”¨ç´¢å¼•æœ€å·¦å‰ç¼€ <span class="operator">-</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> a</span><br><span class="line"><span class="operator">-</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> a,b</span><br><span class="line"><span class="operator">-</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> a,b,c</span><br><span class="line"><span class="operator">-</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> a <span class="keyword">DESC</span>,b <span class="keyword">DESC</span>,c <span class="keyword">DESC</span></span><br><span class="line"></span><br><span class="line">å¦‚æœ <span class="keyword">WHERE</span> ä½¿ç”¨ç´¢å¼•çš„æœ€å·¦å‰ç¼€å®šä¹‰ä¸ºå¸¸é‡ï¼Œåˆ™ <span class="keyword">order</span> <span class="keyword">by</span> èƒ½ä½¿ç”¨ç´¢å¼• </span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> b,c</span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> const <span class="keyword">AND</span> b <span class="operator">=</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> c</span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> b,c</span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> const <span class="keyword">AND</span> b <span class="operator">&gt;</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> b,c</span><br><span class="line"></span><br><span class="line">ä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åº</span><br><span class="line"><span class="operator">-</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> a <span class="keyword">ASC</span>,b <span class="keyword">DESC</span>,c <span class="keyword">DESC</span> <span class="comment">/* æ’åºä¸ä¸€è‡´ */</span> </span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> g <span class="operator">=</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> b,c <span class="comment">/*ä¸¢å¤±aç´¢å¼•*/</span></span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> c <span class="comment">/*ä¸¢å¤±bç´¢å¼•*/</span></span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> const <span class="keyword">ORDER</span> <span class="keyword">BY</span> a,d <span class="comment">/*dä¸æ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†*/</span></span><br><span class="line"><span class="operator">-</span> <span class="keyword">WHERE</span> a <span class="keyword">in</span> (...) <span class="keyword">ORDER</span> <span class="keyword">BY</span> b,c <span class="comment">/*å¯¹äºæ’åºæ¥è¯´ï¼Œå¤šä¸ªç›¸ç­‰æ¡ä»¶ä¹Ÿæ˜¯èŒƒå›´æŸ¥è¯¢*/</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-æ¡ˆä¾‹å®æˆ˜"><a href="#5-3-æ¡ˆä¾‹å®æˆ˜" class="headerlink" title="5.3 æ¡ˆä¾‹å®æˆ˜"></a>5.3 æ¡ˆä¾‹å®æˆ˜</h3><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹æ¥å®æˆ˜filesortå’Œindexä¸¤ç§æ’åºã€‚&#x3D;&#x3D;å¯¹ORDER BYå­å¥ï¼Œå°½é‡ä½¿ç”¨ Index æ–¹å¼æ’åºï¼Œé¿å…ä½¿ç”¨ FileSort æ–¹å¼æ’åº&#x3D;&#x3D;ã€‚</p>
<p><font color=blue><strong>åœºæ™¯:æŸ¥è¯¢å¹´é¾„ä¸º30å²çš„ï¼Œä¸”å­¦ç”Ÿç¼–å·å°äº101000çš„å­¦ç”Ÿï¼ŒæŒ‰ç”¨æˆ·åç§°æ’åº</strong></font></p>
<p>æ‰§è¡Œæ¡ˆä¾‹å‰å…ˆæ¸…é™¤studentä¸Šçš„ç´¢å¼•ï¼Œåªç•™ä¸»é”®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX idx_age <span class="keyword">ON</span> student;</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_age_classid_stuno <span class="keyword">ON</span> student;</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_age_classid_name <span class="keyword">ON</span> student;</span><br><span class="line">#æˆ–è€…</span><br><span class="line"><span class="keyword">call</span> proc_drop_index(<span class="string">&#x27;atguigudb2&#x27;</span>,<span class="string">&#x27;student&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä»¥ä¸‹çš„æŸ¥è¯¢ï¼Œæ­¤æ—¶æ˜¾ç„¶ä½¿ç”¨çš„æ˜¯filesortè¿›è¡Œæ’åº</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">AND</span> stuno <span class="operator">&lt;</span><span class="number">101000</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> NAME ;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301616220.png" alt="image-20220317213102709"></p>
<p>ç»“è®ºï¼štype æ˜¯ ALLï¼Œå³æœ€åçš„æƒ…å†µã€‚Extra é‡Œè¿˜å‡ºç°äº† Using filesortï¼Œä¹Ÿæ˜¯æœ€åçš„æƒ…å†µã€‚ä¼˜åŒ–æ˜¯å¿…é¡»çš„ã€‚</p>
<p><strong>æ–¹æ¡ˆä¸€ï¼šä¸ºäº†å»æ‰ filesort æˆ‘ä»¬å¯ä»¥åˆ›å»ºç‰¹å®šç´¢å¼•</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºæ–°ç´¢å¼•</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_name <span class="keyword">ON</span> student(age,NAME);</span><br><span class="line"># è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»ä½¿ç”¨äº†ç´¢å¼•ï¼Œè™½ç„¶ä»…ä»…ä½¿ç”¨åˆ°äº†ageè¿™ä¸ªå­—æ®µ</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">AND</span> stuno <span class="operator">&lt;</span> <span class="number">101000</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> NAME ;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301616745.png" alt="image-20220317213227501"></p>
<p><strong>æ–¹æ¡ˆäºŒï¼šå°½é‡è®© where çš„è¿‡æ»¤æ¡ä»¶å’Œæ’åºä½¿ç”¨ä¸Šç´¢å¼•</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX idx_age_name <span class="keyword">ON</span> student;</span><br><span class="line"># å»ºç«‹ä¸‰ä¸ªå­—æ®µçš„ç´¢å¼•</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_stuno_name <span class="keyword">ON</span> student (age,stuno,NAME);</span><br><span class="line"># è¿›è¡Œæµ‹è¯•</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> SQL_NO_CACHE <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">AND</span> stuno <span class="operator">&lt;</span><span class="number">101000</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> NAME ;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301616962.png" alt="image-20220317213450582"></p>
<p>æ­¤æ—¶åˆä½¿ç”¨äº†filesortï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæ­¤æ—¶filesortçš„æ€§èƒ½æ›´é«˜ã€‚ä¸ä¿¡ä½ å¯ä»¥å¯¹æ¯”æ‰§è¡Œä¸‹ï¼ˆ0.03secå’Œ0.00secï¼‰ï¼Œçœ‹çœ‹æ—¶é—´çš„åŒºåˆ«ã€‚ç»“æœç«Ÿç„¶æœ‰ filesort çš„ sql è¿è¡Œé€Ÿåº¦ï¼Œè¶…è¿‡äº†å·²ç»ä¼˜åŒ–æ‰ filesortçš„ sqlï¼Œè€Œä¸”å¿«äº†å¾ˆå¤šï¼Œå‡ ä¹ä¸€ç¬é—´å°±å‡ºç°äº†ç»“æœã€‚çœ‹æ¥ä¼˜åŒ–å™¨åšçš„å·¥ä½œçœŸçš„ç‰¹åˆ«çµæ´»</p>
<p><strong>åŸå› </strong>ï¼šæ‰€æœ‰çš„æ’åºéƒ½æ˜¯åœ¨æ¡ä»¶è¿‡æ»¤ä¹‹åæ‰æ‰§è¡Œçš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ¡ä»¶è¿‡æ»¤å¤§éƒ¨åˆ†æ•°æ®çš„è¯ï¼Œå‰©ä¸‹å‡ ç™¾å‡ åƒæ¡æ•°æ®è¿›è¡Œæ’åºå…¶å®å¹¶ä¸æ˜¯å¾ˆæ¶ˆè€—æ€§èƒ½ï¼Œå³ä½¿ç´¢å¼•ä¼˜åŒ–äº†æ’åºï¼Œä½†å®é™…æå‡æ€§èƒ½å¾ˆæœ‰é™ã€‚ç›¸å¯¹çš„ stuno &lt; 10100 è¿™ä¸ªæ¡ä»¶ï¼Œå¦‚æœæ²¡æœ‰ç”¨åˆ°ç´¢å¼•çš„è¯ï¼Œè¦å¯¹å‡ ä¸‡æ¡æ•°æ®è¿›è¡Œæ‰«æï¼Œè¿™æ˜¯éå¸¸æ¶ˆè€—æ€§èƒ½çš„ï¼Œæ‰€ä»¥ç´¢å¼•æ”¾åœ¨è¿™ä¸ªå­—æ®µä¸Šæ€§ä»·æ¯”æœ€é«˜ï¼Œæ˜¯æœ€ä¼˜é€‰æ‹©ã€‚</p>
<blockquote>
<p>ç»“è®º:</p>
<ol>
<li>ä¸¤ä¸ªç´¢å¼•åŒæ—¶å­˜åœ¨ï¼Œmysql è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜çš„æ–¹æ¡ˆã€‚ï¼ˆå¯¹äºè¿™ä¸ªä¾‹å­ï¼Œmysql é€‰æ‹© idx_age_stuno_nameï¼‰ã€‚ä½†æ˜¯ï¼Œ<code>éšç€æ•°æ®é‡çš„å˜åŒ–ï¼Œé€‰æ‹©çš„ç´¢å¼•ä¹Ÿä¼šéšä¹‹å˜åŒ–çš„</code> ã€‚</li>
<li><strong>å½“ã€èŒƒå›´æ¡ä»¶ã€‘å’Œã€group by æˆ–è€… order byã€‘çš„å­—æ®µå‡ºç°äºŒé€‰ä¸€æ—¶ï¼Œä¼˜å…ˆè§‚å¯Ÿæ¡ä»¶å­—æ®µçš„è¿‡æ»¤æ•°é‡ï¼Œå¦‚æœè¿‡æ»¤çš„æ•°æ®è¶³å¤Ÿå¤šï¼Œè€Œéœ€è¦æ’åºçš„æ•°æ®å¹¶ä¸å¤šæ—¶ï¼Œä¼˜å…ˆæŠŠç´¢å¼•æ”¾åœ¨èŒƒå›´å­—æ®µä¸Šã€‚åä¹‹ï¼Œäº¦ç„¶ã€‚</strong></li>
</ol>
</blockquote>
<p>æ€è€ƒï¼šè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹ç´¢å¼•ï¼Œæ˜¯å¦å¯è¡Œ? (<strong>å¯è¡Œ</strong>)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX idx_age_stuno_name <span class="keyword">ON</span> student;</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_stuno <span class="keyword">ON</span> student(age,stuno);</span><br></pre></td></tr></table></figure>

<h3 id="5-4-filesort-ç®—æ³•ï¼šåŒè·¯æ’åºå’Œå•è·¯æ’åº"><a href="#5-4-filesort-ç®—æ³•ï¼šåŒè·¯æ’åºå’Œå•è·¯æ’åº" class="headerlink" title="5.4 filesort ç®—æ³•ï¼šåŒè·¯æ’åºå’Œå•è·¯æ’åº"></a>5.4 filesort ç®—æ³•ï¼šåŒè·¯æ’åºå’Œå•è·¯æ’åº</h3><p>æ’åºçš„å­—æ®µè‹¥ä¸åœ¨ç´¢å¼•åˆ—ä¸Šï¼Œåˆ™ filesort ä¼šæœ‰ä¸¤ç§ç®—æ³•ï¼š<code>åŒè·¯æ’åº</code> å’Œ <code>å•è·¯æ’åº</code></p>
<p><font color=blue>1.Â <strong>åŒè·¯æ’åºï¼ˆæ…¢ï¼‰</strong></font></p>
<ul>
<li><code>MySQL4.1 ä¹‹å‰æ˜¯ä½¿ç”¨åŒè·¯æ’åº</code>ï¼Œå­—é¢æ„æ€å°±æ˜¯ä¸¤æ¬¡æ‰«æç£ç›˜ï¼Œæœ€ç»ˆå¾—åˆ°æ•°æ®ï¼Œ è¯»å–è¡ŒæŒ‡é’ˆå’Œ <code>order by åˆ—</code>ï¼Œå¯¹ä»–ä»¬è¿›è¡Œæ’åºï¼Œç„¶åæ‰«æå·²ç»æ’åºå¥½çš„åˆ—è¡¨ï¼ŒæŒ‰ç…§åˆ—è¡¨ä¸­çš„å€¼é‡æ–°ä»åˆ—è¡¨ä¸­è¯»å–å¯¹åº”çš„æ•°æ®è¾“å‡º</li>
<li>ä»ç£ç›˜å–æ’åºå­—æ®µï¼Œåœ¨ buffer è¿›è¡Œæ’åºï¼Œå†ä» <code>ç£ç›˜å–å…¶ä»–å­—æ®µ</code> ã€‚</li>
</ul>
<p>å–ä¸€æ‰¹æ•°æ®ï¼Œè¦å¯¹ç£ç›˜è¿›è¡Œä¸¤æ¬¡æ‰«æï¼Œä¼—æ‰€å‘¨çŸ¥ï¼ŒIO æ˜¯å¾ˆè€—æ—¶çš„ï¼Œæ‰€ä»¥åœ¨ MySQL4.1 ä¹‹åï¼Œå‡ºç°äº†ç¬¬äºŒç§æ”¹è¿›çš„ç®—æ³•ï¼Œå°±æ˜¯å•è·¯æ’åºã€‚</p>
<p><font color=blue>2.Â <strong>å•è·¯æ’åºï¼ˆå¿«ï¼‰</strong></font></p>
<p>ä»ç£ç›˜è¯»å–æŸ¥è¯¢éœ€è¦çš„ <code>æ‰€æœ‰åˆ—</code> ï¼ŒæŒ‰ç…§ order by åˆ—åœ¨ buffer å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œç„¶åæ‰«ææ’åºåçš„åˆ—è¡¨è¿›è¡Œè¾“å‡ºï¼Œ å®ƒçš„æ•ˆç‡æ›´å¿«ä¸€äº›ï¼Œé¿å…äº†ç¬¬äºŒæ¬¡è¯»å–æ•°æ®ã€‚å¹¶ä¸”æŠŠéšæœº IO å˜æˆäº†é¡ºåº IOï¼Œä½†æ˜¯å®ƒä¼šä½¿ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œ å› ä¸ºå®ƒæŠŠæ¯ä¸€è¡Œéƒ½ä¿å­˜åœ¨å†…å­˜ä¸­äº†ã€‚</p>
<p><strong>ç»“è®ºåŠå¼•ç”³å‡ºçš„é—®é¢˜</strong></p>
<ul>
<li><p>ç”±äºå•è·¯æ˜¯åå‡ºçš„ï¼Œæ€»ä½“è€Œè¨€å¥½è¿‡åŒè·¯</p>
</li>
<li><p>ä½†æ˜¯ç”¨å•è·¯æœ‰é—®é¢˜</p>
<ul>
<li><p>åœ¨ sort_buffer ä¸­ï¼Œå•è·¯æ¯”å¤šè·¯è¦<code>å¤šå ç”¨å¾ˆå¤šç©ºé—´</code>ï¼Œå› ä¸ºå•è·¯æ˜¯æŠŠæ‰€æœ‰å­—æ®µéƒ½å–å‡ºï¼Œæ‰€ä»¥å¯èƒ½å–å‡ºçš„æ•°æ®çš„æ€»å¤§å°è¶…å‡ºäº†<code>sort_buffer</code>çš„å®¹é‡ï¼Œå¯¼è‡´æ¯æ¬¡åªèƒ½å– sort_buffer å®¹é‡å¤§å°çš„æ•°æ®ï¼Œè¿›è¡Œæ’åºï¼ˆåˆ›å»º temp æ–‡ä»¶ï¼Œå¤šè·¯åˆå¹¶ï¼‰ï¼Œæ’å®Œå†å– sort_buffer å®¹é‡å¤§å°ï¼Œå†æ’â€¦â€¦ä»è€Œå¤šæ¬¡I&#x2F;Oã€‚</p>
</li>
<li><p>å•è·¯æœ¬æ¥æƒ³çœä¸€æ¬¡ I&#x2F;O æ“ä½œï¼Œ<code>åè€Œå¯¼è‡´äº†å¤§é‡çš„ I/O æ“ä½œ</code>ï¼Œåè€Œå¾—ä¸å¿å¤±ã€‚</p>
</li>
</ul>
</li>
</ul>
<p><font color=red><strong>ä¼˜åŒ–ç­–ç•¥</strong></font></p>
<ul>
<li><p><strong>å°è¯•æé«˜ sort_buffer_size</strong></p>
<ul>
<li><p>ä¸ç®¡ç”¨å“ªç§ç®—æ³•ï¼Œæé«˜è¿™ä¸ªå‚æ•°éƒ½ä¼šæé«˜æ•ˆç‡ï¼Œè¦æ ¹æ®ç³»ç»Ÿçš„èƒ½åŠ›å»æé«˜ï¼Œå› ä¸ºè¿™ä¸ªå‚æ•°æ˜¯é’ˆå¯¹æ¯ä¸ªè¿›ç¨‹ï¼ˆconnectionï¼‰çš„ 1M - 8M ä¹‹é—´è°ƒæ•´ã€‚MySQL5.7ï¼ŒInnoDB å­˜å‚¨å¼•æ“é»˜è®¤å€¼éƒ½æ˜¯ 1048576 å­—èŠ‚ï¼Œ1MBã€‚</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301616578.png" alt="image-20220826160456207"></p>
</li>
</ul>
</li>
<li><p><strong>å°è¯•æé«˜ max_length_for_sort_data</strong></p>
<ul>
<li><p>æé«˜è¿™ä¸ªå‚æ•°ï¼Œä¼šå¢åŠ æ”¹è¿›ç®—æ³•çš„æ¦‚ç‡ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span><span class="string">&#x27;%max_length_for_sort_data%&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½†æ˜¯å¦‚æœè®¾çš„å¤ªé«˜ï¼Œæ•°æ®æ€»å®¹é‡è¶…å‡º sort_buffer_size çš„æ¦‚ç‡å°±å¢å¤§ï¼Œæ˜æ˜¾ç—‡çŠ¶æ˜¯é«˜çš„ç£ç›˜ I&#x2F;O æ´»åŠ¨å’Œä½çš„å¤„ç†å™¨ä½¿ç”¨ç‡ã€‚å¦‚æœéœ€è¦è¿”å›çš„åˆ—çš„æ€»é•¿åº¦å¤§äº max_length_for_sort_dataï¼Œä½¿ç”¨åŒè·¯ç®—æ³•ï¼Œå¦åˆ™ä½¿ç”¨å•è·¯ç®—æ³•ã€‚1024-8192å­—èŠ‚ä¹‹é—´è°ƒæ•´ã€‚</p>
</li>
</ul>
</li>
<li><p><em><em>Order by æ—¶ select</em> æ˜¯ä¸€ä¸ªå¤§å¿Œã€‚æœ€å¥½åªQueryéœ€è¦çš„å­—æ®µã€‚</em>*</p>
<ul>
<li>å½“ Query çš„å­—æ®µå¤§å°ç»¼åˆå°äº max_length_for_sort_dataï¼Œè€Œä¸”æ’åºå­—æ®µä¸æ˜¯ TEXT|BLOG ç±»å‹æ—¶ï¼Œä¼šæ”¹è¿›åçš„ç®—æ³•â€”â€”å•è·¯æ’åºï¼Œå¦åˆ™ç”¨è€ç®—æ³•â€”â€”å¤šè·¯æ’åºã€‚</li>
<li>ä¸¤ç§ç®—æ³•çš„æ•°æ®éƒ½æœ‰å¯èƒ½è¶…å‡º sort_buffer_size çš„å®¹é‡ï¼Œè¶…å‡ºä¹‹åï¼Œä¼šåˆ›å»º tmp æ–‡ä»¶è¿›è¡Œåˆå¹¶æ’åºï¼Œå¯¼è‡´å¤šæ¬¡ I&#x2F;Oï¼Œä½†æ˜¯ç”¨å•è·¯æ’åºç®—æ³•çš„é£é™©ä¼šæ›´å¤§ä¸€äº›ï¼Œæ‰€ä»¥è¦æé«˜ sort_buffer_size</li>
</ul>
</li>
</ul>
<h2 id="6-GROUP-BYä¼˜åŒ–"><a href="#6-GROUP-BYä¼˜åŒ–" class="headerlink" title="6. GROUP BYä¼˜åŒ–"></a>6. GROUP BYä¼˜åŒ–</h2><ul>
<li>group by ä½¿ç”¨ç´¢å¼•çš„åŸåˆ™å‡ ä¹è·Ÿ order by ä¸€è‡´ ï¼Œgroup by å³ä½¿æ²¡æœ‰è¿‡æ»¤æ¡ä»¶ç”¨åˆ°ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ç´¢å¼•ã€‚</li>
<li>group by å…ˆæ’åºå†åˆ†ç»„ï¼Œéµç…§ç´¢å¼•å»ºçš„æœ€ä½³å·¦å‰ç¼€æ³•åˆ™</li>
<li>å½“æ— æ³•ä½¿ç”¨ç´¢å¼•åˆ—ï¼Œå¢å¤§ <code>max_length_for_sort_data</code> å’Œ <code>sort_buffer_size</code> å‚æ•°çš„è®¾ç½®</li>
<li>where æ•ˆç‡é«˜äº havingï¼Œèƒ½å†™åœ¨ where é™å®šçš„æ¡ä»¶å°±ä¸è¦å†™åœ¨ having ä¸­äº†</li>
<li>å‡å°‘ä½¿ç”¨ order byï¼Œå’Œä¸šåŠ¡æ²Ÿé€šèƒ½ä¸æ’åºå°±ä¸æ’åºï¼Œæˆ–å°†æ’åºæ”¾åˆ°ç¨‹åºç«¯å»åšã€‚Order byã€group byã€distinct è¿™äº›è¯­å¥è¾ƒä¸ºè€—è´¹ CPUï¼Œæ•°æ®åº“çš„ CPU èµ„æºæ˜¯æå…¶å®è´µçš„ã€‚</li>
<li>åŒ…å«äº† order byã€group byã€distinct è¿™äº›æŸ¥è¯¢çš„è¯­å¥ï¼Œwhere æ¡ä»¶è¿‡æ»¤å‡ºæ¥çš„ç»“æœé›†è¯·ä¿æŒåœ¨ 1000 è¡Œä»¥å†…ï¼Œå¦åˆ™ SQL ä¼šå¾ˆæ…¢ã€‚</li>
</ul>
<h2 id="7-ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢"><a href="#7-ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="7. ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢"></a>7. ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢</h2><p>ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»ºè¦†ç›–ç´¢å¼•èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ã€‚ä¸€ä¸ªå¸¸è§æœ‰éå¸¸å¤´ç–¼çš„é—®é¢˜å°±æ˜¯ <code>limit 2000000,10</code>ï¼Œæ­¤æ—¶éœ€è¦ MySQL æ’åºå‰ 2000010 è®°å½•ï¼Œä»…ä»…è¿”å› 2000000-2000010 çš„è®°å½•ï¼Œå…¶ä»–è®°å½•ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æ’åºçš„ä»£ä»·éå¸¸å¤§ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student LIMIT <span class="number">2000000</span>,<span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ä¼˜åŒ–æ€è·¯ä¸€</strong></p>
<p>åœ¨ç´¢å¼•ä¸Šå®Œæˆæ’åºåˆ†é¡µæ“ä½œï¼Œæœ€åæ ¹æ®ä¸»é”®å…³è”å›åŸè¡¨æŸ¥è¯¢æ‰€éœ€è¦çš„å…¶ä»–åˆ—å†…å®¹ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student t,(<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">2000000</span>,<span class="number">10</span>) a</span><br><span class="line"><span class="keyword">WHERE</span> t.id <span class="operator">=</span> a.id;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301616923.png" alt="image-20220118212331595"></p>
<p><strong>ä¼˜åŒ–æ€è·¯äºŒ</strong></p>
<p>è¯¥æ–¹æ¡ˆé€‚ç”¨äºä¸»é”®è‡ªå¢çš„è¡¨ï¼Œå¯ä»¥æŠŠ Limit æŸ¥è¯¢è½¬æ¢æˆæŸä¸ªä½ç½®çš„æŸ¥è¯¢ ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">2000000</span> LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301616809.png" alt="image-20220118212357618"></p>
<h2 id="8-ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•"><a href="#8-ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•" class="headerlink" title="8. ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•"></a>8. ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•</h2><h3 id="8-1-ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ"><a href="#8-1-ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ" class="headerlink" title="8.1 ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ"></a>8.1 ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ</h3><p><strong>ç†è§£æ–¹å¼ä¸€</strong>ï¼šç´¢å¼•æ˜¯é«˜æ•ˆæ‰¾åˆ°è¡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬æ•°æ®åº“ä¹Ÿèƒ½ä½¿ç”¨ç´¢å¼•æ‰¾åˆ°ä¸€ä¸ªåˆ—çš„æ•°æ®ï¼Œå› æ­¤å®ƒä¸å¿…è¯»å–æ•´ä¸ªè¡Œã€‚æ¯•ç«Ÿç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®ƒä»¬ç´¢å¼•çš„æ•°æ®ï¼›å½“èƒ½é€šè¿‡è¯»å–ç´¢å¼•å°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„æ•°æ®ï¼Œé‚£å°±ä¸éœ€è¦è¯»å–è¡Œäº†ã€‚ &#x3D;&#x3D;ä¸€ä¸ªç´¢å¼•åŒ…å«äº†æ»¡è¶³æŸ¥è¯¢ç»“æœçš„æ•°æ®å°±å«åšè¦†ç›–ç´¢å¼•ã€‚&#x3D;&#x3D;</p>
<p><strong>ç†è§£æ–¹å¼äºŒ</strong>ï¼šéèšç°‡å¤åˆç´¢å¼•çš„ä¸€ç§å½¢å¼ï¼Œå®ƒåŒ…æ‹¬åœ¨æŸ¥è¯¢é‡Œçš„ SELECTã€JOIN å’Œ WHERE å­å¥ç”¨åˆ°çš„æ‰€æœ‰åˆ—ï¼ˆå³å»ºç´¢å¼•çš„å­—æ®µæ­£å¥½æ˜¯è¦†ç›–æŸ¥è¯¢æ¡ä»¶ä¸­æ‰€æ¶‰åŠçš„å­—æ®µï¼‰ã€‚</p>
<p>ç®€å•è¯´å°±æ˜¯ï¼Œ <code>ç´¢å¼•åˆ—+ä¸»é”®</code> åŒ…å« <code>SELECT åˆ° FROM ä¹‹é—´æŸ¥è¯¢çš„åˆ—</code>ã€‚</p>
<p><strong>ä¸¾ä¾‹ä¸€ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#åˆ é™¤ä¹‹å‰çš„ç´¢å¼•</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_age_stuno <span class="keyword">ON</span> student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_name <span class="keyword">ON</span> student (age,NAME);</span><br><span class="line"></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">&lt;&gt;</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301616617.png" alt="image-20220317220113590"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> age,NAME <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">&lt;&gt;</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301616971.png" alt="image-20220317220203223"></p>
<blockquote>
<p>æ³¨æ„ï¼šå‰é¢æˆ‘ä»¬æåˆ°å¦‚æœä½¿ç”¨ä¸Š<code>&lt;&gt;</code>å°±ä¸ä¼šä½¿ç”¨ä¸Šç´¢å¼•äº† å¹¶ä¸æ˜¯ç»å¯¹çš„ã€‚æ¯”å¦‚ä¸Šé¢è¿™æ¡SQLå°±ç”¨ä¸Šäº†ï¼ï¼ï¼Attentionï¼æˆ‘ä»¬è®²è§£çš„å…³äº ç´¢å¼•å¤±æ•ˆä»¥åŠç´¢å¼•ä¼˜åŒ–éƒ½æ˜¯æ ¹æ®æ•ˆç‡æ¥å†³å®šçš„ã€‚å¯¹äºäºŒçº§ç´¢å¼•æ¥è¯´ï¼šæŸ¥è¯¢æ—¶é—´ &#x3D; äºŒçº§ç´¢å¼•è®¡ç®—æ—¶é—´ + å›è¡¨æŸ¥è¯¢æ—¶é—´ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯è¦†ç›–ç´¢å¼•ï¼Œå›è¡¨æŸ¥è¯¢æ—¶é—´ &#x3D; 0ï¼Œç´¢å¼•ä¼˜åŒ–å™¨è€ƒè™‘åˆ°è¿™ä¸€ç‚¹å°±ä½¿ç”¨ä¸Š äºŒçº§ç´¢å¼•äº†~</p>
</blockquote>
<p><strong>ä¸¾ä¾‹äºŒï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%abc&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301616195.png" alt="image-20220317220552145"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> id,age <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%abc&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301616530.png" alt="image-20220317220630975"></p>
<p>åŒä¸Šï¼Œç”±äºä¹Ÿä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œæœ€ç»ˆSQLæ‰§è¡Œä¹Ÿæ­£å¸¸ä½¿ç”¨ä¸Šäº†ç´¢å¼•~</p>
<h3 id="8-2-è¦†ç›–ç´¢å¼•çš„åˆ©å¼Š"><a href="#8-2-è¦†ç›–ç´¢å¼•çš„åˆ©å¼Š" class="headerlink" title="8.2 è¦†ç›–ç´¢å¼•çš„åˆ©å¼Š"></a>8.2 è¦†ç›–ç´¢å¼•çš„åˆ©å¼Š</h3><p><font color=#5d0308><strong>å¥½å¤„:</strong></font></p>
<p><strong><font color=blue>1. é¿å…Innodbè¡¨è¿›è¡Œç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ï¼ˆå›è¡¨ï¼‰</font></strong></p>
<p>Innodb æ˜¯ä»¥èšé›†ç´¢å¼•çš„é¡ºåºæ¥å­˜å‚¨çš„ï¼Œå¯¹äº Innodb æ¥è¯´ï¼ŒäºŒçº§ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸­æ‰€ä¿å­˜çš„æ˜¯è¡Œçš„ä¸»é”®ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ç”¨äºŒçº§ç´¢å¼•æŸ¥è¯¢æ•°æ®ï¼Œåœ¨æŸ¥æ‰¾åˆ°ç›¸åº”çš„é”®å€¼åï¼Œè¿˜éœ€é€šè¿‡ä¸»é”®è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢æ‰èƒ½è·å–æˆ‘ä»¬çœŸå®æ‰€éœ€è¦çš„æ•°æ®ã€‚</p>
<p>åœ¨è¦†ç›–ç´¢å¼•ä¸­ï¼ŒäºŒçº§ç´¢å¼•çš„é”®å€¼ä¸­å¯ä»¥è·å–æ‰€è¦çš„æ•°æ®ï¼Œé¿å…äº†å¯¹ä¸»é”®çš„äºŒæ¬¡æŸ¥è¯¢ï¼Œå‡å°‘äº† IO æ“ä½œï¼Œæå‡äº†æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<p><strong><font color=blue>2. å¯ä»¥æŠŠéšæœº IO å˜æˆé¡ºåº IO åŠ å¿«æŸ¥è¯¢æ•ˆç‡</font></strong></p>
<p>ç”±äºè¦†ç›–ç´¢å¼•æ˜¯æŒ‰é”®å€¼çš„é¡ºåºå­˜å‚¨çš„ï¼Œå¯¹äº I&#x2F;O å¯†é›†å‹çš„èŒƒå›´æŸ¥æ‰¾æ¥è¯´ï¼Œå¯¹æ¯”éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œçš„æ•°æ® I&#x2F;O è¦å°‘çš„å¤šï¼Œå› æ­¤åˆ©ç”¨è¦†ç›–ç´¢å¼•åœ¨è®¿é—®æ—¶ä¹Ÿå¯ä»¥æŠŠç£ç›˜çš„éšæœºè¯»å–çš„ I&#x2F;O è½¬å˜æˆç´¢å¼•æŸ¥æ‰¾çš„é¡ºåº I&#x2F;Oã€‚</p>
<p>ç”±äºè¦†ç›–ç´¢å¼•å¯ä»¥å‡å°‘æ ‘çš„æœç´¢æ¬¡æ•°ï¼Œæ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œæ‰€ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µã€‚</p>
<p><strong><font color=#5d0308>å¼Šç«¯:</font></strong></p>
<p><code>ç´¢å¼•å­—æ®µçš„ç»´æŠ¤</code> æ€»æ˜¯æœ‰ä»£ä»·çš„ã€‚å› æ­¤ï¼Œåœ¨å»ºç«‹å†—ä½™ç´¢å¼•æ¥æ”¯æŒè¦†ç›–ç´¢å¼•æ—¶å°±éœ€è¦æƒè¡¡è€ƒè™‘äº†ã€‚è¿™æ˜¯ä¸šåŠ¡ DBAï¼Œæˆ–è€…ç§°ä¸ºä¸šåŠ¡æ•°æ®æ¶æ„å¸ˆçš„å·¥ä½œã€‚</p>
<h2 id="9-å¦‚ä½•ç»™å­—ç¬¦ä¸²æ·»åŠ ç´¢å¼•"><a href="#9-å¦‚ä½•ç»™å­—ç¬¦ä¸²æ·»åŠ ç´¢å¼•" class="headerlink" title="9. å¦‚ä½•ç»™å­—ç¬¦ä¸²æ·»åŠ ç´¢å¼•"></a>9. å¦‚ä½•ç»™å­—ç¬¦ä¸²æ·»åŠ ç´¢å¼•</h2><p>æœ‰ä¸€å¼ æ•™å¸ˆè¡¨ï¼Œè¡¨å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teacher(</span><br><span class="line">    ID <span class="type">bigint</span> unsigned <span class="keyword">primary</span> key,</span><br><span class="line">    email <span class="type">varchar</span>(<span class="number">64</span>),</span><br><span class="line">    ...</span><br><span class="line">)engine<span class="operator">=</span>innodb;</span><br></pre></td></tr></table></figure>

<p>è®²å¸ˆè¦ä½¿ç”¨é‚®ç®±ç™»å½•ï¼Œæ‰€ä»¥ä¸šåŠ¡ä»£ç ä¸­ä¸€å®šä¼šå‡ºç°ç±»ä¼¼äºè¿™æ ·çš„è¯­å¥:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> col1, col2 <span class="keyword">from</span> teacher <span class="keyword">where</span> email<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>; </span><br></pre></td></tr></table></figure>

<p>å¦‚æœ email è¿™ä¸ªå­—æ®µä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯­å¥å°±åªèƒ½åš <code>å…¨è¡¨æ‰«æ</code> ã€‚</p>
<h3 id="9-1-å‰ç¼€ç´¢å¼•"><a href="#9-1-å‰ç¼€ç´¢å¼•" class="headerlink" title="9.1 å‰ç¼€ç´¢å¼•"></a>9.1 å‰ç¼€ç´¢å¼•</h3><p>MySQLæ˜¯æ”¯æŒå‰ç¼€ç´¢å¼•çš„ã€‚é»˜è®¤åœ°ï¼Œå¦‚æœä½ åˆ›å»ºç´¢å¼•çš„è¯­å¥ä¸æŒ‡å®šå‰ç¼€é•¿åº¦ï¼Œé‚£ä¹ˆç´¢å¼•å°±ä¼šåŒ…å«æ•´ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> teacher <span class="keyword">add</span> index index1(email); </span><br><span class="line">#æˆ–</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> teacher <span class="keyword">add</span> index index2(email(<span class="number">6</span>));</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ç§ä¸åŒçš„å®šä¹‰åœ¨æ•°æ®ç»“æ„å’Œå­˜å‚¨ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢?ä¸‹å›¾å°±æ˜¯è¿™ä¸¤ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾ã€‚</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301616747.png" alt="image-20220828195350954"></p>
<p>ä»¥åŠ</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301617322.png" alt="image-20220828195404648"></p>
<p><font color=blue><strong>å¦‚æœä½¿ç”¨çš„æ˜¯ index1</strong> ï¼ˆå³ email æ•´ä¸ªå­—ç¬¦ä¸²çš„ç´¢å¼•ç»“æ„ï¼‰ï¼Œæ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„:</font></p>
<ol>
<li>ä» index1 ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯â€™ <a href="mailto:&#x7a;&#104;&#x61;&#x6e;&#x67;&#x73;&#x73;&#x78;&#x79;&#122;&#64;&#x78;&#120;&#x78;&#x2e;&#x63;&#111;&#x6d;">&#x7a;&#104;&#x61;&#x6e;&#x67;&#x73;&#x73;&#x78;&#x79;&#122;&#64;&#x78;&#120;&#x78;&#x2e;&#x63;&#111;&#x6d;</a> â€™çš„è¿™æ¡è®°å½•ï¼Œå–å¾— ID2 çš„å€¼;</li>
<li>åˆ°ä¸»é”®ä¸ŠæŸ¥åˆ°ä¸»é”®å€¼æ˜¯ ID2 çš„è¡Œï¼Œåˆ¤æ–­ email çš„å€¼æ˜¯æ­£ç¡®çš„ï¼Œå°†è¿™è¡Œè®°å½•åŠ å…¥ç»“æœé›†;</li>
<li>å– index1 ç´¢å¼•æ ‘ä¸ŠåˆšåˆšæŸ¥åˆ°çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œå‘ç°å·²ç»ä¸æ»¡è¶³email&#x3D;â€™ <a href="mailto:&#122;&#x68;&#97;&#110;&#x67;&#x73;&#115;&#x78;&#121;&#122;&#x40;&#120;&#120;&#x78;&#x2e;&#99;&#111;&#x6d;">&#122;&#x68;&#97;&#110;&#x67;&#x73;&#115;&#x78;&#121;&#122;&#x40;&#120;&#120;&#x78;&#x2e;&#99;&#111;&#x6d;</a> â€™çš„æ¡ä»¶äº†ï¼Œå¾ªç¯ç»“æŸã€‚</li>
</ol>
<p>è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦å›ä¸»é”®ç´¢å¼•å–ä¸€æ¬¡æ•°æ®ï¼Œæ‰€ä»¥ç³»ç»Ÿè®¤ä¸ºåªæ‰«æäº†ä¸€è¡Œã€‚</p>
<p><font color=blue><strong>å¦‚æœä½¿ç”¨çš„æ˜¯ index2</strong>ï¼ˆå³ email(6) ç´¢å¼•ç»“æ„ï¼‰ï¼Œæ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š</font></p>
<ol>
<li>ä» index2 ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯â€™zhangsâ€™çš„è®°å½•ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ˜¯ ID1;</li>
<li>åˆ°ä¸»é”®ä¸ŠæŸ¥åˆ°ä¸»é”®å€¼æ˜¯ ID1 çš„è¡Œï¼Œåˆ¤æ–­å‡º email çš„å€¼ä¸æ˜¯â€™ <a href="mailto:&#x7a;&#x68;&#97;&#110;&#103;&#115;&#x73;&#x78;&#121;&#x7a;&#64;&#x78;&#120;&#120;&#46;&#x63;&#x6f;&#x6d;">&#x7a;&#x68;&#97;&#110;&#103;&#115;&#x73;&#x78;&#121;&#x7a;&#64;&#x78;&#120;&#120;&#46;&#x63;&#x6f;&#x6d;</a> â€™ï¼Œè¿™è¡Œè®°å½•ä¸¢å¼ƒ;</li>
<li>å– index2 ä¸ŠåˆšåˆšæŸ¥åˆ°çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œå‘ç°ä»ç„¶æ˜¯â€™zhangsâ€™ï¼Œå–å‡º ID2ï¼Œå†åˆ° ID ç´¢å¼•ä¸Šå–æ•´è¡Œç„¶ååˆ¤æ–­ï¼Œè¿™æ¬¡å€¼å¯¹äº†ï¼Œå°†è¿™è¡Œè®°å½•åŠ å…¥ç»“æœé›†;</li>
<li>é‡å¤ä¸Šä¸€æ­¥ï¼Œç›´åˆ°åœ¨ idxe2 ä¸Šå–åˆ°çš„å€¼ä¸æ˜¯â€™zhangsâ€™æ—¶ï¼Œå¾ªç¯ç»“æŸã€‚</li>
</ol>
<p>ä¹Ÿå°±æ˜¯è¯´ <font color=red><strong>ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå®šä¹‰å¥½é•¿åº¦ï¼Œå°±å¯ä»¥åšåˆ°æ—¢èŠ‚çœç©ºé—´ï¼Œåˆä¸ç”¨é¢å¤–å¢åŠ å¤ªå¤šçš„æŸ¥è¯¢æˆæœ¬ã€‚</strong> </font>å‰é¢å·²ç»è®²è¿‡åŒºåˆ†åº¦ï¼ŒåŒºåˆ†åº¦è¶Šé«˜è¶Šå¥½ã€‚å› ä¸ºåŒºåˆ†åº¦è¶Šé«˜ï¼Œæ„å‘³ç€é‡å¤çš„é”®å€¼è¶Šå°‘ã€‚</p>
<h3 id="9-2-å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“"><a href="#9-2-å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“" class="headerlink" title="9.2 å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“"></a>9.2 å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“</h3><p>å‰é¢æˆ‘ä»¬è¯´äº†ä½¿ç”¨&#x3D;&#x3D;å‰ç¼€ç´¢å¼•å¯èƒ½ä¼šå¢åŠ æ‰«æè¡Œæ•°&#x3D;&#x3D;ï¼Œè¿™ä¼šå½±å“åˆ°æ€§èƒ½ã€‚å…¶å®ï¼Œå‰ç¼€ç´¢å¼•çš„å½±å“ä¸æ­¢å¦‚æ­¤ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹å¦å¤–ä¸€ä¸ªåœºæ™¯ï¼š</p>
<p>å¦‚æœä½¿ç”¨ index1ï¼ˆå³ email æ•´ä¸ªå­—ç¬¦ä¸²çš„ç´¢å¼•ç»“æ„ï¼‰çš„è¯ï¼Œå¯ä»¥åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Œä» index1 æŸ¥åˆ°ç»“æœåç›´æ¥å°±è¿”å›äº†ï¼Œä¸éœ€è¦å›åˆ° ID ç´¢å¼•å†å»æŸ¥ä¸€æ¬¡ã€‚è€Œå¦‚æœä½¿ç”¨ index2ï¼ˆå³ email(6) ç´¢å¼•ç»“æ„ï¼‰çš„è¯ï¼Œå°±ä¸å¾—ä¸å›åˆ° ID ç´¢å¼•å†å»åˆ¤æ–­ email å­—æ®µçš„å€¼ã€‚</p>
<p>å³ä½¿ä½ å°† index2 çš„å®šä¹‰ä¿®æ”¹ä¸º email(18) çš„å‰ç¼€ç´¢å¼•ï¼Œè¿™æ—¶å€™è™½ç„¶ index2 å·²ç»åŒ…å«äº†æ‰€æœ‰çš„ä¿¡æ¯ï¼Œä½† InnoDB è¿˜æ˜¯è¦å›åˆ° id ç´¢å¼•å†æŸ¥ä¸€ä¸‹ï¼Œå› ä¸ºç³»ç»Ÿå¹¶ä¸ç¡®å®šå‰ç¼€ç´¢å¼•çš„å®šä¹‰æ˜¯å¦æˆªæ–­äº†å®Œæ•´ä¿¡æ¯ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,email <span class="keyword">from</span> teacher <span class="keyword">where</span> email<span class="operator">=</span><span class="string">&#x27;songhongkangexxx.com&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç»“è®º:</p>
<p>&#x3D;&#x3D;ä½¿ç”¨å‰ç¼€ç´¢å¼•å°±ç”¨ä¸ä¸Šè¦†ç›–ç´¢å¼•å¯¹æŸ¥è¯¢æ€§èƒ½çš„ä¼˜åŒ–äº†&#x3D;&#x3D;ï¼Œè¿™ä¹Ÿæ˜¯ä½ åœ¨é€‰æ‹©æ˜¯å¦ä½¿ç”¨å‰ç¼€ç´¢å¼•æ—¶éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªå› ç´ ã€‚</p>
</blockquote>
<h3 id="9-3-æ‹“å±•å†…å®¹"><a href="#9-3-æ‹“å±•å†…å®¹" class="headerlink" title="9.3 æ‹“å±•å†…å®¹"></a>9.3 æ‹“å±•å†…å®¹</h3><p>å¯¹äºç±»ä¼¼äºé‚®ç®±è¿™æ ·çš„å­—æ®µæ¥è¯´ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•çš„æ•ˆæœå¯èƒ½è¿˜ä¸é”™ã€‚ä½†æ˜¯ï¼Œé‡åˆ°å‰ç¼€çš„åŒºåˆ†åº¦ä¸å¤Ÿå¥½çš„æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆåŠå‘¢?</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å›½å®¶çš„èº«ä»½è¯å·ï¼Œä¸€å…± 18 ä½ï¼Œå…¶ä¸­å‰ 6 ä½æ˜¯åœ°å€ç ï¼Œæ‰€ä»¥åŒä¸€ä¸ªå¿çš„äººçš„èº«ä»½è¯å·å‰ 6 ä½ä¸€èˆ¬ä¼šæ˜¯ç›¸åŒçš„ã€‚</p>
<p>å‡è®¾ä½ ç»´æŠ¤çš„æ•°æ®åº“æ˜¯ä¸€ä¸ªå¸‚çš„å…¬æ°‘ä¿¡æ¯ç³»ç»Ÿï¼Œè¿™æ—¶å€™å¦‚æœå¯¹èº«ä»½è¯å·åšé•¿åº¦ä¸º 6 çš„å‰ç¼€ç´¢å¼•çš„è¯ï¼Œè¿™ä¸ªç´¢å¼•çš„åŒºåˆ†åº¦å°±éå¸¸ä½äº†ã€‚æŒ‰ç…§æˆ‘ä»¬å‰é¢è¯´çš„æ–¹æ³•ï¼Œå¯èƒ½ä½ éœ€è¦åˆ›å»ºé•¿åº¦ä¸º 12 ä»¥ä¸Šçš„å‰ç¼€ç´¢å¼•ï¼Œæ‰èƒ½å¤Ÿæ»¡è¶³åŒºåˆ†åº¦è¦æ±‚ã€‚</p>
<p>ä½†æ˜¯ï¼Œç´¢å¼•é€‰å–çš„è¶Šé•¿ï¼Œå ç”¨çš„ç£ç›˜ç©ºé—´å°±è¶Šå¤§ï¼Œç›¸åŒçš„æ•°æ®é¡µèƒ½æ”¾ä¸‹çš„ç´¢å¼•å€¼å°±è¶Šå°‘ï¼Œæœç´¢çš„æ•ˆç‡ä¹Ÿå°±ä¼šè¶Šä½ã€‚<br>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç¡®å®šä¸šåŠ¡éœ€æ±‚é‡Œé¢åªæœ‰æŒ‰ç…§èº«ä»½è¯è¿›è¡Œç­‰å€¼æŸ¥è¯¢çš„éœ€æ±‚ï¼Œè¿˜æœ‰æ²¡æœ‰åˆ«çš„å¤„ç†æ–¹æ³•å‘¢?è¿™ç§æ–¹æ³•ï¼Œæ—¢å¯ä»¥å ç”¨æ›´å°çš„ç©ºé—´ï¼Œä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„æŸ¥è¯¢æ•ˆç‡ã€‚æœ‰!</p>
<p><strong>ç¬¬ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨å€’åºå­˜å‚¨ã€‚</strong>å¦‚æœä½ å­˜å‚¨èº«ä»½è¯å·çš„æ—¶å€™æŠŠå®ƒå€’è¿‡æ¥å­˜ï¼Œæ¯æ¬¡æŸ¥è¯¢çš„æ—¶å€™ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> field list <span class="keyword">from</span> teacher <span class="keyword">where</span> id_card<span class="operator">=</span>reverse(input_id_card_string);</span><br></pre></td></tr></table></figure>

<p>ç”±äºèº«ä»½è¯å·çš„æœ€å 6 ä½æ²¡æœ‰åœ°å€ç è¿™æ ·çš„é‡å¤é€»è¾‘ï¼Œæ‰€ä»¥æœ€åè¿™ 6 ä½å¾ˆå¯èƒ½å°±æä¾›äº†è¶³å¤Ÿçš„åŒºåˆ†åº¦ã€‚å½“ç„¶ï¼Œå®è·µä¸­ä½ è¿˜è¦ä½¿ç”¨ count(distinct) æ–¹æ³•å»åšéªŒè¯ã€‚</p>
<p><strong>ç¬¬äºŒç§æ–¹å¼æ˜¯ä½¿ç”¨ hash å­—æ®µã€‚</strong>ä½ å¯ä»¥åœ¨è¡¨ä¸Šå†åˆ›å»ºä¸€ä¸ªæ•´æ•°å­—æ®µï¼Œæ¥ä¿å­˜èº«ä»½è¯çš„æ ¡éªŒç ï¼ŒåŒæ—¶åœ¨è¿™ä¸ªå­—æ®µä¸Šåˆ›å»ºç´¢å¼•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> teacher <span class="keyword">add</span> id_card_crc <span class="type">int</span> unsignedadd index(id_card_crc);</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ¯æ¬¡æ’å…¥æ–°è®°å½•çš„æ—¶å€™ï¼Œéƒ½åŒæ—¶ç”¨ crc32() è¿™ä¸ªå‡½æ•°å¾—åˆ°æ ¡éªŒç å¡«åˆ°è¿™ä¸ªæ–°å­—æ®µï¼Œç”±äºæ ¡éªŒç å¯èƒ½å­˜åœ¨å†²çªï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªä¸åŒçš„èº«ä»½è¯å·é€šè¿‡ crc32() å‡½æ•°å¾—åˆ°çš„ç»“æœå¯èƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥ä½ çš„æŸ¥è¯¢è¯­å¥ where éƒ¨åˆ†è¦åˆ¤æ–­ id_card çš„å€¼æ˜¯å¦ç²¾ç¡®ç›¸åŒã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> field list <span class="keyword">from</span> twhere id_card_rc<span class="operator">=</span>crc32(input_id_card_string) <span class="keyword">and</span> id_card<span class="operator">=</span>input id_card_string</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œç´¢å¼•çš„é•¿åº¦å˜æˆäº†4ä¸ªå­—èŠ‚ï¼Œæ¯”åŸæ¥å°äº†å¾ˆå¤šã€‚</p>
<blockquote>
<p>ä»æŸ¥è¯¢æ•ˆç‡ä¸Šçœ‹ï¼Œä½¿ç”¨ hash å­—æ®µæ–¹å¼çš„æŸ¥è¯¢æ€§èƒ½ç›¸å¯¹æ›´ç¨³å®šä¸€äº›ï¼Œå› ä¸º crc32 ç®—å‡ºæ¥çš„å€¼è™½ç„¶æœ‰å†²çªçš„æ¦‚ç‡ä½†æ˜¯æ¦‚ç‡éå¸¸å°ï¼Œå¯ä»¥è®¤ä¸ºæ¯æ¬¡æŸ¥è¯¢çš„å¹³å‡æ‰«æè¡Œæ•°æ¥è¿‘ 1ã€‚è€Œå€’åºå­˜å‚¨æ–¹å¼æ¯•ç«Ÿè¿˜æ˜¯ç”¨çš„å‰ç¼€ç´¢å¼•çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´è¿˜æ˜¯ä¼šå¢åŠ æ‰«æè¡Œæ•°ã€‚</p>
</blockquote>
<h2 id="10-ç´¢å¼•ä¸‹æ¨"><a href="#10-ç´¢å¼•ä¸‹æ¨" class="headerlink" title="10. ç´¢å¼•ä¸‹æ¨"></a>10. ç´¢å¼•ä¸‹æ¨</h2><p>Index Condition Pushdown(ICP) æ˜¯ MySQL 5.6 ä¸­æ–°ç‰¹æ€§ï¼Œæ˜¯ä¸€ç§&#x3D;&#x3D;åœ¨å­˜å‚¨å¼•æ“å±‚ä½¿ç”¨ç´¢å¼•è¿‡æ»¤æ•°æ®&#x3D;&#x3D;çš„ä¸€ç§ä¼˜åŒ–æ–¹å¼ã€‚ICP å¯ä»¥&#x3D;&#x3D;å‡å°‘å­˜å‚¨å¼•æ“è®¿é—®åŸºè¡¨çš„æ¬¡æ•°ä»¥åŠ MySQL æœåŠ¡å™¨è®¿é—®å­˜å‚¨å¼•æ“çš„æ¬¡æ•°&#x3D;&#x3D;ã€‚</p>
<h3 id="10-1-ä½¿ç”¨å‰åå¯¹æ¯”"><a href="#10-1-ä½¿ç”¨å‰åå¯¹æ¯”" class="headerlink" title="10.1 ä½¿ç”¨å‰åå¯¹æ¯”"></a>10.1 ä½¿ç”¨å‰åå¯¹æ¯”</h3><p><strong>åœ¨ä¸ä½¿ç”¨ ICP ç´¢å¼•æ‰«æçš„è¿‡ç¨‹ï¼š</strong></p>
<ul>
<li>storage å±‚ï¼šåªå°†æ»¡è¶³ index key æ¡ä»¶çš„ç´¢å¼•è®°å½•å¯¹åº”çš„æ•´è¡Œè®°å½•å–å‡ºï¼Œè¿”å›ç»™ server å±‚</li>
<li>server å±‚ï¼šå¯¹è¿”å›çš„æ•°æ®ï¼Œä½¿ç”¨åé¢çš„ where æ¡ä»¶è¿‡æ»¤ï¼Œç›´è‡³è¿”å›æœ€åä¸€è¡Œã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ ICP æ‰«æçš„è¿‡ç¨‹ï¼š</strong></p>
<ul>
<li>storageå±‚ï¼šé¦–å…ˆå°† index key æ¡ä»¶æ»¡è¶³çš„ç´¢å¼•è®°å½•åŒºé—´ç¡®å®šï¼Œç„¶ååœ¨ç´¢å¼•ä¸Šä½¿ç”¨ index filter è¿›è¡Œè¿‡æ»¤ã€‚å°†æ»¡è¶³çš„ index filter æ¡ä»¶çš„ç´¢å¼•è®°å½•æ‰å»å›è¡¨å–å‡ºæ•´è¡Œè®°å½•è¿”å› server å±‚ã€‚ä¸æ»¡è¶³ index filter æ¡ä»¶çš„ç´¢å¼•è®°å½•ä¸¢å¼ƒï¼Œä¸å›è¡¨ã€ä¹Ÿä¸ä¼šè¿”å› server å±‚ã€‚</li>
<li>server å±‚ï¼šå¯¹è¿”å›çš„æ•°æ®ï¼Œä½¿ç”¨ table filter æ¡ä»¶åšæœ€åçš„è¿‡æ»¤ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨å‰åçš„æˆæœ¬å·®åˆ«ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨å‰ï¼Œå­˜å‚¨å±‚å¤šè¿”å›äº†éœ€è¦è¢« index filter è¿‡æ»¤æ‰çš„æ•´è¡Œè®°å½•</li>
<li>ä½¿ç”¨ ICP åï¼Œç›´æ¥å°±å»æ‰äº†ä¸æ»¡è¶³ index filter æ¡ä»¶çš„è®°å½•ï¼Œçœå»äº†ä»–ä»¬å›è¡¨å’Œä¼ é€’åˆ° server å±‚çš„æˆæœ¬ã€‚</li>
<li>ICP çš„åŠ é€Ÿæ•ˆæœå–å†³äºåœ¨å­˜å‚¨å¼•æ“å†…é€šè¿‡ ICP ç­›é€‰æ‰çš„æ•°æ®çš„æ¯”ä¾‹ã€‚</li>
</ul>
<blockquote>
<p>ç´¢å¼•ä¸­åŒ…å«è¿™ä¸ªå­—æ®µï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨åˆ°è¿™ä¸ªå­—æ®µçš„ç´¢å¼•(æ¯”å¦‚â€˜%a%â€™)ï¼Œå´å¯ä»¥ä½¿ç”¨è¿™ä¸ªå­—æ®µåœ¨ç´¢å¼•ä¸­è¿›è¡Œæ¡ä»¶è¿‡æ»¤ï¼Œä»è€Œå‡å°‘å›è¡¨çš„è®°å½•æ¡æ•°ï¼Œè¿™ç§æƒ…å†µå°±å«åšç´¢å¼•ä¸‹æ¨</p>
</blockquote>
<h3 id="10-2-ICP-çš„å¼€å¯ã€å…³é—­"><a href="#10-2-ICP-çš„å¼€å¯ã€å…³é—­" class="headerlink" title="10.2 ICP çš„å¼€å¯ã€å…³é—­"></a>10.2 ICP çš„å¼€å¯ã€å…³é—­</h3><ul>
<li>é»˜è®¤æƒ…å†µä¸‹å¯ç”¨ç´¢å¼•æ¡ä»¶ä¸‹æ¨ã€‚å¯ä»¥é€šè¿‡è®¾ç½®ç³»ç»Ÿå˜é‡ <code>optimizer_switch </code>æ§åˆ¶ <code>indexcondition_pushdown</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#å…³é—­ç´¢å¼•ä¸‹æ¨</span><br><span class="line"><span class="keyword">SET</span> optimizer_switch<span class="operator">=</span>index_condition_pushdown<span class="operator">=</span>off;</span><br><span class="line"></span><br><span class="line">#æ‰“å¼€ç´¢å¼•ä¸‹æ¨</span><br><span class="line"><span class="keyword">SET</span> optimizerswitch<span class="operator">=</span>indexcondition_pushdown<span class="operator">=</span><span class="keyword">on</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>å½“ä½¿ç”¨ç´¢å¼•æ¡ä»¶ä¸‹æ¨æ—¶ï¼Œ<code>EXPLAIN</code>è¯­å¥è¾“å‡ºç»“æœä¸­<code>Extra</code>åˆ—å†…å®¹æ˜¾ç¤ºä¸º<code>Using index condition</code></li>
</ul>
<h3 id="10-3-ICP-ä½¿ç”¨æ¡ˆä¾‹"><a href="#10-3-ICP-ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="10.3 ICP ä½¿ç”¨æ¡ˆä¾‹"></a>10.3 ICP ä½¿ç”¨æ¡ˆä¾‹</h3><p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301620330.png" alt="image-20220828212345673"></p>
<p>ä¸ºè¯¥è¡¨å®šä¹‰è”åˆç´¢å¼• <code>zip_last_first(zipcode, lastname, firstname)</code> ã€‚å¦‚æœæˆ‘ä»¬çŸ¥é“äº†ä¸€ä¸ªäººçš„é‚®ç¼–ï¼Œä½†æ˜¯ä¸ç¡®å®šè¿™ä¸ªäººçš„å§“æ°ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ£€ç´¢:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> people</span><br><span class="line"><span class="keyword">WHERE</span> zipcode<span class="operator">=</span> <span class="string">&#x27;000001&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> lastname <span class="keyword">LIKE</span> <span class="string">&#x27;%å¼ %&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> address <span class="keyword">LIKE</span> <span class="string">&#x27;%åŒ—äº¬å¸‚%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡ŒæŸ¥çœ‹SQLçš„æŸ¥è¯¢è®¡åˆ’ï¼ŒExtra ä¸­æ˜¾ç¤ºäº†<code>Using index condition</code> ï¼Œè¿™è¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨ã€‚å³ï¼šå…ˆä½¿ç”¨ç´¢å¼•çš„zipcodeå­—æ®µè¿›è¡ŒåŒ¹é…ï¼Œç„¶å &#x3D;&#x3D;ç´¢å¼•ä¸‹æ¨&#x3D;&#x3D; ä½¿ç”¨lastnameå­—æ®µè¿›è¡Œè¿‡æ»¤ï¼Œæœ€åå†è¿›è¡Œå›è¡¨ã€‚</p>
<p>å¦å¤–ï¼ŒUsing whereè¡¨ç¤ºæ¡ä»¶ä¸­åŒ…å«éœ€è¦è¿‡æ»¤çš„éç´¢å¼•åˆ—çš„æ•°æ®ï¼Œå³address LIKE â€˜%åŒ—äº¬å¸‚%â€™è¿™ä¸ªæ¡ä»¶å¹¶ä¸æ˜¯ç´¢å¼•åˆ—ï¼Œéœ€è¦åœ¨æœåŠ¡ç«¯è¿‡æ»¤æ‰ã€‚</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301617739.png" alt="image-20220828220045412"></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301617764.png" alt="image-20220828212600518"></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301617290.png" alt="image-20220828212715729"></p>
<h3 id="11-4-å¼€å¯å’Œå…³é—­ICPçš„æ€§èƒ½å¯¹æ¯”"><a href="#11-4-å¼€å¯å’Œå…³é—­ICPçš„æ€§èƒ½å¯¹æ¯”" class="headerlink" title="11.4 å¼€å¯å’Œå…³é—­ICPçš„æ€§èƒ½å¯¹æ¯”"></a>11.4 å¼€å¯å’Œå…³é—­ICPçš„æ€§èƒ½å¯¹æ¯”</h3><p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301617811.png"></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301617219.png" alt="image-20220828213739703"></p>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301617611.png" alt="image-20220828213847767"></p>
<p>å¤šæ¬¡æµ‹è¯•æ•ˆç‡å¯¹æ¯”æ¥çœ‹ï¼Œä½¿ç”¨ICPä¼˜åŒ–çš„æŸ¥è¯¢æ•ˆç‡ä¼šå¥½ä¸€äº›ã€‚è¿™é‡Œå»ºè®®å¤šå­˜å‚¨ä¸€äº›æ•°æ®æ•ˆæœæ›´æ˜æ˜¾ã€‚</p>
<h3 id="10-5-ICP-çš„ä½¿ç”¨æ¡ä»¶"><a href="#10-5-ICP-çš„ä½¿ç”¨æ¡ä»¶" class="headerlink" title="10.5 ICP çš„ä½¿ç”¨æ¡ä»¶"></a>10.5 ICP çš„ä½¿ç”¨æ¡ä»¶</h3><ol>
<li>åªèƒ½ç”¨äºäºŒçº§ç´¢å¼•ï¼ˆsecondary indexï¼‰</li>
<li>explain æ˜¾ç¤ºçš„æ‰§è¡Œè®¡åˆ’ä¸­ type å€¼ï¼ˆjoin ç±»å‹ï¼‰ä¸º <code>range</code> ã€ <code>ref</code> ã€ <code>eq_ref</code> æˆ–è€… <code>ref_or_null</code> ã€‚</li>
<li>å¹¶éå…¨éƒ¨ where æ¡ä»¶éƒ½å¯ä»¥ç”¨ ICP ç­›é€‰ï¼Œå¦‚æœ where æ¡ä»¶çš„å­—æ®µä¸åœ¨ç´¢å¼•åˆ—ä¸­ï¼Œè¿˜æ˜¯è¦è¯»å–æ•´è¡¨çš„è®°å½•åˆ° server ç«¯åš where è¿‡æ»¤ã€‚</li>
<li>ICP å¯ä»¥ç”¨äº MyISAM å’Œ InnnoDB å­˜å‚¨å¼•æ“</li>
<li>MySQL 5.6 ç‰ˆæœ¬çš„ä¸æ”¯æŒåˆ†åŒºè¡¨çš„ ICP åŠŸèƒ½ï¼Œ5.7 ç‰ˆæœ¬çš„å¼€å§‹æ”¯æŒã€‚</li>
<li>å½“ SQL ä½¿ç”¨è¦†ç›–ç´¢å¼•æ—¶ï¼Œä¸æ”¯æŒ ICP ä¼˜åŒ–æ–¹æ³•ã€‚</li>
</ol>
<h2 id="11-æ™®é€šç´¢å¼•-vs-å”¯ä¸€ç´¢å¼•"><a href="#11-æ™®é€šç´¢å¼•-vs-å”¯ä¸€ç´¢å¼•" class="headerlink" title="11. æ™®é€šç´¢å¼• vs å”¯ä¸€ç´¢å¼•"></a>11. æ™®é€šç´¢å¼• vs å”¯ä¸€ç´¢å¼•</h2><p>åœ¨ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œåº”è¯¥é€‰æ‹©æ™®é€šç´¢å¼•ï¼Œè¿˜æ˜¯å”¯ä¸€ç´¢å¼•ï¼Ÿ</p>
<p>å‡è®¾ä½ åœ¨ç»´æŠ¤ä¸€ä¸ªå±…æ°‘ç³»ç»Ÿï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„èº«ä»½è¯å·ï¼Œè€Œä¸”ä¸šåŠ¡ä»£ç å·²ç»ä¿è¯äº†ä¸ä¼šå†™å…¥ä¸¤ä¸ªé‡å¤çš„èº«ä»½è¯å·ã€‚å¦‚æœå±…æ°‘ç³»ç»Ÿéœ€è¦æŒ‰ç…§èº«ä»½è¯å·æŸ¥å§“åï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> CUser <span class="keyword">where</span> id_card<span class="operator">=</span><span class="string">&#x27;xxxxxxxyyyyyyzzzzz&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œä½ ä¸€å®šä¼šè€ƒè™‘åœ¨ id_card å­—æ®µä¸Šå»ºç´¢å¼•ã€‚<br>ç”±äºèº«ä»½è¯å·å­—æ®µæ¯”è¾ƒå¤§ï¼Œä¸å»ºè®®æŠŠèº«ä»½è¯å·å½“åšä¸»é”®ã€‚ç°åœ¨æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œè¦ä¹ˆç»™ id_card å­—æ®µåˆ›å»º å”¯ä¸€ç´ å¼•ï¼Œè¦ä¹ˆåˆ›å»ºä¸€ä¸ªæ™®é€šç´¢å¼•ã€‚å¦‚æœä¸šåŠ¡ä»£ç å·²ç»ä¿è¯äº†ä¸ä¼šå†™å…¥é‡å¤çš„èº«ä»½è¯å·ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªé€‰æ‹©é€»è¾‘ä¸Šéƒ½æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>ä½ çŸ¥é“çš„ï¼ŒInnoDB çš„æ•°æ®æ˜¯æŒ‰æ•°æ®é¡µä¸ºå•ä½æ¥è¯»å†™çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éœ€è¦è¯»ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å°†è¿™ä¸ªè®°å½•æœ¬èº«ä»ç£ç›˜è¯»å‡ºæ¥ï¼Œè€Œæ˜¯ä»¥é¡µä¸ºå•ä½ï¼Œå°†å…¶æ•´ä½“è¯»å…¥å†…å­˜ã€‚åœ¨ InnoDBä¸­ï¼Œæ¯ä¸ªæ•°æ®é¡µçš„å¤§å°é»˜è®¤æ˜¯16KB</p>
<p><strong>ä»æ€§èƒ½çš„è§’åº¦è€ƒè™‘ï¼Œä½ é€‰æ‹©å”¯ä¸€ç´¢å¼•è¿˜æ˜¯æ™®é€šç´¢å¼•å‘¢ï¼Ÿé€‰æ‹©çš„ä¾æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</strong></p>
<p>å‡è®¾ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸»é”®åˆ—ä¸º ID çš„è¡¨ï¼Œè¡¨ä¸­æœ‰å­—æ®µ kï¼Œå¹¶ä¸”åœ¨ k ä¸Šæœ‰ç´¢å¼•ï¼Œå‡è®¾å­—æ®µ k ä¸Šçš„å€¼éƒ½ä¸é‡å¤ã€‚ è¿™ä¸ªè¡¨çš„å»ºè¡¨è¯­å¥æ˜¯:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> test(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">    k <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">16</span>),</span><br><span class="line">    index (k)</span><br><span class="line">)engine<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>

<p>è¡¨ä¸­ R1~R5 çš„ (ID,k) å€¼åˆ†åˆ«ä¸º (100,1)ã€(200,2)ã€(300,3)ã€(500,5) å’Œ (600,6)ã€‚</p>
<h3 id="11-1-æŸ¥è¯¢è¿‡ç¨‹"><a href="#11-1-æŸ¥è¯¢è¿‡ç¨‹" class="headerlink" title="11.1 æŸ¥è¯¢è¿‡ç¨‹"></a>11.1 æŸ¥è¯¢è¿‡ç¨‹</h3><p>å‡è®¾ï¼Œæ‰§è¡ŒæŸ¥è¯¢çš„è¯­å¥æ˜¯ <code>select id from test where k=5</code>ã€‚</p>
<ul>
<li>å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼ŒæŸ¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªè®°å½• (5,500) åï¼Œéœ€è¦æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè®°å½•ï¼Œç›´åˆ°ç¢°åˆ°ç¬¬ä¸€ ä¸ªä¸æ»¡è¶³k&#x3D;5æ¡ä»¶çš„è®°å½•ã€‚</li>
<li>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œç”±äºç´¢å¼•å®šä¹‰äº†å”¯ä¸€æ€§ï¼ŒæŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½•åï¼Œå°±ä¼šåœæ­¢ç»§ç»­æ£€ç´¢ã€‚</li>
</ul>
<p>é‚£ä¹ˆï¼Œè¿™ä¸ªä¸åŒå¸¦æ¥çš„æ€§èƒ½å·®è·ä¼šæœ‰å¤šå°‘å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œ <code>å¾®ä¹å…¶å¾®</code>ã€‚</p>
<p>ä½ çŸ¥é“çš„ï¼ŒInnoDB çš„æ•°æ®æ˜¯æŒ‰æ•°æ®é¡µä¸ºå•ä½æ¥è¯»å†™çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éœ€è¦è¯»ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å°†è¿™ä¸ªè®°å½•æœ¬èº«ä»ç£ç›˜è¯»å‡ºæ¥ï¼Œè€Œæ˜¯ä»¥é¡µä¸ºå•ä½ï¼Œå°†å…¶æ•´ä½“è¯»å…¥å†…å­˜ã€‚åœ¨ InnoDB ä¸­ï¼Œæ¯ä¸ªæ•°æ®é¡µçš„å¤§å°é»˜è®¤æ˜¯ 16KB</p>
<p>å› ä¸ºå¼•æ“æ˜¯æŒ‰é¡µè¯»å†™çš„ï¼Œæ‰€ä»¥è¯´ï¼Œå½“æ‰¾åˆ° k&#x3D;5 çš„è®°å½•çš„æ—¶å€™ï¼Œå®ƒæ‰€åœ¨çš„æ•°æ®é¡µå°±éƒ½åœ¨å†…å­˜é‡Œäº†ã€‚é‚£ä¹ˆï¼Œå¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œè¦å¤šåšçš„é‚£ä¸€æ¬¡â€œæŸ¥æ‰¾å’Œåˆ¤æ–­ä¸‹ä¸€æ¡è®°å½•â€çš„æ“ä½œï¼Œå°±åªéœ€è¦ä¸€æ¬¡æŒ‡é’ˆå¯»æ‰¾å’Œä¸€æ¬¡è®¡ç®—ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœ k&#x3D;5 è¿™ä¸ªè®°å½•åˆšå¥½æ˜¯è¿™ä¸ªæ•°æ®é¡µçš„æœ€åä¸€ä¸ªè®°å½•ï¼Œé‚£ä¹ˆè¦å–ä¸‹ä¸€ä¸ªè®°å½•ï¼Œå¿…é¡»è¯»å–ä¸‹ä¸€ä¸ªæ•°æ®é¡µï¼Œè¿™ä¸ªæ“ä½œä¼šç¨å¾®å¤æ‚ä¸€äº›ã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹‹å‰è®¡ç®—è¿‡ï¼Œå¯¹äºæ•´å‹å­—æ®µï¼Œä¸€ä¸ªæ•°æ®é¡µå¯ä»¥æ”¾è¿‘åƒä¸ª keyï¼Œå› æ­¤å‡ºç°è¿™ç§æƒ…å†µçš„æ¦‚ç‡ä¼šå¾ˆä½ã€‚æ‰€ä»¥æˆ‘ä»¬è®¡ç®—å¹³å‡æ€§èƒ½å·®å¼‚æ—¶ï¼Œä»å¯ä»¥è®¤ä¸ºè¿™ä¸ªæ“ä½œæˆæœ¬å¯¹äºç°åœ¨çš„ CPU æ¥è¯´å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p>
<h3 id="11-2-æ›´æ–°è¿‡ç¨‹"><a href="#11-2-æ›´æ–°è¿‡ç¨‹" class="headerlink" title="11.2 æ›´æ–°è¿‡ç¨‹"></a>11.2 æ›´æ–°è¿‡ç¨‹</h3><p>ä¸ºäº†è¯´æ˜æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¯¹æ›´æ–°è¯­å¥æ€§èƒ½çš„å½±å“è¿™ä¸ªé—®é¢˜ï¼Œä»‹ç»ä¸€ä¸‹ change bufferã€‚</p>
<p>å½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µæ—¶ï¼Œå¦‚æœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æ¥æ›´æ–°ï¼Œè€Œå¦‚æœè¿™ä¸ªæ•°æ®é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­çš„è¯ï¼Œ åœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼Œ<code>InooDB ä¼šå°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨ change buffer ä¸­</code> ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä»ç£ç›˜ä¸­è¯»å…¥è¿™ä¸ªæ•°æ®é¡µäº†ã€‚åœ¨ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œå°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œç„¶åæ‰§è¡Œ change buffer ä¸­ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¿è¯è¿™ä¸ªæ•°æ®é€»è¾‘çš„æ­£ç¡®æ€§ã€‚</p>
<p>å°† change buffer ä¸­çš„æ“ä½œåº”ç”¨åˆ°åŸæ•°æ®é¡µï¼Œå¾—åˆ°æœ€æ–°ç»“æœçš„è¿‡ç¨‹ç§°ä¸º <code>merge</code>ã€‚é™¤äº† <code>è®¿é—®è¿™ä¸ªæ•°æ®é¡µ</code> ä¼šè§¦å‘ merge å¤–ï¼Œç³»ç»Ÿæœ‰ <code>åå°çº¿ç¨‹ä¼šå®šæœŸ</code> mergeã€‚åœ¨ <code>æ•°æ®åº“æ­£å¸¸å…³é—­ï¼ˆshutdownï¼‰</code> çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ‰§è¡Œ merge æ“ä½œã€‚</p>
<p>å¦‚æœèƒ½å¤Ÿå°†æ›´æ–°æ“ä½œå…ˆè®°å½•åœ¨ change bufferï¼Œ <code>å‡å°‘è¯»ç£ç›˜</code> ï¼Œè¯­å¥çš„æ‰§è¡Œé€Ÿåº¦ä¼šå¾—åˆ°æ˜æ˜¾çš„æå‡ã€‚è€Œä¸”ï¼Œ æ•°æ®è¯»å…¥å†…å­˜æ˜¯éœ€è¦å ç”¨ buffer pool çš„ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼è¿˜èƒ½å¤Ÿ <code>é¿å…å ç”¨å†…å­˜</code> ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡ã€‚</p>
<p><strong>é‚£ä¹ˆï¼Œä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥ä½¿ç”¨ change buffer å‘¢ï¼Ÿ</strong></p>
<p>å¯¹å¹²å”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œæ‰€æœ‰çš„æ›´æ–°æ“ä½œéƒ½è¦å…ˆåˆ¤æ–­è¿™ä¸ªæ“ä½œæ˜¯å¦è¿åå”¯ä¸€æ€§çº¦æŸã€‚æ¯”å¦‚ï¼Œè¦æ’å…¥ (4.400) è¿™ä¸ªè®°å½•ï¼Œå°±è¦å…ˆåˆ¤æ–­ç°åœ¨è¡¨ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ k&#x3D;4 çš„è®°å½•ï¼Œè€Œè¿™å¿…é¡»è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜æ‰èƒ½åˆ¤æ–­ã€‚å¦‚æœéƒ½å·²ç»è¯»å…¥åˆ°å†…å­˜äº†ï¼Œé‚£ç›´æ¥æ›´æ–°å†…å­˜ä¼šæ›´å¿«ï¼Œå°±æ²¡å¿…è¦ä½¿ç”¨ change buffer äº†ã€‚</p>
<p>å› æ­¤ï¼Œ&#x3D;&#x3D;å”¯ä¸€ç´¢å¼•çš„æ›´æ–°å°±ä¸èƒ½ä½¿ç”¨ change bufferï¼Œå®é™…ä¸Šä¹Ÿåªæœ‰æ™®é€šç´¢å¼•å¯ä»¥ä½¿ç”¨&#x3D;&#x3D;ã€‚</p>
<p>change buffer ç”¨çš„æ˜¯ buffer pool é‡Œçš„å†…å­˜ï¼Œå› æ­¤ä¸èƒ½æ— é™å¢å¤§ã€‚change buffer çš„å¤§å°ï¼Œå¯ä»¥é€šè¿‡å‚æ•°<code>innodb change buffer maxsize</code> æ¥åŠ¨æ€è®¾ç½®ã€‚è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º 50 çš„æ—¶å€™ï¼Œè¡¨ç¤º changebuffer çš„å¤§å°æœ€å¤šåªèƒ½å ç”¨ buffer pool çš„ 50%ã€‚</p>
<p><strong>å¦‚æœè¦åœ¨è¿™å¼ è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ–°è®°å½• (4,400) çš„è¯ï¼ŒInnoDBçš„å¤„ç†æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</strong></p>
<p>ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œè¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µåœ¨å†…å­˜ä¸­ã€‚è¿™æ—¶ï¼š</p>
<ul>
<li>å¯¹å¹²å”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œæ‰¾åˆ° 3 å’Œ 5 ä¹‹é—´çš„ä½ç½®ï¼Œåˆ¤æ–­ä¸ºæ²¡æœ‰å†²çªï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸ</li>
<li>å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œæ‰¾åˆ° 3 å’Œ 5 ä¹‹é—´çš„ä½ç½®ï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸã€‚</li>
</ul>
<p>è¿™æ ·çœ‹æ¥ï¼Œæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¯¹æ›´æ–°è¯­å¥æ€§èƒ½å½±å“çš„å·®åˆ«ï¼Œåªæ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œåªä¼šè€—è´¹å¾®å°çš„CPUæ—¶é—´ã€‚</p>
<p>ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œè¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µä¸åœ¨å†…å­˜ä¸­ã€‚è¿™æ—¶ï¼š</p>
<ul>
<li>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œéœ€è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œåˆ¤æ–­åˆ°æ²¡æœ‰å†²çªï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸ;</li>
<li>å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œåˆ™æ˜¯å°†æ›´æ–°è®°å½•åœ¨ change bufferï¼Œè¯­å¥æ‰§è¡Œå°±ç»“æŸäº†ã€‚</li>
</ul>
<p>&#x3D;&#x3D;å°†æ•°æ®ä»ç£ç›˜è¯»å…¥å†…å­˜æ¶‰åŠéšæœº I&#x2F;O çš„è®¿é—®ï¼Œæ˜¯æ•°æ®åº“é‡Œé¢æˆæœ¬æœ€é«˜çš„æ“ä½œä¹‹ä¸€&#x3D;&#x3D;ã€‚change buffer å› ä¸ºå‡å°‘äº†éšæœºç£ç›˜è®¿é—®ï¼Œæ‰€ä»¥å¯¹æ›´æ–°æ€§èƒ½çš„æå‡æ˜¯ä¼šå¾ˆæ˜æ˜¾çš„ã€‚</p>
<blockquote>
<p>æ¡ˆä¾‹ï¼š</p>
<p>æŸä¸ªä¸šåŠ¡çš„åº“å†…å­˜å‘½ä¸­ç‡çªç„¶ä» 99% é™ä½åˆ°äº† 75%ï¼Œæ•´ä¸ªç³»ç»Ÿå¤„äºé˜»å¡çŠ¶æ€ï¼Œæ›´æ–°è¯­å¥å…¨éƒ¨å µä½ã€‚è€Œæ¢ç©¶å…¶åŸå› åï¼Œå‘ç°è¿™ä¸ªä¸šåŠ¡æœ‰å¤§é‡æ’å…¥æ•°æ®çš„æ“ä½œï¼Œè€Œä»–åœ¨å‰ä¸€å¤©æŠŠå…¶ä¸­çš„æŸä¸ªæ™®é€šç´¢å¼•æ”¹æˆäº†å”¯ä¸€ç´¢å¼•ã€‚</p>
</blockquote>
<h3 id="11-3-change-bufferçš„ä½¿ç”¨åœºæ™¯"><a href="#11-3-change-bufferçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="11.3 change bufferçš„ä½¿ç”¨åœºæ™¯"></a>11.3 change bufferçš„ä½¿ç”¨åœºæ™¯</h3><p>change buffer åªé™äºç”¨åœ¨æ™®é€šç´¢å¼•çš„åœºæ™¯ä¸‹ï¼Œè€Œä¸é€‚ç”¨äºå”¯ä¸€ç´¢å¼•ã€‚é‚£ä¹ˆï¼Œç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼š<strong>æ™®é€šç´¢å¼•çš„æ‰€æœ‰åœºæ™¯ï¼Œä½¿ç”¨ change buffer éƒ½å¯ä»¥èµ·åˆ°åŠ é€Ÿä½œç”¨å—ï¼Ÿ</strong></p>
<p>å› ä¸º merge çš„æ—¶å€™æ˜¯çœŸæ­£è¿›è¡Œæ•°æ®æ›´æ–°çš„æ—¶åˆ»ï¼Œè€Œ change buffer çš„ä¸»è¦ç›®çš„å°±æ˜¯&#x3D;&#x3D;å°†è®°å½•çš„å˜æ›´åŠ¨ä½œç¼“å­˜ä¸‹æ¥&#x3D;&#x3D;ï¼Œæ‰€ä»¥&#x3D;&#x3D;åœ¨ä¸€ä¸ªæ•°æ®é¡µåš merge ä¹‹å‰ï¼Œchange buffer è®°å½•çš„å˜æ›´è¶Šå¤š&#x3D;&#x3D;ï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªé¡µé¢ä¸Šè¦æ›´æ–°çš„æ¬¡æ•°è¶Šå¤šï¼‰ï¼Œ&#x3D;&#x3D;æ”¶ç›Šå°±è¶Šå¤§&#x3D;&#x3D;ã€‚</p>
<p>å› æ­¤ï¼Œå¯¹äºå†™å¤šè¯»å°‘çš„ä¸šåŠ¡æ¥è¯´ï¼Œé¡µé¢åœ¨å†™å®Œä»¥åé©¬ä¸Šè¢«è®¿é—®åˆ°çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶ change buffer çš„ä½¿ç”¨æ•ˆæœæœ€å¥½ã€‚è¿™ç§ä¸šåŠ¡æ¨¡å‹å¸¸è§çš„å°±æ˜¯<code>è´¦å•ç±»ã€æ—¥å¿—ç±»</code>çš„ç³»ç»Ÿã€‚</p>
<p>åè¿‡æ¥ï¼Œå‡è®¾ä¸€ä¸ªä¸šåŠ¡çš„æ›´æ–°æ¨¡å¼æ˜¯å†™å…¥ä¹‹åé©¬ä¸Šä¼šåšæŸ¥è¯¢ï¼Œé‚£ä¹ˆå³ä½¿æ»¡è¶³äº†æ¡ä»¶ï¼Œå°†æ›´æ–°å…ˆè®°å½•åœ¨ change bufferï¼Œä¹‹åç”±å¹²é©¬ä¸Šè¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µï¼Œä¼šç«‹å³è§¦å‘ merge è¿‡ç¨‹ï¼Œè¿™æ ·éšæœºè®¿é—® I&#x2F;O çš„æ¬¡æ•°ä¸ä¼šå‡å°‘ï¼Œåè€Œå¢åŠ äº† change buffer çš„ç»´æŠ¤ä»£ä»·ã€‚æ‰€ä»¥ï¼Œå¯¹äºè¿™ç§ä¸šåŠ¡æ¨¡å¼æ¥è¯´ï¼Œchangebuffer åè€Œèµ·åˆ°äº†å‰¯ä½œç”¨ã€‚</p>
<ol>
<li>æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•åº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿå…¶å®ï¼Œè¿™ä¸¤ç±»ç´¢å¼•åœ¨æŸ¥è¯¢èƒ½åŠ›ä¸Šæ˜¯æ²¡å·®åˆ«çš„ï¼Œä¸»è¦è€ƒè™‘çš„æ˜¯å¯¹ <code>æ›´æ–°æ€§èƒ½</code> çš„å½±å“ã€‚æ‰€ä»¥ï¼Œå»ºè®®ä½  <code>å°½é‡é€‰æ‹©æ™®é€šç´¢å¼•</code> ã€‚</li>
<li>åœ¨å®é™…ä½¿ç”¨ä¸­ä¼šå‘ç°ï¼Œ <code>æ™®é€šç´¢å¼•</code> å’Œ <code>change buffer</code> çš„é…åˆä½¿ç”¨ï¼Œå¯¹äº <code>æ•°æ®é‡å¤§</code> çš„è¡¨çš„æ›´æ–°ä¼˜åŒ–è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚</li>
<li>å¦‚æœæ‰€æœ‰çš„æ›´æ–°åé¢ï¼Œéƒ½é©¬ä¸Š <code>ä¼´éšç€å¯¹è¿™ä¸ªè®°å½•çš„æŸ¥è¯¢</code>ï¼Œé‚£ä¹ˆä½ åº”è¯¥å…³é—­<code>change buffer</code> ã€‚è€Œåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œchange buffer éƒ½èƒ½æå‡æ›´æ–°æ€§èƒ½ã€‚</li>
<li>ç”±äºå”¯ä¸€ç´¢å¼•ç”¨ä¸ä¸Š change buffer çš„ä¼˜åŒ–æœºåˆ¶ï¼Œå› æ­¤å¦‚æœ <code>ä¸šåŠ¡å¯ä»¥æ¥å—</code> ï¼Œä»æ€§èƒ½è§’åº¦å‡ºå‘å»ºè®®ä¼˜å…ˆè€ƒè™‘éå”¯ä¸€ç´¢å¼•ã€‚ä½†æ˜¯å¦‚æœâ€ä¸šåŠ¡å¯èƒ½æ— æ³•ç¡®ä¿â€çš„æƒ…å†µä¸‹ï¼Œæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ<ul>
<li>é¦–å…ˆï¼Œ <code>ä¸šåŠ¡æ­£ç¡®æ€§ä¼˜å…ˆ</code> ã€‚æˆ‘ä»¬çš„å‰ææ˜¯â€œä¸šåŠ¡ä»£ç å·²ç»ä¿è¯ä¸ä¼šå†™å…¥é‡å¤æ•°æ®â€çš„æƒ…å†µä¸‹ï¼Œè®¨è®ºæ€§èƒ½é—®é¢˜ã€‚å¦‚æœä¸šåŠ¡ä¸èƒ½ä¿è¯ï¼Œæˆ–è€…ä¸šåŠ¡å°±æ˜¯è¦æ±‚æ•°æ®åº“æ¥åšçº¦æŸï¼Œé‚£ä¹ˆæ²¡å¾—é€‰ï¼Œå¿…é¡»åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œæœ¬èŠ‚çš„æ„ä¹‰åœ¨äºï¼Œå¦‚æœç¢°ä¸Šäº†å¤§é‡æ’å…¥æ•°æ®æ…¢ã€å†…å­˜å‘½ä¸­ç‡ä½çš„æ—¶å€™ï¼Œç»™ä½ å¤šæä¾›ä¸€ä¸ªæ’æŸ¥æ€è·¯ã€‚</li>
<li>ç„¶åï¼Œåœ¨ä¸€äº›â€œ<code>å½’æ¡£åº“</code> â€çš„åœºæ™¯ï¼Œä½ æ˜¯å¯ä»¥è€ƒè™‘ä½¿ç”¨å”¯ä¸€ç´¢å¼•çš„ã€‚æ¯”å¦‚ï¼Œçº¿ä¸Šæ•°æ®åªéœ€è¦ä¿ç•™åŠå¹´ï¼Œ ç„¶åå†å²æ•°æ®ä¿å­˜åœ¨å½’æ¡£åº“ã€‚è¿™æ—¶å€™ï¼Œå½’æ¡£æ•°æ®å·²ç»æ˜¯ç¡®ä¿æ²¡æœ‰å”¯ä¸€é”®å†²çªäº†ã€‚è¦æé«˜å½’æ¡£æ•ˆç‡ï¼Œ å¯ä»¥è€ƒè™‘æŠŠè¡¨é‡Œé¢çš„å”¯ä¸€ç´¢å¼•æ”¹æˆæ™®é€šç´¢å¼•ã€‚</li>
</ul>
</li>
</ol>
<h2 id="12-å…¶å®ƒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥"><a href="#12-å…¶å®ƒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="12. å…¶å®ƒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥"></a>12. å…¶å®ƒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥</h2><h3 id="12-1-EXISTS-å’Œ-IN-çš„åŒºåˆ†"><a href="#12-1-EXISTS-å’Œ-IN-çš„åŒºåˆ†" class="headerlink" title="12.1 EXISTS å’Œ IN çš„åŒºåˆ†"></a>12.1 EXISTS å’Œ IN çš„åŒºåˆ†</h3><p><strong>é—®é¢˜ï¼š</strong></p>
<p>ä¸å¤ªç†è§£å“ªç§æƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨ EXISTSï¼Œå“ªç§æƒ…å†µåº”è¯¥ç”¨ INã€‚é€‰æ‹©çš„æ ‡å‡†æ˜¯çœ‹èƒ½å¦ä½¿ç”¨è¡¨çš„ç´¢å¼•å—?</p>
<p>å›ç­”:</p>
<p>ç´¢å¼•æ˜¯ä¸ªå‰æï¼Œå…¶å®é€‰æ‹©ä¸å¦è¿˜æ˜¯è¦çœ‹è¡¨çš„å¤§å°ã€‚ä½ å¯ä»¥å°†é€‰æ‹©çš„æ ‡å‡†ç†è§£ä¸º <code>å°è¡¨é©±åŠ¨å¤§è¡¨</code>ã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹æ•ˆç‡æ˜¯æœ€é«˜çš„ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> A <span class="keyword">WHERE</span> cc <span class="keyword">IN</span> (<span class="keyword">SELECT</span> cc <span class="keyword">FROM</span> B)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> A <span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> cc <span class="keyword">FROM</span> B <span class="keyword">WHERE</span> B.cc <span class="operator">=</span> A.cc)</span><br></pre></td></tr></table></figure>

<p>å½“ A å°äº B æ—¶ï¼Œç”¨ EXISTSã€‚å› ä¸º EXISTS çš„å®ç°ï¼Œç›¸å½“äºå¤–è¡¨å¾ªç¯ï¼Œå®ç°çš„é€»è¾‘ç±»ä¼¼äºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i in A</span><br><span class="line">    <span class="keyword">for</span> j in B</span><br><span class="line">        <span class="keyword">if</span> j.cc == i.cc then ...</span><br></pre></td></tr></table></figure>

<p>å½“ B å°äº A æ—¶ç”¨ INï¼Œå› ä¸ºå®ç°çš„é€»è¾‘ç±»ä¼¼äºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i in B</span><br><span class="line">    <span class="keyword">for</span> j in A</span><br><span class="line">        <span class="keyword">if</span> j.cc == i.cc then ...</span><br></pre></td></tr></table></figure>

<p>ç»“è®ºï¼š<strong>å“ªä¸ªè¡¨å°å°±ç”¨å“ªä¸ªè¡¨æ¥é©±åŠ¨ï¼ŒA è¡¨å°å°±ç”¨ EXISTS ï¼ŒB è¡¨å°å°±ç”¨ IN</strong></p>
<h3 id="12-2-COUNT-ä¸-COUNT-å…·ä½“å­—æ®µ-æ•ˆç‡"><a href="#12-2-COUNT-ä¸-COUNT-å…·ä½“å­—æ®µ-æ•ˆç‡" class="headerlink" title="12.2 COUNT(*) ä¸ COUNT(å…·ä½“å­—æ®µ) æ•ˆç‡"></a>12.2 COUNT(*) ä¸ COUNT(å…·ä½“å­—æ®µ) æ•ˆç‡</h3><p>é—®ï¼šåœ¨MySQLä¸­ç»Ÿè®¡æ•°æ®è¡¨çš„è¡Œæ•°ï¼Œå¯ä»¥ä½¿ç”¨ä¸‰ç§æ–¹å¼ <code>SELECT COUNT(*)</code>ã€<code>SELECT COUNT(1)</code> å’Œ <code>SELECT COUNT(å…·ä½“å­—æ®µ)</code>ï¼Œä½¿ç”¨è¿™ä¸‰è€…ä¹‹é—´çš„æŸ¥è¯¢æ•ˆç‡æ˜¯æ€æ ·çš„ï¼Ÿ</p>
<p>ç­”ï¼š</p>
<p>å‰æï¼šå¦‚æœä½ è¦ç»Ÿè®¡çš„æ˜¯æŸä¸ªå­—æ®µçš„éç©ºæ•°æ®è¡Œæ•°ï¼Œåˆ™å¦å½“åˆ«è®ºï¼Œæ¯•ç«Ÿæ¯”è¾ƒæ‰§è¡Œæ•ˆç‡çš„å‰ææ˜¯ç»“æœä¸€æ ·æ‰å¯ä»¥ã€‚</p>
<p><strong>ç¯èŠ‚1ï¼š</strong><code>COUNT(*)</code> å’Œ <code>COUNT(1)</code> éƒ½æ˜¯å¯¹æ‰€æœ‰ç»“æœè¿›è¡Œ COUNTï¼ŒCOUNT(*) å’Œ COUNT(1) æœ¬è´¨ä¸Šå¹¶æ²¡æœ‰åŒºåˆ«ï¼ˆäºŒè€…æ‰§è¡Œæ—¶é—´å¯èƒ½ç•¥æœ‰å·®åˆ«ï¼Œä¸è¿‡ä½ è¿˜æ˜¯å¯ä»¥æŠŠå®ƒä¿©çš„æ‰§è¡Œæ•ˆç‡çœ‹æˆæ˜¯ç›¸ç­‰çš„ï¼‰ã€‚å¦‚æœæœ‰ WHERE å­å¥ï¼Œåˆ™æ˜¯å¯¹æ‰€æœ‰ç¬¦åˆç­›é€‰æ¡ä»¶çš„æ•°æ®è¡Œè¿›è¡Œç»Ÿè®¡ï¼›å¦‚æœæ²¡æœ‰ WHERE å­å¥ï¼Œåˆ™æ˜¯å¯¹æ•°æ®è¡¨çš„æ•°æ®è¡Œæ•°è¿›è¡Œç»Ÿè®¡ã€‚</p>
<p><strong>ç¯èŠ‚2ï¼š</strong>å¦‚æœæ˜¯ MvlSAM å­˜å‚¨å¼•æ“ï¼Œç»Ÿè®¡æ•°æ®è¡¨çš„è¡Œæ•°åªéœ€è¦ O(1)çš„å¤æ‚åº¦ï¼Œè¿™æ˜¯å› ä¸ºæ¯å¼ MvlSAM çš„æ•°æ®è¡¨éƒ½æœ‰ä¸€ä¸ª meta ä¿¡æ¯å­˜å‚¨äº† row_count å€¼ï¼Œè€Œä¸€è‡´æ€§åˆ™ç”±è¡¨çº§é”æ¥ä¿è¯ã€‚</p>
<p>å¦‚æœæ˜¯ InnoDB å­˜å‚¨å¼•æ“ï¼Œå› ä¸º InnoDB æ”¯æŒäº‹åŠ¡ï¼Œé‡‡ç”¨è¡Œçº§é”å’Œ MVCC æœºåˆ¶ï¼Œæ‰€ä»¥æ— æ³•åƒ MyISAM ä¸€æ ·ï¼Œç»´æŠ¤ä¸€ä¸ª row_count å˜é‡ï¼Œå› æ­¤éœ€è¦é‡‡ç”¨æ‰«æå…¨è¡¨ï¼Œæ˜¯ O(n) çš„å¤æ‚åº¦ï¼Œè¿›è¡Œå¾ªç¯+è®¡æ•°çš„æ–¹å¼æ¥å®Œæˆç»Ÿè®¡ã€‚</p>
<p><strong>ç¯èŠ‚3ï¼š</strong>åœ¨ InnoDB å¼•æ“ä¸­ï¼Œå¦‚æœé‡‡ç”¨ COUNT(å…·ä½“å­—æ®µ) æ¥ç»Ÿè®¡æ•°æ®è¡Œæ•°ï¼Œè¦å°½é‡é‡‡ç”¨äºŒçº§ç´¢å¼•ã€‚å› ä¸ºä¸»é”®é‡‡ç”¨çš„ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼Œèšç°‡ç´¢å¼•åŒ…å«çš„ä¿¡æ¯å¤šï¼Œæ˜æ˜¾ä¼šå¤§äºäºŒçº§ç´¢å¼•ã€‚å¯¹äº <code>COUNT(*)</code> å’Œ<code>COUNT(1)</code> æ¥è¯´ï¼Œå®ƒä»¬ä¸éœ€è¦æŸ¥æ‰¾å…·ä½“çš„è¡Œï¼Œåªæ˜¯ç»Ÿè®¡è¡Œæ•°ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é‡‡ç”¨å ç”¨ç©ºé—´æ›´å°çš„äºŒçº§ç´¢å¼•æ¥è¿›è¡Œç»Ÿè®¡ã€‚</p>
<p>å¦‚æœæœ‰å¤šä¸ªäºŒçº§ç´¢å¼•ï¼Œä¼šä½¿ç”¨ keylen å°çš„äºŒçº§ç´¢å¼•è¿›è¡Œæ‰«æã€‚å½“æ²¡æœ‰äºŒçº§ç´¢å¼•çš„æ—¶å€™ï¼Œæ‰ä¼šé‡‡ç”¨ä¸»é”®ç´¢å¼•æ¥è¿›è¡Œç»Ÿè®¡ã€‚</p>
<h3 id="12-3-å…³äº-SELECT"><a href="#12-3-å…³äº-SELECT" class="headerlink" title="12.3 å…³äº SELECT(*)"></a>12.3 å…³äº SELECT(*)</h3><p>åœ¨è¡¨æŸ¥è¯¢ä¸­ï¼Œå»ºè®®æ˜ç¡®å­—æ®µï¼Œä¸è¦ä½¿ç”¨ * ä½œä¸ºæŸ¥è¯¢çš„å­—æ®µåˆ—è¡¨ï¼Œæ¨èä½¿ç”¨ SELECT &lt;å­—æ®µåˆ—è¡¨&gt; æŸ¥è¯¢ã€‚åŸå› ï¼š</p>
<ol>
<li>MySQL åœ¨è§£æçš„è¿‡ç¨‹ä¸­ï¼Œä¼šé€šè¿‡ <code>æŸ¥è¯¢æ•°æ®å­—å…¸</code> å°†â€*â€æŒ‰åºè½¬æ¢æˆæ‰€æœ‰åˆ—åï¼Œè¿™ä¼šå¤§å¤§çš„è€—è´¹èµ„æºå’Œæ—¶é—´ã€‚</li>
<li>æ— æ³•ä½¿ç”¨ <code>è¦†ç›–ç´¢å¼•</code></li>
</ol>
<h3 id="12-4-LIMIT-1-å¯¹ä¼˜åŒ–çš„å½±å“"><a href="#12-4-LIMIT-1-å¯¹ä¼˜åŒ–çš„å½±å“" class="headerlink" title="12.4 LIMIT 1 å¯¹ä¼˜åŒ–çš„å½±å“"></a>12.4 LIMIT 1 å¯¹ä¼˜åŒ–çš„å½±å“</h3><p>é’ˆå¯¹çš„æ˜¯ä¼šæ‰«æå…¨è¡¨çš„SQLè¯­å¥ï¼Œå¦‚æœä½ å¯ä»¥ç¡®å®šç»“æœé›†åªæœ‰ä¸€æ¡ï¼Œé‚£ä¹ˆåŠ ä¸Š <code>LIMIT 1</code> çš„æ—¶å€™ï¼Œå½“æ‰¾åˆ°ä¸€æ¡ç»“æœçš„æ—¶å€™å°±ä¸ä¼šç»§ç»­æ‰«æäº†ï¼Œè¿™æ ·ä¼šåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚</p>
<p>å¦‚æœæ•°æ®è¡¨å·²ç»å¯¹å­—æ®µå»ºç«‹äº†å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼Œä¸ä¼šå…¨è¡¨æ‰«æçš„è¯ï¼Œå°±ä¸éœ€è¦åŠ ä¸Š <code>LIMIT 1</code>äº†ã€‚</p>
<h3 id="12-5-å¤šä½¿ç”¨COMMIT"><a href="#12-5-å¤šä½¿ç”¨COMMIT" class="headerlink" title="12.5 å¤šä½¿ç”¨COMMIT"></a>12.5 å¤šä½¿ç”¨COMMIT</h3><p>åªè¦æœ‰å¯èƒ½ï¼Œåœ¨ç¨‹åºä¸­å°½é‡å¤šä½¿ç”¨ COMMITï¼Œè¿™æ ·ç¨‹åºçš„æ€§èƒ½å¾—åˆ°æé«˜ï¼Œéœ€æ±‚ä¹Ÿä¼šå› ä¸º COMMIT æ‰€é‡Šæ”¾çš„èµ„æºè€Œå‡å°‘ã€‚</p>
<p>COMMIT æ‰€é‡Šæ”¾çš„èµ„æº:</p>
<ul>
<li>å›æ»šæ®µä¸Šç”¨äºæ¢å¤æ•°æ®çš„ä¿¡æ¯</li>
<li>è¢«ç¨‹åºè¯­å¥è·å¾—çš„é”</li>
<li>redo &#x2F; undo log buffer ä¸­çš„ç©ºé—´</li>
<li>ç®¡ç†ä¸Šè¿° 3 ç§èµ„æºä¸­çš„å†…éƒ¨èŠ±è´¹</li>
</ul>
<h2 id="13-æ·˜å®æ•°æ®åº“ï¼Œä¸»é”®å¦‚ä½•è®¾è®¡çš„"><a href="#13-æ·˜å®æ•°æ®åº“ï¼Œä¸»é”®å¦‚ä½•è®¾è®¡çš„" class="headerlink" title="13. æ·˜å®æ•°æ®åº“ï¼Œä¸»é”®å¦‚ä½•è®¾è®¡çš„?"></a>13. æ·˜å®æ•°æ®åº“ï¼Œä¸»é”®å¦‚ä½•è®¾è®¡çš„?</h2><p>èŠä¸€ä¸ªå®é™…é—®é¢˜ï¼šæ·˜å®çš„æ•°æ®åº“ï¼Œä¸»é”®æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</p>
<p>æŸäº›é”™çš„ç¦»è°±çš„ç­”æ¡ˆè¿˜åœ¨ç½‘ä¸Šå¹´å¤ä¸€å¹´çš„æµä¼ ç€ï¼Œç”šè‡³è¿˜æˆä¸ºäº†æ‰€è°“çš„ MySQL å†›è§„ã€‚å…¶ä¸­ï¼Œä¸€ä¸ªæœ€æ˜æ˜¾çš„é”™è¯¯å°±æ˜¯å…³äº MySQL çš„ä¸»é”®è®¾è®¡ã€‚</p>
<p>å¤§éƒ¨åˆ†äººçš„å›ç­”å¦‚æ­¤è‡ªä¿¡ï¼šç”¨8å­—èŠ‚çš„ BIGINT åšä¸»é”®ï¼Œè€Œä¸è¦ç”¨INTã€‚<code>é”™</code>!</p>
<p>è¿™æ ·çš„å›ç­”ï¼Œåªç«™åœ¨äº†æ•°æ®åº“è¿™ä¸€å±‚ï¼Œè€Œæ²¡æœ‰ <code>ä»ä¸šåŠ¡çš„è§’åº¦</code> æ€è€ƒä¸»é”®ã€‚ä¸»é”®å°±æ˜¯ä¸€ä¸ªè‡ªå¢ ID å—ï¼Ÿç«™åœ¨ 2022 å¹´çš„æ–°å¹´æ¡£å£ï¼Œç”¨è‡ªå¢åšä¸»é”®ï¼Œæ¶æ„è®¾è®¡ä¸Šå¯èƒ½ <code>è¿åŠæ ¼éƒ½æ‹¿ä¸åˆ°</code>ã€‚</p>
<h3 id="13-1-è‡ªå¢IDçš„é—®é¢˜"><a href="#13-1-è‡ªå¢IDçš„é—®é¢˜" class="headerlink" title="13.1 è‡ªå¢IDçš„é—®é¢˜"></a>13.1 è‡ªå¢IDçš„é—®é¢˜</h3><p>è‡ªå¢ ID åšä¸»é”®ï¼Œç®€å•æ˜“æ‡‚ï¼Œå‡ ä¹æ‰€æœ‰æ•°æ®åº“éƒ½æ”¯æŒè‡ªå¢ç±»å‹ï¼Œåªæ˜¯å®ç°ä¸Šå„è‡ªæœ‰æ‰€ä¸åŒè€Œå·²ã€‚è‡ªå¢ ID é™¤äº†ç®€å•ï¼Œå…¶ä»–éƒ½æ˜¯ç¼ºç‚¹ï¼Œæ€»ä½“æ¥çœ‹å­˜åœ¨ä»¥ä¸‹å‡ æ–¹é¢çš„é—®é¢˜ï¼š</p>
<p><font color=blue><strong>1. å¯é æ€§ä¸é«˜</strong></font></p>
<p>å­˜åœ¨è‡ªå¢IDå›æº¯çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜ç›´åˆ°æœ€æ–°ç‰ˆæœ¬çš„MySQL 8.0æ‰ä¿®å¤ã€‚</p>
<p><font color=blue><strong>2. å®‰å…¨æ€§ä¸é«˜</strong></font></p>
<p>å¯¹å¤–æš´éœ²çš„æ¥å£å¯ä»¥éå¸¸å®¹æ˜“çŒœæµ‹å¯¹åº”çš„ä¿¡æ¯ã€‚æ¯”å¦‚ï¼š&#x2F;User&#x2F;1&#x2F; è¿™æ ·çš„æ¥å£ï¼Œå¯ä»¥éå¸¸å®¹æ˜“çŒœæµ‹ç”¨æˆ·IDçš„å€¼ä¸ºå¤šå°‘ï¼Œæ€»ç”¨æˆ·æ•°é‡æœ‰å¤šå°‘ï¼Œä¹Ÿå¯ä»¥éå¸¸å®¹æ˜“åœ°é€šè¿‡æ¥å£è¿›è¡Œæ•°æ®çš„çˆ¬å–ã€‚</p>
<p><font color=blue><strong>3. æ€§èƒ½å·®</strong></font></p>
<p>è‡ªå¢ ID çš„æ€§èƒ½è¾ƒå·®ï¼Œéœ€è¦åœ¨æ•°æ®åº“æœåŠ¡å™¨ç«¯ç”Ÿæˆã€‚</p>
<p><font color=blue><strong>4. äº¤äº’å¤š</strong></font></p>
<p>ä¸šåŠ¡è¿˜éœ€è¦é¢å¤–æ‰§è¡Œä¸€æ¬¡ç±»ä¼¼ <code>last_insert_id()</code> çš„å‡½æ•°æ‰èƒ½çŸ¥é“åˆšæ‰æ’å…¥çš„è‡ªå¢å€¼ï¼Œè¿™éœ€è¦å¤šä¸€æ¬¡çš„ç½‘ç»œäº¤äº’ã€‚åœ¨æµ·é‡å¹¶å‘çš„ç³»ç»Ÿä¸­ï¼Œå¤š1æ¡SQLï¼Œå°±å¤šä¸€æ¬¡æ€§èƒ½ä¸Šçš„å¼€é”€ã€‚</p>
<p><font color=blue><strong>5. å±€éƒ¨å”¯ä¸€æ€§</strong></font></p>
<p>æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œè‡ªå¢ ID æ˜¯å±€éƒ¨å”¯ä¸€ï¼Œåªåœ¨å½“å‰æ•°æ®åº“å®ä¾‹ä¸­å”¯ä¸€ï¼Œè€Œä¸æ˜¯å…¨å±€å”¯ä¸€ï¼Œåœ¨ä»»æ„æœåŠ¡å™¨é—´éƒ½æ˜¯å”¯ä¸€çš„ã€‚å¯¹äºç›®å‰åˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œè¿™ç®€ç›´å°±æ˜¯å™©æ¢¦ã€‚</p>
<h3 id="13-2-ä¸šåŠ¡å­—æ®µåšä¸»é”®"><a href="#13-2-ä¸šåŠ¡å­—æ®µåšä¸»é”®" class="headerlink" title="13.2 ä¸šåŠ¡å­—æ®µåšä¸»é”®"></a>13.2 ä¸šåŠ¡å­—æ®µåšä¸»é”®</h3><p>ä¸ºäº†èƒ½å¤Ÿå”¯ä¸€åœ°æ ‡è¯†ä¸€ä¸ªä¼šå‘˜çš„ä¿¡æ¯ï¼Œéœ€è¦ä¸º <code>ä¼šå‘˜ä¿¡æ¯è¡¨</code> è®¾ç½®ä¸€ä¸ªä¸»é”®ã€‚é‚£ä¹ˆï¼Œæ€ä¹ˆä¸ºè¿™ä¸ªè¡¨è®¾ç½®ä¸»é”®ï¼Œæ‰èƒ½è¾¾åˆ°æˆ‘ä»¬ç†æƒ³çš„ç›®æ ‡å‘¢? è¿™é‡Œæˆ‘ä»¬è€ƒè™‘ä¸šåŠ¡å­—æ®µåšä¸»é”®ã€‚ è¡¨æ•°æ®å¦‚ä¸‹:</p>
<p>åœ¨è¿™è¡¨é‡Œï¼Œå“ªä¸ªå­—æ®µæ¯”è¾ƒåˆé€‚å‘¢?</p>
<ul>
<li><strong>é€‰æ‹©å¡å·(cardno)</strong></li>
</ul>
<p>ä¼šå‘˜å¡å·ï¼ˆcardnoï¼‰çœ‹èµ·æ¥æ¯”è¾ƒåˆé€‚ï¼Œå› ä¸ºä¼šå‘˜å¡å·ä¸èƒ½ä¸ºç©ºï¼Œè€Œä¸”æœ‰å”¯ä¸€æ€§ï¼Œå¯ä»¥ç”¨æ¥æ ‡è¯†ä¸€æ¡ä¼šå‘˜è®°å½•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> demo.membermaster</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> (</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> cardno <span class="type">CHAR</span>(<span class="number">8</span>) <span class="keyword">PRIMARY</span> KEY, <span class="comment">-- ä¼šå‘˜å¡å·ä¸ºä¸»é”® -&gt; membername TEXT,</span></span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> memberphone TEXT,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> memberpid TEXT,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> memberaddress TEXT,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> sex TEXT,</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> birthday DATETIME</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> );</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.06</span> sec)</span><br></pre></td></tr></table></figure>

<p>ä¸åŒçš„ä¼šå‘˜å¡å·å¯¹åº”ä¸åŒçš„ä¼šå‘˜ï¼Œå­—æ®µâ€œcardnoâ€å”¯ä¸€åœ°æ ‡è¯†æŸä¸€ä¸ªä¼šå‘˜ã€‚å¦‚æœéƒ½æ˜¯è¿™æ ·ï¼Œä¼šå‘˜å¡å·ä¸ä¼šå‘˜ä¸€ä¸€å¯¹åº”ï¼Œç³»ç»Ÿæ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œçš„ã€‚</p>
<p>ä½†å®é™…æƒ…å†µæ˜¯ï¼Œ <code>ä¼šå‘˜å¡å·å¯èƒ½å­˜åœ¨é‡å¤ä½¿ç”¨</code> çš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œå¼ ä¸‰å› ä¸ºå·¥ä½œå˜åŠ¨æ¬ç¦»äº†åŸæ¥çš„åœ°å€ï¼Œä¸å†åˆ°å•†å®¶çš„é—¨åº—æ¶ˆè´¹äº† (é€€è¿˜äº†ä¼šå‘˜å¡)ï¼Œäºæ˜¯å¼ ä¸‰å°±ä¸å†æ˜¯è¿™ä¸ªå•†å®¶é—¨åº—çš„ä¼šå‘˜äº†ã€‚ä½†æ˜¯ï¼Œå•†å®¶ä¸æƒ³è®© è¿™ä¸ªä¼š å‘˜å¡ç©ºç€ï¼Œå°±æŠŠå¡å·æ˜¯â€œ10000001â€çš„ä¼šå‘˜å¡å‘ç»™äº†ç‹äº”ã€‚</p>
<p>ä»ç³»ç»Ÿè®¾è®¡çš„è§’åº¦çœ‹ï¼Œè¿™ä¸ªå˜åŒ–åªæ˜¯ä¿®æ”¹äº†ä¼šå‘˜ä¿¡æ¯è¡¨ä¸­çš„å¡å·æ˜¯â€œ10000001â€è¿™ä¸ªä¼šå‘˜ ä¿¡æ¯ï¼Œå¹¶ä¸ä¼šå½±å“åˆ°æ•°æ®ä¸€è‡´æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¿®æ”¹ä¼šå‘˜å¡å·æ˜¯â€œ10000001â€çš„ä¼šå‘˜ä¿¡æ¯ï¼Œ ç³»ç»Ÿçš„å„ä¸ªæ¨¡å—ï¼Œéƒ½ä¼šè·å–åˆ°ä¿®æ”¹åçš„ä¼šå‘˜ä¿¡æ¯ï¼Œä¸ä¼šå‡ºç°â€œæœ‰çš„æ¨¡å—è·å–åˆ°ä¿®æ”¹ä¹‹å‰çš„ä¼šå‘˜ä¿¡æ¯ï¼Œæœ‰çš„æ¨¡å—è·å–åˆ°ä¿®æ”¹åçš„ä¼šå‘˜ä¿¡æ¯ï¼Œ è€Œå¯¼è‡´ç³»ç»Ÿå†…éƒ¨æ•°æ®ä¸ä¸€è‡´â€çš„æƒ…å†µã€‚å› æ­¤ï¼Œä» <code>ä¿¡æ¯ç³»ç»Ÿå±‚é¢</code> ä¸Šçœ‹æ˜¯æ²¡é—®é¢˜çš„ã€‚</p>
<p>ä½†æ˜¯ä»ä½¿ç”¨ç³»ç»Ÿçš„ä¸šåŠ¡å±‚é¢ æ¥çœ‹ï¼Œå°±æœ‰å¾ˆå¤§çš„é—®é¢˜ äº†ï¼Œä¼šå¯¹å•†å®¶é€ æˆå½±å“ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªé”€å”®æµæ°´è¡¨(trans)ï¼Œè®°å½•äº†æ‰€æœ‰çš„é”€å”®æµæ°´æ˜ç»†ã€‚2020 å¹´ 12 æœˆ 01 æ—¥ï¼Œå¼ ä¸‰åœ¨é—¨åº—è´­ä¹°äº†ä¸€æœ¬ä¹¦ï¼Œæ¶ˆè´¹äº† 89 å…ƒã€‚é‚£ä¹ˆï¼Œç³»ç»Ÿä¸­å°±æœ‰äº†å¼ ä¸‰ä¹°ä¹¦çš„æµæ°´è®°å½•ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301617739.png" alt="image-20220829162818316"></p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸‹ 2020 å¹´ 12 æœˆ 01 æ—¥çš„ä¼šå‘˜é”€å”®è®°å½•:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> b.membername,c.goodsname,a.quantity,a.salesvalue,a.transdate</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> demo.trans <span class="keyword">AS</span> a</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">JOIN</span> demo.membermaster <span class="keyword">AS</span> b</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">JOIN</span> demo.goodsmaster <span class="keyword">AS</span> c</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ON</span> (a.cardno <span class="operator">=</span> b.cardno <span class="keyword">AND</span> a.itemnumber<span class="operator">=</span>c.itemnumber); </span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------+----------+------------+---------------------+ </span></span><br><span class="line"><span class="operator">|</span> membername <span class="operator">|</span> goodsname <span class="operator">|</span> quantity <span class="operator">|</span> salesvalue <span class="operator">|</span>           transdate <span class="operator">|</span> </span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------+----------+------------+---------------------+ </span></span><br><span class="line"><span class="operator">|</span> å¼ ä¸‰        <span class="operator">|</span>        ä¹¦ <span class="operator">|</span>    <span class="number">1.000</span> <span class="operator">|</span>      <span class="number">89.00</span> <span class="operator">|</span> <span class="number">2020</span><span class="number">-12</span><span class="number">-01</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span> </span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------+----------+------------+---------------------+ </span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¼šå‘˜å¡â€œ10000001â€åˆå‘ç»™äº†ç‹äº”ï¼Œæˆ‘ä»¬ä¼šæ›´æ”¹ä¼šå‘˜ä¿¡æ¯è¡¨ã€‚å¯¼è‡´æŸ¥è¯¢æ—¶:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> b.membername,c.goodsname,a.quantity,a.salesvalue,a.transdate</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> demo.trans <span class="keyword">AS</span> a</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">JOIN</span> demo.membermaster <span class="keyword">AS</span> b</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">JOIN</span> demo.goodsmaster <span class="keyword">AS</span> c</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ON</span> (a.cardno <span class="operator">=</span> b.cardno <span class="keyword">AND</span> a.itemnumber<span class="operator">=</span>c.itemnumber); </span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------+----------+------------+---------------------+ </span></span><br><span class="line"><span class="operator">|</span> membername <span class="operator">|</span> goodsname <span class="operator">|</span> quantity <span class="operator">|</span> salesvalue <span class="operator">|</span> transdate           <span class="operator">|</span> </span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------+----------+------------+---------------------+ </span></span><br><span class="line"><span class="operator">|</span> ç‹äº”        <span class="operator">|</span>        ä¹¦ <span class="operator">|</span>    <span class="number">1.000</span> <span class="operator">|</span>      <span class="number">89.00</span> <span class="operator">|</span> <span class="number">2020</span><span class="number">-12</span><span class="number">-01</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span> </span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------+----------+------------+---------------------+ </span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡å¾—åˆ°çš„ç»“æœæ˜¯ï¼šç‹äº”åœ¨ 2020 å¹´ 12 æœˆ 01 æ—¥ï¼Œä¹°äº†ä¸€æœ¬ä¹¦ï¼Œæ¶ˆè´¹ 89 å…ƒã€‚æ˜¾ç„¶æ˜¯é”™è¯¯çš„!ç»“è®ºï¼šåƒä¸‡ä¸èƒ½æŠŠä¼šå‘˜å¡å·å½“åšä¸»é”®ã€‚</p>
<ul>
<li><strong>é€‰æ‹©ä¼šå‘˜ç”µè¯æˆ–èº«ä»½è¯å·</strong></li>
</ul>
<p>ä¼šå‘˜ç”µè¯å¯ä»¥åšä¸»é”®å—ï¼Ÿä¸è¡Œçš„ã€‚åœ¨å®é™…æ“ä½œä¸­ï¼Œæ‰‹æœºå·ä¹Ÿå­˜åœ¨ <code>è¢«è¿è¥å•†æ”¶å›</code> ï¼Œé‡æ–°å‘ç»™åˆ«äººç”¨çš„æƒ…å†µã€‚</p>
<p>é‚£èº«ä»½è¯å·è¡Œä¸è¡Œå‘¢ï¼Ÿå¥½åƒå¯ä»¥ã€‚å› ä¸ºèº«ä»½è¯å†³ä¸ä¼šé‡å¤ï¼Œèº«ä»½è¯å·ä¸ä¸€ä¸ªäººå­˜åœ¨ä¸€ä¸€å¯¹ åº”çš„å…³ç³»ã€‚å¯é—®é¢˜æ˜¯ï¼Œèº«ä»½è¯å·å±äº <code>ä¸ªäººéšç§</code> ï¼Œé¡¾å®¢ä¸ä¸€å®šæ„¿æ„ç»™ä½ ã€‚è¦æ˜¯å¼ºåˆ¶è¦æ±‚ä¼šå‘˜å¿…é¡»ç™»è®°èº«ä»½è¯å·ï¼Œä¼šæŠŠå¾ˆå¤šå®¢äººèµ¶è·‘çš„ã€‚å…¶å®ï¼Œå®¢æˆ·ç”µè¯ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨è®¾è®¡ä¼šå‘˜ä¿¡æ¯è¡¨çš„æ—¶å€™ï¼Œå…è®¸èº«ä»½è¯å·å’Œç”µè¯éƒ½ä¸ºç©ºçš„åŸå› ã€‚</p>
<p><strong>æ‰€ä»¥ï¼Œå»ºè®®å°½é‡ä¸è¦ç”¨è·Ÿä¸šåŠ¡æœ‰å…³çš„å­—æ®µåšä¸»é”®ã€‚æ¯•ç«Ÿï¼Œä½œä¸ºé¡¹ç›®è®¾è®¡çš„æŠ€æœ¯äººå‘˜ï¼Œæˆ‘ä»¬è°ä¹Ÿæ— æ³•é¢„æµ‹åœ¨é¡¹ç›®çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå“ªä¸ªä¸šåŠ¡å­—æ®µä¼šå› ä¸ºé¡¹ç›®çš„ä¸šåŠ¡éœ€æ±‚è€Œæœ‰é‡å¤ï¼Œæˆ–è€…é‡ç”¨ä¹‹ç±»çš„æƒ…å†µå‡ºç°ã€‚</strong></p>
<blockquote>
<p>ç»éªŒ:</p>
<p>åˆšå¼€å§‹ä½¿ç”¨ MySQL æ—¶ï¼Œå¾ˆå¤šäººéƒ½å¾ˆå®¹æ˜“çŠ¯çš„é”™è¯¯æ˜¯å–œæ¬¢ç”¨ä¸šåŠ¡å­—æ®µåšä¸»é”®ï¼Œæƒ³å½“ç„¶åœ°è®¤ä¸ºäº†è§£ä¸šåŠ¡éœ€æ±‚ï¼Œä½†å®é™…æƒ…å†µå¾€å¾€å‡ºä¹æ„æ–™ï¼Œè€Œæ›´æ”¹ä¸»é”®è®¾ç½®çš„æˆæœ¬éå¸¸é«˜ã€‚</p>
</blockquote>
<h3 id="13-3-æ·˜å®çš„ä¸»é”®è®¾è®¡"><a href="#13-3-æ·˜å®çš„ä¸»é”®è®¾è®¡" class="headerlink" title="13.3 æ·˜å®çš„ä¸»é”®è®¾è®¡"></a>13.3 æ·˜å®çš„ä¸»é”®è®¾è®¡</h3><p>åœ¨æ·˜å®çš„ç”µå•†ä¸šåŠ¡ä¸­ï¼Œè®¢å•æœåŠ¡æ˜¯ä¸€ä¸ªæ ¸å¿ƒä¸šåŠ¡ã€‚è¯·é—®ï¼Œ <code>è®¢å•è¡¨çš„ä¸»é”®</code> æ·˜å®æ˜¯å¦‚ä½•è®¾è®¡çš„å‘¢ï¼Ÿæ˜¯è‡ªå¢IDå—ï¼Ÿ</p>
<p>æ‰“å¼€æ·˜å®ï¼Œçœ‹ä¸€ä¸‹è®¢å•ä¿¡æ¯ï¼š</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301617124.png" alt="image-20220829163123686"></p>
<p>ä»ä¸Šå›¾å¯ä»¥å‘ç°ï¼Œè®¢å•å·ä¸æ˜¯è‡ªå¢ID!æˆ‘ä»¬è¯¦ç»†çœ‹ä¸‹ä¸Šè¿°4ä¸ªè®¢å•å·:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1550672064762308113</span><br><span class="line">1481195847180308113</span><br><span class="line">1431156171142308113</span><br><span class="line">1431146631521308113</span><br></pre></td></tr></table></figure>

<p>è®¢å•å·æ˜¯ 19 ä½çš„é•¿åº¦ï¼Œä¸”è®¢å•çš„æœ€å 5 ä½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ 08113ã€‚ä¸”è®¢å•å·çš„å‰é¢ 14 ä½éƒ¨åˆ†æ˜¯å•è°ƒé€’å¢çš„ã€‚</p>
<p>å¤§èƒ†çŒœæµ‹ï¼Œæ·˜å®çš„è®¢å• ID è®¾è®¡åº”è¯¥æ˜¯ï¼š<code>è®¢å•ID = æ—¶é—´ + å»é‡å­—æ®µ + ç”¨æˆ·IDå6ä½å°¾å·</code></p>
<p>è¿™æ ·çš„è®¾è®¡èƒ½åšåˆ°å…¨å±€å”¯ä¸€ï¼Œä¸”å¯¹åˆ†å¸ƒå¼ç³»ç»ŸæŸ¥è¯¢åŠå…¶å‹å¥½ã€‚</p>
<h3 id="13-4-æ¨èçš„ä¸»é”®è®¾è®¡"><a href="#13-4-æ¨èçš„ä¸»é”®è®¾è®¡" class="headerlink" title="13.4 æ¨èçš„ä¸»é”®è®¾è®¡"></a>13.4 æ¨èçš„ä¸»é”®è®¾è®¡</h3><p><code>éæ ¸å¿ƒä¸šåŠ¡</code>ï¼šå¯¹åº”è¡¨çš„ä¸»é”®è‡ªå¢ IDï¼Œå¦‚å‘Šè­¦ã€æ—¥å¿—ã€ç›‘æ§ç­‰ä¿¡æ¯ã€‚</p>
<p><code>æ ¸å¿ƒä¸šåŠ¡</code>ï¼š<strong>ä¸»é”®è®¾è®¡è‡³å°‘åº”è¯¥æ˜¯å…¨å±€å”¯ä¸€ä¸”æ˜¯å•è°ƒé€’å¢</strong>ã€‚å…¨å±€å”¯ä¸€ä¿è¯åœ¨å„ç³»ç»Ÿä¹‹é—´éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå•è°ƒé€’å¢æ˜¯å¸Œæœ›æ’å…¥æ—¶ä¸å½±å“æ•°æ®åº“æ€§èƒ½ã€‚</p>
<p>è¿™é‡Œæ¨èæœ€ç®€å•çš„ä¸€ç§ä¸»é”®è®¾è®¡ï¼šUUIDã€‚</p>
<p><strong>UUIDçš„ç‰¹ç‚¹:</strong></p>
<p>å…¨å±€å”¯ä¸€ï¼Œå ç”¨ 36 å­—èŠ‚ï¼Œæ•°æ®æ— åºï¼Œæ’å…¥æ€§èƒ½å·®ã€‚</p>
<p><strong>è®¤è¯†UUID:</strong></p>
<ul>
<li>ä¸ºä»€ä¹ˆUUIDæ˜¯å…¨å±€å”¯ä¸€çš„?</li>
<li>ä¸ºä»€ä¹ˆUUIDå ç”¨36ä¸ªå­—èŠ‚?</li>
<li>ä¸ºä»€ä¹ˆUUIDæ˜¯æ— åºçš„?</li>
</ul>
<p>MySQLæ•°æ®åº“çš„UUIDç»„æˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UUID = æ—¶é—´ + UUID ç‰ˆæœ¬ï¼ˆ16å­—èŠ‚ï¼‰- æ—¶é’Ÿåºåˆ—ï¼ˆ4å­—èŠ‚ï¼‰ - MAC åœ°å€ï¼ˆ12å­—èŠ‚ï¼‰</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä»¥ UUID å€¼ï¼še0ea12d4-6473-11eb-943c-00155dbaa39d ä¸¾ä¾‹</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301618227.png" alt="image-20220830155849839"></p>
<p><strong><font color=blue>1. ä¸ºä»€ä¹ˆUUIDæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Ÿ</font></strong></p>
<p>åœ¨ UUID ä¸­æ—¶é—´éƒ¨åˆ†å ç”¨ 60 ä½ï¼Œå­˜å‚¨çš„ç±»ä¼¼ TIMESTAMP çš„æ—¶é—´æˆ³ï¼Œä½†è¡¨ç¤ºçš„æ˜¯ä»1582-10-15 00:00:00.00 åˆ°ç°åœ¨çš„ 100 ns çš„è®¡æ•°ã€‚å¯ä»¥çœ‹åˆ° UUID å­˜å‚¨çš„æ—¶é—´ç²¾åº¦æ¯” TIMESTAMPE æ›´é«˜ï¼Œæ—¶é—´ç»´åº¦å‘ç”Ÿé‡å¤çš„æ¦‚ç‡é™ä½åˆ°1&#x2F;100nsã€‚</p>
<p>æ—¶é’Ÿåºåˆ—æ˜¯ä¸ºäº†é¿å…æ—¶é’Ÿè¢«å›æ‹¨å¯¼è‡´äº§ç”Ÿæ—¶é—´é‡å¤çš„å¯èƒ½æ€§ã€‚MACåœ°å€ç”¨äºå…¨å±€å”¯ä¸€ã€‚</p>
<p><strong><font color=blue>2. ä¸ºä»€ä¹ˆUUIDå ç”¨36ä¸ªå­—èŠ‚ï¼Ÿ</font></strong></p>
<p>UUID æ ¹æ®å­—ç¬¦ä¸²è¿›è¡Œå­˜å‚¨ï¼Œè®¾è®¡æ—¶è¿˜å¸¦æœ‰æ— ç”¨â€-â€œå­—ç¬¦ä¸²ï¼Œå› æ­¤æ€»å…±éœ€è¦36ä¸ªå­—èŠ‚ã€‚</p>
<p><strong><font color=blue>3. ä¸ºä»€ä¹ˆUUIDæ˜¯éšæœºæ— åºçš„å‘¢ï¼Ÿ</font></strong></p>
<p>å› ä¸º UUID çš„è®¾è®¡ä¸­ï¼Œå°†æ—¶é—´ä½ä½æ”¾åœ¨æœ€å‰é¢ï¼Œè€Œè¿™éƒ¨åˆ†çš„æ•°æ®æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ï¼Œå¹¶ä¸”æ˜¯æ— åºã€‚</p>
<p><font color=red><strong>æ”¹é€ UUID</strong></font></p>
<p>è‹¥å°†æ—¶é—´é«˜ä½ä½äº’æ¢ï¼Œåˆ™æ—¶é—´å°±æ˜¯å•è°ƒé€’å¢çš„äº†ï¼Œä¹Ÿå°±å˜å¾—å•è°ƒé€’å¢äº†ã€‚MySQL 8.0 å¯ä»¥æ›´æ¢æ—¶é—´ä½ä½å’Œæ—¶é—´é«˜ä½çš„å­˜å‚¨æ–¹å¼ï¼Œè¿™æ · UUID å°±æ˜¯æœ‰åºçš„UUIDäº†ã€‚</p>
<p>MySQL 8.0 è¿˜è§£å†³äº† UUID å­˜åœ¨çš„ç©ºé—´å ç”¨çš„é—®é¢˜ï¼Œé™¤å»äº† UUID å­—ç¬¦ä¸²ä¸­æ— æ„ä¹‰çš„â€-â€œå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å°†å­—ç¬¦ä¸²ç”¨äºŒè¿›åˆ¶ç±»å‹ä¿å­˜ï¼Œè¿™æ ·å­˜å‚¨ç©ºé—´é™ä½ä¸ºäº†16å­—èŠ‚ã€‚</p>
<p>å¯ä»¥é€šè¿‡ MySQL 8.0 æä¾›çš„ uuid_to_bin å‡½æ•°å®ç°ä¸Šè¿°åŠŸèƒ½ï¼ŒåŒæ ·çš„ï¼ŒMySQL ä¹Ÿæä¾›äº† bin_to_uuid å‡½æ•°è¿›è¡Œ è½¬åŒ–ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="variable">@uuid</span> <span class="operator">=</span> UUID();</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@uuid</span>,uuid_to_bin(<span class="variable">@uuid</span>),uuid_to_bin(<span class="variable">@uuid</span>,<span class="literal">TRUE</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301618354.png" alt="image-20220118215859456"></p>
<p><strong>é€šè¿‡å‡½æ•° <code>uuid_to_bin(@uuid,true)</code> å°† UUID è½¬åŒ–ä¸ºæœ‰åº UUID äº†</strong>ã€‚&#x3D;&#x3D;å…¨å±€å”¯ä¸€ + å•è°ƒé€’å¢&#x3D;&#x3D;ï¼Œè¿™ä¸å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä¸»é”®ï¼</p>
<h3 id="13-5-æœ‰åº-UUID-æ€§èƒ½æµ‹è¯•"><a href="#13-5-æœ‰åº-UUID-æ€§èƒ½æµ‹è¯•" class="headerlink" title="13.5 æœ‰åº UUID æ€§èƒ½æµ‹è¯•"></a>13.5 æœ‰åº UUID æ€§èƒ½æµ‹è¯•</h3><p>16 å­—èŠ‚çš„æœ‰åº UUIDï¼Œç›¸æ¯”ä¹‹å‰ 8 å­—èŠ‚çš„è‡ªå¢IDï¼Œæ€§èƒ½å’Œå­˜å‚¨ç©ºé—´å¯¹æ¯”ç©¶ç«Ÿå¦‚ä½•å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æ¥åšä¸€ä¸ªæµ‹è¯•ï¼Œæ’å…¥ 1 äº¿æ¡æ•°æ®ï¼Œæ¯æ¡æ•°æ®å ç”¨ 500 å­—èŠ‚ï¼Œå«æœ‰ 3 ä¸ªäºŒçº§ç´¢å¼•ï¼Œæœ€ç»ˆçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208301618602.png" alt="image-20220830155246358"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æ’å…¥ 1 äº¿æ¡æ•°æ®æœ‰åº UUID æ˜¯æœ€å¿«çš„ï¼Œè€Œä¸”åœ¨å®é™…ä¸šåŠ¡ä½¿ç”¨ä¸­æœ‰åº UUID åœ¨ <code>ä¸šåŠ¡ç«¯å°±å¯ä»¥ç”Ÿæˆ</code> ã€‚è¿˜å¯ä»¥è¿›ä¸€æ­¥å‡å°‘ SQL çš„äº¤äº’æ¬¡æ•°ã€‚</p>
<p>å¦å¤–ï¼Œè™½ç„¶æœ‰åº UUID ç›¸æ¯”è‡ªå¢ ID å¤šäº† 8 ä¸ªå­—èŠ‚ï¼Œä½†å®é™…åªå¢å¤§äº† 3G çš„å­˜å‚¨ç©ºé—´ï¼Œè¿˜å¯ä»¥æ¥å—ã€‚</p>
<blockquote>
<p>åœ¨å½“ä»Šçš„äº’è”ç½‘ç¯å¢ƒä¸­ï¼Œéå¸¸ä¸æ¨èè‡ªå¢ ID ä½œä¸ºä¸»é”®çš„æ•°æ®åº“è®¾è®¡ã€‚æ›´æ¨èç±»ä¼¼æœ‰åº UUID çš„å…¨å±€å”¯ä¸€çš„å®ç°ã€‚</p>
<p>å¦å¤–åœ¨çœŸå®çš„ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œä¸»é”®è¿˜å¯ä»¥åŠ å…¥ä¸šåŠ¡å’Œç³»ç»Ÿå±æ€§ï¼Œå¦‚ç”¨æˆ·çš„å°¾å·ï¼Œæœºæˆ¿çš„ä¿¡æ¯ç­‰ã€‚è¿™æ ·çš„ä¸»é”®è®¾è®¡å°±æ›´ä¸ºè€ƒéªŒæ¶æ„å¸ˆçš„æ°´å¹³äº†ã€‚</p>
</blockquote>
<p><strong>å¦‚æœä¸æ˜¯ MySQL8.0 è‚¿ä¹ˆåŠ?</strong></p>
<p>æ‰‹åŠ¨èµ‹å€¼å­—æ®µåšä¸»é”®ï¼</p>
<p>æ¯”å¦‚ï¼Œè®¾è®¡å„ä¸ªåˆ†åº—çš„ä¼šå‘˜è¡¨çš„ä¸»é”®ï¼Œå› ä¸ºå¦‚æœæ¯å°æœºå™¨å„è‡ªäº§ç”Ÿçš„æ•°æ®éœ€è¦åˆå¹¶ï¼Œå°±å¯èƒ½ä¼šå‡ºç°ä¸»é”®é‡å¤çš„é—®é¢˜ã€‚</p>
<p>å¯ä»¥åœ¨æ€»éƒ¨ MySQL æ•°æ®åº“ä¸­ï¼Œæœ‰ä¸€ä¸ªç®¡ç†ä¿¡æ¯è¡¨ï¼Œåœ¨è¿™ä¸ªè¡¨ä¸­æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œä¸“é—¨ç”¨æ¥è®°å½•å½“å‰ä¼šå‘˜ç¼–å·çš„æœ€å¤§å€¼ã€‚</p>
<p>é—¨åº—åœ¨æ·»åŠ ä¼šå‘˜çš„æ—¶å€™ï¼Œå…ˆåˆ°æ€»éƒ¨ MySQL æ•°æ®åº“ä¸­è·å–è¿™ä¸ªæœ€å¤§å€¼ï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸ŠåŠ  1ï¼Œç„¶åç”¨è¿™ä¸ªå€¼ä½œä¸ºæ–°ä¼šå‘˜çš„â€œidâ€åŒæ—¶ï¼Œæ›´æ–°æ€»éƒ¨ MySQL æ•°æ®åº“ç®¡ç†ä¿¡æ¯è¡¨ä¸­çš„å½“å‰ä¼šå‘˜ç¼–å·çš„æœ€å¤§å€¼ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œå„ä¸ªé—¨åº—æ·»åŠ ä¼šå‘˜çš„æ—¶å€™ï¼Œéƒ½å¯¹åŒä¸€ä¸ªæ€»éƒ¨ MySQL æ•°æ®åº“ä¸­çš„æ•°æ®è¡¨å­—æ®µè¿›è¡Œæ“ä½œï¼Œå°±è§£å†³äº†å„é—¨åº—æ·»åŠ ä¼šå‘˜æ—¶ä¼šå‘˜ç¼–å·å†²çªçš„é—®é¢˜ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://blog.dalicoding.fun">Leo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://blog.dalicoding.fun/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC08%E7%AB%A0_%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%B8%8E%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/">https://blog.dalicoding.fun/2024/04/05/MySQLä»å…¥é—¨åˆ°å…¥åœŸ/ç¬¬08ç« _ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://blog.dalicoding.fun" target="_blank">Leoçš„åšå®¢</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>èµåŠ©</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202404041655138.jpg" target="_blank"><img class="post-qr-code-img" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202404041655138.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202404041655057.jpg" target="_blank"><img class="post-qr-code-img" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202404041655057.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC07%E7%AB%A0_%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/" title="ä¸ƒã€æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">ä¸ƒã€æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨</div></div></a></div><div class="next-post pull-right"><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC09%E7%AB%A0%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83/" title="ä¹ã€æ•°æ®åº“çš„è®¾è®¡è§„èŒƒ"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909521.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">ä¹ã€æ•°æ®åº“çš„è®¾è®¡è§„èŒƒ</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC01%E7%AB%A0_MySQL%E7%9A%84%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95/" title="ä¸€ã€MySQLçš„æ•°æ®ç›®å½•"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">ä¸€ã€MySQLçš„æ•°æ®ç›®å½•</div></div></a></div><div><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC02%E7%AB%A0_%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84%E5%89%96%E6%9E%90/" title="äºŒã€é€»è¾‘æ¶æ„å‰–æ"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">äºŒã€é€»è¾‘æ¶æ„å‰–æ</div></div></a></div><div><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC03%E7%AB%A0_%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/" title="ä¸‰ã€å­˜å‚¨å¼•æ“"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909521.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">ä¸‰ã€å­˜å‚¨å¼•æ“</div></div></a></div><div><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC04%E7%AB%A0_%E7%B4%A2%E5%BC%95%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="å››ã€ç´¢å¼•çš„æ•°æ®ç»“æ„"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">å››ã€ç´¢å¼•çš„æ•°æ®ç»“æ„</div></div></a></div><div><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC05%E7%AB%A0_InnoDB%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/" title="äº”ã€InnoDBæ•°æ®å­˜å‚¨ç»“æ„"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909521.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">äº”ã€InnoDBæ•°æ®å­˜å‚¨ç»“æ„</div></div></a></div><div><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC06%E7%AB%A0_%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" title="å…­ã€ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909521.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">å…­ã€ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403221853832.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Leo</div><div class="author-info__description">Leoçš„åšå®¢</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/LiXuYangISZ"><i class="fab fa-github"></i><span>ğŸ›´å‰å¾€å°å®¶...</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/LiXuYangISZ" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/img/WeChatQRCode.jpg" target="_blank" title="icon-weixin"><i class="å¾®ä¿¡" style="color: faa-tada;"></i></a><a class="social-icon" href="https://res.abeim.cn/api/qq/?qq=2422737092" target="_blank" title="icon-QQ"><i class="QQ" style="color: faa-tada;"></i></a><a class="social-icon" href="https://space.bilibili.com/434261812" target="_blank" title="icon-bilibili"><i class="Bç«™" style="color: faa-tada;"></i></a><a class="social-icon" href="mailto:2422737092@qq.com" target="_blank" title="icon-youxiang"><i class="QQé‚®ç®±" style="color: faa-tada;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content"><center>ä¸»åŸŸåï¼š<br><a href="https://blog.dalicoding.fun"><b><font color="#5ea6e5">æ¬¢è¿æ¥åˆ°Leoçš„åšå®¢~</font></b></a></center></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="toc-number">1.</span> <span class="toc-text">1. æ•°æ®å‡†å¤‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E6%A1%88%E4%BE%8B"><span class="toc-number">2.</span> <span class="toc-text">2. ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%85%A8%E5%80%BC%E5%8C%B9%E9%85%8D%E6%88%91%E6%9C%80%E7%88%B1"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%9C%80%E5%B7%A6%E5%8C%B9%E9%85%8D%E5%8E%9F%E5%88%99"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 æœ€å·¦åŒ¹é…åŸåˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E4%B8%BB%E9%94%AE%E6%8F%92%E5%85%A5%E9%A1%BA%E5%BA%8F"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 ä¸»é”®æ’å…¥é¡ºåº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E8%AE%A1%E7%AE%97%E3%80%81%E5%87%BD%E6%95%B0%E3%80%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%EF%BC%88%E8%87%AA%E5%8A%A8%E6%88%96%E6%89%8B%E5%8A%A8%EF%BC%89%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢ï¼ˆè‡ªåŠ¨æˆ–æ‰‹åŠ¨ï¼‰å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E8%8C%83%E5%9B%B4%E6%9D%A1%E4%BB%B6%E5%8F%B3%E8%BE%B9%E7%9A%84%E5%88%97%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—ç´¢å¼•å¤±æ•ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E4%B8%8D%E7%AD%89%E4%BA%8E%EF%BC%88-%E6%88%96%E8%80%85-%EF%BC%89%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">2.6.</span> <span class="toc-text">2.6 ä¸ç­‰äºï¼ˆ!&#x3D; æˆ–è€… &lt;&gt;ï¼‰ç´¢å¼•å¤±æ•ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-is-null%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%EF%BC%8Cis-not-null%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95"><span class="toc-number">2.7.</span> <span class="toc-text">2.7 is nullå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œis not nullæ— æ³•ä½¿ç”¨ç´¢å¼•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-like-%E4%BB%A5%E9%80%9A%E9%85%8D%E7%AC%A6-%E5%BC%80%E5%A4%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">2.8.</span> <span class="toc-text">2.8 like ä»¥é€šé…ç¬¦ % å¼€å¤´ç´¢å¼•å¤±æ•ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-OR-%E5%89%8D%E5%90%8E%E5%AD%98%E5%9C%A8%E9%9D%9E%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%97%EF%BC%8C%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">2.9.</span> <span class="toc-text">2.9 OR å‰åå­˜åœ¨éç´¢å¼•çš„åˆ—ï¼Œç´¢å¼•å¤±æ•ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-10-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86%E7%BB%9F%E4%B8%80%E4%BD%BF%E7%94%A8utf8mb4-utf8mb3"><span class="toc-number">2.10.</span> <span class="toc-text">2.10 æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨utf8mb4&#x2F;utf8mb3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-11-%E7%BB%83%E4%B9%A0%E5%8F%8A%E4%B8%80%E8%88%AC%E6%80%A7%E5%BB%BA%E8%AE%AE"><span class="toc-number">2.11.</span> <span class="toc-text">2.11 ç»ƒä¹ åŠä¸€èˆ¬æ€§å»ºè®®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">3.</span> <span class="toc-text">3. å…³è”æŸ¥è¯¢ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 æ•°æ®å‡†å¤‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E9%87%87%E7%94%A8%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.2.</span> <span class="toc-text">3.1 é‡‡ç”¨å·¦å¤–è¿æ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E9%87%87%E7%94%A8%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.3.</span> <span class="toc-text">3.2 é‡‡ç”¨å†…è¿æ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-join-%E8%AF%AD%E5%8F%A5%E5%8E%9F%E7%90%86"><span class="toc-number">3.4.</span> <span class="toc-text">3.3 join è¯­å¥åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E9%A9%B1%E5%8A%A8%E8%A1%A8%E5%92%8C%E8%A2%AB%E9%A9%B1%E5%8A%A8%E8%A1%A8"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.3.1 é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-Simple-Nested-Loop-Join%EF%BC%88%E7%AE%80%E5%8D%95%E5%B5%8C%E5%A5%97%E5%BE%AA%E7%8E%AF%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.3.2 Simple Nested-Loop Joinï¼ˆç®€å•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-Index-Nested-Loop-Join%EF%BC%88%E7%B4%A2%E5%BC%95%E5%B5%8C%E5%A5%97%E5%BE%AA%E7%8E%AF%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="toc-number">3.4.3.</span> <span class="toc-text">3.3.3 Index Nested-Loop Joinï¼ˆç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-Block-Nested-Loop-Join%EF%BC%88%E5%BF%AB%E5%B5%8C%E5%A5%97%E5%BE%AA%E7%8E%AF%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="toc-number">3.4.4.</span> <span class="toc-text">3.3.4 Block Nested-Loop Joinï¼ˆå¿«åµŒå¥—å¾ªç¯è¿æ¥ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-5-%E5%B0%8F%E7%BB%93"><span class="toc-number">3.4.5.</span> <span class="toc-text">3.3.5 å°ç»“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-6-Hash-Join"><span class="toc-number">3.4.6.</span> <span class="toc-text">3.3.6 Hash Join</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%AD%90%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">4. å­æŸ¥è¯¢ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%8E%92%E5%BA%8F%E4%BC%98%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">5. æ’åºä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E6%8E%92%E5%BA%8F%E4%BC%98%E5%8C%96"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 æ’åºä¼˜åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E6%B5%8B%E8%AF%95"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 æµ‹è¯•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 æ¡ˆä¾‹å®æˆ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-filesort-%E7%AE%97%E6%B3%95%EF%BC%9A%E5%8F%8C%E8%B7%AF%E6%8E%92%E5%BA%8F%E5%92%8C%E5%8D%95%E8%B7%AF%E6%8E%92%E5%BA%8F"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 filesort ç®—æ³•ï¼šåŒè·¯æ’åºå’Œå•è·¯æ’åº</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-GROUP-BY%E4%BC%98%E5%8C%96"><span class="toc-number">6.</span> <span class="toc-text">6. GROUP BYä¼˜åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E4%BC%98%E5%8C%96%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.</span> <span class="toc-text">7. ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E4%BC%98%E5%85%88%E8%80%83%E8%99%91%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="toc-number">8.</span> <span class="toc-text">8. ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E4%BB%80%E4%B9%88%E6%98%AF%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%EF%BC%9F"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%A9%E5%BC%8A"><span class="toc-number">8.2.</span> <span class="toc-text">8.2 è¦†ç›–ç´¢å¼•çš„åˆ©å¼Š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%A6%82%E4%BD%95%E7%BB%99%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%B7%BB%E5%8A%A0%E7%B4%A2%E5%BC%95"><span class="toc-number">9.</span> <span class="toc-text">9. å¦‚ä½•ç»™å­—ç¬¦ä¸²æ·»åŠ ç´¢å¼•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95"><span class="toc-number">9.1.</span> <span class="toc-text">9.1 å‰ç¼€ç´¢å¼•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95%E5%AF%B9%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-number">9.2.</span> <span class="toc-text">9.2 å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E6%8B%93%E5%B1%95%E5%86%85%E5%AE%B9"><span class="toc-number">9.3.</span> <span class="toc-text">9.3 æ‹“å±•å†…å®¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8"><span class="toc-number">10.</span> <span class="toc-text">10. ç´¢å¼•ä¸‹æ¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E4%BD%BF%E7%94%A8%E5%89%8D%E5%90%8E%E5%AF%B9%E6%AF%94"><span class="toc-number">10.1.</span> <span class="toc-text">10.1 ä½¿ç”¨å‰åå¯¹æ¯”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-ICP-%E7%9A%84%E5%BC%80%E5%90%AF%E3%80%81%E5%85%B3%E9%97%AD"><span class="toc-number">10.2.</span> <span class="toc-text">10.2 ICP çš„å¼€å¯ã€å…³é—­</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-ICP-%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">10.3.</span> <span class="toc-text">10.3 ICP ä½¿ç”¨æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-%E5%BC%80%E5%90%AF%E5%92%8C%E5%85%B3%E9%97%ADICP%E7%9A%84%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="toc-number">10.4.</span> <span class="toc-text">11.4 å¼€å¯å’Œå…³é—­ICPçš„æ€§èƒ½å¯¹æ¯”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-ICP-%E7%9A%84%E4%BD%BF%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">10.5.</span> <span class="toc-text">10.5 ICP çš„ä½¿ç”¨æ¡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E6%99%AE%E9%80%9A%E7%B4%A2%E5%BC%95-vs-%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95"><span class="toc-number">11.</span> <span class="toc-text">11. æ™®é€šç´¢å¼• vs å”¯ä¸€ç´¢å¼•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-%E6%9F%A5%E8%AF%A2%E8%BF%87%E7%A8%8B"><span class="toc-number">11.1.</span> <span class="toc-text">11.1 æŸ¥è¯¢è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-%E6%9B%B4%E6%96%B0%E8%BF%87%E7%A8%8B"><span class="toc-number">11.2.</span> <span class="toc-text">11.2 æ›´æ–°è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-change-buffer%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">11.3.</span> <span class="toc-text">11.3 change bufferçš„ä½¿ç”¨åœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E5%85%B6%E5%AE%83%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-number">12.</span> <span class="toc-text">12. å…¶å®ƒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-EXISTS-%E5%92%8C-IN-%E7%9A%84%E5%8C%BA%E5%88%86"><span class="toc-number">12.1.</span> <span class="toc-text">12.1 EXISTS å’Œ IN çš„åŒºåˆ†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-COUNT-%E4%B8%8E-COUNT-%E5%85%B7%E4%BD%93%E5%AD%97%E6%AE%B5-%E6%95%88%E7%8E%87"><span class="toc-number">12.2.</span> <span class="toc-text">12.2 COUNT(*) ä¸ COUNT(å…·ä½“å­—æ®µ) æ•ˆç‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-3-%E5%85%B3%E4%BA%8E-SELECT"><span class="toc-number">12.3.</span> <span class="toc-text">12.3 å…³äº SELECT(*)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-4-LIMIT-1-%E5%AF%B9%E4%BC%98%E5%8C%96%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-number">12.4.</span> <span class="toc-text">12.4 LIMIT 1 å¯¹ä¼˜åŒ–çš„å½±å“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-5-%E5%A4%9A%E4%BD%BF%E7%94%A8COMMIT"><span class="toc-number">12.5.</span> <span class="toc-text">12.5 å¤šä½¿ç”¨COMMIT</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E6%B7%98%E5%AE%9D%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E4%B8%BB%E9%94%AE%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E7%9A%84"><span class="toc-number">13.</span> <span class="toc-text">13. æ·˜å®æ•°æ®åº“ï¼Œä¸»é”®å¦‚ä½•è®¾è®¡çš„?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-%E8%87%AA%E5%A2%9EID%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">13.1.</span> <span class="toc-text">13.1 è‡ªå¢IDçš„é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-%E4%B8%9A%E5%8A%A1%E5%AD%97%E6%AE%B5%E5%81%9A%E4%B8%BB%E9%94%AE"><span class="toc-number">13.2.</span> <span class="toc-text">13.2 ä¸šåŠ¡å­—æ®µåšä¸»é”®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-3-%E6%B7%98%E5%AE%9D%E7%9A%84%E4%B8%BB%E9%94%AE%E8%AE%BE%E8%AE%A1"><span class="toc-number">13.3.</span> <span class="toc-text">13.3 æ·˜å®çš„ä¸»é”®è®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-4-%E6%8E%A8%E8%8D%90%E7%9A%84%E4%B8%BB%E9%94%AE%E8%AE%BE%E8%AE%A1"><span class="toc-number">13.4.</span> <span class="toc-text">13.4 æ¨èçš„ä¸»é”®è®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-5-%E6%9C%89%E5%BA%8F-UUID-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-number">13.5.</span> <span class="toc-text">13.5 æœ‰åº UUID æ€§èƒ½æµ‹è¯•</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/04/05/Redis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC08%E7%AB%A0_Redis%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" title="ä¸ƒã€Redisæ¶ˆæ¯é˜Ÿåˆ—"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ä¸ƒã€Redisæ¶ˆæ¯é˜Ÿåˆ—"/></a><div class="content"><a class="title" href="/2024/04/05/Redis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC08%E7%AB%A0_Redis%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" title="ä¸ƒã€Redisæ¶ˆæ¯é˜Ÿåˆ—">ä¸ƒã€Redisæ¶ˆæ¯é˜Ÿåˆ—</a><time datetime="2024-04-05T06:46:07.000Z" title="å‘è¡¨äº 2024-04-05 14:46:07">2024-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/05/Redis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC07%E7%AB%A0_%E7%A7%92%E6%9D%80%E4%BC%98%E5%8C%96/" title="å…­ã€ç§’æ€ä¼˜åŒ–"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å…­ã€ç§’æ€ä¼˜åŒ–"/></a><div class="content"><a class="title" href="/2024/04/05/Redis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC07%E7%AB%A0_%E7%A7%92%E6%9D%80%E4%BC%98%E5%8C%96/" title="å…­ã€ç§’æ€ä¼˜åŒ–">å…­ã€ç§’æ€ä¼˜åŒ–</a><time datetime="2024-04-05T06:46:06.000Z" title="å‘è¡¨äº 2024-04-05 14:46:06">2024-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/05/Redis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC06%E7%AB%A0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81-redission/" title="äº”ã€åˆ†å¸ƒå¼é”-Redission"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="äº”ã€åˆ†å¸ƒå¼é”-Redission"/></a><div class="content"><a class="title" href="/2024/04/05/Redis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC06%E7%AB%A0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81-redission/" title="äº”ã€åˆ†å¸ƒå¼é”-Redission">äº”ã€åˆ†å¸ƒå¼é”-Redission</a><time datetime="2024-04-05T06:46:05.000Z" title="å‘è¡¨äº 2024-04-05 14:46:05">2024-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/05/Redis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC05%E7%AB%A0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" title="å››ã€åˆ†å¸ƒå¼é”"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å››ã€åˆ†å¸ƒå¼é”"/></a><div class="content"><a class="title" href="/2024/04/05/Redis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC05%E7%AB%A0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" title="å››ã€åˆ†å¸ƒå¼é”">å››ã€åˆ†å¸ƒå¼é”</a><time datetime="2024-04-05T06:46:04.000Z" title="å‘è¡¨äº 2024-04-05 14:46:04">2024-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/05/Redis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC04%E7%AB%A0_%E4%BC%98%E6%83%A0%E5%88%B8%E7%A7%92%E6%9D%80/" title="ä¸‰ã€ä¼˜æƒ åˆ¸ç§’æ€"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ä¸‰ã€ä¼˜æƒ åˆ¸ç§’æ€"/></a><div class="content"><a class="title" href="/2024/04/05/Redis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC04%E7%AB%A0_%E4%BC%98%E6%83%A0%E5%88%B8%E7%A7%92%E6%9D%80/" title="ä¸‰ã€ä¼˜æƒ åˆ¸ç§’æ€">ä¸‰ã€ä¼˜æƒ åˆ¸ç§’æ€</a><time datetime="2024-04-05T06:46:03.000Z" title="å‘è¡¨äº 2024-04-05 14:46:03">2024-04-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By Leo</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">I wish you to become your own sun, no need to rely on who's light.<p><a target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="åšå®¢æ¡†æ¶ä¸ºHexo"></a>&nbsp;<a target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="ä¸»é¢˜é‡‡ç”¨butterfly"></a>&nbsp;<a target="_blank" href="https://www.jsdelivr.com/"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="æœ¬ç«™ä½¿ç”¨JsDelivrä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ"></a> &nbsp;<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><img  src="https://img.shields.io/badge/%E8%B1%ABICP%E5%A4%87-2023001225-%23c41b6c" title="æœ¬ç«™å·²åŠ å…¥ICPè±ªåå¥—é¤ï¼Œè±«ICPå¤‡2023001225å·"></a>&nbsp;   <a target="_blank" href="https://vercel.com/ "><img src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&logo=Vercel" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œé»˜è®¤çº¿è·¯æ‰˜ç®¡äºVercel"></a>&nbsp;<a target="_blank" href="https://vercel.com/ "><img src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&logo=Codio" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œè”é€šçº¿è·¯æ‰˜ç®¡äºCoding"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="æœ¬ç«™é¡¹ç›®ç”±Gtihubæ‰˜ç®¡"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://my-twikoo-orpin.vercel.app/',
      region: 'ap-hangzhou',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://my-twikoo-orpin.vercel.app/',
      region: 'ap-hangzhou',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))

    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(init,0)
    else getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.31/dist/twikoo.all.min.js').then(init)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[å›¾ç‰‡]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[é“¾æ¥]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[ä»£ç ]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://my-twikoo-orpin.vercel.app/',
        region: 'ap-hangzhou',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "æ— æ³•è·å–è¯„è®ºï¼Œè¯·ç¡®è®¤ç›¸å…³é…ç½®æ˜¯å¦æ­£ç¡®"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.31/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'æ²¡æœ‰è¯„è®º'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script defer src="/live2d-widget/autoload.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.22.1/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.65.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js?v=4.13.0"></script></div></div></body></html>