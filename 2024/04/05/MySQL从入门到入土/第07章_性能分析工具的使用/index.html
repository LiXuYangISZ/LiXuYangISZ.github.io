<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ä¸ƒã€æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨ | Leoçš„åšå®¢</title><meta name="author" content="Leo"><meta name="copyright" content="Leo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="[TOC] åœ¨æ•°æ®åº“è°ƒä¼˜ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯å“åº”æ—¶é—´æ›´å¿«ï¼Œååé‡æ›´å¤§ã€‚åˆ©ç”¨å®è§‚çš„ç›‘æ§å·¥å…·å’Œå¾®è§‚çš„æ—¥å¿—åˆ†æå¯ä»¥å¸®æˆ‘ä»¬å¿«é€Ÿæ‰¾åˆ°è°ƒä¼˜çš„æ€è·¯å’Œæ–¹å¼ 1. æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤å½“æˆ‘ä»¬é‡åˆ°æ•°æ®åº“è°ƒä¼˜é—®é¢˜çš„æ—¶å€™ï¼Œè¯¥å¦‚ä½•æ€è€ƒå‘¢ï¼Ÿè¿™é‡ŒæŠŠæ€è€ƒçš„æµç¨‹æ•´ç†æˆä¸‹é¢è¿™å¼ å›¾ã€‚ æ•´ä¸ªæµç¨‹åˆ’åˆ†æˆäº† è§‚å¯Ÿï¼ˆShow statusï¼‰ å’Œ è¡ŒåŠ¨ï¼ˆActionï¼‰ ä¸¤ä¸ªéƒ¨åˆ†ã€‚å­—æ¯ S çš„éƒ¨åˆ†ä»£è¡¨è§‚å¯Ÿï¼ˆä¼šä½¿ç”¨ç›¸åº”çš„åˆ†æå·¥å…·ï¼‰ï¼Œå­—æ¯ A ä»£è¡¨çš„">
<meta property="og:type" content="article">
<meta property="og:title" content="ä¸ƒã€æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨">
<meta property="og:url" content="https://blog.dalicoding.fun/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC07%E7%AB%A0_%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="Leoçš„åšå®¢">
<meta property="og:description" content="[TOC] åœ¨æ•°æ®åº“è°ƒä¼˜ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯å“åº”æ—¶é—´æ›´å¿«ï¼Œååé‡æ›´å¤§ã€‚åˆ©ç”¨å®è§‚çš„ç›‘æ§å·¥å…·å’Œå¾®è§‚çš„æ—¥å¿—åˆ†æå¯ä»¥å¸®æˆ‘ä»¬å¿«é€Ÿæ‰¾åˆ°è°ƒä¼˜çš„æ€è·¯å’Œæ–¹å¼ 1. æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤å½“æˆ‘ä»¬é‡åˆ°æ•°æ®åº“è°ƒä¼˜é—®é¢˜çš„æ—¶å€™ï¼Œè¯¥å¦‚ä½•æ€è€ƒå‘¢ï¼Ÿè¿™é‡ŒæŠŠæ€è€ƒçš„æµç¨‹æ•´ç†æˆä¸‹é¢è¿™å¼ å›¾ã€‚ æ•´ä¸ªæµç¨‹åˆ’åˆ†æˆäº† è§‚å¯Ÿï¼ˆShow statusï¼‰ å’Œ è¡ŒåŠ¨ï¼ˆActionï¼‰ ä¸¤ä¸ªéƒ¨åˆ†ã€‚å­—æ¯ S çš„éƒ¨åˆ†ä»£è¡¨è§‚å¯Ÿï¼ˆä¼šä½¿ç”¨ç›¸åº”çš„åˆ†æå·¥å…·ï¼‰ï¼Œå­—æ¯ A ä»£è¡¨çš„">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg">
<meta property="article:published_time" content="2024-04-05T06:24:06.000Z">
<meta property="article:modified_time" content="2024-04-05T07:08:17.559Z">
<meta property="article:author" content="Leo">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.dalicoding.fun/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC07%E7%AB%A0_%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"00PKU8B7R6","apiKey":"058cbcb1db57036717778c874da0ef87","indexName":"blog-leo","hits":{"per_page":10},"languages":{"input_placeholder":"æœç´¢æ–‡ç« ","hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œç”¨æ—¶ ${time} æ¯«ç§’"}},
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":50,"languages":{"author":"ä½œè€…: Leo","link":"é“¾æ¥: ","source":"æ¥æº: Leoçš„åšå®¢","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ä¸ƒã€æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-05 15:08:17'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/center-atom.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403221853832.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">37</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> æ¸…å•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Leoçš„åšå®¢"><img class="site-icon" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202404041655130.png"/><span class="site-name">Leoçš„åšå®¢</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> æ¸…å•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ä¸ƒã€æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-04-05T06:24:06.000Z" title="å‘è¡¨äº 2024-04-05 14:24:06">2024-04-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-04-05T07:08:17.559Z" title="æ›´æ–°äº 2024-04-05 15:08:17">2024-04-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">14.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>58åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ä¸ƒã€æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>[TOC]</p>
<p>åœ¨æ•°æ®åº“è°ƒä¼˜ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯<code>å“åº”æ—¶é—´æ›´å¿«ï¼Œååé‡æ›´å¤§</code>ã€‚åˆ©ç”¨å®è§‚çš„ç›‘æ§å·¥å…·å’Œå¾®è§‚çš„æ—¥å¿—åˆ†æå¯ä»¥å¸®æˆ‘ä»¬å¿«é€Ÿæ‰¾åˆ°è°ƒä¼˜çš„æ€è·¯å’Œæ–¹å¼</p>
<h1 id="1-æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤"><a href="#1-æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤" class="headerlink" title="1. æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤"></a>1. æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤</h1><p>å½“æˆ‘ä»¬é‡åˆ°æ•°æ®åº“è°ƒä¼˜é—®é¢˜çš„æ—¶å€™ï¼Œè¯¥å¦‚ä½•æ€è€ƒå‘¢ï¼Ÿè¿™é‡ŒæŠŠæ€è€ƒçš„æµç¨‹æ•´ç†æˆä¸‹é¢è¿™å¼ å›¾ã€‚</p>
<p>æ•´ä¸ªæµç¨‹åˆ’åˆ†æˆäº†<code> è§‚å¯Ÿï¼ˆShow statusï¼‰</code> å’Œ <code>è¡ŒåŠ¨ï¼ˆActionï¼‰</code> ä¸¤ä¸ªéƒ¨åˆ†ã€‚å­—æ¯ S çš„éƒ¨åˆ†ä»£è¡¨è§‚å¯Ÿï¼ˆä¼šä½¿ç”¨ç›¸åº”çš„åˆ†æå·¥å…·ï¼‰ï¼Œå­—æ¯ A ä»£è¡¨çš„éƒ¨åˆ†æ˜¯è¡ŒåŠ¨ï¼ˆå¯¹åº”åˆ†æå¯ä»¥é‡‡å–çš„è¡ŒåŠ¨ï¼‰</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150030458.png" alt="image-20220811114111312"></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150030400.png"><br><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150030169.png" alt="image-20220811114145753"></p>
<p>å¯ä»¥çœ‹åˆ°æ•°æ®åº“è°ƒä¼˜çš„æ­¥éª¤ä¸­è¶Šå¾€é‡‘å­—å¡”å°–èµ°ï¼Œå…¶æˆæœ¬è¶Šé«˜ï¼Œæ•ˆæœè¶Šå·®ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ•°æ®åº“è°ƒä¼˜çš„è¿‡ç¨‹ä¸­ï¼Œè¦é‡ç‚¹æŠŠæ¡é‡‘å­—å¡”åº•éƒ¨çš„ &#x3D;&#x3D;sql åŠç´¢å¼•è°ƒä¼˜ï¼Œæ•°æ®åº“è¡¨ç»“æ„è°ƒä¼˜ï¼Œç³»ç»Ÿé…ç½®å‚æ•°è°ƒä¼˜&#x3D;&#x3D;ç­‰è½¯ä»¶å±‚é¢çš„è°ƒä¼˜</p>
<h1 id="2-æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°"><a href="#2-æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°" class="headerlink" title="2. æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°"></a>2. æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°</h1><p>å¯ä»¥ä½¿ç”¨ <code>SHOW STATUS</code> è¯­å¥æŸ¥è¯¢ä¸€äº›æ•°æ®åº“æœåŠ¡å™¨çš„&#x3D;&#x3D;æ€§èƒ½å‚æ•°å’Œä½¿ç”¨é¢‘ç‡&#x3D;&#x3D;ã€‚</p>
<p>å…¶è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> [<span class="keyword">GLOBAL</span>][SESSION] STATUES <span class="keyword">LIKE</span> <span class="string">&#x27;å‚æ•°&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>ä¸€äº›å¸¸ç”¨çš„æ€§èƒ½å‚æ•°å¦‚ä¸‹ï¼š</p>
<p>â€¢<code>Connections</code>ï¼šè¿æ¥MySQLæœåŠ¡å™¨çš„æ¬¡æ•°ã€‚<br>â€¢<code>Uptime</code>ï¼šMySQLæœåŠ¡å™¨çš„ä¸Šçº¿æ—¶é—´ã€‚<br>â€¢<code>Slow_queries</code>ï¼šæ…¢æŸ¥è¯¢çš„æ¬¡æ•°ã€‚<br>â€¢<code>Innodb_rows_read</code>ï¼šSelectæŸ¥è¯¢è¿”å›çš„è¡Œæ•°<br>â€¢<code>Innodb_rows_inserted</code>ï¼šæ‰§è¡ŒINSERTæ“ä½œæ’å…¥çš„è¡Œæ•°<br>â€¢<code>Innodb_rows_updated</code>ï¼šæ‰§è¡ŒUPDATEæ“ä½œæ›´æ–°çš„è¡Œæ•°<br>â€¢<code>Innodb_rows_deleted</code>ï¼šæ‰§è¡ŒDELETEæ“ä½œåˆ é™¤çš„è¡Œæ•°<br>â€¢<code>Com_select</code>ï¼šæŸ¥è¯¢æ“ä½œçš„æ¬¡æ•°ã€‚<br>â€¢<code>Com_insert</code>ï¼šæ’å…¥æ“ä½œçš„æ¬¡æ•°ã€‚å¯¹äºæ‰¹é‡æ’å…¥çš„ INSERT æ“ä½œï¼Œåªç´¯åŠ ä¸€æ¬¡ã€‚<br>â€¢<code>Com_update</code>ï¼šæ›´æ–°æ“ä½œçš„æ¬¡æ•°ã€‚<br>â€¢<code>Com_delete</code>ï¼šåˆ é™¤æ“ä½œçš„æ¬¡æ•°ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<ul>
<li>è‹¥æŸ¥è¯¢MySQLæœåŠ¡å™¨çš„è¿æ¥æ¬¡æ•°ï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW STATUS LIKE &#x27;Connections&#x27;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Connections   | 34    |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li>è‹¥æŸ¥è¯¢æœåŠ¡å™¨å·¥ä½œæ—¶é—´ï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Uptime&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+--------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+--------+</span></span><br><span class="line"><span class="operator">|</span> Uptime        <span class="operator">|</span> <span class="number">332933</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+--------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ul>
<li>è‹¥æŸ¥è¯¢MySQLæœåŠ¡å™¨çš„æ…¢æŸ¥è¯¢æ¬¡æ•°ï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Slow_queries&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Slow_queries  <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>æ³¨ï¼šæ…¢æŸ¥è¯¢æ¬¡æ•°å‚æ•°å¯ä»¥ç»“åˆæ…¢æŸ¥è¯¢æ—¥å¿—æ‰¾å‡ºæ…¢æŸ¥è¯¢è¯­å¥ï¼Œç„¶åé’ˆå¯¹æ…¢æŸ¥è¯¢è¯­å¥è¿›è¡Œ <code>è¡¨ç»“æ„ä¼˜åŒ–</code> æˆ–è€…<code>æŸ¥è¯¢è¯­å¥ä¼˜åŒ–</code></p>
<ul>
<li>æŸ¥çœ‹å­˜å‚¨å¼•æ“å¢åˆ æ”¹æŸ¥çš„è¡Œæ•°ï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;innodb_rows_%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name        <span class="operator">|</span> <span class="keyword">Value</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Innodb_rows_deleted  <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_rows_inserted <span class="operator">|</span> <span class="number">1000902</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_rows_read     <span class="operator">|</span> <span class="number">37011100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_rows_updated  <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h1 id="3-ç»Ÿè®¡-SQL-çš„æŸ¥è¯¢æˆæœ¬ï¼šlast-query-cost"><a href="#3-ç»Ÿè®¡-SQL-çš„æŸ¥è¯¢æˆæœ¬ï¼šlast-query-cost" class="headerlink" title="3. ç»Ÿè®¡ SQL çš„æŸ¥è¯¢æˆæœ¬ï¼šlast_query_cost"></a>3. ç»Ÿè®¡ SQL çš„æŸ¥è¯¢æˆæœ¬ï¼šlast_query_cost</h1><p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150030464.png" alt="image-20220811122857202"></p>
<p>æˆ‘ä»¬ä¾ç„¶ä½¿ç”¨student_infoè¡¨ä¸ºä¾‹ï¼ˆå…·ä½“åº“è¡¨åˆ›å»ºä»¥åŠç”Ÿæˆæ•°æ®è¯­å¥è¯·å‚è€ƒä¸Šä¸€ç¯‡ç« ï¼‰</p>
<p>â‘ å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢ id&#x3D;900001 çš„è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨èšç°‡ç´¢å¼•ä¸Šè¿›è¡ŒæŸ¥æ‰¾ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM student_info WHERE id = 900001;</span><br><span class="line">+--------+------------+--------+-----------+----------+---------------------+</span><br><span class="line">| id     | student_id | name   | course_id | class_id | create_time         |</span><br><span class="line">+--------+------------+--------+-----------+----------+---------------------+</span><br><span class="line">| 900001 |     154633 | SYnwsA |     10019 |    10134 | 2022-08-08 22:33:02 |</span><br><span class="line">+--------+------------+--------+-----------+----------+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†çœ‹ä¸‹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æˆæœ¬ï¼Œå®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦æ£€ç´¢ä¸€ä¸ªé¡µå³å¯ã€‚<code>Value</code>è¡¨ç¤º I&#x2F;O åŠ è½½çš„æ•°æ®é¡µçš„é¡µæ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW STATUS LIKE &#x27;last_query_cost&#x27;;</span><br><span class="line">+-----------------+----------+</span><br><span class="line">| Variable_name   | Value    |</span><br><span class="line">+-----------------+----------+</span><br><span class="line">| Last_query_cost | 1.000000 |</span><br><span class="line">+-----------------+----------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>â‘¡æˆ‘ä»¬æ‰©å¤§ä¸‹æŸ¥è¯¢èŒƒå›´ï¼Œstudent_id&gt; 199900çš„å­¦ç”Ÿè®°å½•å‘¢ï¼Ÿè¿è¡Œæ—¶é—´ 0.01sï¼Œè¿™æ—¶æˆ‘ä»¬å¤§æ¦‚éœ€è¦è¿›è¡Œ 232ä¸ªé¡µçš„æŸ¥è¯¢</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student_info <span class="keyword">WHERE</span> student_id <span class="operator">&gt;</span> <span class="number">199900</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+--------+-----------+----------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id     <span class="operator">|</span> student_id <span class="operator">|</span> name   <span class="operator">|</span> course_id <span class="operator">|</span> class_id <span class="operator">|</span> create_time         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+--------+-----------+----------+---------------------+</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>...</span><br><span class="line"><span class="operator">|</span> <span class="number">523982</span> <span class="operator">|</span>     <span class="number">200000</span> <span class="operator">|</span> vcaUvw <span class="operator">|</span>     <span class="number">10010</span> <span class="operator">|</span>    <span class="number">10173</span> <span class="operator">|</span> <span class="number">2022</span><span class="number">-08</span><span class="number">-08</span> <span class="number">22</span>:<span class="number">32</span>:<span class="number">31</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+--------+-----------+----------+---------------------+</span></span><br><span class="line"><span class="number">516</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;last_query_cost&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name   <span class="operator">|</span> <span class="keyword">Value</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+------------+</span></span><br><span class="line"><span class="operator">|</span> Last_query_cost <span class="operator">|</span> <span class="number">232.459000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>â‘¢æˆ‘ä»¬å†æ¬¡æ‰©å¤§èŒƒå›´ï¼Œå‡è‹¥æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢ student_id &gt; 199000çš„å­¦ç”Ÿè®°å½•å‘¢ï¼Ÿè¿è¡Œæ—¶é—´ 0.02sï¼Œè¿™æ—¶æˆ‘ä»¬å¤§æ¦‚éœ€è¦è¿›è¡Œ 2279ä¸ªé¡µçš„æŸ¥è¯¢</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student_info <span class="keyword">WHERE</span> student_id <span class="operator">&gt;</span> <span class="number">199000</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>...</span><br><span class="line"><span class="number">5065</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;last_query_cost&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name   <span class="operator">|</span> <span class="keyword">Value</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> Last_query_cost <span class="operator">|</span> <span class="number">2279.509000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰å‘ç°ï¼Œä¸Šé¢çš„æŸ¥è¯¢é¡µçš„æ•°é‡æ˜¯åˆšæ‰çš„ 10å€ï¼Œä½†æ˜¯æŸ¥è¯¢çš„æ•ˆç‡å¹¶æ²¡æœ‰æ˜æ˜¾çš„å˜åŒ–ï¼Œå°±æ˜¯å› ä¸ºé‡‡ç”¨äº†é¡ºåºè¯»å–çš„æ–¹å¼å°†é¡µé¢ä¸€æ¬¡æ€§åŠ è½½åˆ°ç¼“å†²æ± ä¸­ï¼Œç„¶åå†è¿›è¡ŒæŸ¥æ‰¾ã€‚è™½ç„¶é¡µæ•°é‡ï¼ˆ<code>last_query_cost</code>ï¼‰å¢åŠ äº†ä¸å°‘ï¼Œä½†æ˜¯é€šè¿‡ç¼“å†²æ± çš„æœºåˆ¶ï¼Œå¹¶æ²¡æœ‰å¢åŠ å¤šå°‘æŸ¥è¯¢æ—¶é—´ã€‚</p>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong>æŸ¥è¯¢ <code>last_query_cost</code> å¯¹äºæ¯”è¾ƒå¼€é”€æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œç‰¹åˆ«æ˜¯æˆ‘ä»¬æœ‰å¥½å‡ ç§æŸ¥è¯¢æ–¹å¼å¯é€‰çš„æ—¶å€™</p>
<blockquote>
<p>ğŸˆ SQLæŸ¥è¯¢æ˜¯ä¸€ä¸ªåŠ¨æ€çš„è¿‡ç¨‹ï¼Œä»é¡µåŠ è½½çš„è§’åº¦ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¸¤ç‚¹ç»“è®ºï¼š</p>
<ol>
<li><strong>ä½ç½®å†³å®šæ•ˆç‡</strong>ï¼šå¦‚æœé¡µå°±åœ¨æ•°æ®åº“<code>ç¼“å†²æ± </code>ä¸­ï¼Œé‚£ä¹ˆæ•ˆç‡æ˜¯æœ€é«˜çš„ï¼Œå¦åˆ™è¿˜éœ€è¦ä»<code>å†…å­˜</code>æˆ–è€…<code>ç£ç›˜</code>ä¸­è¿›è¡Œè¯»å–ï¼Œå½“ç„¶é’ˆå¯¹å•ä¸ªé¡µçš„è¯»å–æ¥è¯´ï¼Œå¦‚æœé¡µå­˜åœ¨äºå†…å­˜ä¸­ï¼Œä¼šæ¯”åœ¨ç£ç›˜ä¸­è¯»å–æ•ˆç‡é«˜å¾ˆå¤šã€‚å³ &#x3D;&#x3D;æ•°æ®åº“ç¼“å†²æ± &gt;å†…å­˜&gt;ç£ç›˜&#x3D;&#x3D;</li>
<li><strong>æ‰¹é‡å†³å®šæ•ˆç‡</strong>ï¼šå¦‚æœæˆ‘ä»¬ä»ç£ç›˜ä¸­å•ä¸€é¡µè¿›è¡Œéšæœºè¯»ï¼Œé‚£ä¹ˆæ•ˆç‡æ˜¯å¾ˆä½çš„ï¼ˆå·®ä¸å¤š10msï¼‰ï¼Œè€Œé‡‡ç”¨é¡ºåºè¯»å–çš„æ–¹å¼ï¼Œæ‰¹é‡å¯¹é¡µè¿›è¡Œè¯»å–ï¼Œå¹³å‡ä¸€é¡µçš„è¯»å–æ•ˆç‡å°±ä¼šæå‡å¾ˆå¤šï¼Œç”šè‡³è¦å¿«äºå•ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­çš„éšæœºè¯»å–ã€‚å³&#x3D;&#x3D;é¡ºåºè¯»å–&gt;å¤§äºéšæœºè¯»å–&#x3D;&#x3D;</li>
</ol>
<p>æ‰€ä»¥è¯´ï¼Œé‡åˆ° I&#x2F;O å¹¶ä¸ç”¨æ‹…å¿ƒï¼Œæ–¹æ³•æ‰¾å¯¹äº†ï¼Œæ•ˆç‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚æˆ‘ä»¬é¦–å…ˆè¦è€ƒè™‘æ•°æ®å­˜æ”¾çš„ä½ç½®ï¼Œå¦‚æœæ˜¯ç»å¸¸ä½¿ç”¨çš„æ•°æ®å°±è¦å°½é‡æ”¾åˆ°ç¼“å†²æ± ä¸­ï¼Œå…¶æ¬¡æˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨ç£ç›˜çš„ååèƒ½åŠ›ï¼Œä¸€æ¬¡æ€§æ‰¹é‡è¯»å–æ•°æ®ï¼Œè¿™æ ·å•ä¸ªé¡µçš„è¯»å–æ•ˆç‡ä¹Ÿå°±å¾—åˆ°äº†æå‡ã€‚</p>
<p>æ³¨ï¼šç¼“å†²æ± å’ŒæŸ¥è¯¢ç¼“å­˜å¹¶ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿</p>
</blockquote>
<h1 id="4-å®šä½æ‰§è¡Œæ…¢çš„-SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#4-å®šä½æ‰§è¡Œæ…¢çš„-SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="4. å®šä½æ‰§è¡Œæ…¢çš„ SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—"></a>4. å®šä½æ‰§è¡Œæ…¢çš„ SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—</h1><p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150030839.png" alt="image-20220811155538530"></p>
<h2 id="4-1-å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#4-1-å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="4.1 å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—"></a>4.1 å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</h2><p><strong><font color=blue>1. å¼€å¯ slow_query_log</font></strong></p>
<p>æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œä»¥åŠæ—¥å¿—çš„ä½ç½®</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%slow_query_log%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name       <span class="operator">|</span> <span class="keyword">Value</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> slow_query_log      <span class="operator">|</span> OFF                               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> slow_query_log_file <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>hadoop102<span class="operator">-</span>slow.log <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.03</span> sec)</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹æ…¢æŸ¥è¯¢æ—¥å¿—çŠ¶æ€ä¸ºå¼€å¯ï¼Œæ³¨æ„è¿™é‡Œè¦åŠ  <code>global</code>ï¼Œå› ä¸ºå®ƒæ˜¯å…¨å±€ç³»ç»Ÿå˜é‡ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set global slow_query_log=&#x27;ON&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br></pre></td></tr></table></figure>

<p>å†æŸ¥çœ‹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%slow_query_log%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name       <span class="operator">|</span> <span class="keyword">Value</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> slow_query_log      <span class="operator">|</span> <span class="keyword">ON</span>                                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> slow_query_log_file <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>hadoop102<span class="operator">-</span>slow.log <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>2. ä¿®æ”¹long_query_timeé˜ˆå€¼</font></strong></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹æ…¢æŸ¥è¯¢çš„æ—¶é—´é˜ˆå€¼è®¾ç½®ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;%long_query_time%&#x27;;</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">| Variable_name   | Value     |</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">| long_query_time | 10.000000 |</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¦‚æœæˆ‘ä»¬æƒ³æŠŠæ—¶é—´ç¼©çŸ­ï¼Œæ¯”å¦‚è®¾ç½®æˆ1ç§’ï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># æµ‹è¯•å‘ç°ï¼šè®¾ç½®globalçš„æ–¹å¼å¯¹å½“å‰sessionçš„long_query_timeå¤±æ•ˆã€‚å¯¹æ–°è¿æ¥çš„å®¢æˆ·ç«¯æœ‰æ•ˆï¼Œæ‰€ä»¥å¯ä»¥ä¸€å¹¶æ‰§è¡Œä¸‹åˆ—è¯­å¥</span><br><span class="line">mysql&gt; set global long_query_time = 1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set long_query_time = 1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>å†æŸ¥çœ‹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">global</span> variables <span class="keyword">like</span> <span class="string">&#x27;%long_query_time%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name   <span class="operator">|</span> <span class="keyword">Value</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+----------+</span></span><br><span class="line"><span class="operator">|</span> long_query_time <span class="operator">|</span> <span class="number">1.000000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150030579.png" alt="image-20220811165316520"></p>
<h2 id="4-2-æ¡ˆä¾‹æ¼”ç¤º"><a href="#4-2-æ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="4.2 æ¡ˆä¾‹æ¼”ç¤º"></a>4.2 æ¡ˆä¾‹æ¼”ç¤º</h2><p><strong><font color=blue>æ­¥éª¤ä¸€ã€å»ºè¡¨</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `student` (</span><br><span class="line">    `id` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    `stuno` <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">    `name` <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `age` <span class="type">INT</span>(<span class="number">3</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `classId` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>æ­¥éª¤äºŒã€ è®¾ç½®å‚æ•° log_bin_trust_function_creators</font></strong></p>
<p>åˆ›å»ºå‡½æ•°ï¼Œå‡å¦‚æŠ¥é”™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This function has none of DETERMINISTIC......</span><br></pre></td></tr></table></figure>

<p>å‘½ä»¤å¼€å¯ï¼šå…è®¸åˆ›å»ºå‡½æ•°è®¾ç½®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_bin_trust_function_creators<span class="operator">=</span><span class="number">1</span>;   # ä¸åŠ <span class="keyword">global</span>åªæ˜¯å½“å‰çª—å£æœ‰æ•ˆ</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>æ­¥éª¤ä¸‰ã€åˆ›å»ºå‡½æ•°</font></strong></p>
<p>éšæœºäº§ç”Ÿå­—ç¬¦ä¸²ï¼š(åŒä¸Šä¸€ç« )</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_string(n <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">255</span>) #è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> chars_str <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span></span><br><span class="line"><span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> return_str <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">WHILE i <span class="operator">&lt;</span> n DO</span><br><span class="line">   <span class="keyword">SET</span> return_str <span class="operator">=</span>CONCAT(return_str,<span class="built_in">SUBSTRING</span>(chars_str,<span class="built_in">FLOOR</span>(<span class="number">1</span><span class="operator">+</span>RAND()<span class="operator">*</span><span class="number">52</span>),<span class="number">1</span>));</span><br><span class="line">   <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">END</span> WHILE;</span><br><span class="line">  <span class="keyword">RETURN</span> return_str;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line">#æµ‹è¯•</span><br><span class="line"><span class="keyword">SELECT</span> rand_string(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p>äº§ç”Ÿéšæœºæ•°å€¼ï¼šï¼ˆåŒä¸Šä¸€ç« ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_num (from_num <span class="type">INT</span> ,to_num <span class="type">INT</span>) <span class="keyword">RETURNS</span> <span class="type">INT</span>(<span class="number">11</span>)</span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; </span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> <span class="built_in">FLOOR</span>(from_num <span class="operator">+</span>RAND()<span class="operator">*</span>(to_num <span class="operator">-</span> from_num<span class="operator">+</span><span class="number">1</span>))  ;</span><br><span class="line"><span class="keyword">RETURN</span> i; </span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line">#æµ‹è¯•ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> rand_num(<span class="number">10</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>æ­¥éª¤å››ã€åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_stu1(  <span class="keyword">START</span> <span class="type">INT</span> , max_num <span class="type">INT</span> )</span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; </span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;   #è®¾ç½®æ‰‹åŠ¨æäº¤äº‹åŠ¡</span><br><span class="line">REPEAT  #å¾ªç¯</span><br><span class="line"><span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;  #èµ‹å€¼</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student (stuno, NAME ,age ,classId ) <span class="keyword">VALUES</span></span><br><span class="line">((<span class="keyword">START</span><span class="operator">+</span>i),rand_string(<span class="number">6</span>),rand_num(<span class="number">10</span>,<span class="number">100</span>),rand_num(<span class="number">10</span>,<span class="number">1000</span>)); </span><br><span class="line">UNTIL i <span class="operator">=</span> max_num </span><br><span class="line"><span class="keyword">END</span> REPEAT; </span><br><span class="line"><span class="keyword">COMMIT</span>;  #æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>æ­¥éª¤äº”ã€è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#è°ƒç”¨åˆšåˆšå†™å¥½çš„å‡½æ•°, <span class="number">4000000</span>æ¡è®°å½•,ä»<span class="number">100001</span>å·å¼€å§‹</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CALL</span> insert_stu1(<span class="number">100001</span>,<span class="number">4000000</span>);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">10</span> min <span class="number">47.03</span> sec)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œè¿™ä¸ªæ—¶é—´ä¼šæ¯”è¾ƒé•¿ï¼Œè¯·è€å¿ƒç­‰å¾…å‡ åˆ†é’Ÿå“Ÿã€‚ç»“æŸåå¯ä»¥æŸ¥è¯¢ä¸‹æ˜¯ä¸æ˜¯æ’å…¥æˆåŠŸäº†ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> student;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4000000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.82</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="4-3-æµ‹è¯•åŠè¯´æ˜"><a href="#4-3-æµ‹è¯•åŠè¯´æ˜" class="headerlink" title="4.3 æµ‹è¯•åŠè¯´æ˜"></a>4.3 æµ‹è¯•åŠè¯´æ˜</h2><p><strong><font color=blue>1. æ‰§è¡Œä¸€ä¸‹ä¸‹é¢çš„æŸ¥è¯¢æ“ä½œï¼Œè¿›è¡Œæ…¢æŸ¥è¯¢è¯­å¥çš„æµ‹è¯•</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># æ³¨æ„ï¼šæ­¤æ—¶long_query_timeå·²ç»è®¾ç½®ä¸º<span class="number">1</span>äº†å“¦<span class="operator">~</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> stuno <span class="operator">=</span> <span class="number">3455655</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> id      <span class="operator">|</span> stuno   <span class="operator">|</span> name   <span class="operator">|</span> age  <span class="operator">|</span> classId <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3355654</span> <span class="operator">|</span> <span class="number">3455655</span> <span class="operator">|</span> ZfCwDz <span class="operator">|</span>   <span class="number">76</span> <span class="operator">|</span>     <span class="number">228</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">1.03</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;ZfCwDz&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span> id      <span class="operator">|</span> stuno   <span class="operator">|</span> name   <span class="operator">|</span> age  <span class="operator">|</span> classId <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">32843</span> <span class="operator">|</span>  <span class="number">132844</span> <span class="operator">|</span> zfcWDZ <span class="operator">|</span>   <span class="number">32</span> <span class="operator">|</span>     <span class="number">304</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">889126</span> <span class="operator">|</span>  <span class="number">989127</span> <span class="operator">|</span> ZfCwDz <span class="operator">|</span>   <span class="number">77</span> <span class="operator">|</span>     <span class="number">249</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2015535</span> <span class="operator">|</span> <span class="number">2115536</span> <span class="operator">|</span> zfcWDZ <span class="operator">|</span>   <span class="number">36</span> <span class="operator">|</span>     <span class="number">459</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3176527</span> <span class="operator">|</span> <span class="number">3276528</span> <span class="operator">|</span> ZFcwdZ <span class="operator">|</span>   <span class="number">81</span> <span class="operator">|</span>     <span class="number">941</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3355654</span> <span class="operator">|</span> <span class="number">3455655</span> <span class="operator">|</span> ZfCwDz <span class="operator">|</span>   <span class="number">76</span> <span class="operator">|</span>     <span class="number">228</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------+--------+------+---------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">1.09</span> sec)</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼ŒæŸ¥è¯¢å­¦ç”Ÿç¼–å·åˆå’Œå§“åèŠ±è´¹æ—¶é—´ éƒ½åœ¨1sä»¥ä¸Šã€‚å·²ç»è¾¾åˆ°äº†ç§’çš„æ•°é‡çº§ï¼Œè¯´æ˜ç›®å‰æŸ¥è¯¢æ•ˆç‡æ˜¯éå¸¸ä½çš„ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†æä¸€ä¸‹åŸå› </p>
<p><strong><font color=blue>2. å…ˆæŸ¥çœ‹ä¸‹æ…¢æŸ¥è¯¢çš„è®°å½•</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;slow_queries&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Slow_queries  <span class="operator">|</span> <span class="number">2</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ¯<strong>è¡¥å……è¯´æ˜ï¼š</strong></p>
<p>åœ¨Mysqlä¸­ï¼Œé™¤äº†ä¸Šè¿°å˜é‡ï¼Œæ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿—çš„è¿˜æœ‰å¦å¤–ä¸€ä¸ªå˜é‡ <code>min_examined_row_limit</code> ã€‚è¿™ä¸ªå˜é‡çš„æ„æ€æ˜¯ï¼ŒæŸ¥è¯¢<code>æ‰«æè¿‡çš„æœ€å°‘è®°å½•æ•°</code>ã€‚è¿™ä¸ªå˜é‡å’ŒæŸ¥è¯¢æ‰§è¡Œæ—¶é—´ï¼Œå…±åŒç»„æˆäº†åˆ¤åˆ«ä¸€ä¸ªæŸ¥è¯¢æ˜¯å¦æ…¢æŸ¥è¯¢çš„æ¡ä»¶ã€‚å¦‚æœæŸ¥è¯¢æ‰«æè¿‡çš„è®°å½•æ•°å¤§äºç­‰äºè¿™ä¸ªå˜é‡çš„å€¼ï¼Œå¹¶ä¸”æŸ¥è¯¢æ‰§è¡Œæ—¶é—´è¶…è¿‡ <code>long_query_time</code> çš„å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæŸ¥è¯¢å°±è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚åä¹‹ï¼Œåˆ™ä¸è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚å¦å¤–ï¼Œ<code>min_examined_row_limit</code> é»˜è®¤æ˜¯ 0ï¼Œæˆ‘ä»¬ä¹Ÿä¸€èˆ¬ä¸ä¼šå»ä¿®æ”¹å®ƒã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">like</span> <span class="string">&#x27;min%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name          <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> min_examined_row_limit <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure>

<p>å½“è¿™ä¸ªå€¼ä¸ºé»˜è®¤å€¼0æ—¶ï¼Œä¸ long_query_time&#x3D;10åˆåœ¨ä¸€èµ·ï¼Œè¡¨ç¤ºåªè¦æŸ¥è¯¢çš„æ‰§è¡Œæ—¶é—´è¶…è¿‡10ç§’é’Ÿï¼Œå“ªæ€•ä¸€ä¸ªè®°å½•ä¹Ÿæ²¡æœ‰æ‰«æè¿‡ï¼Œéƒ½è¦è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚ä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ï¼Œé€šè¿‡ä¿®æ”¹â€my.iniâ€æ–‡ä»¶ï¼Œæ¥ä¿®æ”¹æŸ¥è¯¢æ—¶é•¿ï¼Œæˆ–è€…é€šè¿‡SETæŒ‡ä»¤ï¼Œç”¨SQLè¯­å¥ä¿®æ”¹<code>min_examined_row_limit</code> çš„å€¼ã€‚</p>
</blockquote>
<h2 id="4-4-æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šMysqldumpslow"><a href="#4-4-æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šMysqldumpslow" class="headerlink" title="4.4 æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šMysqldumpslow"></a>4.4 æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šMysqldumpslow</h2><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦‚æœè¦æ‰‹å·¥åˆ†ææ—¥å¿—ï¼ŒæŸ¥æ‰¾ã€åˆ†æ SQLï¼Œæ˜¾ç„¶æ˜¯ä¸ªä½“åŠ›æ´»ï¼ŒMySQL æä¾›äº†æ—¥å¿—åˆ†æå·¥å…· &#x3D;&#x3D;mysqldumpslow&#x3D;&#x3D;ã€‚</p>
<blockquote>
<p>ğŸ“‘ æ³¨æ„:<br>1.è¯¥å·¥å…·å¹¶ä¸æ˜¯ MySQL å†…ç½®çš„ï¼Œä¸è¦åœ¨ MySQL ä¸‹æ‰§è¡Œï¼Œå¯ä»¥ç›´æ¥åœ¨æ ¹ç›®å½•æˆ–è€…å…¶ä»–ä½ç½®æ‰§è¡Œ<br>2.è¯¥å·¥å…·åªæœ‰ Linux ä¸‹æ‰æ˜¯å¼€ç®±å¯ç”¨çš„ï¼Œå®é™…ä¸Šç”Ÿäº§ä¸­mysqlæ•°æ®åº“ä¸€èˆ¬ä¹Ÿæ˜¯éƒ¨ç½²åœ¨linuxç¯å¢ƒä¸­çš„ã€‚å¦‚æœæ‚¨æ˜¯windowsç¯å¢ƒä¸‹ï¼Œå¯ä»¥å‚è€ƒåšå®¢<a target="_blank" rel="noopener" href="https://www.cnblogs.com/-mrl/p/15770811.html%E3%80%82">https://www.cnblogs.com/-mrl/p/15770811.htmlã€‚</a></p>
</blockquote>
<p>é€šè¿‡ <code>mysqldumpslow </code>å¯ä»¥æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—å¸®åŠ©</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow --help</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150030616.png" alt="image-20220812155219680"></p>
<p>mysqldumpslow å‘½ä»¤çš„å…·ä½“å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>-a: ä¸å°†æ•°å­—æŠ½è±¡æˆNï¼Œå­—ç¬¦ä¸²æŠ½è±¡æˆS</li>
<li><strong><font color=red>-s: æ˜¯è¡¨ç¤ºæŒ‰ç…§ä½•ç§æ–¹å¼æ’åºï¼š</font></strong><ul>
<li>c: è®¿é—®æ¬¡æ•°</li>
<li>l: é”å®šæ—¶é—´</li>
<li>r: è¿”å›è®°å½•</li>
<li><font color=blue>t: æŸ¥è¯¢æ—¶é—´</font></li>
<li>al:å¹³å‡é”å®šæ—¶é—´</li>
<li>ar:å¹³å‡è¿”å›è®°å½•æ•°</li>
<li>at:å¹³å‡æŸ¥è¯¢æ—¶é—´ ï¼ˆé»˜è®¤æ–¹å¼ï¼‰</li>
<li>ac:å¹³å‡æŸ¥è¯¢æ¬¡æ•°</li>
</ul>
</li>
<li><strong><font color=red>-t: å³ä¸ºè¿”å›å‰é¢å¤šå°‘æ¡çš„æ•°æ®ï¼›</font></strong></li>
<li><strong><font color=red>-g: åè¾¹æ­é…ä¸€ä¸ªæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿçš„ï¼›</font></strong></li>
</ul>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—çš„ä½ç½®</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150030118.png" alt="image-20220812160221292"></p>
<p>ä¸¾ä¾‹ï¼šæˆ‘ä»¬æƒ³è¦æŒ‰ç…§æŸ¥è¯¢æ—¶é—´æ’åºï¼ŒæŸ¥çœ‹å‰äº”æ¡ SQL è¯­å¥ï¼Œè¿™æ ·å†™å³å¯ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@hadoop102</span> mysql]# mysqldumpslow <span class="operator">-</span>s t <span class="operator">-</span>t <span class="number">5</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>hadoop102<span class="operator">-</span>slow.log </span><br><span class="line"></span><br><span class="line">Reading mysql slow query log <span class="keyword">from</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>hadoop102<span class="operator">-</span>slow.log</span><br><span class="line">Count: <span class="number">1</span>  <span class="type">Time</span><span class="operator">=</span><span class="number">283.29</span>s (<span class="number">283</span>s)  Lock<span class="operator">=</span><span class="number">0.00</span>s (<span class="number">0</span>s)  <span class="keyword">Rows</span><span class="operator">=</span><span class="number">0.0</span> (<span class="number">0</span>), root[root]<span class="variable">@hadoop102</span></span><br><span class="line">  <span class="keyword">CALL</span> insert_stu1(N,N)</span><br><span class="line"></span><br><span class="line">Count: <span class="number">1</span>  <span class="type">Time</span><span class="operator">=</span><span class="number">1.09</span>s (<span class="number">1</span>s)  Lock<span class="operator">=</span><span class="number">0.00</span>s (<span class="number">0</span>s)  <span class="keyword">Rows</span><span class="operator">=</span><span class="number">5.0</span> (<span class="number">5</span>), root[root]<span class="variable">@localhost</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;S&#x27;</span></span><br><span class="line"></span><br><span class="line">Count: <span class="number">1</span>  <span class="type">Time</span><span class="operator">=</span><span class="number">1.03</span>s (<span class="number">1</span>s)  Lock<span class="operator">=</span><span class="number">0.00</span>s (<span class="number">0</span>s)  <span class="keyword">Rows</span><span class="operator">=</span><span class="number">1.0</span> (<span class="number">1</span>), root[root]<span class="variable">@localhost</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> stuno <span class="operator">=</span> N</span><br><span class="line"></span><br><span class="line">Died <span class="keyword">at</span> <span class="operator">/</span>usr<span class="operator">/</span>bin<span class="operator">/</span>mysqldumpslow line <span class="number">162</span>, <span class="operator">&lt;&gt;</span> chunk <span class="number">3.</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ä¸Šé¢ sql ä¸­å…·ä½“çš„æ•°å€¼ç±»éƒ½è¢«Nä»£æ›¿ï¼Œå­—ç¬¦ä¸²éƒ½è¢«ä½¿ç”¨ S ä»£æ›¿ï¼Œå¦‚æœæƒ³è¦æ˜¾ç¤ºçœŸå®çš„æ•°æ®ï¼Œå¯ä»¥åŠ ä¸Šå‚æ•° <code>-a</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@hadoop102</span> mysql]# mysqldumpslow <span class="operator">-</span>a <span class="operator">-</span>s t <span class="operator">-</span>t <span class="number">5</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>hadoop102<span class="operator">-</span>slow.log </span><br><span class="line"></span><br><span class="line">Reading mysql slow query log <span class="keyword">from</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>hadoop102<span class="operator">-</span>slow.log</span><br><span class="line">Count: <span class="number">1</span>  <span class="type">Time</span><span class="operator">=</span><span class="number">283.29</span>s (<span class="number">283</span>s)  Lock<span class="operator">=</span><span class="number">0.00</span>s (<span class="number">0</span>s)  <span class="keyword">Rows</span><span class="operator">=</span><span class="number">0.0</span> (<span class="number">0</span>), root[root]<span class="variable">@hadoop102</span></span><br><span class="line">  <span class="keyword">CALL</span> insert_stu1(<span class="number">100001</span>,<span class="number">4000000</span>)</span><br><span class="line"></span><br><span class="line">Count: <span class="number">1</span>  <span class="type">Time</span><span class="operator">=</span><span class="number">1.09</span>s (<span class="number">1</span>s)  Lock<span class="operator">=</span><span class="number">0.00</span>s (<span class="number">0</span>s)  <span class="keyword">Rows</span><span class="operator">=</span><span class="number">5.0</span> (<span class="number">5</span>), root[root]<span class="variable">@localhost</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;ZfCwDz&#x27;</span></span><br><span class="line"></span><br><span class="line">Count: <span class="number">1</span>  <span class="type">Time</span><span class="operator">=</span><span class="number">1.03</span>s (<span class="number">1</span>s)  Lock<span class="operator">=</span><span class="number">0.00</span>s (<span class="number">0</span>s)  <span class="keyword">Rows</span><span class="operator">=</span><span class="number">1.0</span> (<span class="number">1</span>), root[root]<span class="variable">@localhost</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> stuno <span class="operator">=</span> <span class="number">3455655</span></span><br><span class="line"></span><br><span class="line">Died <span class="keyword">at</span> <span class="operator">/</span>usr<span class="operator">/</span>bin<span class="operator">/</span>mysqldumpslow line <span class="number">162</span>, <span class="operator">&lt;&gt;</span> chunk <span class="number">3.</span></span><br></pre></td></tr></table></figure>

<p>æœ€åç½—åˆ—ä¸‹å·¥ä½œä¸­å¸¸ç”¨çš„ä¸€äº›æŸ¥è¯¢ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¾—åˆ°è¿”å›è®°å½•é›†æœ€å¤šçš„10ä¸ªSQL</span></span><br><span class="line">mysqldumpslow -s r -t 10 /var/lib/mysql/atguigu-slow.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¾—åˆ°è®¿é—®æ¬¡æ•°æœ€å¤šçš„10ä¸ªSQL</span></span><br><span class="line">mysqldumpslow -s c -t 10 /var/lib/mysql/atguigu-slow.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¾—åˆ°æŒ‰ç…§æ—¶é—´æ’åºçš„å‰10æ¡é‡Œé¢å«æœ‰å·¦è¿æ¥çš„æŸ¥è¯¢è¯­å¥</span></span><br><span class="line">mysqldumpslow -s t -t 10 -g &quot;left join&quot; /var/lib/mysql/atguigu-slow.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¦å¤–å»ºè®®åœ¨ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶ç»“åˆ | å’Œmore ä½¿ç”¨ ï¼Œå¦åˆ™æœ‰å¯èƒ½å‡ºç°çˆ†å±æƒ…å†µ</span></span><br><span class="line">mysqldumpslow -s r -t 10 /var/lib/mysql/atguigu-slow.log | more</span><br></pre></td></tr></table></figure>

<h2 id="4-5-å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#4-5-å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="4.5 å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—"></a>4.5 å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—</h2><p>MySQL æœåŠ¡å™¨åœæ­¢æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<p><strong><font color=blue>æ–¹å¼ä¸€ï¼šæ°¸ä¹…æ€§æ–¹å¼</font></strong></p>
<p>ä¿®æ”¹my.cnfæˆ–my.iniæ–‡ä»¶ï¼ŒæŠŠã€mysqldã€‘ç»„ä¸‹çš„slow_query_logå€¼è®¾ç½®ä¸ºOFFï¼Œä¿®æ”¹ä¿å­˜åï¼Œå†é‡å¯MySQLæœåŠ¡ï¼Œå³å¯ç”Ÿæ•ˆã€‚</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">slow_query_log</span>=<span class="string">OFF</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼ŒæŠŠslow_query_logä¸€é¡¹æ³¨é‡Šæ‰ æˆ– åˆ é™¤</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment">#slow_query_log =OFF</span></span><br></pre></td></tr></table></figure>

<p>é‡å¯MySQLæœåŠ¡ï¼Œæ‰§è¡Œå¦‚ä¸‹è¯­å¥æŸ¥è¯¢æ…¢æ—¥å¿—åŠŸèƒ½ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%slow%&#x27;</span>;  #æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—æ‰€åœ¨ç›®å½•</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%long_query_time%&#x27;</span>;  #æŸ¥è¯¢è¶…æ—¶æ—¶é•¿</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒMySQLç³»ç»Ÿä¸­çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å…³é—­çš„ã€‚</p>
<p><strong><font color=blue>æ–¹å¼äºŒï¼šä¸´æ—¶æ€§æ–¹å¼</font></strong></p>
<p>ä½¿ç”¨ SET è¯­å¥æ¥è®¾ç½®ã€‚<br>ï¼ˆ1ï¼‰åœæ­¢ MySQL æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ï¼Œå…·ä½“ SQL è¯­å¥å¦‚ä¸‹ã€‚</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">SET</span> <span class="string">GLOBAL slow_query_log=off;</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰<font color=red>é‡å¯MySQLæœåŠ¡</font>ï¼Œä½¿ç”¨ SHOW è¯­å¥æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ä¿¡æ¯ï¼Œå…·ä½“æ¼”ç¤ºå¦‚ä¸‹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@hadoop102</span> mysql]# systemctl restart mysqld;</span><br><span class="line">[root<span class="variable">@hadoop102</span> mysql]# mysql <span class="operator">-</span>hlocalhost <span class="operator">-</span>P3306 <span class="operator">-</span>uroot <span class="operator">-</span>p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome <span class="keyword">to</span> the MySQL monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> \g.</span><br><span class="line">Your MySQL connection id <span class="keyword">is</span> <span class="number">10</span></span><br><span class="line">Server version: <span class="number">8.0</span><span class="number">.25</span> MySQL Community Server <span class="operator">-</span> GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) <span class="number">2000</span>, <span class="number">2021</span>, Oracle <span class="keyword">and</span><span class="operator">/</span><span class="keyword">or</span> its affiliates.</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%slow%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name             <span class="operator">|</span> <span class="keyword">Value</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> log_slow_admin_statements <span class="operator">|</span> OFF                               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_slow_extra            <span class="operator">|</span> OFF                               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_slow_slave_statements <span class="operator">|</span> OFF                               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> slow_launch_time          <span class="operator">|</span> <span class="number">2</span>                                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> slow_query_log            <span class="operator">|</span> OFF  #æ…¢æŸ¥è¯¢æ—¥å¿—å·²å…³é—­               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> slow_query_log_file       <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>hadoop102<span class="operator">-</span>slow.log <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------+-----------------------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%long_query_time%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name   <span class="operator">|</span> <span class="keyword">Value</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> long_query_time <span class="operator">|</span> <span class="number">10.000000</span> <span class="operator">|</span> #å·²æ¢å¤è‡³é»˜è®¤çš„ <span class="number">10</span>s</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="4-6-åˆ é™¤ä¸æ¢å¤æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#4-6-åˆ é™¤ä¸æ¢å¤æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="4.6 åˆ é™¤ä¸æ¢å¤æ…¢æŸ¥è¯¢æ—¥å¿—"></a>4.6 åˆ é™¤ä¸æ¢å¤æ…¢æŸ¥è¯¢æ—¥å¿—</h2><p>ä½¿ç”¨SHOWè¯­å¥æ˜¾ç¤ºæ…¢æŸ¥è¯¢æ—¥å¿—ä¿¡æ¯ï¼Œå…·ä½“SQLè¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%slow_query_log%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name       <span class="operator">|</span> <span class="keyword">Value</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> slow_query_log      <span class="operator">|</span> <span class="keyword">ON</span>                                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> slow_query_log_file <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>hadoop102<span class="operator">-</span>slow.log <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>è°ƒä¼˜ç»“æŸå¯ä»¥åŠæ—¶åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—èŠ‚çœç£ç›˜ç©ºé—´å“Ÿï¼Œå½“ç„¶æ‰‹å·¥åˆ é™¤ä¹Ÿæ˜¯å¯ä»¥çš„</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150030512.png" alt="image-20220812163728793"></p>
<p>å¦‚æœè¯¯åˆ äº†ï¼Œè€Œä¸”è¿˜æ²¡æœ‰äº†å¤‡ä»½ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥é‡æ–°æ¢å¤ç”Ÿæˆå“Ÿï¼Œæ‰§è¡Œå®Œæ¯•åä¼šåœ¨æ•°æ®ç›®å½•ä¸‹é‡æ–°ç”ŸæˆæŸ¥è¯¢æ—¥å¿—æ–‡ä»¶</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#å…ˆè¦æ‰“å¼€æ…¢æŸ¥è¯¢æ—¥å¿—</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log<span class="operator">=</span><span class="keyword">ON</span>;</span><br><span class="line">#æ¢å¤æ…¢æŸ¥è¯¢æ—¥å¿—</span><br><span class="line">mysqladmin <span class="operator">-</span>uroot <span class="operator">-</span>p flush<span class="operator">-</span>logs slow</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æç¤º</p>
<p>æ…¢æŸ¥è¯¢æ—¥å¿—éƒ½æ˜¯ä½¿ç”¨<code>mysqladmin -uroot -p flush-logs slow</code> å‘½ä»¤æ¥åˆ é™¤é‡å»ºçš„ã€‚ä½¿ç”¨æ—¶ä¸€å®šè¦æ³¨æ„ï¼Œä¸€æ—¦æ‰§è¡Œäº†è¿™ä¸ªå‘½ä»¤ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—éƒ½åªå­˜åœ¨äºæ–°çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¦‚æœéœ€è¦æ—§çš„æŸ¥è¯¢æ—¥å¿—ï¼Œå°±å¿…é¡»äº‹å…ˆå¤‡ä»½ã€‚</p>
</blockquote>
<h1 id="5-æŸ¥çœ‹-SQL-æ‰§è¡Œæˆæœ¬ï¼šSHOW-PROFILE"><a href="#5-æŸ¥çœ‹-SQL-æ‰§è¡Œæˆæœ¬ï¼šSHOW-PROFILE" class="headerlink" title="5. æŸ¥çœ‹ SQL æ‰§è¡Œæˆæœ¬ï¼šSHOW PROFILE"></a>5. æŸ¥çœ‹ SQL æ‰§è¡Œæˆæœ¬ï¼šSHOW PROFILE</h1><p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150030478.png" alt="image-20220812175708623"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;profiling&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> profiling     <span class="operator">|</span> OFF   <span class="operator">|</span> #å½“å‰æ˜¯å…³é—­çŠ¶æ€</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> profiling <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;#å¼€å¯</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œç›¸å…³çš„æŸ¥è¯¢è¯­å¥ã€‚æ¥ç€çœ‹ä¸‹å½“å‰ä¼šè¯ä¸‹æœ‰å“ªäº›profiles</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> stuno <span class="operator">=</span> <span class="number">3455655</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>...</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;ZfCwDz&#x27;</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>...</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> profiles;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------------+---------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Query_ID <span class="operator">|</span> Duration   <span class="operator">|</span> Query                                       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------------+---------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span> <span class="number">0.00133475</span> <span class="operator">|</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;profiling&#x27;</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span> <span class="number">0.00021050</span> <span class="operator">|</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> stuno <span class="operator">=</span> <span class="number">3455655</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span> <span class="number">0.00053600</span> <span class="operator">|</span> <span class="keyword">SELECT</span> DATABASE()                           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">4</span> <span class="operator">|</span> <span class="number">0.01693325</span> <span class="operator">|</span> <span class="keyword">show</span> databases                              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">5</span> <span class="operator">|</span> <span class="number">0.00375125</span> <span class="operator">|</span> <span class="keyword">show</span> tables                                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">6</span> <span class="operator">|</span> <span class="number">1.75597875</span> <span class="operator">|</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> stuno <span class="operator">=</span> <span class="number">3455655</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">7</span> <span class="operator">|</span> <span class="number">1.11115150</span> <span class="operator">|</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;ZfCwDz&#x27;</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------------+---------------------------------------------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>ä½ èƒ½çœ‹åˆ°å½“å‰ä¼šè¯ä¸€å…±æœ‰7ä¸ªæŸ¥è¯¢ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡æŸ¥è¯¢çš„å¼€é”€ï¼Œå¯ä»¥ä½¿ç”¨</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> profile;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150030438.png" alt="image-20220812180852535"></p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æŸ¥çœ‹æŒ‡å®šçš„Query IDçš„å¼€é”€ï¼Œåªéœ€è¦åé¢è·Ÿä¸Š <code>for num</code>ã€‚ä¹Ÿå¯ä»¥æŸ¥çœ‹ä¸åŒéƒ¨åˆ†çš„å¼€é”€ï¼Œæ¯”å¦‚CPUã€block.ioç­‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show profile cpu,block io for query 7;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031520.png" alt="image-20220812181159314"></p>
<p>é€šè¿‡å¦‚æœå‘ç°ä¸Šä¸€æ¡ sql æ…¢çš„åŸå› åœ¨äºæ‰§è¡Œæ…¢ï¼ˆ<code>executing</code>å­—æ®µè€—æ—¶å¤šï¼‰ï¼Œå°±å¯ä»¥æ¥ç€ç”¨ <code>Explain</code> è¿›è¡Œåˆ†æå…·ä½“çš„ sql è¯­å¥ã€‚ç­‰åé¢æˆ‘ä»¬ä¸ºå…¶å»ºç«‹ç´¢å¼•ï¼Œå°±å¯ä»¥å¤§å¤§æé«˜æ•ˆç‡äº†</p>
<p>ğŸ”Š**<font color=blue>show profileçš„å¸¸ç”¨æŸ¥è¯¢å‚æ•°ï¼š</font>**</p>
<p>â‘  ALLï¼šæ˜¾ç¤ºæ‰€æœ‰çš„å¼€é”€ä¿¡æ¯ã€‚<br>â‘¡ BLOCK IOï¼šæ˜¾ç¤ºå— IO å¼€é”€ã€‚<br>â‘¢ CONTEXT SWITCHESï¼šä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚<br>â‘£ CPUï¼šæ˜¾ç¤º CPU å¼€é”€ä¿¡æ¯ã€‚<br>â‘¤ IPCï¼šæ˜¾ç¤ºå‘é€å’Œæ¥æ”¶å¼€é”€ä¿¡æ¯ã€‚<br>â‘¥ MEMORYï¼šæ˜¾ç¤ºå†…å­˜å¼€é”€ä¿¡æ¯ã€‚<br>â‘¦ PAGE FAULTSï¼šæ˜¾ç¤ºé¡µé¢é”™è¯¯å¼€é”€ä¿¡æ¯ã€‚<br>â‘§ SOURCEï¼šæ˜¾ç¤ºå’Œ Source_functionï¼ŒSource_fileï¼ŒSource_line ç›¸å…³çš„å¼€é”€ä¿¡æ¯ã€‚<br>â‘¨ SWAPSï¼šæ˜¾ç¤ºäº¤æ¢æ¬¡æ•°å¼€é”€ä¿¡æ¯ã€‚</p>
<p>ğŸ¨**<font color=blue>æ—¥å¸¸å¼€å‘éœ€è¦æ³¨æ„çš„ç»“è®ºï¼š</font>**</p>
<p>â‘  <code>Coverting Heap to MyISAM</code>ï¼šæŸ¥è¯¢ç»“æœå¤ªå¤§ï¼Œå†…å­˜ä¸å¤Ÿï¼Œæ­£åœ¨å¾€ç£ç›˜ä¸­è¿ç§»<br>â‘¡ <code>Creating tmp table</code>ï¼šåˆ›å»ºä¸´æ—¶è¡¨ï¼Œå…ˆæ‹·è´æ•°æ®åˆ°ä¸´æ—¶è¡¨ï¼Œç”¨å®Œå†åˆ é™¤ä¸´æ—¶è¡¨<br>â‘¢<code>Coping to tmp table on disk</code>ï¼šæŠŠå†…å­˜ä¸­ä¸´æ—¶è¡¨å¤åˆ¶åˆ°ç£ç›˜ä¸Šï¼Œè­¦æƒ•ï¼<br>â‘£ <code>locked</code></p>
<p>&#x3D;&#x3D;å¦‚æœåœ¨ show profile çš„æŸ¥è¯¢ç»“æœä¸­ï¼Œå‡ºç°äº†ä»¥ä¸Š4æ¡ç»“æœä¸­çš„ä»»ä½•ä¸€æ¡ã€‚åˆ™sql è¯­å¥éœ€è¦ä¼˜åŒ–&#x3D;&#x3D;</p>
<p><strong><font color=blue>æœ€åï¼Œè¿˜éœ€è¦æ³¨æ„ï¼š</font></strong></p>
<p><code>SHOW PROFILE</code> å‘½ä»¤å°†è¢«å¼ƒç”¨ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥ä» <code>information_schema</code> ä¸­çš„ <code>profiling</code> æ•°æ®è¡¨è¿›è¡ŒæŸ¥çœ‹</p>
<h1 id="6-åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAINï¼ˆé‡ç‚¹ï¼‰"><a href="#6-åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAINï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="6. åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAINï¼ˆé‡ç‚¹ï¼‰"></a>6. åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAINï¼ˆé‡ç‚¹ï¼‰</h1><h2 id="6-1-EXPLAIN-æ¦‚è¿°"><a href="#6-1-EXPLAIN-æ¦‚è¿°" class="headerlink" title="6.1 EXPLAIN æ¦‚è¿°"></a>6.1 EXPLAIN æ¦‚è¿°</h2><p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031440.png" alt="image-20220812182818655"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html">https://dev.mysql.com/doc/refman/5.7/en/explain-output.html</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/explain-output.html">https://dev.mysql.com/doc/refman/8.0/en/explain-output.html</a></li>
</ul>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031002.png" alt="image-20220812183245510"></p>
<p><strong><font color=#681016>3. ç‰ˆæœ¬æƒ…å†µ</font></strong></p>
<ul>
<li><p>MySQL 5.6.3ä»¥å‰åªèƒ½<code>EXPLAIN SELECT</code> ï¼›MYSQL 5.6.3ä»¥åå°±å¯ä»¥<code>EXPLAIN SELECTï¼ŒUPDATEï¼ŒDELETE</code></p>
</li>
<li><p>åœ¨5.7ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæƒ³è¦æ˜¾ç¤º<code>partitions </code>éœ€è¦ä½¿ç”¨<code>explain partitions</code>å‘½ä»¤ï¼›æƒ³è¦æ˜¾ç¤º<br><code>filtered </code>éœ€è¦ä½¿ç”¨<code>explain extended</code> å‘½ä»¤ã€‚åœ¨5.7ç‰ˆæœ¬åï¼Œé»˜è®¤explainç›´æ¥æ˜¾ç¤ºpartitionså’Œ<br>filteredä¸­çš„ä¿¡æ¯</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031919.png" alt="image-20220812184127567"></p>
</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong>&#x3D;&#x3D;EXPLAIN ä»…ä»…æ˜¯æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œä¸ä¼šçœŸå®çš„æ‰§è¡Œ sql&#x3D;&#x3D;</p>
<h2 id="6-2-åŸºæœ¬è¯­æ³•"><a href="#6-2-åŸºæœ¬è¯­æ³•" class="headerlink" title="6.2 åŸºæœ¬è¯­æ³•"></a>6.2 åŸºæœ¬è¯­æ³•</h2><p>EXPLAIN æˆ– DESCRIBEè¯­å¥çš„è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> select_options</span><br><span class="line">æˆ–è€…</span><br><span class="line"><span class="keyword">DESCRIBE</span> <span class="keyword">SELECT</span> select_options</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬æƒ³çœ‹çœ‹æŸä¸ªæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’çš„è¯ï¼Œå¯ä»¥åœ¨å…·ä½“çš„æŸ¥è¯¢è¯­å¥å‰è¾¹åŠ ä¸€ä¸ªEXPLAIN ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031664.png" alt="image-20220812225914302"></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031294.png" alt="image-20220812225822122"></p>
<p>EXPLAIN è¯­å¥è¾“å‡ºçš„å„ä¸ªåˆ—çš„ä½œç”¨å¦‚ä¸‹ï¼š</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031821.png" alt="image-20220812225712460"></p>
<p>åœ¨è¿™é‡ŒæŠŠå®ƒä»¬éƒ½åˆ—å‡ºæ¥åªæ˜¯ä¸ºäº†æè¿°ä¸€ä¸ªè½®å»“ï¼Œè®©å¤§å®¶æœ‰ä¸€ä¸ªå¤§è‡´çš„å°è±¡ã€‚</p>
<h2 id="6-3-æ•°æ®å‡†å¤‡"><a href="#6-3-æ•°æ®å‡†å¤‡" class="headerlink" title="6.3 æ•°æ®å‡†å¤‡"></a>6.3 æ•°æ®å‡†å¤‡</h2><p><strong><font color=blue>1. å»ºè¡¨</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> s1 (</span><br><span class="line">     id <span class="type">INT</span> AUTO_INCREMENT,</span><br><span class="line">     key1 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">     key2 <span class="type">INT</span>,</span><br><span class="line">     key3 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">     key_part1 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">     key_part2 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">     key_part3 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">     common_field <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">      <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">      INDEX idx_key1 (key1),</span><br><span class="line">      <span class="keyword">UNIQUE</span> INDEX idx_key2 (key2),</span><br><span class="line">      INDEX idx_key3 (key3),</span><br><span class="line">      INDEX idx_key_part(key_part1, key_part2, key_part3)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> s2 (</span><br><span class="line">     id <span class="type">INT</span> AUTO_INCREMENT,</span><br><span class="line">     key1 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">     key2 <span class="type">INT</span>,</span><br><span class="line">     key3 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">     key_part1 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">     key_part2 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">     key_part3 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">     common_field <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">      <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">      INDEX idx_key1 (key1),</span><br><span class="line">      <span class="keyword">UNIQUE</span> INDEX idx_key2 (key2),</span><br><span class="line">      INDEX idx_key3 (key3),</span><br><span class="line">      INDEX idx_key_part(key_part1, key_part2, key_part3)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<p>æ³¨ï¼šå»ºä¸¤ä¸ªè¡¨æ–¹ä¾¿è”åˆæŸ¥è¯¢</p>
<p><strong><font color=blue>2. åˆ›å»ºå­˜å‚¨å‡½æ•°</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_string1(n <span class="type">INT</span>)</span><br><span class="line">    <span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">255</span>) #è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> chars_str <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> return_str <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    WHILE i <span class="operator">&lt;</span> n DO</span><br><span class="line">        <span class="keyword">SET</span> return_str <span class="operator">=</span>CONCAT(return_str,<span class="built_in">SUBSTRING</span>(chars_str,<span class="built_in">FLOOR</span>(<span class="number">1</span><span class="operator">+</span>RAND()<span class="operator">*</span><span class="number">52</span>),<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line">    <span class="keyword">RETURN</span> return_str;</span><br><span class="line"><span class="keyword">END</span> </span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå‡½æ•°ï¼Œå‡å¦‚æŠ¥é”™ï¼Œéœ€è®¾ç½®å‚æ•° <code>log_bin_trust_function_creators</code>ï¼Œå…è®¸åˆ›å»ºå‡½æ•°è®¾ç½®</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_bin_trust_function_creators<span class="operator">=</span><span class="number">1</span>;   # ä¸åŠ <span class="keyword">global</span>åªæ˜¯å½“å‰çª—å£æœ‰æ•ˆã€‚</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>3. åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</font></strong></p>
<p>åˆ›å»ºå¾€ s1 è¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_s1 (<span class="keyword">IN</span> min_num <span class="type">INT</span> (<span class="number">10</span>),<span class="keyword">IN</span> max_num <span class="type">INT</span> (<span class="number">10</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    REPEAT</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> s1 <span class="keyword">VALUES</span>(</span><br><span class="line">     (min_num <span class="operator">+</span> i),</span><br><span class="line">     rand_string1(<span class="number">6</span>),</span><br><span class="line">     (min_num <span class="operator">+</span> <span class="number">30</span> <span class="operator">*</span> i <span class="operator">+</span> <span class="number">5</span>),</span><br><span class="line">     rand_string1(<span class="number">6</span>),</span><br><span class="line">     rand_string1(<span class="number">10</span>),</span><br><span class="line">     rand_string1(<span class="number">5</span>),</span><br><span class="line">     rand_string1(<span class="number">10</span>),</span><br><span class="line">     rand_string1(<span class="number">10</span>));</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå¾€ s2 è¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_s2 (<span class="keyword">IN</span> min_num <span class="type">INT</span> (<span class="number">10</span>),<span class="keyword">IN</span> max_num <span class="type">INT</span> (<span class="number">10</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    REPEAT</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> s2 <span class="keyword">VALUES</span>((min_num <span class="operator">+</span> i),</span><br><span class="line">        rand_string1(<span class="number">6</span>),</span><br><span class="line">        (min_num <span class="operator">+</span> <span class="number">30</span> <span class="operator">*</span> i <span class="operator">+</span> <span class="number">5</span>),</span><br><span class="line">        rand_string1(<span class="number">6</span>),</span><br><span class="line">        rand_string1(<span class="number">10</span>),</span><br><span class="line">        rand_string1(<span class="number">5</span>),</span><br><span class="line">        rand_string1(<span class="number">10</span>),</span><br><span class="line">        rand_string1(<span class="number">10</span>));</span><br><span class="line">    UNTIL i <span class="operator">=</span> max_num</span><br><span class="line">    <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>4. è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</font></strong></p>
<p>s1 è¡¨æ•°æ®çš„æ·»åŠ ï¼šåŠ å…¥ 1 ä¸‡æ¡è®°å½•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CALL insert_s1(10001,10000);</span><br></pre></td></tr></table></figure>

<p>s2 è¡¨æ•°æ®çš„æ·»åŠ ï¼šåŠ å…¥ 1 ä¸‡æ¡è®°å½•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CALL insert_s2(10001,10000);</span><br></pre></td></tr></table></figure>

<h2 id="6-4-EXPLAIN-å„åˆ—ä½œç”¨"><a href="#6-4-EXPLAIN-å„åˆ—ä½œç”¨" class="headerlink" title="6.4 EXPLAIN å„åˆ—ä½œç”¨"></a>6.4 EXPLAIN å„åˆ—ä½œç”¨</h2><p>ä¸ºäº†è®©å¤§å®¶æœ‰æ¯”è¾ƒå¥½çš„ä½“éªŒï¼Œæˆ‘ä»¬è°ƒæ•´äº†ä¸‹<code>EXPLAIN</code>è¾“å‡ºåˆ—çš„é¡ºåºã€‚</p>
<h3 id="6-4-1-table"><a href="#6-4-1-table" class="headerlink" title="6.4.1 table"></a>6.4.1 table</h3><p>ä¸è®ºæˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥æœ‰å¤šå¤æ‚ï¼Œé‡Œè¾¹å„¿åŒ…å«äº†å¤šå°‘ä¸ªè¡¨ ï¼Œåˆ°æœ€åä¹Ÿæ˜¯éœ€è¦å¯¹æ¯ä¸ªè¡¨è¿›è¡Œå•è¡¨è®¿é—®çš„ï¼Œæ‰€ä»¥ MySQL è§„å®š EXPLAIN è¯­å¥è¾“å‡ºçš„æ¯æ¡è®°å½•éƒ½å¯¹åº”ç€æŸä¸ªå•è¡¨çš„è®¿é—®æ–¹æ³•ï¼Œè¯¥æ¡è®°å½•çš„ &#x3D;&#x3D;table åˆ—ä»£è¡¨ç€è¯¥è¡¨çš„è¡¨å&#x3D;&#x3D;ï¼ˆæœ‰æ—¶ä¸æ˜¯çœŸå®çš„è¡¨åå­—ï¼Œå¯èƒ½æ˜¯ç®€ç§°ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM s1 INNER JOIN s2;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸‹å›¾ï¼Œ&#x3D;&#x3D;ä¸€å¼ è¡¨å¯¹åº”ä¸€ä¸ªè®°å½•&#x3D;&#x3D;ã€‚</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031570.png" alt="image-20220812235854193"></p>
<p>æ³¨ï¼šä¸´æ—¶è¡¨ä¹Ÿä¼šæœ‰å¯¹åº”çš„è®°å½•ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨UNIONæ—¶å°±ä¼šå‡ºç°ä¸´æ—¶è¡¨</p>
<h3 id="6-4-2-id"><a href="#6-4-2-id" class="headerlink" title="6.4.2 id"></a>6.4.2 id</h3><p>ä¾‹1ï¼šä¸‹é¢çš„æŸ¥è¯¢ç»“æœï¼Œä¸¤ä¸ªè®°å½•ä¼¼ä¹idéƒ½æ˜¯1.è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031032.png" alt="image-20220813001639812"></p>
<p>å®é™…ä¸Šï¼Œ&#x3D;&#x3D;åœ¨æŸ¥è¯¢è¯­å¥ä¸­æ¯å‡ºç°ä¸€ä¸ªSELECTå…³é”®å­—ï¼ŒMySQLå°±ä¼šä¸ºå®ƒåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„id&#x3D;&#x3D; ï¼Œä»£è¡¨ç€ä¸€æ¬¡æŸ¥è¯¢ã€‚è¿™ä¸ªid å°±æ˜¯ <code>EXPLAIN</code>è¯­å¥çš„ç¬¬ä¸€åˆ—ã€‚</p>
<p>ä¾‹2ï¼šä¸‹é¢çš„æŸ¥è¯¢ä¸­åªæœ‰ä¸€ä¸ªSELECTï¼Œæ‰€ä»¥<code>EXPLAIN</code>çš„ç»“æœä¸­ä¹Ÿå°±åªæœ‰ä¸€æ¡idä¸º 1 çš„è®°å½•å–½~</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031185.png" alt="image-20220813001157042"></p>
<p>ä¾‹3ï¼šä¸‹é¢çš„æŸ¥è¯¢æœ‰ä¸¤ä¸ªSELECTï¼Œæ‰€ä»¥<code>EXPLAIN</code>çš„ç»“æœä¸­ ä¼šæœ‰ä¸¤æ¡è®°å½•ï¼Œä¸”idåˆ†åˆ«å°±æ˜¯1å’Œ2å–½~ ã€‚å…¶ä¸­ s1è¢«ç§°ä¸ºé©±åŠ¨è¡¨ï¼Œs2è¢«ç§°ä¸º è¢«é©±åŠ¨è¡¨</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031326.png" alt="image-20220813005516485"></p>
<p>ä¾‹4ï¼šä¸‹é¢è¿™æ¡SQLæœ‰ä¸€ä¸ªå‘ï¼Œè¯·æ³¨æ„ï¼ï¼ï¼</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> key2 <span class="keyword">FROM</span> s2 <span class="keyword">WHERE</span> common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªè®°å½•çš„ id éƒ½æ˜¯ 1ï¼Œå°å°çš„çœ¼ç›æ˜¯å¦å……æ»¡äº†å¤§å¤§çš„ç–‘æƒ‘ï¼Ÿ</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031679.png" alt="image-20220813105713820"></p>
<p>è¿™æ˜¯å› ä¸ºä¼˜åŒ–å™¨ä¼šå¯¹ä¸Šé¢çš„ sql è¯­å¥è¿›è¡Œä¼˜åŒ–ï¼Œå°†å…¶è½¬æ¢ä¸ºå¤šè¡¨è¿æ¥ï¼Œè€Œä¸æ˜¯å­æŸ¥è¯¢ã€‚å› ä¸ºå­æŸ¥è¯¢å…¶å®æ˜¯ä¸€ç§åµŒå¥—æŸ¥è¯¢çš„æƒ…å†µï¼Œå…¶æ—¶é—´å¤æ‚åº¦æ˜¯ O(n^m)ï¼Œå…¶ä¸­ m æ˜¯åµŒå¥—çš„å±‚æ•°ï¼Œè€Œå¤šè¡¨æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n*m)</p>
<p>ä¾‹5ï¼šå†çœ‹çœ‹ Union è”åˆæŸ¥è¯¢çš„æƒ…å†µã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s2;</span><br></pre></td></tr></table></figure>

<p>ç»“æœæ˜¯è¿™æ ·ï¼Œç«Ÿç„¶ä¼šå‡ºç°ä¸‰å¼ è¡¨~ Amazingï¼</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031358.png" alt="image-20220813110019454"></p>
<p>è¿™æ˜¯å› ä¸º Union æ˜¯å–è¡¨çš„å¹¶é›†ï¼Œéœ€è¦å»ºä¸´æ—¶è¡¨è¿›è¡Œå»é‡ï¼Œå› æ­¤ä¼šæœ‰ä¸‰æ¡è®°å½•ã€‚å¯ä»¥çœ‹åˆ°ç¬¬ä¸‰æ¡è®°å½•çš„ <code>Extra</code> å°±æ ‡è¯†äº†å®ƒæ˜¯ä¸€å¼ ä¸´æ—¶è¡¨å“¦ã€‚<code>ä¸´æ—¶è¡¨ id æ˜¯ Null</code>ã€‚</p>
<p>ä¾‹6ï¼šå†çœ‹çœ‹ Union ALLï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1  <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s2;</span><br></pre></td></tr></table></figure>

<p>äº§ç”Ÿä¸¤æ¡è®°å½•ï¼Œå› ä¸ºå®ƒä¸ä¼šå»é‡~</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031768.png" alt="image-20220813110210174"></p>
<p><strong>ğŸ’Œå°ç»“</strong></p>
<ol>
<li>idå¦‚æœç›¸åŒï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œ</li>
<li>åœ¨æ‰€æœ‰ç»„ä¸­ï¼Œidå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ</li>
<li>å…³æ³¨ç‚¹ï¼šidå·æ¯ä¸ªå·ç ï¼Œè¡¨ç¤ºä¸€è¶Ÿç‹¬ç«‹çš„æŸ¥è¯¢, ä¸€ä¸ªsqlçš„æŸ¥è¯¢è¶Ÿæ•°è¶Šå°‘è¶Šå¥½</li>
</ol>
<h3 id="6-4-3-select-type"><a href="#6-4-3-select-type" class="headerlink" title="6.4.3 select_type"></a>6.4.3 select_type</h3><p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031617.png" alt="image-20220813114910520"></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150031504.png" alt="image-20220813115146750"></p>
<p><strong><font color=blue>â‘ ï¼šæŸ¥è¯¢è¯­å¥ä¸­ä¸åŒ…å«<code>UNION</code>æˆ–è€…å­æŸ¥è¯¢çš„æŸ¥è¯¢éƒ½ç®—ä½œæ˜¯<code>SIMPLE</code>ç±»å‹</font></strong></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032310.png" alt="image-20220813133415051"></p>
<p>å†çœ‹ä¸‹è¿æ¥æŸ¥è¯¢ï¼Œå¯ä»¥çœ‹åˆ° è¿æ¥æŸ¥è¯¢ä¹Ÿç®—æ˜¯<code>SIMPLE</code>ç±»å‹</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032728.png" alt="image-20220813133509606"></p>
<p><strong><font color=blue>â‘¡ï¼šUnion è”åˆæŸ¥è¯¢ã€‚å…¶å·¦è¾¹çš„æŸ¥è¯¢æ˜¯ <code>Primary</code>ï¼Œå³è¾¹çš„æŸ¥è¯¢ç±»å‹æ˜¯ <code>Union</code>ï¼Œå»é‡çš„ä¸´æ—¶è¡¨æŸ¥è¯¢ç±»å‹æ˜¯ï¼š <code>Union Result</code></font></strong></p>
<ul>
<li><p>å¯¹äºåŒ…å«<code>UNION</code>æˆ–è€…<code>UNION ALL</code>çš„å¤§æŸ¥è¯¢æ¥è¯´ï¼Œå®ƒæ˜¯ç”±å‡ ä¸ªå°æŸ¥è¯¢ç»„æˆçš„ï¼Œå…¶ä¸­é™¤äº†æœ€å·¦è¾¹çš„é‚£ä¸ªæŸ¥è¯¢çš„<code>select_type</code>å€¼å°±æ˜¯<code>PRIMARY</code>ï¼Œå…¶ä½™çš„å°æŸ¥è¯¢çš„<code>select_type</code>å€¼å°±æ˜¯<code>UNION</code></p>
</li>
<li><p><code>MySQL</code>é€‰æ‹©ä½¿ç”¨ä¸´æ—¶è¡¨æ¥å®Œæˆ<code>UNION</code>æŸ¥è¯¢çš„å»é‡å·¥ä½œï¼Œé’ˆå¯¹è¯¥ä¸´æ—¶è¡¨çš„æŸ¥è¯¢çš„<code>select_type</code>å°±æ˜¯<br><code>UNION RESULT</code></p>
</li>
<li><p>å¯¹åº”å­æŸ¥è¯¢çš„å¤§æŸ¥è¯¢æ¥è¯´ï¼Œå­æŸ¥è¯¢æ˜¯å¤–è¾¹çš„é‚£ä¸ªæ˜¯<code>PRIMARY</code></p>
</li>
</ul>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032169.png" alt="image-20220813133840236"></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032358.png" alt="image-20220813134118038"></p>
<p><strong><font color=blue>â‘¢ï¼šä¸ä¼šè¢«ä¼˜åŒ–æˆå¤šè¡¨è¿æ¥çš„å­æŸ¥è¯¢</font></strong></p>
<p>å¦‚æœåŒ…å«å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥ä¸èƒ½å¤Ÿè½¬ä¸ºå¤šè¡¨è¿æ¥çš„å½¢å¼(ä¹Ÿå°±æ˜¯ä¸ä¼šè¢«ä¼˜åŒ–å™¨è¿›è¡Œè‡ªåŠ¨çš„ä¼˜åŒ–)ï¼Œå¹¶ä¸”è¯¥å­æŸ¥è¯¢æ˜¯ä¸ç›¸å…³çš„å­æŸ¥è¯¢</p>
<p>è¯¥å­æŸ¥è¯¢çš„ç¬¬ä¸€ä¸ª<code>SELECT</code>å…³é”®å­—ä»£è¡¨çš„é‚£ä¸ªæŸ¥è¯¢çš„<code>select_type</code>å°±æ˜¯<code>SUBQUERY</code>ã€‚ä¹Ÿå°±æ˜¯å¤–å±‚æŸ¥è¯¢æ˜¯ <code>Primary</code>ï¼Œå†…å±‚æŸ¥è¯¢æ˜¯ <code>SUBQUERY</code></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032686.png" alt="image-20220813134931380"></p>
<p>å¦‚æœå­æŸ¥è¯¢ä¸èƒ½è¢«è½¬æ¢ä¸ºå¤šè¡¨è¿æ¥çš„å½¢å¼ï¼Œå¹¶ä¸”è¯¥å­æŸ¥è¯¢æ˜¯ç›¸å…³å­æŸ¥è¯¢ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢çš„æŸ¥è¯¢åœ¨å†…éƒ¨å­æŸ¥è¯¢ä½¿ç”¨äº†å¤–éƒ¨çš„è¡¨ã€‚åˆ™è¯¥å­æŸ¥è¯¢çš„ç¬¬ä¸€ä¸ª<code>SELECT</code>å…³é”®å­—ä»£è¡¨çš„é‚£ä¸ªæŸ¥è¯¢çš„<code>select_type</code>å°±æ˜¯<code>DEPENDENT SUBQUERY</code>ã€‚ å¤–å±‚æŸ¥è¯¢æ˜¯<code>Primary</code>ï¼Œå†…å±‚æŸ¥è¯¢æ˜¯<code>DEPENDENT SUBQUERY</code> </p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032673.png" alt="image-20220813135056579"></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>DEPENDENT SUBQUERY</code> çš„æŸ¥è¯¢è¯­å¥å¯èƒ½ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ï¼Œå› ä¸ºå†…å±‚æŸ¥è¯¢ä¾èµ–äºå¤–å±‚çš„æŸ¥è¯¢ï¼Œå› æ­¤å¯èƒ½ä¼šæ˜¯å¤–å±‚ä¼ ä¸€ä¸ªå€¼ï¼Œå†…å±‚å°±æ‰§è¡Œä¸€æ¬¡çš„æ¨¡å¼ã€‚</p>
<blockquote>
<p>å­æŸ¥è¯¢éœ€è¦æ‰§è¡Œå¤šæ¬¡ï¼Œå³é‡‡ç”¨å¾ªç¯çš„æ–¹å¼ï¼Œå…ˆä»å¤–éƒ¨æŸ¥è¯¢å¼€å§‹ï¼Œæ¯æ¬¡éƒ½ä¼ å…¥å­æŸ¥è¯¢è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åå†å°†ç»“æœåé¦ˆç»™å¤–éƒ¨ï¼Œè¿™ç§åµŒå¥—çš„æ‰§è¡Œæ–¹å¼å°±ç§°ä¸ºç›¸å…³å­æŸ¥è¯¢ã€‚</p>
<p>å­æŸ¥è¯¢ä»æ•°æ®è¡¨ä¸­æŸ¥è¯¢äº†æ•°æ®ç»“æœï¼Œå¦‚æœè¿™ä¸ªæ•°æ®ç»“æœåªæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åè¿™ä¸ªæ•°æ®ç»“æœä½œä¸ºä¸»æŸ¥è¯¢çš„æ¡ ä»¶è¿›è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆè¿™æ ·çš„å­æŸ¥è¯¢å«åšä¸ç›¸å…³å­æŸ¥è¯¢ã€‚</p>
</blockquote>
<p><strong><font color=blue>â‘£ï¼šåŒ…å«<code>UNION</code>æˆ–è€…<code>UNION ALL</code>çš„å­æŸ¥è¯¢</font></strong></p>
<p>åœ¨åŒ…å« <code>Union</code>æˆ–è€… <code>Union All</code> çš„å­æŸ¥è¯¢ sql ä¸­ï¼Œå¦‚æœå„ä¸ªå°æŸ¥è¯¢éƒ½ä¾èµ–äºå¤–æŸ¥è¯¢ï¼Œé‚£ä¹ˆé™¤äº†æœ€å·¦è¾¹çš„å°æŸ¥è¯¢å¤–ï¼Œå„ä¸ªå°æŸ¥è¯¢çš„ç±»å‹éƒ½æ˜¯ <code>DEPENDENT UNION</code> </p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032262.png" alt="image-20220813145005814"></p>
<p>å¤–æŸ¥è¯¢æ˜¯ <code>Primary</code>ï¼Œæœ€å·¦è¾¹çš„å­æŸ¥è¯¢æ˜¯ <code>DEPENDENT SUBQUERY</code>ï¼Œåé¢çš„å­æŸ¥è¯¢æ˜¯ <code>DEPENDENT UNION</code>ï¼Œä¸´æ—¶å»é‡è¡¨çš„ç±»å‹æ˜¯ <code>Union Result</code>ã€‚è¿™é‡Œå¤§å®¶å¯èƒ½è¦å›°æƒ‘ï¼Œç¬¬ä¸€ä¸ªå­æŸ¥è¯¢ä¸­ä¹Ÿæ²¡æœ‰çœ‹åˆ°ä¾èµ– s1 å•Šã€‚è¿™å…¶å®ä¹Ÿæ˜¯ä¼˜åŒ–å™¨ä¼šåœ¨æ‰§è¡Œæ—¶è¿›è¡Œä¼˜åŒ–ï¼Œå°† <code>IN</code> æ”¹æˆ <code>Exist</code>ï¼Œå¹¶ä¸”æŠŠå¤–éƒ¨çš„è¡¨ç§»åˆ°å†…éƒ¨å»ã€‚è¿™é‡Œæˆ‘ä»¬äº†è§£å°±è¡Œï¼Œä»¥åä¼šæœ‰æ–‡ç« ç»™å¤§å®¶ä»‹ç»ä¼˜åŒ–å™¨çš„ã€‚</p>
<p><strong><font color=blue>â‘¤ï¼šå…³äºæ´¾ç”Ÿè¡¨çš„å­æŸ¥è¯¢</font></strong></p>
<p>å¯¹äºåŒ…å«<code>æ´¾ç”Ÿè¡¨</code>çš„æŸ¥è¯¢ï¼Œè¯¥æ´¾ç”Ÿè¡¨å¯¹åº”çš„å­æŸ¥è¯¢çš„<code>select_type</code>å°±æ˜¯<code>DERIVED</code></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032278.png" alt="image-20220813145348553"></p>
<p><strong><font color=blue>â‘¥ï¼šå­æŸ¥è¯¢çš„ç‰©åŒ–åä¸å¤–å±‚è¿æ¥æŸ¥è¯¢</font></strong></p>
<p>å½“ä¼˜åŒ–å™¨åœ¨æ‰§è¡Œå­æŸ¥è¯¢æ—¶é€‰æ‹©æŠŠå­æŸ¥è¯¢ä¼˜åŒ–æˆä¸ºä¸€å¼ ç‰©åŒ–è¡¨ï¼Œä¸å¤–å±‚æŸ¥è¯¢è¿›è¡Œè¿æ¥æŸ¥è¯¢æ—¶ã€‚</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032153.png" alt="image-20220813150059254"></p>
<p>ä»ä¸‹å¾€ä¸Šçœ‹ï¼Œå­æŸ¥è¯¢çš„æŸ¥è¯¢ç±»å‹æ˜¯ <code>MATERIALIZED</code>ï¼›ç‰©åŒ–è¿‡ç¨‹æ˜¯åŸºäº id ä¸º 2 çš„æŸ¥è¯¢ç»“æœè¡¨è¿›è¡Œçš„ï¼Œå…¶ table æ˜¯ <code>subquery 2</code>ï¼ŒæŸ¥è¯¢ç±»å‹æ˜¯ <code>SIMPLE</code>ï¼Œè€Œå¤–å±‚ä¹Ÿç›¸å½“äºæ˜¯ä¸å›ºå®šçš„ç›´æ¥å€¼è¿›è¡ŒæŸ¥è¯¢ï¼Œå…¶ç±»å‹ä¹Ÿæ˜¯ <code>SIMPLE</code></p>
<p>ä¸Šé¢çš„ä»‹ç»éƒ½æ˜¯ä¸€äº›åŸºæœ¬çš„æƒ…å†µï¼Œè¿˜æ²¡æœ‰çœŸæ­£çš„ä»‹ç»ä¸ç´¢å¼•ç›¸å…³çš„æƒ…å†µå“¦ã€‚è§‰å¾—æ˜¯ä¸æ˜¯æ™•æ™•çš„äº†ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªè¡¨æ ¼è¿›è¡Œä¸‹æ€»ç»“å§</p>
<h3 id="6-4-4-partitions-å¯ç•¥"><a href="#6-4-4-partitions-å¯ç•¥" class="headerlink" title="6.4.4 partitions (å¯ç•¥)"></a>6.4.4 partitions (å¯ç•¥)</h3><p>ä»£è¡¨åˆ†åŒºè¡¨ä¸­çš„å‘½ä¸­æƒ…å†µï¼Œéåˆ†åŒºè¡¨ï¼Œè¯¥é¡¹ä¸º <code>NULL</code>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’çš„<code>partitions </code>åˆ—çš„å€¼éƒ½æ˜¯<code>NULL</code></p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/alter-table-partition-operations.html">https://dev.mysql.com/doc/refman/8.0/en/alter-table-partition-operations.html</a></p>
<p>å¦‚æœæƒ³è¯¦ç»†äº†è§£ï¼Œå¯ä»¥å¦‚ä¸‹æ–¹å¼æµ‹è¯•ã€‚åˆ›å»ºåˆ†åŒºè¡¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºåˆ†åŒºè¡¨ï¼Œ</span></span><br><span class="line"><span class="comment">-- æŒ‰ç…§idåˆ†åŒºï¼Œid&lt;100 p0åˆ†åŒºï¼Œå…¶ä»–p1åˆ†åŒº</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_partitions (id <span class="type">INT</span> auto_increment,</span><br><span class="line">    NAME <span class="type">VARCHAR</span>(<span class="number">12</span>),<span class="keyword">PRIMARY</span> KEY(id))</span><br><span class="line">    <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>(id)(</span><br><span class="line">    <span class="keyword">PARTITION</span> p0 <span class="keyword">VALUES</span> less than(<span class="number">100</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p1 <span class="keyword">VALUES</span> less than MAXVALUE</span><br><span class="line"> );</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢ id å¤§äº200ï¼ˆ200&gt;100ï¼Œp1åˆ†åŒºï¼‰çš„è®°å½•ï¼ŒæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œpartitions æ˜¯ p1ï¼Œç¬¦åˆæˆ‘ä»¬çš„åˆ†åŒºè§„åˆ™</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032328.png" alt="image-20220813151056438"></p>
<h3 id="6-4-5-type-â˜†"><a href="#6-4-5-type-â˜†" class="headerlink" title="6.4.5 type â˜†"></a>6.4.5 type â˜†</h3><p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150102778.png" alt="image-20220813152916930"></p>
<p>å®Œæ•´çš„è®¿é—®æ–¹æ³•å¦‚ä¸‹ï¼š <code>system </code>ã€<code>const</code>ã€<code>eq_ref </code>ã€<code>ref </code>ã€<code>fulltext</code>ã€<code>ref_or_null</code>ã€<code>index_merge</code>ã€<code>unique_subquery</code>ã€<code>index_subquery</code>ã€ <code>range</code>ã€<code>index</code>ã€<code>ALL</code>ã€‚</p>
<p>æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š</p>
<p><strong>1ï¸âƒ£system</strong></p>
<p>å½“è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ï¼Œå¹¶ä¸”è¯¥è¡¨ä¸­å­˜å‚¨å¼•æ“ç»Ÿè®¡æ•°æ®æ˜¯ç²¾ç¡®çš„ï¼Œæ¯”å¦‚ MYISAMï¼ŒMemoryï¼Œé‚£ä¹ˆå…¶è®¿é—®æ–¹æ³•å°±æ˜¯<code>System</code>ã€‚è¿™ç§æ–¹å¼å‡ ä¹æ˜¯æ€§èƒ½æœ€é«˜çš„ï¼Œå½“ç„¶æˆ‘ä»¬å‡ ä¹ç”¨ä¸ä¸Šã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t(i int) Engine=MyISAM;#åˆ›å»ºè¡¨</span><br><span class="line">INSERT INTO t VALUES(1);# æ’å…¥ç¬¬ä¸€æ¡è®°å½•</span><br><span class="line">EXPLAIN SELECT * FROM t;# æŸ¥çœ‹æ€§èƒ½</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032626.png" alt="image-20220813161234015"><br>ä½†å‡¡æˆ‘ä»¬å†æ’å…¥ä¸€æ¡æ•°æ®ï¼Œå…¶è®¿é—®æ–¹å¼å°±å˜æˆäº†æ€§èƒ½æœ€å·®çš„å…¨è¡¨æ‰«æ <code>ALL</code>ã€‚</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032680.png" alt="image-20220813161324653"></p>
<p>å¦‚æœå­˜å‚¨å¼•æ“æ˜¯InnoDBï¼Œå³ä½¿åªæœ‰ä¸€æ¡æ•°æ®ï¼Œå…¶è®¿é—®æ–¹å¼ä¹Ÿæ˜¯ALLï¼Œè¿™æ˜¯å› ä¸º InnnoDB è®¿é—®æ•°æ®ä¸æ˜¯ç²¾ç¡®çš„</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032943.png" alt="image-20220813161518641"></p>
<p><strong>2ï¸âƒ£Const</strong></p>
<p>å½“æˆ‘ä»¬æ ¹æ®ä¸»é”®æˆ–è€…å”¯ä¸€çš„äºŒçº§ç´¢å¼•ï¼Œä¸å¸¸æ•°è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå¯¹å•è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯ <code>const</code>ã€‚è¿™ä¸ªè®¿é—®æ–¹å¼çš„æ•ˆç‡ä½äº <code>system</code>ï¼Œä½†ä¹Ÿæ˜¯å¾ˆé«˜æ•ˆçš„ã€‚</p>
<p>æ¯”å¦‚å¯¹ä¸»é”®ä¸å¸¸æ•°åŒ¹é…ï¼Œè¿›è¡Œç­‰å€¼æŸ¥è¯¢</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10005</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032582.png" alt="image-20220813161700890"></p>
<p>æ¯”å¦‚å¯¹Uniqueæ ‡è¯†çš„å”¯ä¸€äºŒçº§ç´¢å¼•key2ä¸å¸¸æ•°åŒ¹é…ï¼Œè¿›è¡Œç­‰å€¼æŸ¥è¯¢ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key2 <span class="operator">=</span> <span class="number">10066</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032734.png" alt="image-20220813163815258"></p>
<p>å½“æˆ‘ä»¬æŠŠwhereåé¢çš„å…³é”®å­—æ”¹æˆkey3 æ™®é€šç´¢å¼•æ—¶ï¼Œç”±äºkey3çš„å­—æ®µå€¼æ˜¯å¯é‡å¤çš„ã€‚typeç±»å‹å°±å˜æˆäº† <code>All</code>ï¼Œå…¨è¡¨æŸ¥è¯¢</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032927.png" alt="image-20220813164458327"></p>
<p>æ³¨æ„ï¼šæ­¤æ—¶å¯èƒ½æœ‰ç»†å¿ƒçš„å°ä¼™ä¼´å¯èƒ½æ³¨æ„åˆ°æˆ‘ä»¬çš„key3ä¸æ˜¯ä¹Ÿæœ‰ç´¢å¼•<code>idx_key3</code>ï¼Œæ€§èƒ½å†æŸ¥ä¹Ÿä¸è‡³äºå…¨è¡¨æŸ¥è¯¢å§~ ä½†æ˜¯å¿˜è®°äº†ä¸€ä¸ªç»†èŠ‚ï¼Œkey3æœ¬èº«æ˜¯varcharç±»å‹çš„ï¼Œ <code>key3 = 10066</code>ä¼šè¿›è¡Œä¸€ä¸ªéšå¼ç±»å‹è½¬æ¢ï¼Œä»è€Œä¼šå¯¼è‡´ ç´¢å¼•å¤±æ•ˆï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ° <code>key</code>åˆ—å¯¹åº”çš„ä¸ºç©ºã€‚</p>
<p>å½“ä¿®æ”¹æˆ<code>key3 = 10066</code>åï¼Œç»“æœå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032846.png" alt="image-20220813172536786"></p>
<p><strong>3ï¸âƒ£eq_ref</strong></p>
<p>å†è¿›è¡Œ<strong>è¿æ¥æŸ¥è¯¢</strong>æ—¶ï¼Œå¦‚æœ<strong>è¢«é©±åŠ¨è¡¨</strong>æ˜¯é€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•ç­‰å€¼åŒ¹é…çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢çš„ï¼Œé‚£ä¹ˆè¢«é©±åŠ¨è¡¨çš„è®¿é—®æ–¹å¼æ˜¯ <code>eq_ref</code>ã€‚è¿™ä¹Ÿæ˜¯ä¸€ç§æ€§èƒ½å¾ˆä¸é”™çš„æ–¹å¼ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.id <span class="operator">=</span> s2.id;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢è¿æ¥æŸ¥è¯¢è¯­å¥ï¼Œå¯¹äºé©±åŠ¨è¡¨æ¥è¯´ï¼Œå°±æ˜¯å¯¹s1å…¨è¡¨è¿›è¡Œæ‰«æï¼Œæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œå› æ­¤å…¶<code>type</code>æ˜¯<code>All</code>,å¯¹è¢«é©±åŠ¨è¡¨æ¥è¯´ï¼Œç›¸äºç›´æ¥è®¿é—®é©±åŠ¨è¡¨æŸ¥è¯¢åˆ°çš„æ•°æ®è¿›è¡Œç­‰å€¼æŸ¥è¯¢ï¼Œå› æ­¤å…¶è®¿é—®æ–¹å¼æ˜¯<code>eq_ref</code><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032989.png" alt="image-20220813173413307"></p>
<p><strong>4ï¸âƒ£ref</strong></p>
<p>å½“ä½¿ç”¨æ™®é€šçš„äºŒçº§ç´¢å¼•ä¸å¸¸é‡è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œtype æ˜¯ <code>ref</code>ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032310.png" alt="image-20220813173618072"></p>
<p>ä¸‹é¢è€ƒè€ƒä½ ã€‚ä»¥ä¸‹ sql çš„å¼•ç”¨ç±»å‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key3 <span class="operator">=</span> <span class="number">10066</span>;</span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹ç­”æ¡ˆã€‚ä½ æ˜¯ä¸æ˜¯çŒœé”™äº†ã€‚æ˜¯ <code>All</code>ã€‚è¿™æ˜¯å› ä¸º key3 çš„å­—æ®µ varchar ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œå¸¸é‡å€¼æ˜¯æ•´å½¢ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å‡½æ•°è¿›è¡Œ&#x3D;&#x3D;éšå¼çš„ç±»å‹è½¬æ¢&#x3D;&#x3D;ï¼Œä¸€æ—¦ä½¿ç”¨å‡½æ•°ï¼Œç´¢å¼•å°±å¤±æ•ˆäº†ï¼Œå› æ­¤è®¿é—®ç±»å‹å˜æˆäº†å…¨è¡¨æ‰«æ <code>All</code></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032919.png" alt="image-20220813173814439"></p>
<p>å½“æˆ‘ä»¬å¸¸é‡ä½¿ç”¨å¯¹åº”çš„ç±»å‹ï¼Œå°±æ˜¯æœŸæœ›çš„<code>ref</code>è®¿é—®ç±»å‹äº†</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150032015.png" alt="image-20220813173912091"></p>
<p><strong>5ï¸âƒ£ref_or_null</strong></p>
<p>å½“ä½¿ç”¨æ™®é€šçš„äºŒçº§ç´¢å¼•è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå½“ç´¢å¼•å€¼å¯ä»¥æ˜¯ Null æ—¶ï¼Œtype æ˜¯ <code>ref_or_null</code>ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">OR</span> key1 <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033169.png" alt="image-20220813174556607"></p>
<p><strong>6ï¸âƒ£index_merge</strong></p>
<p>å½“è¿›è¡Œå•è¡¨è®¿é—®æ—¶ï¼Œå¦‚æœå¤šä¸ªæŸ¥è¯¢å­—æ®µåˆ†åˆ«å»ºç«‹äº†å•åˆ—ç´¢å¼•ï¼Œä½¿ç”¨ OR è¿æ¥ï¼Œå…¶è®¿é—®ç±»å‹æ˜¯ <code>index_merge</code>ã€‚åŒæ—¶è¿˜å¯ä»¥çœ‹åˆ° <code>key </code>è¿™ä¸€å­—æ®µï¼Œæ˜¯ä½¿ç”¨äº†å¤šä¸ªç´¢å¼•</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">OR</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033310.png" alt="image-20220813174718756"></p>
<p>çŒœçŒœä¸‹é¢ sql çš„å¼•ç”¨ç±»å‹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">AND</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>çŒœå¯¹äº†å—ï¼Ÿç­”æ¡ˆæ˜¯ <code>ref</code>ï¼Œè¿™æ˜¯å› ä¸ºç”¨ AND è¿æ¥ä¸¤ä¸ªæŸ¥è¯¢æ—¶ï¼Œå®é™…ä¸Šåªä½¿ç”¨äº† key1 çš„ç´¢å¼•ã€‚</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033111.png" alt="image-20220813174912860"></p>
<p><strong>7ï¸âƒ£unique_subquery</strong></p>
<p>é’ˆå¯¹ä¸€äº›åŒ…å« <code>IN</code> çš„ å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥ä¸­ï¼Œå¦‚æœä¼˜åŒ–å™¨å†³å®šå°† IN å­æŸ¥è¯¢ä¼˜åŒ–ä¸º EXIST å­æŸ¥è¯¢ï¼Œè€Œä¸”å­æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ä¸»é”®è¿›è¡Œç­‰å€¼åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆè¯¥å­æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’çš„ <code>type </code>å°±æ˜¯ <code>unique_subquery</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key2 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> s2 <span class="keyword">where</span> s1.key1 <span class="operator">=</span> s2.key1) <span class="keyword">OR</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033407.png" alt="image-20220813182322867"></p>
<p><strong>8ï¸âƒ£range</strong></p>
<p>å¦‚æœä½¿ç”¨ç´¢å¼•è·å–æŸäº›<code>èŒƒå›´åŒºé—´</code>çš„è®°å½•ï¼Œé‚£ä¹ˆå°±å¯èƒ½ä½¿ç”¨åˆ°<code>range</code>è®¿é—®æ–¹æ³•</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="keyword">IN</span> (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>);</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">&gt;</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">AND</span> key1 <span class="operator">&lt;</span> <span class="string">&#x27;b&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033065.png" alt="image-20220813182743852"></p>
<p><strong>9ï¸âƒ£index</strong></p>
<p>å½“æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>ç´¢å¼•è¦†ç›–</strong>ï¼Œä½†æ˜¯éœ€è¦æ‰«æçš„å…¨éƒ¨çš„ç´¢å¼•è®°å½•æ—¶ï¼Œè¯¥è¡¨çš„è®¿é—®æ–¹å¼å°±æ˜¯ <code>index</code>ã€‚ç´¢å¼•è¦†ç›–åé¢æ–‡ç« ä»‹ç»ä¼˜åŒ–å™¨æ—¶ä¼šè¯¦ç»†ä»‹ç»ï¼Œä¸ºäº†ä¾¿äºå¤§å®¶ç†è§£ï¼Œå…ˆç®€å•ä»‹ç»å¦‚ä¸‹ã€‚æ¯”å¦‚ä¸‹é¢ sql è¯­å¥ä¸­ï¼Œkey_part2 ï¼Œkey_part2 éƒ½å±äºè”åˆç´¢å¼• <code>idx_key_part(key_part1, key_part2, key_part3)</code> çš„ä¸€éƒ¨åˆ†ï¼Œ&#x3D;&#x3D;åœ¨æŸ¥æ‰¾æ•°æ®æ—¶å¯ä»¥ç”¨ä¸Šè¿™ä¸ªè”åˆç´¢å¼•ï¼Œè€Œä¸ç”¨è¿›è¡Œå›è¡¨æ“ä½œ&#x3D;&#x3D;ï¼Œè¿™ç§æƒ…å†µå³&#x3D;&#x3D;ç´¢å¼•è¦†ç›–&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> key_part2 <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key_part2 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033505.png" alt="image-20220813183057913"></p>
<p><strong>1ï¸âƒ£0ï¸âƒ£ALL</strong></p>
<p>æœ€ç†Ÿæ‚‰çš„å…¨è¡¨æ‰«æ <code>ALL</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033592.png" alt="image-20220813183153914"></p>
<blockquote>
<p>â¤æ¸©é¦¨æç¤ºï¼šè¿™é‡Œå¾ˆå¤šå°ä¼™ä¼´ä¼šè§‰å¾—è®°ä¸ä½ï¼Œå…¶å®æ‚¨å¯ä»¥æ”¶è—è¿™ç¯‡åšå®¢ï¼Œæ‰§è¡Œ EXPLAIN æ—¶å¯¹åº”ç»“æœï¼Œåå‘æŸ¥æ‰¾åšæ–‡å¯¹åº”å†…å®¹ï¼Œæ¯•ç«Ÿå’±ä»¬åªéœ€è¦èƒ½å¤Ÿè¯»æ‡‚æ€§èƒ½åˆ†æçš„ç»“æœ</p>
</blockquote>
<p><strong>å°ç»“</strong></p>
<p>ç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡æ˜¯ï¼š <font color=green>system &gt; const &gt; eq_ref &gt; ref </font>&gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; <font color=green>range &gt; index &gt; ALL</font> å…¶ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæå–å‡ºæ¥ï¼ˆè§ç»¿è‰²éƒ¨åˆ†ï¼‰</p>
<p>SQL æ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡ï¼š&#x3D;&#x3D;è‡³å°‘è¦è¾¾åˆ° range çº§åˆ«ï¼Œè¦æ±‚æ˜¯ ref çº§åˆ«ï¼Œæœ€å¥½æ˜¯ consts çº§åˆ«&#x3D;&#x3D;ï¼ˆé˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œè¦æ±‚ï¼‰</p>
<h3 id="6-4-6-possible-keys-å’Œ-key"><a href="#6-4-6-possible-keys-å’Œ-key" class="headerlink" title="6.4.6 possible_keys å’Œ key"></a>6.4.6 possible_keys å’Œ key</h3><p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150102167.png" alt="image-20220813225540107"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">&gt;</span> <span class="string">&#x27;z&#x27;</span> <span class="keyword">AND</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033297.png" alt="image-20220813225634984"></p>
<p>å¯¹åº”ä¼˜åŒ–å™¨æ¥è¯´ï¼Œå¯ä»¥é€‰æ‹©çš„ <code>possible_keys</code> è¶Šå°‘è¶Šå¥½ï¼Œå› ä¸ºé€‰é¡¹è¶Šå¤šï¼Œè¿›è¡Œè¿‡æ»¤èŠ±çš„æ—¶é—´ä¹Ÿå°±å¯¹åº”æ›´å¤šã€‚å¦å¤–ï¼Œä¼˜åŒ–å™¨ä¼šå¯¹å„ä¸ªç´¢å¼•è¿›è¡ŒæŸ¥è¯¢çš„æ•ˆç‡è¿›è¡Œè¯„ä¼°ï¼Œä»¥æ­¤æ¥é€‰æ‹©å®é™…ä½¿ç”¨çš„ <code>key</code>ã€‚è€Œä¸”ç”±äºä¼˜åŒ–å™¨ä¼šå¯¹ sql è¿›è¡Œä¼˜åŒ–ï¼Œå®Œå…¨å¯èƒ½ä¼šå‡ºç° <code>possible_keys</code> æ˜¯ nullï¼Œä½†æ˜¯ <code>key</code> ä¸ä¸º null çš„æƒ…å†µ</p>
<h3 id="6-4-7-key-len-â˜†"><a href="#6-4-7-key-len-â˜†" class="headerlink" title="6.4.7 key_len â˜†"></a>6.4.7 key_len â˜†</h3><p>å®é™…ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚å¯ä»¥å¸®åŠ©ä½ æ£€æŸ¥æ˜¯å¦å……åˆ†åˆ©ç”¨äº†ç´¢å¼•ï¼Œä¸»è¦é’ˆå¯¹&#x3D;&#x3D;è”åˆç´¢å¼•&#x3D;&#x3D;å…·æœ‰ä¸€å®šçš„å‚è€ƒï¼Œå¯¹åŒä¸€ç´¢å¼•æ¥è¯´ï¼Œkey_len å€¼è¶Šå¤§è¶Šå¥½ï¼ˆä¸è‡ªå·±æ¯”è¾ƒï¼Œåé¢å°†è§£é‡Šï¼‰ã€‚</p>
<p><font color=blue>â‘  ä¸‹é¢SQLæ‰§è¡Œç»“æœæ˜¯ 4ï¼Œè¿™ä¸ªç»“æœæ€ä¹ˆç®—å‡ºæ¥çš„å‘¢ï¼Ÿ</font></p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033607.png" alt="image-20220813230641143"></p>
<p>è¿™æ˜¯å› ä¸ºä½¿ç”¨çš„æ˜¯ä¸»é”® id ä½œä¸ºç´¢å¼•ï¼Œå…¶ç±»å‹æ˜¯ intï¼Œå  4 ä¸ªå­—èŠ‚</p>
<p><font color=blue>â‘¡ å†æ¥çŒœçŒœä¸‹é¢çš„ key_len æ˜¯å¤šå°‘~</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key2 <span class="operator">=</span> <span class="number">10126</span>;</span><br></pre></td></tr></table></figure>

<p>ä»€ä¹ˆï¼Ÿä½ çŒœçš„æ˜¯ 4ï¼Œè€Œç­”æ¡ˆæ˜¯ 5~</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033407.png" alt="image-20220813230839120"></p>
<p>è¿™æ˜¯å› ä¸ºè™½ç„¶ key2 ä¹Ÿæ˜¯ int ç±»å‹ï¼Œä½†æ˜¯å®ƒè¢« unique ä¿®é¥°ï¼Œå¹¶æ²¡æœ‰æ ‡è¯†éç©ºï¼ˆè€Œä¸»é”®éƒ½æ˜¯éç©ºçš„ï¼‰ï¼Œå› æ­¤åŠ ä¸Šç©ºå€¼æ ‡è®°ï¼Œä¸€å…±æ˜¯5å­—èŠ‚</p>
<p><font color=blue>â‘¢ å­—ç¬¦ç±»å‹çš„ç´¢å¼•é•¿åº¦ä¸ºå¤šå°‘å‘¢</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033945.png" alt="image-20220813231154852"></p>
<p>ç­”æ¡ˆæ˜¯ 303ï¼Œå› ä¸ºç±»å‹æ˜¯ varchar(100)ï¼Œ100 ä¸ªå­—ç¬¦ï¼Œutf-8 æ¯ä¸ªå­—ç¬¦å  3 ä¸ªå­—èŠ‚ï¼Œå…± 300 ä¸ªå­—èŠ‚ï¼ŒåŠ ä¸Šå˜é•¿åˆ—è¡¨ 2 ä¸ªå­—èŠ‚ä¸ä¸€ä¸ªç©ºå€¼æ ‡è¯†å ä¸€ä¸ªå­—èŠ‚ï¼Œå…± 303 å­—èŠ‚ã€‚</p>
<p><font color=blue>â‘£ çœ‹çœ‹è”åˆç´¢å¼•çš„æƒ…å†µ</font></p>
<ul>
<li>çœ‹ä¸‹é¢çš„è”åˆç´¢å¼•ï¼Œkey_lenè¿˜æ˜¯303ï¼Œä¸éœ€è¦è§£é‡Šäº†å§</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key_part1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033471.png" alt="image-20220813231414814"></p>
<ul>
<li>å†çœ‹çœ‹ä¸‹é¢è¿™ä¸ªè”åˆç´¢å¼•ï¼Œå…¶ç»“æœæ˜¯ 606</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key_part1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">AND</span> key_part2 <span class="operator">=</span> <span class="string">&#x27;b&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033975.png" alt="image-20220813231505907"></p>
<p>&#x3D;&#x3D;è¿™ä¸ªæŸ¥è¯¢çš„ key-len æ¯”ä¸Šé¢çš„æŸ¥è¯¢å¤§ï¼Œæ€§èƒ½å°±æ¯”ä¸Šé¢çš„å¥½&#x3D;&#x3D;ï¼Œæ€ä¹ˆç†è§£å‘¢ï¼Ÿå…¶å®åªè¦ä½ çœ‹è¿‡æˆ‘ä¹‹å‰ä»‹ç»B+æ ‘çš„æ–‡ç« å°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚å› ä¸ºåœ¨ç›®å½•é¡µæˆ‘é™¤äº†è€ƒè™‘ <code>key_part1</code> ï¼Œè¿˜ä¼šè€ƒè™‘ <code>key_part2</code>ï¼Œå®šä½åˆ°çš„æ•°æ®å°±æ›´åŠ ç²¾å‡†ï¼ŒèŒƒå›´æ›´å°ï¼Œéœ€è¦åŠ è½½ I&#x2F;O çš„æ•°æ®é¡µæ•°é‡å°±ä¼šæ›´å°‘ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯æ€§èƒ½å°±æ¯”è¾ƒå¥½å•Š~</p>
<ul>
<li>çŒœçŒœä¸‹é¢çš„ sql æ‰§è¡Œå key_len æ˜¯å¤šå°‘</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key_part3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033287.png" alt="image-20220813231734678"></p>
<p>æ˜¯ç©ºå“¦ï¼Œå› ä¸ºéƒ½ä¸ä¼šä½¿ç”¨åˆ°ç´¢å¼•ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¸€ç›´åœ¨æçš„<strong>æœ€å·¦å‰ç¼€åŸåˆ™</strong>ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»çš„ã€‚</p>
<p><strong><font color=blue>ğŸ“šç»ƒä¹ ï¼škey_lençš„é•¿åº¦è®¡ç®—å…¬å¼ï¼š</font></strong></p>
<ul>
<li>varchar(10)å˜é•¿å­—æ®µä¸”å…è®¸NULL &#x3D; <code>10 *( character setï¼šutf8=3, gbk=2, latin1=1) + 1(NULL)+2(å˜é•¿å­—æ®µ)</code></li>
<li>varchar(10)å˜é•¿å­—æ®µä¸”ä¸å…è®¸NULL &#x3D; <code>10* ( character setï¼šutf8=3 ,gbk=2, latin1=1) +2(å˜é•¿å­—æ®µ)</code></li>
<li>char(10)å›ºå®šå­—æ®µä¸”å…è®¸NULL &#x3D; <code>10 *( character setï¼šutf8=3, gbk=2, latin1=1) +1(NULL)</code></li>
<li>char(10)å›ºå®šå­—æ®µä¸”ä¸å…è®¸NULL &#x3D; <code>10* ( character setï¼šutf8=3,gbk=2,latin1=1)</code></li>
</ul>
<h3 id="6-4-8-ref"><a href="#6-4-8-ref" class="headerlink" title="6.4.8 ref"></a>6.4.8 ref</h3><p>å½“ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œä¸ç´¢å¼•åˆ—åŒ¹é…çš„å¯¹è±¡ä¿¡æ¯ã€‚</p>
<p><font color=blue>â‘  æ¯”å¦‚åªæ˜¯ä¸€ä¸ªå¸¸æ•°æˆ–è€…æ˜¯æŸä¸ªåˆ—ï¼Œå…¶ <code>ref</code> æ˜¯ <code>const</code></font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033417.png" alt="image-20220814103925203"></p>
<p><font color=blue>â‘¡ å½“è¿›è¡Œå¤šè¡¨è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå¯¹è¢«é©±åŠ¨è¡¨s2æ‰§è¡Œçš„æŸ¥è¯¢å¼•ç”¨äº†atguigudb1.s1.idå­—æ®µè¿›è¡Œç­‰å€¼æŸ¥è¯¢</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.id <span class="operator">=</span> s2.id;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033329.png" alt="image-20220814104029459"></p>
<p><font color=blue>â‘¢ å½“è¿æ¥æ¡ä»¶ä½¿ç”¨å‡½æ•°æ—¶ï¼Œå…¶ <code>ref</code> å°±æ˜¯ <code>func</code></font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s2.key1 <span class="operator">=</span> <span class="built_in">UPPER</span>(s1.key1);</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033857.png" alt="image-20220814104217790"></p>
<h3 id="6-4-9-rows-â˜†"><a href="#6-4-9-rows-â˜†" class="headerlink" title="6.4.9 rows â˜†"></a>6.4.9 rows â˜†</h3><p><font color=blue>â‘  é¢„ä¼°çš„éœ€è¦è¯»å–çš„è®°å½•æ¡ç›®æ•°ï¼Œæ¡ç›®æ•°è¶Šå°è¶Šå¥½ã€‚è¿™æ˜¯å› ä¸ºå€¼è¶Šå°ï¼ŒåŠ è½½I&#x2F;Oçš„é¡µæ•°å°±è¶Šå°‘~</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">&gt;</span> <span class="string">&#x27;z&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033295.png" alt="image-20220814104350297"></p>
<h3 id="6-4-10-filtered"><a href="#6-4-10-filtered" class="headerlink" title="6.4.10 filtered"></a>6.4.10 filtered</h3><p>&#x3D;&#x3D;ç»è¿‡æœç´¢æ¡ä»¶åè¿‡æ»¤å‰©ä¸‹çš„è®°å½•æ‰€å çš„ç™¾åˆ†æ¯”&#x3D;&#x3D;ã€‚&#x3D;&#x3D;ç™¾åˆ†æ¯”è¶Šé«˜è¶Šå¥½&#x3D;&#x3D;ï¼Œæ¯”å¦‚åŒæ · rows æ˜¯ 40ï¼Œå¦‚æœ filter æ˜¯ 100ï¼Œåˆ™æ˜¯ä» 40 æ¡è®°å½•é‡Œè¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœ filter æ˜¯ 10ï¼Œåˆ™æ˜¯ä» 400 æ¡è®°å½•é‡Œè¿›è¡ŒæŸ¥æ‰¾ï¼Œç›¸æ¯”è¾ƒè€Œè¨€å½“ç„¶æ˜¯å‰è€…çš„æ•ˆç‡æ›´é«˜å“¦ã€‚</p>
<p><font color=blue>â‘  å¦‚æœæ‰§è¡Œçš„æ˜¯å•è¡¨æ‰«æï¼Œé‚£ä¹ˆè®¡ç®—æ—¶éœ€è¦ä¼°è®¡é™¤äº†å¯¹åº”æœç´¢æ¡ä»¶å¤–çš„å…¶ä»–æœç´¢æ¡ä»¶æ»¡è¶³çš„è®°å½•æœ‰å¤šå°‘æ¡</font> æ™•äº†å°±çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">&gt;</span> <span class="string">&#x27;z&#x27;</span> <span class="keyword">AND</span> common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>ç»“æœæ˜¯ 10ï¼Œè¡¨ç¤ºæœ‰ 347 æ¡è®°å½•æ»¡è¶³ key1 &gt; â€˜zâ€™ çš„æ¡ä»¶ï¼Œè¿™ 347 æ¡è®°å½•çš„ 10% æ»¡è¶³ common_field &#x3D; â€˜aâ€™ æ¡ä»¶ã€‚</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033280.png" alt="image-20220814104530103"></p>
<p><font color=blue>â‘¡ å®é™…ä¸Šï¼Œå¯¹äºå•è¡¨æŸ¥è¯¢ï¼Œè¿™ä¸ªå­—æ®µæ²¡æœ‰å¤ªå¤§çš„æ„ä¹‰ï¼Œæˆ‘ä»¬æ›´åŠ å…³æ³¨è¿æ¥æŸ¥è¯¢æ—¶çš„ filtered å€¼ï¼Œå®ƒå†³å®šäº†è¢«é©±åŠ¨è¡¨è¦æ‰§è¡Œçš„æ¬¡æ•°ã€‚</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key1 <span class="keyword">WHERE</span></span><br><span class="line">s1.common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>ç»“æœå¦‚ä¸‹ã€‚åœ¨æ ‡æ˜é©±åŠ¨è¡¨ s1 æä¾›ç»™è¢«é©±åŠ¨è¡¨çš„è®°å½•æ•°æ˜¯ 9895 æ¡ï¼Œå…¶ä¸­ 989.5 æ¡æ»¡è¶³è¿‡æ»¤æ¡ä»¶s1.key1 &#x3D; s2.key1ï¼Œé‚£ä¹ˆè¢«é©±åŠ¨è¡¨éœ€è¦æ‰§è¡Œ 990 æ¬¡æŸ¥è¯¢ã€‚</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033425.png" alt="image-20220814104852338"></p>
<blockquote>
<p>filtered&#x3D;(æœ€ç»ˆæŸ¥è¯¢ç»“æœ&#x2F;rowsåˆ—æ•°æ®)*100%ï¼Œè¶Šå¤§è¡¨ç¤ºè¿‡æ»¤åçš„æ•°æ®ï¼Œè¶Šæ˜¯æœ€ç»ˆç»“æœã€‚<br>ç›¸æ¯”è¾ƒfilteredè¶Šå°ï¼Œå‡å°‘äº†æ•°æ®å†æ¬¡è¿‡æ»¤çš„æ€§èƒ½</p>
</blockquote>
<h3 id="6-4-11-Extra-â˜†"><a href="#6-4-11-Extra-â˜†" class="headerlink" title="6.4.11 Extra â˜†"></a>6.4.11 Extra â˜†</h3><p>é¡¾åæ€ä¹‰ï¼Œ<code>Extra </code>åˆ—æ˜¯ç”¨æ¥è¯´æ˜ä¸€äº›é¢å¤–ä¿¡æ¯çš„ï¼ŒåŒ…å«ä¸é€‚åˆåœ¨å…¶ä»–åˆ—ä¸­æ˜¾ç¤ºä½†ååˆ†é‡è¦çš„é¢å¤–ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›é¢å¤–ä¿¡æ¯æ¥<code>æ›´å‡†ç¡®çš„ç†è§£MySQLåˆ°åº•å°†å¦‚ä½•æ‰§è¡Œç»™å®šçš„æŸ¥è¯¢è¯­å¥</code>ã€‚MySQLæä¾›çš„é¢å¤–ä¿¡æ¯æœ‰å¥½å‡ åä¸ªï¼Œæˆ‘ä»¬å°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæŒ‘æ¯”è¾ƒé‡è¦çš„é¢å¤–ä¿¡æ¯ä»‹ç»ç»™å¤§å®¶ã€‚</p>
<p><font color=blue>â‘  <code>No tables used</code></font></p>
<p>å½“æŸ¥è¯¢è¯­å¥çš„æ²¡æœ‰<code>FROM</code>å­å¥æ—¶å°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033055.png" alt="image-20220814111715918"></p>
<p><font color=blue>â‘¡ <code>Impossible WHERE</code></font></p>
<p>å½“æŸ¥è¯¢æ¡ä»¶æ°¸è¿œä¸å¯èƒ½æ»¡è¶³ï¼ŒæŸ¥ä¸åˆ°æ•°æ®æ—¶ä¼šå‡ºç°è¯¥ä¿¡æ¯ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">!=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033040.png" alt="image-20220814111830017"></p>
<p><font color=blue>â‘¢ <code>Using where</code></font></p>
<ul>
<li>å½“æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œæ™®é€šçš„ where æŸ¥è¯¢æ—¶ï¼Œä¼šå‡ºç°è¯¥ä¿¡æ¯</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150033056.png" alt="image-20220814111940959"></p>
<ul>
<li>ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ï¼Œåˆ™é»˜é»˜ä½¿ç”¨ç´¢å¼•ï¼Œä»€ä¹ˆé¢å¤–ä¿¡æ¯ä¹Ÿæ²¡æœ‰ã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034481.png" alt="image-20220814112044015"></p>
<ul>
<li>ç´¢å¼•åŠ æ™®é€š whereï¼Œé‚£è¿˜æ˜¯ using where</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">AND</span> common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034568.png" alt="image-20220814112128725"></p>
<p><font color=blue>â‘£ <code>No matching min/max row</code></font></p>
<p>å½“æŸ¥è¯¢è¯­å¥ä¸­æœ‰ MINã€MAX ç­‰èšåˆå‡½æ•°ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç¬¦åˆ where æ¡ä»¶çš„æœç´¢è®°å½•æ—¶ï¼Œä¼šæä¾›é¢å¤–ä¿¡æ¯ <code>No matching min/max row</code>ï¼ˆè¡¨ä¸­æ ¹æœ¬æ²¡æœ‰æ»¡è¶³ where æ¡ä»¶çš„å­—å¥ï¼Œæ‰¾ minã€max æ²¡æœ‰æ„ä¹‰ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(key1) <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;abcdefg&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034576.png" alt="image-20220814112312678"></p>
<p><font color=blue>â‘¤ <code>Select tables optimized away</code></font></p>
<p>å½“æŸ¥è¯¢è¯­å¥ä¸­æœ‰ MINã€MAX ç­‰èšåˆå‡½æ•°ï¼Œæœ‰ç¬¦åˆ where æ¡ä»¶çš„æœç´¢è®°å½•æ—¶</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(key1) <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;oCUPss&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034143.png" alt="image-20220814112508271"></p>
<p><font color=blue>â‘¥ <code>Using index</code> </font></p>
<p>åœ¨ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æƒ…å†µæç¤ºã€‚æ‰€è°“è¦†ç›–ç´¢å¼•ï¼Œå°±æ˜¯&#x3D;&#x3D;ç´¢å¼•ä¸­è¦†ç›–äº†éœ€è¦æŸ¥è¯¢çš„æ‰€æœ‰å­—æ®µï¼Œä¸éœ€è¦å†ä½¿ç”¨èšç°‡ç´¢å¼•è¿›è¡Œå›è¡¨æŸ¥æ‰¾&#x3D;&#x3D;ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œä½¿ç”¨ key1 ä½œä¸ºæŸ¥æ‰¾æ¡ä»¶ï¼Œè¯¥å­—æ®µå»ºç«‹äº†ç´¢å¼•ï¼ŒB+ æ ‘å¯ä»¥æŸ¥æ‰¾åˆ° key1 å­—æ®µå’Œä¸»é”®ï¼Œå› æ­¤ä¸‹é¢åªæŸ¥æ‰¾ key1 å­—æ®µå°±ä¸ç”¨è¿›è¡Œå›è¡¨æ“ä½œï¼Œè¿™æ˜¯éå¸¸æ£’çš„æƒ…å†µã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> key1 <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034753.png" alt="image-20220814112621332"></p>
<p><font color=blue>â‘¦ <code>Using index condition</code></font></p>
<p>æœç´¢åˆ—ä¸­è™½ç„¶å‡ºç°äº†ç´¢å¼•åˆ—ï¼Œä½†æ˜¯ä¸èƒ½å¤Ÿä½¿ç”¨ç´¢å¼•ï¼Œè¿™ç§æƒ…å†µæ˜¯æ¯”è¾ƒå‘çš„~</p>
<p>æ¯”å¦‚ä¸‹é¢çš„æŸ¥è¯¢&#x3D;&#x3D;è™½ç„¶å‡ºç°äº†ç´¢å¼•åˆ—ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦è¿›è¡Œå›è¡¨æŸ¥æ‰¾&#x3D;&#x3D;ï¼Œå›è¡¨æ“ä½œæ˜¯ä¸€ä¸ªéšæœº I&#x2F;Oï¼Œæ¯”è¾ƒè€—æ—¶ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">&gt;</span> <span class="string">&#x27;z&#x27;</span> <span class="keyword">AND</span> key1 <span class="keyword">LIKE</span> <span class="string">&#x27;%a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034072.png" alt="image-20220814114314395"></p>
<p>ä¸Šé¢è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨<font color=red><strong>ç´¢å¼•ä¸‹æ¨</strong></font>(å¯ä»¥é€šè¿‡é…ç½®é¡¹è¿›è¡Œé…ç½®)ï¼Œ&#x3D;&#x3D;ä½¿æˆ‘ä»¬ä½¿ç”¨ WHERE key1 &gt; â€˜zâ€™ å¾—åˆ°çš„ç»“æœå…ˆè¿›è¡Œæ¨¡ç³ŠåŒ¹é… key1 LIKE â€˜%aâ€™ï¼Œç„¶åå†å»å›è¡¨&#x3D;&#x3D;ï¼Œå°±å¯ä»¥å‡å°‘å›è¡¨çš„æ¬¡æ•°äº†ã€‚</p>
<p><font color=blue>â‘§ <code>Using join buffer</code></font></p>
<p>åœ¨è¿æ¥æŸ¥è¯¢ä¸­ï¼Œå½“è¢«é©±åŠ¨è¡¨ä¸èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨ç´¢å¼•å®ç°æå‡é€Ÿåº¦ï¼Œæ•°æ®åº“å°±ä½¿ç”¨ç¼“å­˜æ¥å°½å¯èƒ½æå‡ä¸€äº›æ€§èƒ½ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.common_field <span class="operator">=</span> s2.common_field;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034057.png" alt="image-20220814115201430"></p>
<p><font color=blue>â‘¨ <code>Not exists</code></font></p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨å·¦ï¼ˆå¤–ï¼‰è¿æ¥æ—¶ï¼Œå¦‚æœ<code>WHERE</code>å­å¥ä¸­åŒ…å«è¦æ±‚è¢«é©±åŠ¨è¡¨çš„æŸä¸ªåˆ—ç­‰äº<code>NULL</code>å€¼çš„æœç´¢æ¡ä»¶ï¼Œè€Œä¸”é‚£ä¸ªåˆ—åˆæ˜¯ä¸å…è®¸å­˜å‚¨<code>NULL</code>å€¼çš„ï¼Œé‚£ä¹ˆåœ¨è¯¥è¡¨çš„æ‰§è¡Œè®¡åˆ’çš„Extraåˆ—å°±ä¼šæç¤º<code>Not exists</code>é¢å¤–ä¿¡æ¯</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key1 <span class="keyword">WHERE</span> s2.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034447.png" alt="image-20220814115302073"></p>
<p><font color=blue>â‘© <code>Using intersect(â€¦) ã€ Using union(â€¦) å’Œ Using sort_union(â€¦)</code> </font></p>
<ul>
<li><p>å¦‚æœæ‰§è¡Œè®¡åˆ’çš„<code>Extra</code>åˆ—å‡ºç°äº†<code>Using intersect(...)</code>æç¤ºï¼Œè¯´æ˜å‡†å¤‡ä½¿ç”¨<code>Intersect</code>ç´¢å¼• åˆå¹¶çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ï¼Œæ‹¬å·ä¸­çš„<code>...</code>è¡¨ç¤ºéœ€è¦è¿›è¡Œç´¢å¼•åˆå¹¶çš„ç´¢å¼•åç§°ï¼›</p>
</li>
<li><p>å¦‚æœå‡ºç°äº†<code>Using union(...)</code>æç¤ºï¼Œè¯´æ˜å‡†å¤‡ä½¿ç”¨<code>Union</code>ç´¢å¼•åˆå¹¶çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ï¼›</p>
</li>
<li><p>å¦‚æœå‡ºç°äº†<code>Using sort_union(...)</code>æç¤ºï¼Œè¯´æ˜å‡†å¤‡ä½¿ç”¨<code>Sort-Union</code>ç´¢å¼•åˆå¹¶çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> key1 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">OR</span> key3 <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034777.png" alt="image-20220814115726815"></p>
<p><font color=blue>â‘ª <code>Zero limit</code></font></p>
<p>å½“æˆ‘ä»¬çš„<code>LIMIT</code>å­å¥çš„å‚æ•°ä¸º<code>0</code>æ—¶ï¼Œè¡¨ç¤ºå‹æ ¹å„¿ä¸æ‰“ç®—ä»è¡¨ä¸­è¯»å‡ºä»»ä½•è®°å½•ï¼Œå°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM s1 LIMIT 0;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034392.png" alt="image-20220814115904221"></p>
<p><font color=blue>â‘« <code>Using filesort</code></font></p>
<p>å¾ˆå¤šæƒ…å†µä¸‹æ’åºæ“ä½œæ— æ³•ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œåªèƒ½åœ¨å†…å­˜ä¸­ï¼ˆè®°å½•è¾ƒå°‘çš„æ—¶å€™ï¼‰æˆ–è€…ç£ç›˜ä¸­ï¼ˆè®°å½•è¾ƒå¤šçš„æ—¶å€™ï¼‰è¿›è¡Œæ’åºï¼ŒMySQLæŠŠè¿™ç§åœ¨å†…å­˜ä¸­æˆ–è€…ç£ç›˜ä¸Šè¿›è¡Œæ’åºçš„æ–¹å¼ç»Ÿç§°ä¸º**<font color=red>æ–‡ä»¶æ’åº</font>**ï¼ˆè‹±æ–‡åï¼š<code>filesort</code>ï¼‰ã€‚è¿™ç§æƒ…å†µæ—¶æ¯”è¾ƒæ‚²å£®çš„~</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">ORDER</span> <span class="keyword">BY</span> common_field LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034961.png" alt="image-20220814120453672"></p>
<p><font color=blue>â‘¬ <code>Using temporary</code></font></p>
<p>åœ¨è®¸å¤šæŸ¥è¯¢çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒMySQLå¯èƒ½ä¼šå€ŸåŠ©ä¸´æ—¶è¡¨æ¥å®Œæˆä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚&#x3D;&#x3D;å»é‡ã€æ’åº&#x3D;&#x3D;ä¹‹ç±»çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨æ‰§è¡Œè®¸å¤šåŒ…å«<code>DISTINCT</code>ã€<code>GROUP BY</code>ã€<code>UNION</code>ç­‰å­å¥çš„æŸ¥è¯¢è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸èƒ½æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•æ¥å®ŒæˆæŸ¥è¯¢ï¼ŒMySQLå¾ˆæœ‰å¯èƒ½å¯»æ±‚é€šè¿‡å»ºç«‹å†…éƒ¨çš„ä¸´æ—¶è¡¨æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚å¦‚æœæŸ¥è¯¢ä¸­ä½¿ç”¨åˆ°äº†å†…éƒ¨çš„ä¸´æ—¶è¡¨ï¼Œåœ¨æ‰§è¡Œè®¡åˆ’çš„<code>Extra</code>åˆ—å°†ä¼šæ˜¾ç¤º<code>Using temporary</code>æç¤º</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> common_field <span class="keyword">FROM</span> s1;</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> common_field, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> amount <span class="keyword">FROM</span> s1 <span class="keyword">GROUP</span> <span class="keyword">BY</span> common_field;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034987.png" alt="image-20220814121232140"></p>
<p>æ‰§è¡Œè®¡åˆ’ä¸­å‡ºç°<code>Using temporary</code>å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„å¾å…†ï¼Œå› ä¸ºå»ºç«‹ä¸ç»´æŠ¤ä¸´æ—¶è¡¨è¦ä»˜å‡ºå¾ˆå¤§æˆæœ¬çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬<code>æœ€å¥½èƒ½ä½¿ç”¨ç´¢å¼•æ¥æ›¿ä»£æ‰ä½¿ç”¨ä¸´æ—¶è¡¨</code>ã€‚æ¯”å¦‚ï¼šæ‰«ææŒ‡å®šçš„ç´¢å¼•idx_key1å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT key1, COUNT(*) AS amount FROM s1 GROUP BY key1;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034664.png" alt="image-20220814121019942"></p>
<h3 id="6-4-12-å°ç»“"><a href="#6-4-12-å°ç»“" class="headerlink" title="6.4.12 å°ç»“"></a>6.4.12 å°ç»“</h3><ul>
<li>EXPLAINä¸è€ƒè™‘å„ç§Cacheï¼Œåªè€ƒè™‘SQLæœ¬èº«</li>
<li>EXPLAINä¸èƒ½æ˜¾ç¤ºMySQLåœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶æ‰€ä½œçš„ä¼˜åŒ–å·¥ä½œ</li>
<li>EXPLAINä¸ä¼šå‘Šè¯‰ä½ å…³äºè§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„ä¿¡æ¯æˆ–ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å¯¹æŸ¥è¯¢çš„å½±å“æƒ…å†µéƒ¨åˆ†ç»Ÿè®¡</li>
<li>ä¿¡æ¯æ˜¯ä¼°ç®—çš„ï¼Œå¹¶éç²¾ç¡®å€¼</li>
</ul>
<h1 id="7-EXPLAIN-çš„è¿›ä¸€æ­¥ä½¿ç”¨"><a href="#7-EXPLAIN-çš„è¿›ä¸€æ­¥ä½¿ç”¨" class="headerlink" title="7. EXPLAIN çš„è¿›ä¸€æ­¥ä½¿ç”¨"></a>7. EXPLAIN çš„è¿›ä¸€æ­¥ä½¿ç”¨</h1><h2 id="7-1-EXPLAIN-å››ç§è¾“å‡ºæ ¼å¼"><a href="#7-1-EXPLAIN-å››ç§è¾“å‡ºæ ¼å¼" class="headerlink" title="7.1 EXPLAIN å››ç§è¾“å‡ºæ ¼å¼"></a>7.1 EXPLAIN å››ç§è¾“å‡ºæ ¼å¼</h2><p>è¿™é‡Œè°ˆè°ˆEXPLAINçš„è¾“å‡ºæ ¼å¼ã€‚EXPLAINå¯ä»¥è¾“å‡ºå››ç§æ ¼å¼ï¼š &#x3D;&#x3D;ä¼ ç»Ÿæ ¼å¼ ï¼ŒJSONæ ¼å¼ï¼Œ TREEæ ¼å¼ ä»¥åŠ å¯è§†åŒ–è¾“å‡º&#x3D;&#x3D;ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©é€‚ç”¨äºè‡ªå·±çš„æ ¼å¼ã€‚</p>
<h3 id="7-1-1-ä¼ ç»Ÿæ ¼å¼"><a href="#7-1-1-ä¼ ç»Ÿæ ¼å¼" class="headerlink" title="7.1.1 ä¼ ç»Ÿæ ¼å¼"></a>7.1.1 ä¼ ç»Ÿæ ¼å¼</h3><p>ä¼ ç»Ÿæ ¼å¼ç®€å•æ˜äº†ï¼Œè¾“å‡ºæ˜¯ä¸€ä¸ªè¡¨æ ¼å½¢å¼ï¼Œæ¦‚è¦è¯´æ˜æŸ¥è¯¢è®¡åˆ’ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key2 <span class="keyword">WHERE</span> s1.common_field <span class="operator">=</span><span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034257.png" alt="image-20220814131829731"></p>
<h3 id="7-1-2-JSON-æ ¼å¼"><a href="#7-1-2-JSON-æ ¼å¼" class="headerlink" title="7.1.2 JSON æ ¼å¼"></a>7.1.2 JSON æ ¼å¼</h3><p>ç¬¬1ç§æ ¼å¼ä¸­ä»‹ç»çš„<code>EXPLAIN</code>è¯­å¥è¾“å‡ºä¸­ç¼ºå°‘äº†ä¸€ä¸ªè¡¡é‡æ‰§è¡Œè®¡åˆ’å¥½åçš„é‡è¦å±æ€§â€“æˆæœ¬ã€‚ è€ŒJSONæ ¼å¼æ˜¯å››ç§æ ¼å¼é‡Œé¢è¾“å‡º&#x3D;&#x3D;ä¿¡æ¯æœ€è¯¦å°½&#x3D;&#x3D;çš„æ ¼å¼ï¼Œé‡Œé¢åŒ…å«äº†æ‰§è¡Œçš„æˆæœ¬ä¿¡æ¯ã€‚</p>
<p><strong><font color=red>JSONæ ¼å¼ï¼šåœ¨EXPLAINå•è¯å’ŒçœŸæ­£çš„æŸ¥è¯¢è¯­å¥ä¸­é—´åŠ ä¸Š<code>FORMAT=JSON</code> </font></strong></p>
<p>ä¼ ç»Ÿæ ¼å¼ä¸jsonæ ¼å¼çš„å„ä¸ªå­—æ®µå­˜åœ¨å¦‚ä¸‹è¡¨æ‰€ç¤ºçš„å¯¹åº”å…³ç³»(mysql5.7å®˜æ–¹æ–‡æ¡£)ã€‚<br><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034616.png" alt="image-20220814122734392"></p>
<p>æ¡ˆä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN FORMAT<span class="operator">=</span>JSON <span class="keyword">SELECT</span> s1.key1, s2.key1 <span class="keyword">FROM</span> s1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key1 <span class="keyword">WHERE</span> s2.common_field <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>ç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ° json æ ¼å¼çš„ä¿¡æ¯é‡ä¼šæ›´åŠ ä¸°å¯Œã€‚å°¤å…¶æ˜¯&#x3D;&#x3D;æˆæœ¬ä¿¡æ¯&#x3D;&#x3D;ï¼Œæ˜¯ç”¨äºè¡¡é‡ä¸€ä¸ªæ‰§è¡Œè®¡åˆ’çš„å¥½åçš„é‡è¦æŒ‡æ ‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN FORMAT=JSON SELECT * FROM s1 INNER JOIN s2 ON s1.key1 = s2.key2 WHERE s1.common_field =&#x27;a&#x27;\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">EXPLAIN: &#123;</span><br><span class="line">  &quot;query_block&quot;: &#123;</span><br><span class="line">    &quot;select_id&quot;: 1,</span><br><span class="line">    &quot;cost_info&quot;: &#123;</span><br><span class="line">      &quot;query_cost&quot;: &quot;1360.07&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;nested_loop&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;table&quot;: &#123;</span><br><span class="line">          &quot;table_name&quot;: &quot;s1&quot;,</span><br><span class="line">          &quot;access_type&quot;: &quot;ALL&quot;,</span><br><span class="line">          &quot;possible_keys&quot;: [</span><br><span class="line">            &quot;idx_key1&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;rows_examined_per_scan&quot;: 9895,</span><br><span class="line">          &quot;rows_produced_per_join&quot;: 989,</span><br><span class="line">          &quot;filtered&quot;: &quot;10.00&quot;,</span><br><span class="line">          &quot;cost_info&quot;: &#123;</span><br><span class="line">            &quot;read_cost&quot;: &quot;914.80&quot;,</span><br><span class="line">            &quot;eval_cost&quot;: &quot;98.95&quot;,</span><br><span class="line">            &quot;prefix_cost&quot;: &quot;1013.75&quot;,</span><br><span class="line">            &quot;data_read_per_join&quot;: &quot;1M&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;used_columns&quot;: [</span><br><span class="line">            &quot;id&quot;,</span><br><span class="line">            &quot;key1&quot;,</span><br><span class="line">            &quot;key2&quot;,</span><br><span class="line">            &quot;key3&quot;,</span><br><span class="line">            &quot;key_part1&quot;,</span><br><span class="line">            &quot;key_part2&quot;,</span><br><span class="line">            &quot;key_part3&quot;,</span><br><span class="line">            &quot;common_field&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;attached_condition&quot;: &quot;((`atguigudb1`.`s1`.`common_field` = &#x27;a&#x27;) and (`atguigudb1`.`s1`.`key1` is not null))&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;table&quot;: &#123;</span><br><span class="line">          &quot;table_name&quot;: &quot;s2&quot;,</span><br><span class="line">          &quot;access_type&quot;: &quot;eq_ref&quot;,</span><br><span class="line">          &quot;possible_keys&quot;: [</span><br><span class="line">            &quot;idx_key2&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;key&quot;: &quot;idx_key2&quot;,</span><br><span class="line">          &quot;used_key_parts&quot;: [</span><br><span class="line">            &quot;key2&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;key_length&quot;: &quot;5&quot;,</span><br><span class="line">          &quot;ref&quot;: [</span><br><span class="line">            &quot;atguigudb1.s1.key1&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;rows_examined_per_scan&quot;: 1,</span><br><span class="line">          &quot;rows_produced_per_join&quot;: 989,</span><br><span class="line">          &quot;filtered&quot;: &quot;100.00&quot;,</span><br><span class="line">          &quot;index_condition&quot;: &quot;(cast(`atguigudb1`.`s1`.`key1` as double) = cast(`atguigudb1`.`s2`.`key2` as double))&quot;,</span><br><span class="line">          &quot;cost_info&quot;: &#123;</span><br><span class="line">            &quot;read_cost&quot;: &quot;247.38&quot;,</span><br><span class="line">            &quot;eval_cost&quot;: &quot;98.95&quot;,</span><br><span class="line">            &quot;prefix_cost&quot;: &quot;1360.08&quot;,</span><br><span class="line">            &quot;data_read_per_join&quot;: &quot;1M&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;used_columns&quot;: [</span><br><span class="line">            &quot;id&quot;,</span><br><span class="line">            &quot;key1&quot;,</span><br><span class="line">            &quot;key2&quot;,</span><br><span class="line">            &quot;key3&quot;,</span><br><span class="line">            &quot;key_part1&quot;,</span><br><span class="line">            &quot;key_part2&quot;,</span><br><span class="line">            &quot;key_part3&quot;,</span><br><span class="line">            &quot;common_field&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">1 row in set, 2 warnings (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä½¿ç”¨<code>#</code>åé¢è·Ÿéšæ³¨é‡Šçš„å½¢å¼ä¸ºå¤§å®¶è§£é‡Šäº† <code>EXPLAIN FORMAT=JSON</code> è¯­å¥çš„è¾“å‡ºå†…å®¹ï¼Œä½†æ˜¯å¤§å®¶æœ‰ç–‘é—® <code>cost_info</code>é‡Œè¾¹çš„æˆæœ¬çœ‹ç€æ€ªæ€ªçš„ï¼Œå®ƒä»¬æ˜¯æ€ä¹ˆè®¡ç®—å‡ºæ¥çš„ï¼Ÿ</p>
<p>å…ˆçœ‹ s1 è¡¨çš„ â€œcost_infoâ€éƒ¨åˆ†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;cost_info&quot;: &#123;</span><br><span class="line">	&quot;read_cost&quot;: &quot;914.80&quot;,</span><br><span class="line">    &quot;eval_cost&quot;: &quot;98.95&quot;,</span><br><span class="line">    &quot;prefix_cost&quot;: &quot;1013.75&quot;,</span><br><span class="line">    &quot;data_read_per_join&quot;: &quot;1M&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>read_cost</code> æ˜¯ç”±ä¸‹è¾¹è¿™ä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼š<ul>
<li><p><code>IO</code>æˆæœ¬</p>
</li>
<li><p>æ£€æµ‹ <code>rows Ã— (1 - filter) </code>æ¡è®°å½•çš„ <code>CPU </code>æˆæœ¬</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ’š rowså’Œfilteréƒ½æ˜¯æˆ‘ä»¬å‰è¾¹ä»‹ç»æ‰§è¡Œè®¡åˆ’çš„è¾“å‡ºåˆ—ï¼Œåœ¨JSONæ ¼å¼çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œrowsç›¸å½“äºrows_examined_per_scanï¼Œfilteredåç§°ä¸å˜</p>
</blockquote>
<ul>
<li><p><code>eval_cost</code>æ˜¯è¿™æ ·è®¡ç®—çš„ï¼š</p>
<ul>
<li>æ£€æµ‹ <code>rows Ã— filter</code> æ¡è®°å½•çš„æˆæœ¬ã€‚</li>
</ul>
</li>
<li><p><code>prefix_cost</code>å°±æ˜¯å•ç‹¬æŸ¥è¯¢ s1 è¡¨çš„æˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ï¼š<code>read_cost + eval_cost</code></p>
</li>
<li><p><code>data_read_per_join </code>è¡¨ç¤ºåœ¨æ­¤æ¬¡æŸ¥è¯¢ä¸­éœ€è¦è¯»å–çš„æ•°æ®é‡ã€‚</p>
</li>
</ul>
<p>å¯¹äº s2 è¡¨çš„ â€œcost_infoâ€ éƒ¨åˆ†æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;cost_info&quot;: &#123;</span><br><span class="line">	&quot;read_cost&quot;: &quot;247.38&quot;,</span><br><span class="line">    &quot;eval_cost&quot;: &quot;98.95&quot;,</span><br><span class="line">    &quot;prefix_cost&quot;: &quot;1360.08&quot;,</span><br><span class="line">    &quot;data_read_per_join&quot;: &quot;1M&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äº s2 è¡¨æ˜¯è¢«é©±åŠ¨è¡¨ï¼Œæ‰€ä»¥å¯èƒ½è¢«è¯»å–å¤šæ¬¡ï¼Œè¿™é‡Œçš„ <code>read_cost </code>å’Œ <code>eval_cost </code>æ˜¯è®¿é—®å¤šæ¬¡ s2 è¡¨åç´¯åŠ èµ·æ¥çš„å€¼ï¼Œå¤§å®¶ä¸»è¦å…³æ³¨é‡Œè¾¹å„¿çš„ <code>prefix_cost </code>çš„å€¼ä»£è¡¨çš„æ˜¯æ•´ä¸ªè¿æ¥æŸ¥è¯¢é¢„è®¡çš„æˆæœ¬ï¼Œä¹Ÿå°±æ˜¯å•æ¬¡æŸ¥è¯¢ s1 è¡¨å’Œå¤šæ¬¡æŸ¥è¯¢ s2 è¡¨åçš„æˆæœ¬çš„å’Œï¼Œä¹Ÿå°±æ˜¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">247.38</span> + <span class="number">98.95</span> + <span class="number">1013.75</span> = <span class="number">1360.08</span></span><br></pre></td></tr></table></figure>

<h3 id="7-1-3-TREE-æ ¼å¼"><a href="#7-1-3-TREE-æ ¼å¼" class="headerlink" title="7.1.3 TREE æ ¼å¼"></a>7.1.3 TREE æ ¼å¼</h3><p>TREE æ ¼å¼æ˜¯ 8.0.16 ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„æ–°æ ¼å¼ï¼Œä¸»è¦æ ¹æ®æŸ¥è¯¢çš„å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„å…³ç³»å’Œå„éƒ¨åˆ†çš„æ‰§è¡Œé¡ºåº æ¥æè¿°å¦‚ä½•æŸ¥è¯¢ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> EXPLAIN FORMAT<span class="operator">=</span>TREE <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key2 <span class="keyword">WHERE</span> s1.common_field <span class="operator">=</span><span class="string">&#x27;a&#x27;</span>\G;</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">EXPLAIN: <span class="operator">-</span><span class="operator">&gt;</span> Nested loop <span class="keyword">inner</span> <span class="keyword">join</span>  (cost<span class="operator">=</span><span class="number">1360.08</span> <span class="keyword">rows</span><span class="operator">=</span><span class="number">990</span>)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">Filter</span>: ((s1.common_field <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>) <span class="keyword">and</span> (s1.key1 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>))  (cost<span class="operator">=</span><span class="number">1013.75</span> <span class="keyword">rows</span><span class="operator">=</span><span class="number">990</span>)</span><br><span class="line">        <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">Table</span> scan <span class="keyword">on</span> s1  (cost<span class="operator">=</span><span class="number">1013.75</span> <span class="keyword">rows</span><span class="operator">=</span><span class="number">9895</span>)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> Single<span class="operator">-</span><span class="type">row</span> index lookup <span class="keyword">on</span> s2 <span class="keyword">using</span> idx_key2 (key2<span class="operator">=</span>s1.key1), <span class="keyword">with</span> index <span class="keyword">condition</span>: (<span class="built_in">cast</span>(s1.key1 <span class="keyword">as</span> <span class="keyword">double</span>) <span class="operator">=</span> <span class="built_in">cast</span>(s2.key2 <span class="keyword">as</span> <span class="keyword">double</span>))  (cost<span class="operator">=</span><span class="number">0.25</span> <span class="keyword">rows</span><span class="operator">=</span><span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="7-1-4-å¯è§†åŒ–è¾“å‡º"><a href="#7-1-4-å¯è§†åŒ–è¾“å‡º" class="headerlink" title="7.1.4 å¯è§†åŒ–è¾“å‡º"></a>7.1.4 å¯è§†åŒ–è¾“å‡º</h3><p>å¯è§†åŒ–è¾“å‡ºï¼Œå¯ä»¥é€šè¿‡ MySQL Workbench å¯è§†åŒ–æŸ¥çœ‹ MySQL çš„æ‰§è¡Œè®¡åˆ’ã€‚é€šè¿‡ç‚¹å‡» Workbench çš„æ”¾å¤§é•œå›¾æ ‡ï¼Œå³å¯ç”Ÿæˆå¯è§†åŒ–çš„æŸ¥è¯¢è®¡åˆ’</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034098.png"></p>
<p>ä¸Šå›¾æŒ‰ä»å·¦åˆ°å³çš„è¿æ¥é¡ºåºæ˜¾ç¤ºè¡¨ã€‚çº¢è‰²æ¡†è¡¨ç¤º å…¨è¡¨æ‰«æ ï¼Œè€Œç»¿è‰²æ¡†è¡¨ç¤ºä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾å¯¹äºæ¯ä¸ªè¡¨ï¼Œæ˜¾ç¤ºä½¿ç”¨çš„ç´¢å¼•ã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªè¡¨æ ¼çš„æ¡†ä¸Šæ–¹æ˜¯æ¯ä¸ªè¡¨è®¿é—®æ‰€å‘ç°çš„è¡Œæ•°çš„ä¼°è®¡å€¼ä»¥åŠè®¿é—®è¯¥è¡¨çš„æˆæœ¬</p>
<h2 id="7-2-SHOW-WARNINGS-çš„ä½¿ç”¨"><a href="#7-2-SHOW-WARNINGS-çš„ä½¿ç”¨" class="headerlink" title="7.2 SHOW WARNINGS çš„ä½¿ç”¨"></a>7.2 SHOW WARNINGS çš„ä½¿ç”¨</h2><p>&#x3D;&#x3D;å¯ä»¥æ˜¾ç¤ºæ•°æ®åº“çœŸæ­£æ‰§è¡Œçš„ SQL&#x3D;&#x3D; ï¼Œå› ä¸ºæœ‰æ—¶å€™MySQLæ‰§è¡Œå¼•æ“ä¼šå¯¹æˆ‘ä»¬çš„SQLè¿›è¡Œä¼˜åŒ–~</p>
<p><font color=blue>â‘  å…ˆä½¿ç”¨ <code>Explain</code>ï¼Œæˆ‘ä»¬å†™çš„ sql æŒ‰é“ç†æ˜¯ä½¿ç”¨ s1 ä½œä¸ºé©±åŠ¨è¡¨ï¼Œs2ä½œä¸ºè¢«é©±åŠ¨è¡¨</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> s1.key1, s2.key1 <span class="keyword">FROM</span> s1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.key1 <span class="operator">=</span> s2.key1 <span class="keyword">WHERE</span> s2.common_field <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;<span class="operator">*</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ æ‰§è¡Œç»“æœæŠŠ s2 ä½œä¸ºäº†é©±åŠ¨è¡¨ï¼Œs1 ä½œä¸ºäº†è¢«é©±åŠ¨è¡¨<br><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150034776.png" alt="image-20220814133158223"></p>
<p>ç´§æ¥ç€ä½¿ç”¨<code>SHOW WARNINGS</code> ï¼ŒåŸæ¥æ‰§è¡Œå¼•æ“å°†<code> LEFT JOIN</code>ä¼˜åŒ–æˆäº† <code>INNER JOIN</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> WARNINGS\G;</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">  Level: Note</span><br><span class="line">   Code: <span class="number">1003</span></span><br><span class="line">Message: <span class="comment">/* select#1 */</span> <span class="keyword">select</span> `atguigudb1`.`s1`.`key1` <span class="keyword">AS</span> `key1`,`atguigudb1`.`s2`.`key1` <span class="keyword">AS</span> `key1` </span><br><span class="line"><span class="keyword">from</span> `atguigudb1`.`s1` </span><br><span class="line"><span class="keyword">join</span> `atguigudb1`.`s2` </span><br><span class="line"><span class="keyword">where</span> ((`atguigudb1`.`s1`.`key1` <span class="operator">=</span> `atguigudb1`.`s2`.`key1`) </span><br><span class="line"><span class="keyword">and</span> (`atguigudb1`.`s2`.`common_field` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>))</span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ message ä¸­æ˜¾ç¤ºçš„&#x3D;&#x3D;æ˜¯æ•°æ®åº“ä¼˜åŒ–ã€é‡å†™åçœŸæ­£æ‰§è¡Œçš„æŸ¥è¯¢è¯­å¥&#x3D;&#x3D;ã€‚æœç„¶å®ƒå¸®æˆ‘ä»¬åšäº†ä¼˜åŒ–</p>
<p><font color=blue>â‘¡ å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼šä¸‹é¢æ˜¯ä¸€ä¸ª å­æŸ¥è¯¢SQLï¼Œåº”è¯¥å¯¹åº”ç€ä¸¤ä¸ªä¸åŒçš„id~</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM s1 WHERE key1 IN (SELECT key2 FROM s2 WHERE common_field = &#x27;a&#x27;);</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯çœŸæ­£æ‰§è¡Œåï¼Œå¯¹åº”ç€ç«Ÿç„¶æ˜¯ç›¸åŒçš„id</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150035985.png" alt="image-20220814134557598"></p>
<p>æˆ‘ä»¬ä½¿ç”¨<code>SHOW WARNINGS\G;</code>è¿›è¡Œåˆ†æï¼Œå‘ç°æ‰§è¡Œå¼•æ“å°†å…¶ä¼˜åŒ–æˆäº† <strong>å¤šè¡¨è¿æ¥æŸ¥è¯¢</strong>çš„æ–¹å¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW WARNINGS\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">  Level: Warning</span><br><span class="line">   Code: 1739</span><br><span class="line">Message: Cannot use ref access on index &#x27;idx_key1&#x27; due to type or collation conversion on field &#x27;key1&#x27;</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">  Level: Note</span><br><span class="line">   Code: 1003</span><br><span class="line">Message: /* select#1 */ select `atguigudb1`.`s1`.`id` AS `id`,`atguigudb1`.`s1`.`key1` AS `key1`,`atguigudb1`.`s1`.`key2` AS `key2`,`atguigudb1`.`s1`.`key3` AS `key3`,`atguigudb1`.`s1`.`key_part1` AS `key_part1`,`atguigudb1`.`s1`.`key_part2` AS `key_part2`,`atguigudb1`.`s1`.`key_part3` AS `key_part3`,`atguigudb1`.`s1`.`common_field` AS `common_field` </span><br><span class="line">from `atguigudb1`.`s2` </span><br><span class="line">join `atguigudb1`.`s1` </span><br><span class="line">where ((`atguigudb1`.`s2`.`common_field` = &#x27;a&#x27;) </span><br><span class="line">and (cast(`atguigudb1`.`s1`.`key1` as double) = cast(`atguigudb1`.`s2`.`key2` as double)))</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h1 id="8-åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’ï¼štrace"><a href="#8-åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’ï¼štrace" class="headerlink" title="8. åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’ï¼štrace"></a>8. åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’ï¼štrace</h1><p><code>OPTIMIZE_TRACE</code> æ˜¯ mysql 5.6 ä¸­å¼•å…¥çš„ä¸€ä¸ªè·Ÿè¸ªå·¥å…·ï¼Œå®ƒå¯ä»¥è·Ÿè¸ªä¼˜åŒ–å™¨åšå‡ºçš„å„ç§å†³ç­–ï¼Œæ¯”å¦‚è®¿é—®è¡¨çš„æ–¹æ³•ï¼Œå„ç§å¼€é”€è®¡ç®—ï¼Œå„ç§è½¬æ¢ï¼Œç»“æœä¼šè¢«è®°å½•åˆ° <code>information_schema.optimizer_trace</code>ä¸­ã€‚</p>
<p>æ­¤åŠŸèƒ½é»˜è®¤å…³é—­ã€‚å¼€å¯traceï¼Œå¹¶è®¾ç½®æ ¼å¼ä¸ºJSONï¼ŒåŒæ—¶è®¾ç½®traceæœ€å¤§èƒ½å¤Ÿä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œé¿å…è§£æè¿‡ç¨‹ä¸­å› ä¸ºé»˜è®¤å†…å­˜è¿‡å°è€Œä¸èƒ½å¤Ÿå®Œæ•´å±•ç¤ºã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> optimizer_trace<span class="operator">=</span>&quot;enabled=on&quot;,end_markers_in_json<span class="operator">=</span><span class="keyword">on</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> optimizer_trace_max_mem_size<span class="operator">=</span><span class="number">1000000</span>;</span><br></pre></td></tr></table></figure>

<p>å¼€å¯åï¼Œå¯åˆ†æå¦‚ä¸‹è¯­å¥ï¼š</p>
<ul>
<li>SELECT</li>
<li>INSERT</li>
<li>REPLACE</li>
<li>UPDATE</li>
<li>DELETE</li>
<li>EXPLAIN</li>
<li>SET</li>
<li>DECLARE</li>
<li>CASE</li>
<li>IF</li>
<li>RETURN</li>
<li>CALL</li>
</ul>
<p>æµ‹è¯•ï¼šæ‰§è¡Œå¦‚ä¸‹ SQL è¯­å¥</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="operator">&lt;</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>



<p>æœ€åï¼Œ æŸ¥è¯¢ information_schema.optimizer_trace å°±å¯ä»¥çŸ¥é“ MySQL æ˜¯å¦‚ä½•æ‰§è¡Œ SQL çš„</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.optimizer_trace\G;</span><br></pre></td></tr></table></figure>

<p>ç»“æœå¦‚ä¸‹</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line">*************************** <span class="number">1.</span> row ***************************</span><br><span class="line"> <span class="comment">//ç¬¬1éƒ¨åˆ†ï¼šæŸ¥è¯¢è¯­å¥</span></span><br><span class="line"> QUERY<span class="punctuation">:</span> select * from student where id &lt; <span class="number">10</span></span><br><span class="line"> <span class="comment">//ç¬¬2éƒ¨åˆ†ï¼šQUERYå­—æ®µå¯¹åº”è¯­å¥çš„è·Ÿè¸ªä¿¡æ¯</span></span><br><span class="line"> TRACE<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;join_preparation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>  <span class="comment">//é¢„å¤‡å·¥ä½œ</span></span><br><span class="line">    <span class="attr">&quot;select#&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;expanded_query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/* select#1 */ select `student`.`id` AS</span></span><br><span class="line"><span class="string">`id`,`student`.`stuno` AS `stuno`,`student`.`name` AS `name`,`student`.`age` AS</span></span><br><span class="line"><span class="string">`age`,`student`.`classId` AS `classId` from `student` where (`student`.`id` &lt; 10)&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span> <span class="comment">/* steps */</span></span><br><span class="line">  <span class="punctuation">&#125;</span> <span class="comment">/* join_preparation */</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;join_optimization&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>  <span class="comment">//è¿›è¡Œä¼˜åŒ–</span></span><br><span class="line">    <span class="attr">&quot;select#&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;condition_processing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>  <span class="comment">//æ¡ä»¶å¤„ç†</span></span><br><span class="line">       <span class="attr">&quot;condition&quot;</span><span class="punctuation">:</span> <span class="string">&quot;WHERE&quot;</span><span class="punctuation">,</span></span><br><span class="line">       <span class="attr">&quot;original_condition&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(`student`.`id` &lt; 10)&quot;</span><span class="punctuation">,</span></span><br><span class="line">       <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">       <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;transformation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;equality_propagation&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;resulting_condition&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(`student`.`id` &lt; 10)&quot;</span></span><br><span class="line">       <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">       <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;transformation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;constant_propagation&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;resulting_condition&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(`student`.`id` &lt; 10)&quot;</span></span><br><span class="line">       <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">       <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;transformation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;trivial_condition_removal&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;resulting_condition&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(`student`.`id` &lt; 10)&quot;</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span> <span class="comment">/* steps */</span></span><br><span class="line">     <span class="punctuation">&#125;</span> <span class="comment">/* condition_processing */</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;substitute_generated_columns&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>  <span class="comment">//æ›¿æ¢ç”Ÿæˆçš„åˆ—</span></span><br><span class="line">     <span class="punctuation">&#125;</span> <span class="comment">/* substitute_generated_columns */</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;table_dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>   <span class="comment">//è¡¨çš„ä¾èµ–å…³ç³»</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="string">&quot;`student`&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;row_may_be_null&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;map_bit&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;depends_on_map_bits&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">       <span class="punctuation">]</span> <span class="comment">/* depends_on_map_bits */</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">     <span class="punctuation">]</span> <span class="comment">/* table_dependencies */</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;ref_optimizer_key_uses&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>   <span class="comment">//ä½¿ç”¨é”®</span></span><br><span class="line">     <span class="punctuation">]</span> <span class="comment">/* ref_optimizer_key_uses */</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;rows_estimation&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>   <span class="comment">//è¡Œåˆ¤æ–­</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="string">&quot;`student`&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;range_analysis&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;table_scan&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="number">3973767</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;cost&quot;</span><span class="punctuation">:</span> <span class="number">408558</span></span><br><span class="line">        <span class="punctuation">&#125;</span> <span class="comment">/* table_scan */</span><span class="punctuation">,</span>   <span class="comment">//æ‰«æè¡¨</span></span><br><span class="line">         <span class="attr">&quot;potential_range_indexes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>   <span class="comment">//æ½œåœ¨çš„èŒƒå›´ç´¢å¼•</span></span><br><span class="line">         <span class="punctuation">&#123;</span></span><br><span class="line">           <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PRIMARY&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;usable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;key_parts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;id&quot;</span></span><br><span class="line">          <span class="punctuation">]</span> <span class="comment">/* key_parts */</span></span><br><span class="line">         <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span> <span class="comment">/* potential_range_indexes */</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;setup_range_conditions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>   <span class="comment">//è®¾ç½®èŒƒå›´æ¡ä»¶</span></span><br><span class="line">        <span class="punctuation">]</span> <span class="comment">/* setup_range_conditions */</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;group_index_range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;chosen&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;cause&quot;</span><span class="punctuation">:</span> <span class="string">&quot;not_group_by_or_distinct&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span> <span class="comment">/* group_index_range */</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;skip_scan_range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;potential_skip_scan_indexes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PRIMARY&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;usable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cause&quot;</span><span class="punctuation">:</span> <span class="string">&quot;query_references_nonkey_column&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">         <span class="punctuation">]</span> <span class="comment">/* potential_skip_scan_indexes */</span></span><br><span class="line">        <span class="punctuation">&#125;</span> <span class="comment">/* skip_scan_range */</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;analyzing_range_alternatives&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>  <span class="comment">//åˆ†æèŒƒå›´é€‰é¡¹</span></span><br><span class="line">          <span class="attr">&quot;range_scan_alternatives&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PRIMARY&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ranges&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">             <span class="string">&quot;id &lt; 10&quot;</span></span><br><span class="line">           <span class="punctuation">]</span> <span class="comment">/* ranges */</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;index_dives_for_eq_ranges&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;rowid_ordered&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;using_mrr&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;index_only&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cost&quot;</span><span class="punctuation">:</span> <span class="number">1.91986</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;chosen&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">         <span class="punctuation">]</span> <span class="comment">/* range_scan_alternatives */</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;analyzing_roworder_intersect&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">           <span class="attr">&quot;usable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;cause&quot;</span><span class="punctuation">:</span> <span class="string">&quot;too_few_roworder_scans&quot;</span></span><br><span class="line">         <span class="punctuation">&#125;</span> <span class="comment">/* analyzing_roworder_intersect */</span></span><br><span class="line">        <span class="punctuation">&#125;</span> <span class="comment">/* analyzing_range_alternatives */</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;chosen_range_access_summary&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>   <span class="comment">//é€‰æ‹©èŒƒå›´è®¿é—®æ‘˜è¦</span></span><br><span class="line">          <span class="attr">&quot;range_access_plan&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">           <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;range_scan&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PRIMARY&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;ranges&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;id &lt; 10&quot;</span></span><br><span class="line">          <span class="punctuation">]</span> <span class="comment">/* ranges */</span></span><br><span class="line">         <span class="punctuation">&#125;</span> <span class="comment">/* range_access_plan */</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;rows_for_plan&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;cost_for_plan&quot;</span><span class="punctuation">:</span> <span class="number">1.91986</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;chosen&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span> <span class="comment">/* chosen_range_access_summary */</span></span><br><span class="line">       <span class="punctuation">&#125;</span> <span class="comment">/* range_analysis */</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">     <span class="punctuation">]</span> <span class="comment">/* rows_estimation */</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;considered_execution_plans&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>  <span class="comment">//è€ƒè™‘æ‰§è¡Œè®¡åˆ’</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;plan_prefix&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">       <span class="punctuation">]</span> <span class="comment">/* plan_prefix */</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="string">&quot;`student`&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;best_access_path&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>  <span class="comment">//æœ€ä½³è®¿é—®è·¯å¾„</span></span><br><span class="line">         <span class="attr">&quot;considered_access_paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">         <span class="punctuation">&#123;</span></span><br><span class="line">           <span class="attr">&quot;rows_to_scan&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;access_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;range&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;range_details&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;used_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PRIMARY&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span> <span class="comment">/* range_details */</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;resulting_rows&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;cost&quot;</span><span class="punctuation">:</span> <span class="number">2.81986</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;chosen&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">         <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span> <span class="comment">/* considered_access_paths */</span></span><br><span class="line">       <span class="punctuation">&#125;</span> <span class="comment">/* best_access_path */</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;condition_filtering_pct&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span>  <span class="comment">//è¡Œè¿‡æ»¤ç™¾åˆ†æ¯”</span></span><br><span class="line">        <span class="attr">&quot;rows_for_plan&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cost_for_plan&quot;</span><span class="punctuation">:</span> <span class="number">2.81986</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;chosen&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">     <span class="punctuation">]</span> <span class="comment">/* considered_execution_plans */</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;attaching_conditions_to_tables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>  <span class="comment">//å°†æ¡ä»¶é™„åŠ åˆ°è¡¨ä¸Š</span></span><br><span class="line">       <span class="attr">&quot;original_condition&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(`student`.`id` &lt; 10)&quot;</span><span class="punctuation">,</span></span><br><span class="line">       <span class="attr">&quot;attached_conditions_computation&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">]</span> <span class="comment">/* attached_conditions_computation */</span><span class="punctuation">,</span></span><br><span class="line">       <span class="attr">&quot;attached_conditions_summary&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>  <span class="comment">//é™„åŠ æ¡ä»¶æ¦‚è¦</span></span><br><span class="line">       <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="string">&quot;`student`&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;attached&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(`student`.`id` &lt; 10)&quot;</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span> <span class="comment">/* attached_conditions_summary */</span></span><br><span class="line">     <span class="punctuation">&#125;</span> <span class="comment">/* attaching_conditions_to_tables */</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;finalizing_table_conditions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="string">&quot;`student`&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;original_table_condition&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(`student`.`id` &lt; 10)&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;final_table_condition  &quot;</span><span class="punctuation">:</span> <span class="string">&quot;(`student`.`id` &lt; 10)&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">     <span class="punctuation">]</span> <span class="comment">/* finalizing_table_conditions */</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;refine_plan&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>  <span class="comment">//ç²¾ç®€è®¡åˆ’</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="string">&quot;`student`&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">     <span class="punctuation">]</span> <span class="comment">/* refine_plan */</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span> <span class="comment">/* steps */</span></span><br><span class="line">  <span class="punctuation">&#125;</span> <span class="comment">/* join_optimization */</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;join_execution&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>   <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">    <span class="attr">&quot;select#&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">   <span class="punctuation">]</span> <span class="comment">/* steps */</span></span><br><span class="line">  <span class="punctuation">&#125;</span> <span class="comment">/* join_execution */</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span> <span class="comment">/* steps */</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">//ç¬¬3éƒ¨åˆ†ï¼šè·Ÿè¸ªä¿¡æ¯è¿‡é•¿æ—¶ï¼Œè¢«æˆªæ–­çš„è·Ÿè¸ªä¿¡æ¯çš„å­—èŠ‚æ•°ã€‚</span></span><br><span class="line">MISSING_BYTES_BEYOND_MAX_MEM_SIZE<span class="punctuation">:</span> <span class="number">0</span>  <span class="comment">//ä¸¢å¤±çš„è¶…å‡ºæœ€å¤§å®¹é‡çš„å­—èŠ‚</span></span><br><span class="line"><span class="comment">//ç¬¬4éƒ¨åˆ†ï¼šæ‰§è¡Œè·Ÿè¸ªè¯­å¥çš„ç”¨æˆ·æ˜¯å¦æœ‰æŸ¥çœ‹å¯¹è±¡çš„æƒé™ã€‚å½“ä¸å…·æœ‰æƒé™æ—¶ï¼Œè¯¥åˆ—ä¿¡æ¯ä¸º1ä¸”TRACEå­—æ®µä¸ºç©ºï¼Œä¸€èˆ¬åœ¨</span></span><br><span class="line">è°ƒç”¨å¸¦æœ‰SQL SECURITY DEFINERçš„è§†å›¾æˆ–è€…æ˜¯å­˜å‚¨è¿‡ç¨‹çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°æ­¤é—®é¢˜ã€‚</span><br><span class="line">INSUFFICIENT_PRIVILEGES<span class="punctuation">:</span> <span class="number">0</span>  <span class="comment">//ç¼ºå¤±æƒé™</span></span><br><span class="line"><span class="number">1</span> row in set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h1 id="9-MySQL-ç›‘æ§åˆ†æè§†å›¾-sys-schema"><a href="#9-MySQL-ç›‘æ§åˆ†æè§†å›¾-sys-schema" class="headerlink" title="9. MySQL ç›‘æ§åˆ†æè§†å›¾ sys schema"></a>9. MySQL ç›‘æ§åˆ†æè§†å›¾ sys schema</h1><p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150035027.png" alt="image-20220814140207739"></p>
<h2 id="9-1-Sys-schemaè§†å›¾æ‘˜è¦"><a href="#9-1-Sys-schemaè§†å›¾æ‘˜è¦" class="headerlink" title="9.1 Sys schemaè§†å›¾æ‘˜è¦"></a>9.1 Sys schemaè§†å›¾æ‘˜è¦</h2><ol>
<li>ä¸»æœºç›¸å…³ï¼šä»¥ host_summary å¼€å¤´ï¼Œä¸»è¦æ±‡æ€»äº† IO å»¶è¿Ÿçš„ä¿¡æ¯ã€‚</li>
<li>Innodb ç›¸å…³ï¼šä»¥ innodb å¼€å¤´ï¼Œæ±‡æ€»äº† innodb buffer ä¿¡æ¯å’Œäº‹åŠ¡ç­‰å¾… innodb é”çš„ä¿¡æ¯ã€‚</li>
<li>I&#x2F;Oç›¸å…³ï¼šä»¥ IO å¼€å¤´ï¼Œæ±‡æ€»äº†ç­‰å¾… I&#x2F;Oã€I&#x2F;O ä½¿ç”¨é‡æƒ…å†µã€‚</li>
<li>å†…å­˜ä½¿ç”¨æƒ…å†µï¼šä»¥ memory å¼€å¤´ï¼Œä»ä¸»æœºã€çº¿ç¨‹ã€äº‹ä»¶ç­‰è§’åº¦å±•ç¤ºå†…å­˜çš„ä½¿ç”¨æƒ…å†µ</li>
<li>è¿æ¥ä¸ä¼šè¯ä¿¡æ¯ï¼šprocesslist å’Œ session ç›¸å…³è§†å›¾ï¼Œæ€»ç»“äº†ä¼šè¯ç›¸å…³ä¿¡æ¯ã€‚</li>
<li>è¡¨ç›¸å…³ï¼šä»¥ schema_table å¼€å¤´çš„è§†å›¾ï¼Œå±•ç¤ºäº†è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>ç´¢å¼•ä¿¡æ¯ï¼šç»Ÿè®¡äº†ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…å«å†—ä½™ç´¢å¼•å’Œæœªä½¿ç”¨çš„ç´¢å¼•æƒ…å†µã€‚</li>
<li>è¯­å¥ç›¸å…³ï¼šä»¥ statement å¼€å¤´ï¼ŒåŒ…å«æ‰§è¡Œå…¨è¡¨æ‰«æã€ä½¿ç”¨ä¸´æ—¶è¡¨ã€æ’åºç­‰çš„è¯­å¥ä¿¡æ¯ã€‚</li>
<li>ç”¨æˆ·ç›¸å…³ï¼šä»¥ user å¼€å¤´çš„è§†å›¾ï¼Œç»Ÿè®¡äº†ç”¨æˆ·ä½¿ç”¨çš„æ–‡ä»¶ I&#x2F;Oã€æ‰§è¡Œè¯­å¥ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>ç­‰å¾…äº‹ä»¶ç›¸å…³ä¿¡æ¯ï¼šä»¥ wait å¼€å¤´ï¼Œå±•ç¤ºç­‰å¾…äº‹ä»¶çš„å»¶è¿Ÿæƒ…å†µã€‚</li>
</ol>
<h2 id="9-2-Sys-schemaè§†å›¾ä½¿ç”¨åœºæ™¯"><a href="#9-2-Sys-schemaè§†å›¾ä½¿ç”¨åœºæ™¯" class="headerlink" title="9.2 Sys schemaè§†å›¾ä½¿ç”¨åœºæ™¯"></a>9.2 Sys schemaè§†å›¾ä½¿ç”¨åœºæ™¯</h2><p><strong><font color=blue>1. ç´¢å¼•æƒ…å†µ</font></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#1. æŸ¥è¯¢å†—ä½™ç´¢å¼•</span><br><span class="line">select * from sys.schema_redundant_indexes;</span><br><span class="line"></span><br><span class="line">#2. æŸ¥è¯¢æœªä½¿ç”¨è¿‡çš„ç´¢å¼•</span><br><span class="line">select * from sys.schema_unused_indexes;</span><br><span class="line"></span><br><span class="line">#3. æŸ¥è¯¢ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ</span><br><span class="line">select index_name,rows_selected,rows_inserted,rows_updated,rows_deleted</span><br><span class="line">from sys.schema_index_statistics where table_schema=&#x27;dbname&#x27;;</span><br></pre></td></tr></table></figure>

<p>ä¸¾ä¾‹ï¼šæ¯”å¦‚æˆ‘ä»¬æŸ¥çœ‹ä¸‹æ•°æ®çš„çš„å†—ä½™ç´¢å¼•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from sys.schema_redundant_indexes;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150035832.png" alt="image-20220814141233022"></p>
<p>æˆ‘ä»¬ä»»æ„é€‰æ‹©ä¸€æ¡ï¼Œæ¯”å¦‚æœ€åä¸€æ¡ï¼Œç„¶åæŸ¥çœ‹ä¸‹student_infoçš„ç´¢å¼•æƒ…å†µï¼Œçœ‹çœ‹æ˜¯å¦<code>idx_cre_time</code>å†—ä½™äº†</p>
<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150035664.png" alt="image-20220814141532332"></p>
<p>å¯ä»¥ çœ‹åˆ° <code>idx_cre_time</code>å’Œ<code>idx_cre_time_sid</code>ä¸¤ä¸ªç´¢å¼•ä¸­éƒ½æœ‰ <code>create_time</code>ã€‚è€Œä¸”è”åˆç´¢å¼•æ€§èƒ½è¦é«˜äºå•åˆ—ç´¢å¼•ï¼Œæ‰€ä»¥<code>idx_cre_time </code>å®Œå…¨å¯ä»¥åˆ æ‰~</p>
<p><strong><font color=blue>2. è¡¨ç›¸å…³</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span> æŸ¥è¯¢è¡¨çš„è®¿é—®é‡</span><br><span class="line"><span class="keyword">select</span> table_schema,table_name,<span class="built_in">sum</span>(io_read_requests<span class="operator">+</span>io_write_requests) <span class="keyword">as</span> io <span class="keyword">from</span> sys.schema_table_statistics <span class="keyword">group</span> <span class="keyword">by</span> table_schema,table_name <span class="keyword">order</span> <span class="keyword">by</span> io <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">2.</span> æŸ¥è¯¢å ç”¨bufferpoolè¾ƒå¤šçš„è¡¨</span><br><span class="line"><span class="keyword">select</span> object_schema,object_name,allocated,data</span><br><span class="line"><span class="keyword">from</span> sys.innodb_buffer_stats_by_table <span class="keyword">order</span> <span class="keyword">by</span> allocated limit <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">3.</span> æŸ¥çœ‹è¡¨çš„å…¨è¡¨æ‰«ææƒ…å†µ</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys.statements_with_full_table_scans <span class="keyword">where</span> db<span class="operator">=</span><span class="string">&#x27;dbname&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼šæŸ¥è¯¢è¡¨çš„è®¿é—®é‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 1. æŸ¥è¯¢è¡¨çš„è®¿é—®é‡</span><br><span class="line">select table_schema,table_name,sum(io_read_requests+io_write_requests) as io from sys.schema_table_statistics group by table_schema,table_name order by io desc;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/img/202208150035051.png" alt="image-20220814142303829"></p>
<p><strong><font color=blue>3. è¯­å¥ç›¸å…³</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> ç›‘æ§<span class="keyword">SQL</span>æ‰§è¡Œçš„é¢‘ç‡</span><br><span class="line"><span class="keyword">select</span> db,exec_count,query <span class="keyword">from</span> sys.statement_analysis</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> exec_count <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span> ç›‘æ§ä½¿ç”¨äº†æ’åºçš„<span class="keyword">SQL</span></span><br><span class="line"><span class="keyword">select</span> db,exec_count,first_seen,last_seen,query</span><br><span class="line"><span class="keyword">from</span> sys.statements_with_sorting limit <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span> ç›‘æ§ä½¿ç”¨äº†ä¸´æ—¶è¡¨æˆ–è€…ç£ç›˜ä¸´æ—¶è¡¨çš„<span class="keyword">SQL</span></span><br><span class="line"><span class="keyword">select</span> db,exec_count,tmp_tables,tmp_disk_tables,query</span><br><span class="line"><span class="keyword">from</span> sys.statement_analysis <span class="keyword">where</span> tmp_tables<span class="operator">&gt;</span><span class="number">0</span> <span class="keyword">or</span> tmp_disk_tables <span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> (tmp_tables<span class="operator">+</span>tmp_disk_tables) <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>4. IOç›¸å…³</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#æŸ¥çœ‹æ¶ˆè€—ç£ç›˜IOçš„æ–‡ä»¶</span><br><span class="line"><span class="keyword">select</span> file,avg_read,avg_write,avg_read<span class="operator">+</span>avg_write <span class="keyword">as</span> avg_io</span><br><span class="line"><span class="keyword">from</span> sys.io_global_by_file_by_bytes <span class="keyword">order</span> <span class="keyword">by</span> avg_read  limit <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p><strong><font color=blue>5. InnoDBç›¸å…³</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#è¡Œé”é˜»å¡æƒ…å†µ</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys.innodb_lock_waits;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong><font color=red>é£é™©æç¤ºï¼š</font></strong></p>
<p>é€šè¿‡sysåº“å»æŸ¥è¯¢æ—¶ï¼ŒMySQLä¼š&#x3D;&#x3D;æ¶ˆè€—å¤§é‡èµ„æº&#x3D;&#x3D;å»æ”¶é›†ç›¸å…³ä¿¡æ¯ï¼Œä¸¥é‡çš„å¯èƒ½ä¼šå¯¼è‡´ä¸šåŠ¡è¯·æ±‚è¢«é˜»å¡ï¼Œä»è€Œå¼•èµ·æ•…éšœã€‚å»ºè®®ç”Ÿäº§ä¸Š&#x3D;&#x3D;ä¸è¦é¢‘ç¹&#x3D;&#x3D;çš„å»æŸ¥è¯¢sysæˆ–è€…<code>performance_ schema</code>ã€ <code>information_ schema</code>æ¥å®Œæˆç›‘æ§ã€å·¡æ£€ç­‰å·¥ä½œã€‚</p>
</blockquote>
<h1 id="10-å°ç»“"><a href="#10-å°ç»“" class="headerlink" title="10. å°ç»“"></a>10. å°ç»“</h1><p>æŸ¥è¯¢æ—¶æ•°æ®åº“ä¸­æœ€é¢‘ç¹çš„æ“ä½œï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦å¯ä»¥æœ‰æ•ˆåœ°æé«˜MySQLæ•°æ®åº“çš„æ€§èƒ½ã€‚é€šè¿‡å¯¹æŸ¥è¯¢è¯­å¥çš„åˆ†æå¯ä»¥äº†è§£æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæƒ…å†µï¼Œæ‰¾å‡ºæŸ¥è¯¢è¯­å¥æ‰§è¡Œçš„ç“¶é¢ˆï¼Œä»è€Œä¼˜åŒ–æŸ¥è¯¢è¯­å¥ï¼</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://blog.dalicoding.fun">Leo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://blog.dalicoding.fun/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC07%E7%AB%A0_%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/">https://blog.dalicoding.fun/2024/04/05/MySQLä»å…¥é—¨åˆ°å…¥åœŸ/ç¬¬07ç« _æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://blog.dalicoding.fun" target="_blank">Leoçš„åšå®¢</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>èµåŠ©</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202404041655138.jpg" target="_blank"><img class="post-qr-code-img" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202404041655138.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202404041655057.jpg" target="_blank"><img class="post-qr-code-img" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202404041655057.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC06%E7%AB%A0_%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" title="å…­ã€ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">å…­ã€ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™</div></div></a></div><div class="next-post pull-right"><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC08%E7%AB%A0_%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%B8%8E%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/" title="å…«ã€ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">å…«ã€ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC01%E7%AB%A0_MySQL%E7%9A%84%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95/" title="ä¸€ã€MySQLçš„æ•°æ®ç›®å½•"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">ä¸€ã€MySQLçš„æ•°æ®ç›®å½•</div></div></a></div><div><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC03%E7%AB%A0_%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/" title="ä¸‰ã€å­˜å‚¨å¼•æ“"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909521.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">ä¸‰ã€å­˜å‚¨å¼•æ“</div></div></a></div><div><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC02%E7%AB%A0_%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84%E5%89%96%E6%9E%90/" title="äºŒã€é€»è¾‘æ¶æ„å‰–æ"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">äºŒã€é€»è¾‘æ¶æ„å‰–æ</div></div></a></div><div><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC04%E7%AB%A0_%E7%B4%A2%E5%BC%95%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="å››ã€ç´¢å¼•çš„æ•°æ®ç»“æ„"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909521.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">å››ã€ç´¢å¼•çš„æ•°æ®ç»“æ„</div></div></a></div><div><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC05%E7%AB%A0_InnoDB%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/" title="äº”ã€InnoDBæ•°æ®å­˜å‚¨ç»“æ„"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">äº”ã€InnoDBæ•°æ®å­˜å‚¨ç»“æ„</div></div></a></div><div><a href="/2024/04/05/MySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/%E7%AC%AC06%E7%AB%A0_%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" title="å…­ã€ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™"><img class="cover" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">å…­ã€ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403221853832.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Leo</div><div class="author-info__description">Leoçš„åšå®¢</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">37</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/LiXuYangISZ"><i class="fab fa-github"></i><span>ğŸ›´å‰å¾€å°å®¶...</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/LiXuYangISZ" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2422737092@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/img/WeChatQR.jpg" target="_blank" title="WeChat"><i class="fas fa-weixin"></i></a><a class="social-icon" href="https://res.abeim.cn/api/qq/?qq=2422737092" target="_blank" title="QQ"><i class="fas fa-qq" style="color: #3a9ced;"></i></a><a class="social-icon" href="https://space.bilibili.com/434261812" target="_blank" title="BiliBili"><i class="fas fa-bilibili" style="color: #20b0e3;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content"><center>ä¸»åŸŸåï¼š<br><a href="https://blog.dalicoding.fun"><b><font color="#5ea6e5">æ¬¢è¿æ¥åˆ°Leoçš„åšå®¢~</font></b></a></center></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E4%BC%98%E5%8C%96%E6%AD%A5%E9%AA%A4"><span class="toc-text">1. æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E5%8F%82%E6%95%B0"><span class="toc-text">2. æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E7%BB%9F%E8%AE%A1-SQL-%E7%9A%84%E6%9F%A5%E8%AF%A2%E6%88%90%E6%9C%AC%EF%BC%9Alast-query-cost"><span class="toc-text">3. ç»Ÿè®¡ SQL çš„æŸ¥è¯¢æˆæœ¬ï¼šlast_query_cost</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%AE%9A%E4%BD%8D%E6%89%A7%E8%A1%8C%E6%85%A2%E7%9A%84-SQL%EF%BC%9A%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">4. å®šä½æ‰§è¡Œæ…¢çš„ SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%BC%80%E5%90%AF%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">4.1 å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA"><span class="toc-text">4.2 æ¡ˆä¾‹æ¼”ç¤º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E6%B5%8B%E8%AF%95%E5%8F%8A%E8%AF%B4%E6%98%8E"><span class="toc-text">4.3 æµ‹è¯•åŠè¯´æ˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%EF%BC%9AMysqldumpslow"><span class="toc-text">4.4 æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šMysqldumpslow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-%E5%85%B3%E9%97%AD%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">4.5 å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-%E5%88%A0%E9%99%A4%E4%B8%8E%E6%81%A2%E5%A4%8D%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">4.6 åˆ é™¤ä¸æ¢å¤æ…¢æŸ¥è¯¢æ—¥å¿—</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%9F%A5%E7%9C%8B-SQL-%E6%89%A7%E8%A1%8C%E6%88%90%E6%9C%AC%EF%BC%9ASHOW-PROFILE"><span class="toc-text">5. æŸ¥çœ‹ SQL æ‰§è¡Œæˆæœ¬ï¼šSHOW PROFILE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%88%86%E6%9E%90%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%EF%BC%9AEXPLAIN%EF%BC%88%E9%87%8D%E7%82%B9%EF%BC%89"><span class="toc-text">6. åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAINï¼ˆé‡ç‚¹ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-EXPLAIN-%E6%A6%82%E8%BF%B0"><span class="toc-text">6.1 EXPLAIN æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-text">6.2 åŸºæœ¬è¯­æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="toc-text">6.3 æ•°æ®å‡†å¤‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-EXPLAIN-%E5%90%84%E5%88%97%E4%BD%9C%E7%94%A8"><span class="toc-text">6.4 EXPLAIN å„åˆ—ä½œç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-1-table"><span class="toc-text">6.4.1 table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-2-id"><span class="toc-text">6.4.2 id</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-3-select-type"><span class="toc-text">6.4.3 select_type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-4-partitions-%E5%8F%AF%E7%95%A5"><span class="toc-text">6.4.4 partitions (å¯ç•¥)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-5-type-%E2%98%86"><span class="toc-text">6.4.5 type â˜†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-6-possible-keys-%E5%92%8C-key"><span class="toc-text">6.4.6 possible_keys å’Œ key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-7-key-len-%E2%98%86"><span class="toc-text">6.4.7 key_len â˜†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-8-ref"><span class="toc-text">6.4.8 ref</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-9-rows-%E2%98%86"><span class="toc-text">6.4.9 rows â˜†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-10-filtered"><span class="toc-text">6.4.10 filtered</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-11-Extra-%E2%98%86"><span class="toc-text">6.4.11 Extra â˜†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-12-%E5%B0%8F%E7%BB%93"><span class="toc-text">6.4.12 å°ç»“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-EXPLAIN-%E7%9A%84%E8%BF%9B%E4%B8%80%E6%AD%A5%E4%BD%BF%E7%94%A8"><span class="toc-text">7. EXPLAIN çš„è¿›ä¸€æ­¥ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-EXPLAIN-%E5%9B%9B%E7%A7%8D%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F"><span class="toc-text">7.1 EXPLAIN å››ç§è¾“å‡ºæ ¼å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-1-%E4%BC%A0%E7%BB%9F%E6%A0%BC%E5%BC%8F"><span class="toc-text">7.1.1 ä¼ ç»Ÿæ ¼å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-2-JSON-%E6%A0%BC%E5%BC%8F"><span class="toc-text">7.1.2 JSON æ ¼å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-3-TREE-%E6%A0%BC%E5%BC%8F"><span class="toc-text">7.1.3 TREE æ ¼å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-4-%E5%8F%AF%E8%A7%86%E5%8C%96%E8%BE%93%E5%87%BA"><span class="toc-text">7.1.4 å¯è§†åŒ–è¾“å‡º</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-SHOW-WARNINGS-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">7.2 SHOW WARNINGS çš„ä½¿ç”¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E5%88%86%E6%9E%90%E4%BC%98%E5%8C%96%E5%99%A8%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%EF%BC%9Atrace"><span class="toc-text">8. åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’ï¼štrace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-MySQL-%E7%9B%91%E6%8E%A7%E5%88%86%E6%9E%90%E8%A7%86%E5%9B%BE-sys-schema"><span class="toc-text">9. MySQL ç›‘æ§åˆ†æè§†å›¾ sys schema</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-Sys-schema%E8%A7%86%E5%9B%BE%E6%91%98%E8%A6%81"><span class="toc-text">9.1 Sys schemaè§†å›¾æ‘˜è¦</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-Sys-schema%E8%A7%86%E5%9B%BE%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">9.2 Sys schemaè§†å›¾ä½¿ç”¨åœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E5%B0%8F%E7%BB%93"><span class="toc-text">10. å°ç»“</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/04/05/JVM%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/%E7%AC%AC13%E7%AB%A0-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8/" title="åä¸‰ã€åƒåœ¾å›æ”¶å™¨"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åä¸‰ã€åƒåœ¾å›æ”¶å™¨"/></a><div class="content"><a class="title" href="/2024/04/05/JVM%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/%E7%AC%AC13%E7%AB%A0-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8/" title="åä¸‰ã€åƒåœ¾å›æ”¶å™¨">åä¸‰ã€åƒåœ¾å›æ”¶å™¨</a><time datetime="2024-04-05T07:45:13.000Z" title="å‘è¡¨äº 2024-04-05 15:45:13">2024-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/05/JVM%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/%E7%AC%AC12%E7%AB%A0-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/" title="åäºŒã€åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909521.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åäºŒã€åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ"/></a><div class="content"><a class="title" href="/2024/04/05/JVM%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/%E7%AC%AC12%E7%AB%A0-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/" title="åäºŒã€åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ">åäºŒã€åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ</a><time datetime="2024-04-05T07:45:12.000Z" title="å‘è¡¨äº 2024-04-05 15:45:12">2024-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/05/JVM%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/%E7%AC%AC11%E7%AB%A0_%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95/" title="åä¸€ã€åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åä¸€ã€åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•"/></a><div class="content"><a class="title" href="/2024/04/05/JVM%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/%E7%AC%AC11%E7%AB%A0_%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95/" title="åä¸€ã€åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•">åä¸€ã€åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•</a><time datetime="2024-04-05T07:45:11.000Z" title="å‘è¡¨äº 2024-04-05 15:45:11">2024-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/05/JVM%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/%E7%AC%AC10%E7%AB%A0_StringTable/" title="åã€StringTable"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909053.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åã€StringTable"/></a><div class="content"><a class="title" href="/2024/04/05/JVM%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/%E7%AC%AC10%E7%AB%A0_StringTable/" title="åã€StringTable">åã€StringTable</a><time datetime="2024-04-05T07:45:10.000Z" title="å‘è¡¨äº 2024-04-05 15:45:10">2024-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/05/JVM%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/%E7%AC%AC09%E7%AB%A0_%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/" title="ä¹ã€æ‰§è¡Œå¼•æ“"><img src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ä¹ã€æ‰§è¡Œå¼•æ“"/></a><div class="content"><a class="title" href="/2024/04/05/JVM%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/%E7%AC%AC09%E7%AB%A0_%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/" title="ä¹ã€æ‰§è¡Œå¼•æ“">ä¹ã€æ‰§è¡Œå¼•æ“</a><time datetime="2024-04-05T07:45:09.000Z" title="å‘è¡¨äº 2024-04-05 15:45:09">2024-04-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By Leo</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">I wish you to become your own sun, no need to rely on who's light.<p><a target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="åšå®¢æ¡†æ¶ä¸ºHexo"></a>&nbsp;<a target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="ä¸»é¢˜é‡‡ç”¨butterfly"></a>&nbsp;<a target="_blank" href="https://www.jsdelivr.com/"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="æœ¬ç«™ä½¿ç”¨JsDelivrä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ"></a> &nbsp;<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><img  src="https://img.shields.io/badge/%E8%B1%ABICP%E5%A4%87-2023001225-%23c41b6c" title="æœ¬ç«™å·²åŠ å…¥ICPè±ªåå¥—é¤ï¼Œè±«ICPå¤‡2023001225å·"></a>&nbsp;   <a target="_blank" href="https://vercel.com/ "><img src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&logo=Vercel" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œé»˜è®¤çº¿è·¯æ‰˜ç®¡äºVercel"></a>&nbsp;<a target="_blank" href="https://vercel.com/ "><img src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&logo=Codio" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œè”é€šçº¿è·¯æ‰˜ç®¡äºCoding"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="æœ¬ç«™é¡¹ç›®ç”±Gtihubæ‰˜ç®¡"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://my-twikoo-orpin.vercel.app/',
      region: 'ap-hangzhou',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://my-twikoo-orpin.vercel.app/',
      region: 'ap-hangzhou',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))

    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(init,0)
    else getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.31/dist/twikoo.all.min.js').then(init)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[å›¾ç‰‡]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[é“¾æ¥]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[ä»£ç ]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://my-twikoo-orpin.vercel.app/',
        region: 'ap-hangzhou',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "æ— æ³•è·å–è¯„è®ºï¼Œè¯·ç¡®è®¤ç›¸å…³é…ç½®æ˜¯å¦æ­£ç¡®"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.31/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'æ²¡æœ‰è¯„è®º'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async defer src="//at.alicdn.com/t/c/font_4495482_sjg6otfg7pd.js"></script><script defer src="/live2d-widget/autoload.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.22.1/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.65.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2024/04/05/Redisä»å…¥é—¨åˆ°å…¥åœŸ/ç¬¬01ç« _å¸¦ä½ èµ°è¿›Redisçš„ä¸–ç•Œ/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311909521.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-04-05</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2024/04/05/Redisä»å…¥é—¨åˆ°å…¥åœŸ/ç¬¬01ç« _å¸¦ä½ èµ°è¿›Redisçš„ä¸–ç•Œ/&quot;);" href="javascript:void(0);" alt="">é›¶ã€å¸¦ä½ èµ°è¿›Redisçš„ä¸–ç•Œ â­å¿…çœ‹å¿…çœ‹â­</a><div class="blog-slider__text">å­¦ä¹ Redisçš„å®‰è£…å’Œä½¿ç”¨çš„åœºæ™¯ï¼Œèƒ½å¤Ÿè§£å†³å“ªäº›é—®é¢˜~</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2024/04/05/Redisä»å…¥é—¨åˆ°å…¥åœŸ/ç¬¬01ç« _å¸¦ä½ èµ°è¿›Redisçš„ä¸–ç•Œ/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2024/04/05/MySQLä»å…¥é—¨åˆ°å…¥åœŸ/ç¬¬16ç«  ä¸»ä»å¤åˆ¶/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-04-05</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2024/04/05/MySQLä»å…¥é—¨åˆ°å…¥åœŸ/ç¬¬16ç«  ä¸»ä»å¤åˆ¶/&quot;);" href="javascript:void(0);" alt="">åå…­ã€ä¸»ä»å¤åˆ¶</a><div class="blog-slider__text">æœ¬æ–‡ä¸»è¦è®²è§£MySQLä¸»ä»å¤åˆ¶çš„æ­å»ºä»¥åŠåŸç†</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2024/04/05/MySQLä»å…¥é—¨åˆ°å…¥åœŸ/ç¬¬16ç«  ä¸»ä»å¤åˆ¶/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2024/04/05/JVMä»å…¥é—¨åˆ°ç²¾é€š/ç¬¬13ç« -åƒåœ¾å›æ”¶å™¨/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://blog-photos-lxy.oss-cn-hangzhou.aliyuncs.com/images/2023/7/202403311910777.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-04-05</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2024/04/05/JVMä»å…¥é—¨åˆ°ç²¾é€š/ç¬¬13ç« -åƒåœ¾å›æ”¶å™¨/&quot;);" href="javascript:void(0);" alt="">åä¸‰ã€åƒåœ¾å›æ”¶å™¨</a><div class="blog-slider__text">JVMä¸­æ‰€æœ‰çš„åƒåœ¾å›æ”¶å™¨ä»‹ç»</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2024/04/05/JVMä»å…¥é—¨åˆ°ç²¾é€š/ç¬¬13ç« -åƒåœ¾å›æ”¶å™¨/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var qweather_key = '2c87d9479d1c4b648370d9aec95714e2';
  var gaud_map_key = 'bd4b03777d348b0d98dd851e76f191dc';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '113.34532,23.15624';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>